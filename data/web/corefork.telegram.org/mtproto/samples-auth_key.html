<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 C8 CC 0A 00 C2 B0 D6 68
0010 | 14 00 00 00 F1 8E 7E BE 07 7B B2 0E 4C D4 19 64
0020 | EA D4 74 51 34 7D DC 71</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>C8CC0A00C2B0D668</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 14 62 1B C2 B0 D6 68
0010 | 50 00 00 00 63 24 16 05 07 7B B2 0E 4C D4 19 64
0020 | EA D4 74 51 34 7D DC 71 9B 97 1D D5 29 27 F8 5E
0030 | 4E 1E 69 10 51 AE 6C 5D 08 18 27 86 EE FD 63 6D
0040 | D5 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0114621BC2B0D668</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>08182786EEFD636DD5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1740508142013476309</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 1740508142013476309</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>1740508142013476309 = 1148520409 * 1515435101</code></p>
<pre><code>p = 1148520409
q = 1515435101</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 18 27 86 EE FD 63 6D D5 00 00 00
0010 | 04 44 75 07 D9 00 00 00 04 5A 53 B4 5D 00 00 00
0020 | 07 7B B2 0E 4C D4 19 64 EA D4 74 51 34 7D DC 71
0030 | 9B 97 1D D5 29 27 F8 5E 4E 1E 69 10 51 AE 6C 5D
0040 | 9C CF 50 AD 67 45 FD 5F 7D 86 9A D1 10 CA 8E FF
0050 | CF 9E E1 D9 7A 66 E0 70 95 8D 72 37 45 DB 78 24
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>08182786EEFD636DD5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1740508142013476309</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>04447507D9000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1148520409</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>045A53B45D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1515435101</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>9CCF50AD6745FD5F7D869AD110CA8EFF</code> <code>CF9EE1D97A66E070958D723745DB7824</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A908182786EEFD636DD500000004447507D9000000045A53B45D000000077BB20E4CD41964EAD47451347DDC719B971DD52927F85E4E1E691051AE6C5D9CCF50AD6745FD5F7D869AD110CA8EFFCF9EE1D97A66E070958D723745DB782402000000
random_padding_bytes = 7514EF45957C8694DA200509E5450FEC70207DCA31ADDD2954F81FF52CD01E2B37533636F40CA6A97954DD33480BC100A2CBCE679EA4303468C7034BD51020B39B6DDC5A3EF060AA5915815C93E4BBEED581C5AEA9DA50324C07093B</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 00AE4E21B1A824142C36258143838B7F91748B07E223D01E27DFFA830F5D85211471A6F5F863F5BC1B241929AE04E9CE2E681866DC82B7EF219A2E10E18A8C6ABEBD330C558FE34C608142FAED6A2A730F62249DE98D28D162274B7E7562DE72923041E9EA8706EFAC20AF5965E2C69FA5EE57AC47F023414F8B739C985A28D059669E9692F797023E832273829BEC7B7F841BC0173556104A065B005786CE08A77D948F1CBF5FAFA9400FFAB57D07AB6149D55CAD594A2F7B7EBD74918C8129A70AC67B89418ED7CEAB126F5BB31AE1460E44CE13C8E8FD31C6B4CC2A316D8941AA07ED583CFC656EDD0442F67D62820D61621F78907C3EBD2C067AAFC35775</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 B8 F0 0C 00 C2 B0 D6 68
0010 | 40 01 00 00 BE E4 12 D7 07 7B B2 0E 4C D4 19 64
0020 | EA D4 74 51 34 7D DC 71 9B 97 1D D5 29 27 F8 5E
0030 | 4E 1E 69 10 51 AE 6C 5D 04 44 75 07 D9 00 00 00
0040 | 04 5A 53 B4 5D 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 00 AE 4E 21 B1 A8 24 14 2C 36 25 81
0060 | 43 83 8B 7F 91 74 8B 07 E2 23 D0 1E 27 DF FA 83
0070 | 0F 5D 85 21 14 71 A6 F5 F8 63 F5 BC 1B 24 19 29
0080 | AE 04 E9 CE 2E 68 18 66 DC 82 B7 EF 21 9A 2E 10
0090 | E1 8A 8C 6A BE BD 33 0C 55 8F E3 4C 60 81 42 FA
00A0 | ED 6A 2A 73 0F 62 24 9D E9 8D 28 D1 62 27 4B 7E
00B0 | 75 62 DE 72 92 30 41 E9 EA 87 06 EF AC 20 AF 59
00C0 | 65 E2 C6 9F A5 EE 57 AC 47 F0 23 41 4F 8B 73 9C
00D0 | 98 5A 28 D0 59 66 9E 96 92 F7 97 02 3E 83 22 73
00E0 | 82 9B EC 7B 7F 84 1B C0 17 35 56 10 4A 06 5B 00
00F0 | 57 86 CE 08 A7 7D 94 8F 1C BF 5F AF A9 40 0F FA
0100 | B5 7D 07 AB 61 49 D5 5C AD 59 4A 2F 7B 7E BD 74
0110 | 91 8C 81 29 A7 0A C6 7B 89 41 8E D7 CE AB 12 6F
0120 | 5B B3 1A E1 46 0E 44 CE 13 C8 E8 FD 31 C6 B4 CC
0130 | 2A 31 6D 89 41 AA 07 ED 58 3C FC 65 6E DD 04 42
0140 | F6 7D 62 82 0D 61 62 1F 78 90 7C 3E BD 2C 06 7A
0150 | AF C3 57 75</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>B8F00C00C2B0D668</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>04447507D9000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1148520409</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>045A53B45D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1515435101</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE00010000AE4E21B1A824142C362581</code> <code>43838B7F91748B07E223D01E27DFFA83</code> <code>0F5D85211471A6F5F863F5BC1B241929</code> <code>AE04E9CE2E681866DC82B7EF219A2E10</code> <code>E18A8C6ABEBD330C558FE34C608142FA</code> <code>ED6A2A730F62249DE98D28D162274B7E</code> <code>7562DE72923041E9EA8706EFAC20AF59</code> <code>65E2C69FA5EE57AC47F023414F8B739C</code> <code>985A28D059669E9692F797023E832273</code> <code>829BEC7B7F841BC0173556104A065B00</code> <code>5786CE08A77D948F1CBF5FAFA9400FFA</code> <code>B57D07AB6149D55CAD594A2F7B7EBD74</code> <code>918C8129A70AC67B89418ED7CEAB126F</code> <code>5BB31AE1460E44CE13C8E8FD31C6B4CC</code> <code>2A316D8941AA07ED583CFC656EDD0442</code> <code>F67D62820D61621F78907C3EBD2C067A</code><br> <code>AFC35775</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 CC 43 41 C2 B0 D6 68
0010 | 78 02 00 00 5C 07 E8 D0 07 7B B2 0E 4C D4 19 64
0020 | EA D4 74 51 34 7D DC 71 9B 97 1D D5 29 27 F8 5E
0030 | 4E 1E 69 10 51 AE 6C 5D FE 50 02 00 E0 D6 56 97
0040 | A1 F6 2F 01 ED 66 98 CD D4 7F 80 8A C9 BC 45 AF
0050 | 5D B3 48 25 EE 54 A8 84 6E 8D D6 55 23 C2 57 D8
0060 | D5 4B 16 87 38 FA 41 ED 55 1B E5 86 9B 67 EF FD
0070 | 8C 12 55 4E FD 32 72 16 08 FF F4 42 F3 6A 0C EE
0080 | F4 71 88 6F D4 9C 15 8F 3A 83 69 51 EF 50 F5 4F
0090 | 34 61 75 58 52 51 CA 92 1D 60 9C C6 A2 30 CF 38
00A0 | 21 60 67 46 C2 A0 AE 6F 54 E0 49 EC 4F 6A 32 30
00B0 | 4F 31 4B D1 FD AA 32 C2 45 47 E1 38 62 E7 9D 15
00C0 | DF 29 2B 8E 58 C8 0A B0 BE 3F 89 A7 A0 77 51 25
00D0 | FB 68 3F 45 43 97 15 03 5F 7F 6E F6 9E E5 ED E7
00E0 | 01 E6 50 93 0D A6 09 3D 7F EE 44 2B 47 11 31 EB
00F0 | 2F EB 4D AB 9E D0 01 5E 38 05 91 B6 2E 4C 38 0D
0100 | 8F B5 A3 5B 65 3D 8B 1E FF 45 B8 5A B7 14 69 89
0110 | E3 93 A3 31 41 2D 0C 6B 63 9B 2F BC 35 5F 1D 00
0120 | 2A 13 A4 CE F9 82 0D 7C E3 C8 0A 30 E2 E9 0C 56
0130 | 65 91 4C 61 8D 34 19 68 38 09 6E F7 AA A3 8E 1B
0140 | 92 67 75 5C DF FA 02 3D 93 A7 BA 38 C9 7B 85 F9
0150 | 0C A4 DB A8 A8 5F E6 F1 C2 30 0D 5E C3 AA 8A 3C
0160 | D6 98 8C 64 E5 41 F6 53 93 7A D0 18 5D 87 D7 2D
0170 | 4F 95 57 C0 5B 4A 1E 87 2E 1E B4 AB EF FD B3 C6
0180 | F1 E1 FD 6A C3 41 E3 09 3E BE 49 87 9B 0A AB 98
0190 | 0E 9B D5 42 7A C8 7F 91 BD 03 F4 46 3E AB 59 FE
01A0 | 47 9F 67 C8 9A 3F 01 DE 20 9A 1C 76 CB F3 FC 72
01B0 | E1 BC DF A6 6D 3E 53 09 82 08 F1 DE 52 8B CC 2C
01C0 | 69 73 2A 47 09 74 9F B8 7B E1 FF 81 50 66 C1 C4
01D0 | A8 6F 41 7A F2 B9 35 82 3F E5 5A F1 7C 1E 6C 95
01E0 | 16 D2 87 59 AA 17 F1 E0 71 9A B7 57 C2 C1 B4 D8
01F0 | 8A 05 56 D6 F9 D0 62 6B C9 30 34 76 79 C3 9C 7F
0200 | 95 F0 A0 40 4E E7 AE 5E B1 96 DE B7 19 EC 1B 61
0210 | 61 0F 01 05 94 26 64 EC DF 92 D6 44 D5 FA 27 9E
0220 | AA F5 B9 EA 96 0D A4 91 BA 49 ED 8F D2 59 5A B7
0230 | 98 A4 88 FB FC 54 D4 7D C7 AE 48 07 D4 D2 46 F5
0240 | E2 4C 5A F3 E0 09 06 52 30 0A DD D8 9A C2 02 16
0250 | 0D 69 36 ED EA F6 FF B0 D8 62 AE 45 82 19 44 6C
0260 | BD 24 32 02 4D AD 31 04 9D 22 87 3E 56 E6 BE E9
0270 | 55 23 5A 1D 2A 89 FF FD 77 7D FB 35 09 91 B4 17
0280 | 8C FA E3 4A 2C 6B 50 E8 67 22 25 BB</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01CC4341C2B0D668</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200E0D65697A1F62F01ED6698CD</code> <code>D47F808AC9BC45AF5DB34825EE54A884</code> <code>6E8DD65523C257D8D54B168738FA41ED</code> <code>551BE5869B67EFFD8C12554EFD327216</code> <code>08FFF442F36A0CEEF471886FD49C158F</code> <code>3A836951EF50F54F346175585251CA92</code> <code>1D609CC6A230CF3821606746C2A0AE6F</code> <code>54E049EC4F6A32304F314BD1FDAA32C2</code> <code>4547E13862E79D15DF292B8E58C80AB0</code> <code>BE3F89A7A0775125FB683F4543971503</code> <code>5F7F6EF69EE5EDE701E650930DA6093D</code> <code>7FEE442B471131EB2FEB4DAB9ED0015E</code> <code>380591B62E4C380D8FB5A35B653D8B1E</code> <code>FF45B85AB7146989E393A331412D0C6B</code> <code>639B2FBC355F1D002A13A4CEF9820D7C</code> <code>E3C80A30E2E90C5665914C618D341968</code> <code>38096EF7AAA38E1B9267755CDFFA023D</code> <code>93A7BA38C97B85F90CA4DBA8A85FE6F1</code> <code>C2300D5EC3AA8A3CD6988C64E541F653</code> <code>937AD0185D87D72D4F9557C05B4A1E87</code> <code>2E1EB4ABEFFDB3C6F1E1FD6AC341E309</code> <code>3EBE49879B0AAB980E9BD5427AC87F91</code> <code>BD03F4463EAB59FE479F67C89A3F01DE</code> <code>209A1C76CBF3FC72E1BCDFA66D3E5309</code> <code>8208F1DE528BCC2C69732A4709749FB8</code> <code>7BE1FF815066C1C4A86F417AF2B93582</code> <code>3FE55AF17C1E6C9516D28759AA17F1E0</code> <code>719AB757C2C1B4D88A0556D6F9D0626B</code> <code>C930347679C39C7F95F0A0404EE7AE5E</code> <code>B196DEB719EC1B61610F0105942664EC</code> <code>DF92D644D5FA279EAAF5B9EA960DA491</code> <code>BA49ED8FD2595AB798A488FBFC54D47D</code> <code>C7AE4807D4D246F5E24C5AF3E0090652</code> <code>300ADDD89AC202160D6936EDEAF6FFB0</code> <code>D862AE458219446CBD2432024DAD3104</code> <code>9D22873E56E6BEE955235A1D2A89FFFD</code> <code>777DFB350991B4178CFAE34A2C6B50E8</code><br> <code>672225BB</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = E0D65697A1F62F01ED6698CDD47F808AC9BC45AF5DB34825EE54A8846E8DD65523C257D8D54B168738FA41ED551BE5869B67EFFD8C12554EFD32721608FFF442F36A0CEEF471886FD49C158F3A836951EF50F54F346175585251CA921D609CC6A230CF3821606746C2A0AE6F54E049EC4F6A32304F314BD1FDAA32C24547E13862E79D15DF292B8E58C80AB0BE3F89A7A0775125FB683F45439715035F7F6EF69EE5EDE701E650930DA6093D7FEE442B471131EB2FEB4DAB9ED0015E380591B62E4C380D8FB5A35B653D8B1EFF45B85AB7146989E393A331412D0C6B639B2FBC355F1D002A13A4CEF9820D7CE3C80A30E2E90C5665914C618D34196838096EF7AAA38E1B9267755CDFFA023D93A7BA38C97B85F90CA4DBA8A85FE6F1C2300D5EC3AA8A3CD6988C64E541F653937AD0185D87D72D4F9557C05B4A1E872E1EB4ABEFFDB3C6F1E1FD6AC341E3093EBE49879B0AAB980E9BD5427AC87F91BD03F4463EAB59FE479F67C89A3F01DE209A1C76CBF3FC72E1BCDFA66D3E53098208F1DE528BCC2C69732A4709749FB87BE1FF815066C1C4A86F417AF2B935823FE55AF17C1E6C9516D28759AA17F1E0719AB757C2C1B4D88A0556D6F9D0626BC930347679C39C7F95F0A0404EE7AE5EB196DEB719EC1B61610F0105942664ECDF92D644D5FA279EAAF5B9EA960DA491BA49ED8FD2595AB798A488FBFC54D47DC7AE4807D4D246F5E24C5AF3E0090652300ADDD89AC202160D6936EDEAF6FFB0D862AE458219446CBD2432024DAD31049D22873E56E6BEE955235A1D2A89FFFD777DFB350991B4178CFAE34A2C6B50E8672225BB
tmp_aes_key = 7DA709BA763ECB988E307B8A2A79ECF755B4671DCCA88C7119851AD0A963E72B
tmp_aes_iv = A4B59F542ED2CB666EC7CF2C2D94FD301F894CB30B226D022C58AEEA9CCF50AD</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 22259D5761DAE466DA56177C12CC8345D12F6F91BA0D89B5077BB20E4CD41964EAD47451347DDC719B971DD52927F85E4E1E691051AE6C5D03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001009C3CE8DBCEA63A0B68F4ACEC8DE74C6EFFE78C219FE0FF63D9A40722AF31312AA7FD059837AB6553CE7746EB7F7CC267CD081E691A32A22AA8E085D96249E51DAC848A2EDAD222D71F735DD94139BD1063F573BC9BADF5D336ABDAF3122A6645A1D57C9855A6E121400B25E79BCE54173A4F2DE451961EAA5D3E558044939DCB3D505E04F7F48B705D6D1CB52FED9ADD1284EF43E9AB71CAFA646F2A41F104C9F3B79A6577509E7A92988CB39BFCD43BD9EDBCE3DA57BAF104F512BC9E2AE50278AEF4DFAAEC1665F6D2D264FAEF35BE0C56F729A9B5B8EFE6BE5C962C8067096F7DC052C984263CAA85FB960575210E51660E7F44534FD5D0F079B6E2D2228AC2B0D6687E0A9A00D4364B23
answer = BA0D89B5077BB20E4CD41964EAD47451347DDC719B971DD52927F85E4E1E691051AE6C5D03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001009C3CE8DBCEA63A0B68F4ACEC8DE74C6EFFE78C219FE0FF63D9A40722AF31312AA7FD059837AB6553CE7746EB7F7CC267CD081E691A32A22AA8E085D96249E51DAC848A2EDAD222D71F735DD94139BD1063F573BC9BADF5D336ABDAF3122A6645A1D57C9855A6E121400B25E79BCE54173A4F2DE451961EAA5D3E558044939DCB3D505E04F7F48B705D6D1CB52FED9ADD1284EF43E9AB71CAFA646F2A41F104C9F3B79A6577509E7A92988CB39BFCD43BD9EDBCE3DA57BAF104F512BC9E2AE50278AEF4DFAAEC1665F6D2D264FAEF35BE0C56F729A9B5B8EFE6BE5C962C8067096F7DC052C984263CAA85FB960575210E51660E7F44534FD5D0F079B6E2D2228AC2B0D6687E0A9A00D4364B23</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 07 7B B2 0E 4C D4 19 64 EA D4 74 51
0010 | 34 7D DC 71 9B 97 1D D5 29 27 F8 5E 4E 1E 69 10
0020 | 51 AE 6C 5D 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 9C 3C E8 DB CE A6 3A 0B 68 F4 AC EC 8D E7 4C 6E
0140 | FF E7 8C 21 9F E0 FF 63 D9 A4 07 22 AF 31 31 2A
0150 | A7 FD 05 98 37 AB 65 53 CE 77 46 EB 7F 7C C2 67
0160 | CD 08 1E 69 1A 32 A2 2A A8 E0 85 D9 62 49 E5 1D
0170 | AC 84 8A 2E DA D2 22 D7 1F 73 5D D9 41 39 BD 10
0180 | 63 F5 73 BC 9B AD F5 D3 36 AB DA F3 12 2A 66 45
0190 | A1 D5 7C 98 55 A6 E1 21 40 0B 25 E7 9B CE 54 17
01A0 | 3A 4F 2D E4 51 96 1E AA 5D 3E 55 80 44 93 9D CB
01B0 | 3D 50 5E 04 F7 F4 8B 70 5D 6D 1C B5 2F ED 9A DD
01C0 | 12 84 EF 43 E9 AB 71 CA FA 64 6F 2A 41 F1 04 C9
01D0 | F3 B7 9A 65 77 50 9E 7A 92 98 8C B3 9B FC D4 3B
01E0 | D9 ED BC E3 DA 57 BA F1 04 F5 12 BC 9E 2A E5 02
01F0 | 78 AE F4 DF AA EC 16 65 F6 D2 D2 64 FA EF 35 BE
0200 | 0C 56 F7 29 A9 B5 B8 EF E6 BE 5C 96 2C 80 67 09
0210 | 6F 7D C0 52 C9 84 26 3C AA 85 FB 96 05 75 21 0E
0220 | 51 66 0E 7F 44 53 4F D5 D0 F0 79 B6 E2 D2 22 8A
0230 | C2 B0 D6 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE0001009C3CE8DBCEA63A0B68F4ACEC</code> <code>8DE74C6EFFE78C219FE0FF63D9A40722</code> <code>AF31312AA7FD059837AB6553CE7746EB</code> <code>7F7CC267CD081E691A32A22AA8E085D9</code> <code>6249E51DAC848A2EDAD222D71F735DD9</code> <code>4139BD1063F573BC9BADF5D336ABDAF3</code> <code>122A6645A1D57C9855A6E121400B25E7</code> <code>9BCE54173A4F2DE451961EAA5D3E5580</code> <code>44939DCB3D505E04F7F48B705D6D1CB5</code> <code>2FED9ADD1284EF43E9AB71CAFA646F2A</code> <code>41F104C9F3B79A6577509E7A92988CB3</code> <code>9BFCD43BD9EDBCE3DA57BAF104F512BC</code> <code>9E2AE50278AEF4DFAAEC1665F6D2D264</code> <code>FAEF35BE0C56F729A9B5B8EFE6BE5C96</code> <code>2C8067096F7DC052C984263CAA85FB96</code> <code>0575210E51660E7F44534FD5D0F079B6</code><br> <code>E2D2228A</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>C2B0D668</code> (1758900418 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 7B30C56D265669165C506CB59AF308409D12302A0FF6B2AB38CF2C27DC8A80CCD17E31BD0740CD2E357BE66D420F221C64A6F1469907ADF61C0B2C8967AE9665C16FF3761324691375A4EB4E4FD9D6D631BC440AAAAC487D6C763BEA0F4A7084E5104809575C917C3F7F799A2E85C89BF56555745EAE30AFB4FA9B12E42EEA5A66A4D3E095DA10C9ECD5B19B8A3E1969476F171C204281009D8CF7C0539554C6A7DF5121AD48425E2465990044F610037EE3AD2C39FA1A08D57B868997A182FAA5E86746B9ABDC104FA19EA974DF5F0EDD8FF12B3C3954E161DB7E73923D7B4B71D8037AA1A3972498ADBD680122CEC255DB3145683B4DEE5A857EB166BF6030</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 292ABAD1D1E9B897D22D46CC37A1AF675B345E6A46BB674B35538E8EF8C66A374CA74DF2997918D126525C78A092D64F830E94E4AAEF5A9D40EA25D5BC8BC48A980EB89F70C278EB4D7A27E85E1DB003124297EACF963C6556D24A11C187D3302F7C9EE5FA2E1FB3B83D3ED559DEE058B497341A2BBA6F6BFC196EDC26A94F2B77083EE27BF75F3901E87F69B2FEA14E3CC9B3FC03C941585B99BD01BC3B02C83D8BCAEFD2F706E65489A1C544AA26FF15C298F728DA5126C6FB3148CBE07857E1D734593DC5A778B0BDF990E06F19DF0B97E6EECCC244B5A9EC0DAE1CB88FA8DF91F70CE7D6B5F5E2AEE93AFD7569BA6D119212A0365946843A86A1D209092D</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 07 7B B2 0E 4C D4 19 64 EA D4 74 51
0010 | 34 7D DC 71 9B 97 1D D5 29 27 F8 5E 4E 1E 69 10
0020 | 51 AE 6C 5D 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 29 2A BA D1 D1 E9 B8 97 D2 2D 46 CC 37 A1 AF 67
0040 | 5B 34 5E 6A 46 BB 67 4B 35 53 8E 8E F8 C6 6A 37
0050 | 4C A7 4D F2 99 79 18 D1 26 52 5C 78 A0 92 D6 4F
0060 | 83 0E 94 E4 AA EF 5A 9D 40 EA 25 D5 BC 8B C4 8A
0070 | 98 0E B8 9F 70 C2 78 EB 4D 7A 27 E8 5E 1D B0 03
0080 | 12 42 97 EA CF 96 3C 65 56 D2 4A 11 C1 87 D3 30
0090 | 2F 7C 9E E5 FA 2E 1F B3 B8 3D 3E D5 59 DE E0 58
00A0 | B4 97 34 1A 2B BA 6F 6B FC 19 6E DC 26 A9 4F 2B
00B0 | 77 08 3E E2 7B F7 5F 39 01 E8 7F 69 B2 FE A1 4E
00C0 | 3C C9 B3 FC 03 C9 41 58 5B 99 BD 01 BC 3B 02 C8
00D0 | 3D 8B CA EF D2 F7 06 E6 54 89 A1 C5 44 AA 26 FF
00E0 | 15 C2 98 F7 28 DA 51 26 C6 FB 31 48 CB E0 78 57
00F0 | E1 D7 34 59 3D C5 A7 78 B0 BD F9 90 E0 6F 19 DF
0100 | 0B 97 E6 EE CC C2 44 B5 A9 EC 0D AE 1C B8 8F A8
0110 | DF 91 F7 0C E7 D6 B5 F5 E2 AE E9 3A FD 75 69 BA
0120 | 6D 11 92 12 A0 36 59 46 84 3A 86 A1 D2 09 09 2D</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100292ABAD1D1E9B897D22D46CC</code> <code>37A1AF675B345E6A46BB674B35538E8E</code> <code>F8C66A374CA74DF2997918D126525C78</code> <code>A092D64F830E94E4AAEF5A9D40EA25D5</code> <code>BC8BC48A980EB89F70C278EB4D7A27E8</code> <code>5E1DB003124297EACF963C6556D24A11</code> <code>C187D3302F7C9EE5FA2E1FB3B83D3ED5</code> <code>59DEE058B497341A2BBA6F6BFC196EDC</code> <code>26A94F2B77083EE27BF75F3901E87F69</code> <code>B2FEA14E3CC9B3FC03C941585B99BD01</code> <code>BC3B02C83D8BCAEFD2F706E65489A1C5</code> <code>44AA26FF15C298F728DA5126C6FB3148</code> <code>CBE07857E1D734593DC5A778B0BDF990</code> <code>E06F19DF0B97E6EECCC244B5A9EC0DAE</code> <code>1CB88FA8DF91F70CE7D6B5F5E2AEE93A</code> <code>FD7569BA6D119212A0365946843A86A1</code><br> <code>D209092D</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366077BB20E4CD41964EAD47451347DDC719B971DD52927F85E4E1E691051AE6C5D0000000000000000FE000100292ABAD1D1E9B897D22D46CC37A1AF675B345E6A46BB674B35538E8EF8C66A374CA74DF2997918D126525C78A092D64F830E94E4AAEF5A9D40EA25D5BC8BC48A980EB89F70C278EB4D7A27E85E1DB003124297EACF963C6556D24A11C187D3302F7C9EE5FA2E1FB3B83D3ED559DEE058B497341A2BBA6F6BFC196EDC26A94F2B77083EE27BF75F3901E87F69B2FEA14E3CC9B3FC03C941585B99BD01BC3B02C83D8BCAEFD2F706E65489A1C544AA26FF15C298F728DA5126C6FB3148CBE07857E1D734593DC5A778B0BDF990E06F19DF0B97E6EECCC244B5A9EC0DAE1CB88FA8DF91F70CE7D6B5F5E2AEE93AFD7569BA6D119212A0365946843A86A1D209092D
padding = 85895416FA6D9BCA157145B6
tmp_aes_key = 7DA709BA763ECB988E307B8A2A79ECF755B4671DCCA88C7119851AD0A963E72B
tmp_aes_iv = A4B59F542ED2CB666EC7CF2C2D94FD301F894CB30B226D022C58AEEA9CCF50AD</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = EABD8B0EF0E648B34C641B333AE8AE7E0E533F447D7859E130885144EE3917251E950A8356DA0C22A395785CEDB30BFAE45ECACCAE87E5374EE79003D0C29966210FC8815D3CAB789429016174DF3D9D51E2B1A280E422425604CD994FA1432778981A6FA88CD36C88A11B60B540AA7A1891C93B5FD2945C04BE07AD792DD631FB66D31E514E7D2F72112E792EB57A41268F34C3AFCB65C51EFDE3E15D31B37F843DCF94006AD00A936E42B745E35630BBBB853C24295EA62D48D5E96A84B2AC3E1B4744C1023ADDE7917E7FFCC4E21E0E4C28DC78D5092A78B55F147BBFEAA535F9ED03B8A1397BE20B5FD34FDA710399788DB65971C46CE477CE47F274BE3E97924A2456333CCDA7377BFAEDA9E3E48581192AB0E2C422B6137CC02E5BA48E29D6C83325A7467FA1E905AED84093DB76B797C340486B40C07FE5A656D47DCC96C08D4B69DD9261395A36854FA982B3</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 BC F0 0C 00 C2 B0 D6 68
0010 | 78 01 00 00 1F 5F 04 F5 07 7B B2 0E 4C D4 19 64
0020 | EA D4 74 51 34 7D DC 71 9B 97 1D D5 29 27 F8 5E
0030 | 4E 1E 69 10 51 AE 6C 5D FE 50 01 00 EA BD 8B 0E
0040 | F0 E6 48 B3 4C 64 1B 33 3A E8 AE 7E 0E 53 3F 44
0050 | 7D 78 59 E1 30 88 51 44 EE 39 17 25 1E 95 0A 83
0060 | 56 DA 0C 22 A3 95 78 5C ED B3 0B FA E4 5E CA CC
0070 | AE 87 E5 37 4E E7 90 03 D0 C2 99 66 21 0F C8 81
0080 | 5D 3C AB 78 94 29 01 61 74 DF 3D 9D 51 E2 B1 A2
0090 | 80 E4 22 42 56 04 CD 99 4F A1 43 27 78 98 1A 6F
00A0 | A8 8C D3 6C 88 A1 1B 60 B5 40 AA 7A 18 91 C9 3B
00B0 | 5F D2 94 5C 04 BE 07 AD 79 2D D6 31 FB 66 D3 1E
00C0 | 51 4E 7D 2F 72 11 2E 79 2E B5 7A 41 26 8F 34 C3
00D0 | AF CB 65 C5 1E FD E3 E1 5D 31 B3 7F 84 3D CF 94
00E0 | 00 6A D0 0A 93 6E 42 B7 45 E3 56 30 BB BB 85 3C
00F0 | 24 29 5E A6 2D 48 D5 E9 6A 84 B2 AC 3E 1B 47 44
0100 | C1 02 3A DD E7 91 7E 7F FC C4 E2 1E 0E 4C 28 DC
0110 | 78 D5 09 2A 78 B5 5F 14 7B BF EA A5 35 F9 ED 03
0120 | B8 A1 39 7B E2 0B 5F D3 4F DA 71 03 99 78 8D B6
0130 | 59 71 C4 6C E4 77 CE 47 F2 74 BE 3E 97 92 4A 24
0140 | 56 33 3C CD A7 37 7B FA ED A9 E3 E4 85 81 19 2A
0150 | B0 E2 C4 22 B6 13 7C C0 2E 5B A4 8E 29 D6 C8 33
0160 | 25 A7 46 7F A1 E9 05 AE D8 40 93 DB 76 B7 97 C3
0170 | 40 48 6B 40 C0 7F E5 A6 56 D4 7D CC 96 C0 8D 4B
0180 | 69 DD 92 61 39 5A 36 85 4F A9 82 B3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>BCF00C00C2B0D668</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100EABD8B0EF0E648B34C641B33</code> <code>3AE8AE7E0E533F447D7859E130885144</code> <code>EE3917251E950A8356DA0C22A395785C</code> <code>EDB30BFAE45ECACCAE87E5374EE79003</code> <code>D0C29966210FC8815D3CAB7894290161</code> <code>74DF3D9D51E2B1A280E422425604CD99</code> <code>4FA1432778981A6FA88CD36C88A11B60</code> <code>B540AA7A1891C93B5FD2945C04BE07AD</code> <code>792DD631FB66D31E514E7D2F72112E79</code> <code>2EB57A41268F34C3AFCB65C51EFDE3E1</code> <code>5D31B37F843DCF94006AD00A936E42B7</code> <code>45E35630BBBB853C24295EA62D48D5E9</code> <code>6A84B2AC3E1B4744C1023ADDE7917E7F</code> <code>FCC4E21E0E4C28DC78D5092A78B55F14</code> <code>7BBFEAA535F9ED03B8A1397BE20B5FD3</code> <code>4FDA710399788DB65971C46CE477CE47</code> <code>F274BE3E97924A2456333CCDA7377BFA</code> <code>EDA9E3E48581192AB0E2C422B6137CC0</code> <code>2E5BA48E29D6C83325A7467FA1E905AE</code> <code>D84093DB76B797C340486B40C07FE5A6</code> <code>56D47DCC96C08D4B69DD9261395A3685</code><br> <code>4FA982B3</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 942936329A989023DD568B4F7D306339B79379F8619F82E9EE938A8EC7182541088A45BFDF38543CDEA6F58F4F56C31B1D33441619906C4B5259B0090EB0FD4F29466FEE1D6E0CFED88CA913FC2B666949662909A02E43822BE8FC92E21E1D1387E3CA89C1B5FDBF81FDDB8D8CEB130A0C670A4D270EF3BE01B74DA5D26C0FC1A75B9EB5D8FF46B0788AAC9A18F31E9888AD4A2B15F5E0DABFC8E7ED199F459BA98066B8B2F7DF823A4EE55B7327496B0644ED321B1F2ED233071DA20FE27E24DF153B76407E114D46AAC4FDA7E1E503AC0940AADA437BA9235E863D69B7141330336A17C0C9F788ADD32DFD16512E30A7E000EC71F3084426A6A8C1BD792536</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 9C 34 C8 C3 B0 D6 68
0010 | 34 00 00 00 34 F7 CB 3B 07 7B B2 0E 4C D4 19 64
0020 | EA D4 74 51 34 7D DC 71 9B 97 1D D5 29 27 F8 5E
0030 | 4E 1E 69 10 51 AE 6C 5D 91 D0 4B 5D 35 24 10 23
0040 | EA 45 AC 5D CF 88 2E 29</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>019C34C8C3B0D668</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>077BB20E4CD41964EAD47451347DDC71</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>9B971DD52927F85E4E1E691051AE6C5D</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>91D04B5D35241023EA45AC5DCF882E29</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

