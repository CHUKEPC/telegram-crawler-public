<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 40 78 06 00 7D 67 D2 68
0010 | 14 00 00 00 F1 8E 7E BE 42 2B 39 5C 3B 39 10 F0
0020 | 9E 3B 55 90 AC E0 DE 74</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>407806007D67D268</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 40 C2 A1 7D 67 D2 68
0010 | 50 00 00 00 63 24 16 05 42 2B 39 5C 3B 39 10 F0
0020 | 9E 3B 55 90 AC E0 DE 74 F2 A8 61 62 89 31 E0 42
0030 | B3 DA B3 B2 63 62 34 18 08 24 4F DE BD A2 1B AA
0040 | 95 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0140C2A17D67D268</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>08244FDEBDA21BAA95000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2616554814575454869</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2616554814575454869</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2616554814575454869 = 1421119519 * 1841192651</code></p>
<pre><code>p = 1421119519
q = 1841192651</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 24 4F DE BD A2 1B AA 95 00 00 00
0010 | 04 54 B4 90 1F 00 00 00 04 6D BE 5E CB 00 00 00
0020 | 42 2B 39 5C 3B 39 10 F0 9E 3B 55 90 AC E0 DE 74
0030 | F2 A8 61 62 89 31 E0 42 B3 DA B3 B2 63 62 34 18
0040 | 84 D8 A2 BB 12 96 96 DC 95 54 84 C7 BF F3 28 A4
0050 | 7A DC 1B 24 54 29 C2 2D FF 17 AF 2B 96 EC 72 CB
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>08244FDEBDA21BAA95000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2616554814575454869</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>0454B4901F000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1421119519</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046DBE5ECB000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1841192651</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>84D8A2BB129696DC955484C7BFF328A4</code> <code>7ADC1B245429C22DFF17AF2B96EC72CB</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A908244FDEBDA21BAA950000000454B4901F000000046DBE5ECB000000422B395C3B3910F09E3B5590ACE0DE74F2A861628931E042B3DAB3B26362341884D8A2BB129696DC955484C7BFF328A47ADC1B245429C22DFF17AF2B96EC72CB02000000
random_padding_bytes = 5025B7634DB86626A6DFC93D4B87CAA1CFCDB67B60CF82BF2F71D6A3AB4892FE39A40079FD905B714E57DA0263F624B33F4025C526F97CEFA9AA4D3E86FE0B2FBC74D7FB9342EBBAA12CF8D2733729A5019C80E13C85D3DF4012B2E4</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = A1639BEEA3C948C96BD670E15A2791F00418D6D0E82BA0C1DDD28A22D300160CBDC7EC33CC9E2F039AB77E9755A621E56B5EEA1820212C90C885668E69D03E5EF0899D81B275A942B9BBA6AE5914EA2675A59E41E65920AE63A632CB04DBD464CD0B6D2A0B63ACC88AD2ABF384A80A5D3B40A87C7A9CFBFE1656E7BC77B4C16A6CDFBA07586D41EB04B4B1330A38E5706B8113BA8D07FD8CA0A101BF2A6A674A7659AEB491B420AF5C059EE2F3E8E4DC3D7A720B1B9248AB13FA39860A5544BFFF228DBB58C69B4A9EAE6512FACAE2A3C12CF3FC559DACBB95F71530684CB99C6B9034774608DB61AB6C7FD7A9B145D900F0472C984213605EB3CD5A18D4DA89</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 DC 10 0A 00 7D 67 D2 68
0010 | 40 01 00 00 BE E4 12 D7 42 2B 39 5C 3B 39 10 F0
0020 | 9E 3B 55 90 AC E0 DE 74 F2 A8 61 62 89 31 E0 42
0030 | B3 DA B3 B2 63 62 34 18 04 54 B4 90 1F 00 00 00
0040 | 04 6D BE 5E CB 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 A1 63 9B EE A3 C9 48 C9 6B D6 70 E1
0060 | 5A 27 91 F0 04 18 D6 D0 E8 2B A0 C1 DD D2 8A 22
0070 | D3 00 16 0C BD C7 EC 33 CC 9E 2F 03 9A B7 7E 97
0080 | 55 A6 21 E5 6B 5E EA 18 20 21 2C 90 C8 85 66 8E
0090 | 69 D0 3E 5E F0 89 9D 81 B2 75 A9 42 B9 BB A6 AE
00A0 | 59 14 EA 26 75 A5 9E 41 E6 59 20 AE 63 A6 32 CB
00B0 | 04 DB D4 64 CD 0B 6D 2A 0B 63 AC C8 8A D2 AB F3
00C0 | 84 A8 0A 5D 3B 40 A8 7C 7A 9C FB FE 16 56 E7 BC
00D0 | 77 B4 C1 6A 6C DF BA 07 58 6D 41 EB 04 B4 B1 33
00E0 | 0A 38 E5 70 6B 81 13 BA 8D 07 FD 8C A0 A1 01 BF
00F0 | 2A 6A 67 4A 76 59 AE B4 91 B4 20 AF 5C 05 9E E2
0100 | F3 E8 E4 DC 3D 7A 72 0B 1B 92 48 AB 13 FA 39 86
0110 | 0A 55 44 BF FF 22 8D BB 58 C6 9B 4A 9E AE 65 12
0120 | FA CA E2 A3 C1 2C F3 FC 55 9D AC BB 95 F7 15 30
0130 | 68 4C B9 9C 6B 90 34 77 46 08 DB 61 AB 6C 7F D7
0140 | A9 B1 45 D9 00 F0 47 2C 98 42 13 60 5E B3 CD 5A
0150 | 18 D4 DA 89</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>DC100A007D67D268</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>0454B4901F000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1421119519</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046DBE5ECB000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1841192651</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE000100A1639BEEA3C948C96BD670E1</code> <code>5A2791F00418D6D0E82BA0C1DDD28A22</code> <code>D300160CBDC7EC33CC9E2F039AB77E97</code> <code>55A621E56B5EEA1820212C90C885668E</code> <code>69D03E5EF0899D81B275A942B9BBA6AE</code> <code>5914EA2675A59E41E65920AE63A632CB</code> <code>04DBD464CD0B6D2A0B63ACC88AD2ABF3</code> <code>84A80A5D3B40A87C7A9CFBFE1656E7BC</code> <code>77B4C16A6CDFBA07586D41EB04B4B133</code> <code>0A38E5706B8113BA8D07FD8CA0A101BF</code> <code>2A6A674A7659AEB491B420AF5C059EE2</code> <code>F3E8E4DC3D7A720B1B9248AB13FA3986</code> <code>0A5544BFFF228DBB58C69B4A9EAE6512</code> <code>FACAE2A3C12CF3FC559DACBB95F71530</code> <code>684CB99C6B9034774608DB61AB6C7FD7</code> <code>A9B145D900F0472C984213605EB3CD5A</code><br> <code>18D4DA89</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 3C E4 D4 7D 67 D2 68
0010 | 78 02 00 00 5C 07 E8 D0 42 2B 39 5C 3B 39 10 F0
0020 | 9E 3B 55 90 AC E0 DE 74 F2 A8 61 62 89 31 E0 42
0030 | B3 DA B3 B2 63 62 34 18 FE 50 02 00 34 55 12 BC
0040 | 0B B4 47 79 7F EA 75 0B C2 81 52 A4 6A 73 07 86
0050 | 26 3B 96 E6 A1 F0 80 85 29 FF 4B BB 23 5F D0 BD
0060 | 90 A9 A1 8E 46 3C A5 A4 E9 0E 5F 1D F6 B0 04 52
0070 | 0A 8E 46 11 D6 24 14 0B 48 AE B1 F9 6A 94 4A 1C
0080 | 2F 2A A5 A1 F9 DC 97 99 3C F8 59 58 45 AA 23 C5
0090 | 5B D6 F0 10 A2 B0 0F 0B F9 97 A3 20 EB 00 14 9F
00A0 | CB 3F A2 5F 14 1F C1 79 12 6D 45 3E C4 C9 B1 D3
00B0 | 4F 28 BA F1 A8 CD C0 D3 74 69 A7 D2 BB FF AD 04
00C0 | C0 B5 D4 57 0E D8 16 9C 87 84 CD 8E C1 9B CC 3A
00D0 | 71 F7 96 6F 1A 76 89 E6 93 81 56 5E A7 76 06 B2
00E0 | 87 D7 D8 FB 7E 4B 6C 15 77 4B 15 9C E0 D8 D3 90
00F0 | A7 CF B0 E4 7F 45 4F 88 34 6A 44 57 39 DE 02 62
0100 | D0 02 71 0F C4 0E 4A AA D7 A8 BA B0 81 C6 56 7A
0110 | 6B A6 7E D3 54 8B BF 64 05 E8 29 53 54 0A 2D 37
0120 | 16 CF F5 A2 15 19 36 0A B6 D5 70 44 FB E6 8F C0
0130 | 00 42 08 D9 40 8B 74 2B 20 B7 E7 7D E2 60 B4 F6
0140 | 48 16 DE 3F DE 12 C1 D6 E3 47 F7 ED 03 7F DF D6
0150 | 13 D9 AE 4A 52 1D B3 0C 08 AD 83 C8 57 67 53 E4
0160 | 9D F7 12 81 73 B7 DF 9D 99 B0 C1 40 A8 EE 23 A7
0170 | 67 BC 4F 6E 10 5C 01 24 C1 89 C6 65 7A FE EA 5A
0180 | 76 E5 16 50 A9 4D F9 2F 65 F9 17 48 77 48 21 DA
0190 | 53 A8 63 6A 45 E5 1D D1 ED 41 9C C6 7B 11 ED 4B
01A0 | 04 E1 20 69 1D BD 19 EC C5 FF B0 6E 42 C2 65 0E
01B0 | 65 EE 07 25 71 86 4B 98 8B 34 DF 47 BE 7A B6 61
01C0 | 60 CB F4 91 0F FC 82 97 F1 62 77 AC D0 1C CE 65
01D0 | DF B5 1D 0D 5F 73 D4 57 45 5D 95 93 6F 00 CF 5A
01E0 | 6A 9A 66 C8 9A 44 78 82 57 3F 81 16 06 9F C4 1C
01F0 | 63 DA 2F 51 99 52 5F 16 76 6C 8B CB CE F1 6D 69
0200 | FA 95 5F E5 0C 79 11 E9 81 71 0C 75 AB F8 10 DA
0210 | 7C 74 4C C1 D7 95 BF 72 27 CE BA 7E FD 4A BC 23
0220 | F1 88 8F A8 59 B4 00 71 B6 54 9B 9B 92 D9 5A CA
0230 | 2C B8 5B EE 1B 51 A9 F3 E4 A9 8A 2F D2 87 94 49
0240 | 9E 21 5E 9A 1A 69 48 42 6B 3D 17 07 C1 0F 3C 0D
0250 | 0D 70 AE 91 C3 B3 9B B1 78 BB B0 C3 C3 75 E9 63
0260 | 33 BA EA A0 1C 40 F6 6A 41 3D 2D 71 37 B9 14 B4
0270 | 68 B9 EE AE 22 94 30 30 07 E1 03 4D E4 26 1C 7B
0280 | 87 D2 F3 4C 29 32 0C 1A CB D8 C9 D6</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>013CE4D47D67D268</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200345512BC0BB447797FEA750B</code> <code>C28152A46A730786263B96E6A1F08085</code> <code>29FF4BBB235FD0BD90A9A18E463CA5A4</code> <code>E90E5F1DF6B004520A8E4611D624140B</code> <code>48AEB1F96A944A1C2F2AA5A1F9DC9799</code> <code>3CF8595845AA23C55BD6F010A2B00F0B</code> <code>F997A320EB00149FCB3FA25F141FC179</code> <code>126D453EC4C9B1D34F28BAF1A8CDC0D3</code> <code>7469A7D2BBFFAD04C0B5D4570ED8169C</code> <code>8784CD8EC19BCC3A71F7966F1A7689E6</code> <code>9381565EA77606B287D7D8FB7E4B6C15</code> <code>774B159CE0D8D390A7CFB0E47F454F88</code> <code>346A445739DE0262D002710FC40E4AAA</code> <code>D7A8BAB081C6567A6BA67ED3548BBF64</code> <code>05E82953540A2D3716CFF5A21519360A</code> <code>B6D57044FBE68FC0004208D9408B742B</code> <code>20B7E77DE260B4F64816DE3FDE12C1D6</code> <code>E347F7ED037FDFD613D9AE4A521DB30C</code> <code>08AD83C8576753E49DF7128173B7DF9D</code> <code>99B0C140A8EE23A767BC4F6E105C0124</code> <code>C189C6657AFEEA5A76E51650A94DF92F</code> <code>65F91748774821DA53A8636A45E51DD1</code> <code>ED419CC67B11ED4B04E120691DBD19EC</code> <code>C5FFB06E42C2650E65EE072571864B98</code> <code>8B34DF47BE7AB66160CBF4910FFC8297</code> <code>F16277ACD01CCE65DFB51D0D5F73D457</code> <code>455D95936F00CF5A6A9A66C89A447882</code> <code>573F8116069FC41C63DA2F5199525F16</code> <code>766C8BCBCEF16D69FA955FE50C7911E9</code> <code>81710C75ABF810DA7C744CC1D795BF72</code> <code>27CEBA7EFD4ABC23F1888FA859B40071</code> <code>B6549B9B92D95ACA2CB85BEE1B51A9F3</code> <code>E4A98A2FD28794499E215E9A1A694842</code> <code>6B3D1707C10F3C0D0D70AE91C3B39BB1</code> <code>78BBB0C3C375E96333BAEAA01C40F66A</code> <code>413D2D7137B914B468B9EEAE22943030</code> <code>07E1034DE4261C7B87D2F34C29320C1A</code><br> <code>CBD8C9D6</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 345512BC0BB447797FEA750BC28152A46A730786263B96E6A1F0808529FF4BBB235FD0BD90A9A18E463CA5A4E90E5F1DF6B004520A8E4611D624140B48AEB1F96A944A1C2F2AA5A1F9DC97993CF8595845AA23C55BD6F010A2B00F0BF997A320EB00149FCB3FA25F141FC179126D453EC4C9B1D34F28BAF1A8CDC0D37469A7D2BBFFAD04C0B5D4570ED8169C8784CD8EC19BCC3A71F7966F1A7689E69381565EA77606B287D7D8FB7E4B6C15774B159CE0D8D390A7CFB0E47F454F88346A445739DE0262D002710FC40E4AAAD7A8BAB081C6567A6BA67ED3548BBF6405E82953540A2D3716CFF5A21519360AB6D57044FBE68FC0004208D9408B742B20B7E77DE260B4F64816DE3FDE12C1D6E347F7ED037FDFD613D9AE4A521DB30C08AD83C8576753E49DF7128173B7DF9D99B0C140A8EE23A767BC4F6E105C0124C189C6657AFEEA5A76E51650A94DF92F65F91748774821DA53A8636A45E51DD1ED419CC67B11ED4B04E120691DBD19ECC5FFB06E42C2650E65EE072571864B988B34DF47BE7AB66160CBF4910FFC8297F16277ACD01CCE65DFB51D0D5F73D457455D95936F00CF5A6A9A66C89A447882573F8116069FC41C63DA2F5199525F16766C8BCBCEF16D69FA955FE50C7911E981710C75ABF810DA7C744CC1D795BF7227CEBA7EFD4ABC23F1888FA859B40071B6549B9B92D95ACA2CB85BEE1B51A9F3E4A98A2FD28794499E215E9A1A6948426B3D1707C10F3C0D0D70AE91C3B39BB178BBB0C3C375E96333BAEAA01C40F66A413D2D7137B914B468B9EEAE2294303007E1034DE4261C7B87D2F34C29320C1ACBD8C9D6
tmp_aes_key = BB28801B2415F74A968D33D135AF60D53A59D29B9C360FB962B3E99670EF3B5D
tmp_aes_iv = E2F399620E7841D155044E389017380798A506C80765090CC3EEFAD184D8A2BB</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 5F14999BF40DEF9B2774F855763F3D67A6AA06D4BA0D89B5422B395C3B3910F09E3B5590ACE0DE74F2A861628931E042B3DAB3B26362341803000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010011520864B2BF76FCFC4DC7DD25B11E7988A841F98A9D82187829397054C7967D16F516DDCD9C311FB155261207C1B865F70DD3159B26F58FC9176FF6B0DB000D9B1008E9AAC61C0ECEFC0710BD99D6A3BE91F6BFF28C077CD83CBFF381E3792423100EB9678A22423CECB1ADFA1F506D9470D93F7BF742EE17F9675B3D5C91F3A7EAEE8830D24D8A0422642049E18F3022E2A1FF35681FAE4B4ED4D8D157A7B8CA08170C10FC766F00FC452879C8E4F8A08B132C2DBC857165A70C9EC1776BDDCB9790025B9F3F5638ADFAAE2106C2065144DF9BF1401CA56601348FD20B0E6C6ED246773E96214DDB00C88375ACA76C17409129C04F8B04189B331478F3175C7D67D268921B19D78676FBF9
answer = BA0D89B5422B395C3B3910F09E3B5590ACE0DE74F2A861628931E042B3DAB3B26362341803000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010011520864B2BF76FCFC4DC7DD25B11E7988A841F98A9D82187829397054C7967D16F516DDCD9C311FB155261207C1B865F70DD3159B26F58FC9176FF6B0DB000D9B1008E9AAC61C0ECEFC0710BD99D6A3BE91F6BFF28C077CD83CBFF381E3792423100EB9678A22423CECB1ADFA1F506D9470D93F7BF742EE17F9675B3D5C91F3A7EAEE8830D24D8A0422642049E18F3022E2A1FF35681FAE4B4ED4D8D157A7B8CA08170C10FC766F00FC452879C8E4F8A08B132C2DBC857165A70C9EC1776BDDCB9790025B9F3F5638ADFAAE2106C2065144DF9BF1401CA56601348FD20B0E6C6ED246773E96214DDB00C88375ACA76C17409129C04F8B04189B331478F3175C7D67D268921B19D78676FBF9</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 42 2B 39 5C 3B 39 10 F0 9E 3B 55 90
0010 | AC E0 DE 74 F2 A8 61 62 89 31 E0 42 B3 DA B3 B2
0020 | 63 62 34 18 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 11 52 08 64 B2 BF 76 FC FC 4D C7 DD 25 B1 1E 79
0140 | 88 A8 41 F9 8A 9D 82 18 78 29 39 70 54 C7 96 7D
0150 | 16 F5 16 DD CD 9C 31 1F B1 55 26 12 07 C1 B8 65
0160 | F7 0D D3 15 9B 26 F5 8F C9 17 6F F6 B0 DB 00 0D
0170 | 9B 10 08 E9 AA C6 1C 0E CE FC 07 10 BD 99 D6 A3
0180 | BE 91 F6 BF F2 8C 07 7C D8 3C BF F3 81 E3 79 24
0190 | 23 10 0E B9 67 8A 22 42 3C EC B1 AD FA 1F 50 6D
01A0 | 94 70 D9 3F 7B F7 42 EE 17 F9 67 5B 3D 5C 91 F3
01B0 | A7 EA EE 88 30 D2 4D 8A 04 22 64 20 49 E1 8F 30
01C0 | 22 E2 A1 FF 35 68 1F AE 4B 4E D4 D8 D1 57 A7 B8
01D0 | CA 08 17 0C 10 FC 76 6F 00 FC 45 28 79 C8 E4 F8
01E0 | A0 8B 13 2C 2D BC 85 71 65 A7 0C 9E C1 77 6B DD
01F0 | CB 97 90 02 5B 9F 3F 56 38 AD FA AE 21 06 C2 06
0200 | 51 44 DF 9B F1 40 1C A5 66 01 34 8F D2 0B 0E 6C
0210 | 6E D2 46 77 3E 96 21 4D DB 00 C8 83 75 AC A7 6C
0220 | 17 40 91 29 C0 4F 8B 04 18 9B 33 14 78 F3 17 5C
0230 | 7D 67 D2 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE00010011520864B2BF76FCFC4DC7DD</code> <code>25B11E7988A841F98A9D821878293970</code> <code>54C7967D16F516DDCD9C311FB1552612</code> <code>07C1B865F70DD3159B26F58FC9176FF6</code> <code>B0DB000D9B1008E9AAC61C0ECEFC0710</code> <code>BD99D6A3BE91F6BFF28C077CD83CBFF3</code> <code>81E3792423100EB9678A22423CECB1AD</code> <code>FA1F506D9470D93F7BF742EE17F9675B</code> <code>3D5C91F3A7EAEE8830D24D8A04226420</code> <code>49E18F3022E2A1FF35681FAE4B4ED4D8</code> <code>D157A7B8CA08170C10FC766F00FC4528</code> <code>79C8E4F8A08B132C2DBC857165A70C9E</code> <code>C1776BDDCB9790025B9F3F5638ADFAAE</code> <code>2106C2065144DF9BF1401CA56601348F</code> <code>D20B0E6C6ED246773E96214DDB00C883</code> <code>75ACA76C17409129C04F8B04189B3314</code><br> <code>78F3175C</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>7D67D268</code> (1758619517 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 8D067709946C47662DD2701C408DB70FCA7E679F178375D85D5E1B5C673B7C9A2FC3AE971F0E0EEA0BAA1E846E8DA8C7FCE7A076CFF20FEFECC3BF412E6225DB900498184EDBB937D1136D987C3A3852D242F9ADA3D3A7B0444A96311E2C3B9F0C0BCB99BC8B9FFBF47A16C24F064DCBCBE324AA3D5E7955347A830EE73CC0BD5472CB1917DA4E8C038E739B0ABEE154EB944DA2C190F122326E18F261E48BD0E1817499763127FAF01D1F84A99EC88C5B0914B9849E38F8CAE10B28EE8B297917543284436B32D2899992535A343C0B130F288514984CF4CD6980817550D92144DE0134FAD7A883642EE8117E708C47153831B32368C16BDBD9741E40DB87AA</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 7DABAD30E68BBC533CE510EE77C168E82FFD40B4B2D790256736E9B77806592B893245812569FDE8BF91CD4910CF90019C940D1B8CD782E300B890F7E793ED82CB8B9E825826BADAD1ED3347FAE8C769BE09C84D3299353F3C71E68A4B5581B5E6D3DE50AA839E9913842B26D9D57AFD0F08739F08215E8FF604CADFFA82ABA2490755C2DCA9870A313A054F3901DE55D59C575E3BE0E12579FF803093D6EAB4A1BEC00560BD5A668CDE5218BE5B8DCA98DF7AB31473FAE800B0A882FBB76857E489D3C58BA3C189E5ADEB7F90FA2757D83412809949B6D7C9ABEA9F36D6964EEBAC94398217C66ED30AD4D5E1BE0D3D7E06AEE2900C96271D4CA10F53150AC3</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 42 2B 39 5C 3B 39 10 F0 9E 3B 55 90
0010 | AC E0 DE 74 F2 A8 61 62 89 31 E0 42 B3 DA B3 B2
0020 | 63 62 34 18 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 7D AB AD 30 E6 8B BC 53 3C E5 10 EE 77 C1 68 E8
0040 | 2F FD 40 B4 B2 D7 90 25 67 36 E9 B7 78 06 59 2B
0050 | 89 32 45 81 25 69 FD E8 BF 91 CD 49 10 CF 90 01
0060 | 9C 94 0D 1B 8C D7 82 E3 00 B8 90 F7 E7 93 ED 82
0070 | CB 8B 9E 82 58 26 BA DA D1 ED 33 47 FA E8 C7 69
0080 | BE 09 C8 4D 32 99 35 3F 3C 71 E6 8A 4B 55 81 B5
0090 | E6 D3 DE 50 AA 83 9E 99 13 84 2B 26 D9 D5 7A FD
00A0 | 0F 08 73 9F 08 21 5E 8F F6 04 CA DF FA 82 AB A2
00B0 | 49 07 55 C2 DC A9 87 0A 31 3A 05 4F 39 01 DE 55
00C0 | D5 9C 57 5E 3B E0 E1 25 79 FF 80 30 93 D6 EA B4
00D0 | A1 BE C0 05 60 BD 5A 66 8C DE 52 18 BE 5B 8D CA
00E0 | 98 DF 7A B3 14 73 FA E8 00 B0 A8 82 FB B7 68 57
00F0 | E4 89 D3 C5 8B A3 C1 89 E5 AD EB 7F 90 FA 27 57
0100 | D8 34 12 80 99 49 B6 D7 C9 AB EA 9F 36 D6 96 4E
0110 | EB AC 94 39 82 17 C6 6E D3 0A D4 D5 E1 BE 0D 3D
0120 | 7E 06 AE E2 90 0C 96 27 1D 4C A1 0F 53 15 0A C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE0001007DABAD30E68BBC533CE510EE</code> <code>77C168E82FFD40B4B2D790256736E9B7</code> <code>7806592B893245812569FDE8BF91CD49</code> <code>10CF90019C940D1B8CD782E300B890F7</code> <code>E793ED82CB8B9E825826BADAD1ED3347</code> <code>FAE8C769BE09C84D3299353F3C71E68A</code> <code>4B5581B5E6D3DE50AA839E9913842B26</code> <code>D9D57AFD0F08739F08215E8FF604CADF</code> <code>FA82ABA2490755C2DCA9870A313A054F</code> <code>3901DE55D59C575E3BE0E12579FF8030</code> <code>93D6EAB4A1BEC00560BD5A668CDE5218</code> <code>BE5B8DCA98DF7AB31473FAE800B0A882</code> <code>FBB76857E489D3C58BA3C189E5ADEB7F</code> <code>90FA2757D83412809949B6D7C9ABEA9F</code> <code>36D6964EEBAC94398217C66ED30AD4D5</code> <code>E1BE0D3D7E06AEE2900C96271D4CA10F</code><br> <code>53150AC3</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366422B395C3B3910F09E3B5590ACE0DE74F2A861628931E042B3DAB3B2636234180000000000000000FE0001007DABAD30E68BBC533CE510EE77C168E82FFD40B4B2D790256736E9B77806592B893245812569FDE8BF91CD4910CF90019C940D1B8CD782E300B890F7E793ED82CB8B9E825826BADAD1ED3347FAE8C769BE09C84D3299353F3C71E68A4B5581B5E6D3DE50AA839E9913842B26D9D57AFD0F08739F08215E8FF604CADFFA82ABA2490755C2DCA9870A313A054F3901DE55D59C575E3BE0E12579FF803093D6EAB4A1BEC00560BD5A668CDE5218BE5B8DCA98DF7AB31473FAE800B0A882FBB76857E489D3C58BA3C189E5ADEB7F90FA2757D83412809949B6D7C9ABEA9F36D6964EEBAC94398217C66ED30AD4D5E1BE0D3D7E06AEE2900C96271D4CA10F53150AC3
padding = 1F2D0A3FB066CDE1983A9B80
tmp_aes_key = BB28801B2415F74A968D33D135AF60D53A59D29B9C360FB962B3E99670EF3B5D
tmp_aes_iv = E2F399620E7841D155044E389017380798A506C80765090CC3EEFAD184D8A2BB</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 1360EF06804B9ACA859C8ACB56A420F45C33188CEB0C684B608C8524C694AB3C0513848C60FA698AD565491139EE518EF17D2E8B8897355D059DDAE1EFB3AEA88440871C2DC34585CB870877616646E46D8D396F538763E32A611E20ED1DB04CED11D0EA04D319D515A596DD65BFF6DD5938668FB2EC306719E648E5EB5A60EBCAC41DC24E9C8EA7B74446101B8CAFA3D206A5DFBB95B203F38E0024793DD112790D076B9336B42F96D9A86696C978EE98F1544573F464066F2FACF67795676927FC3ABADEDD66E3F0CBE0634148EDFC6B2DF2095022D01C4E7D348B9F23A21B25D71E16A1F2D52DA854A0A8ED87592B78A3223C8856960BA2A0CEBB40AD3FFDFFA16850034F7F675DDDFDE655C5790D60ECA405E732CCCF212BBD0D542107AEA89013BD9EB36E21F863D1CC595E964F63C2A249AB8810D5F2DB7A3223A5C9B912885A4DA84B82B0210CAFDF398C9D7D</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 E0 10 0A 00 7D 67 D2 68
0010 | 78 01 00 00 1F 5F 04 F5 42 2B 39 5C 3B 39 10 F0
0020 | 9E 3B 55 90 AC E0 DE 74 F2 A8 61 62 89 31 E0 42
0030 | B3 DA B3 B2 63 62 34 18 FE 50 01 00 13 60 EF 06
0040 | 80 4B 9A CA 85 9C 8A CB 56 A4 20 F4 5C 33 18 8C
0050 | EB 0C 68 4B 60 8C 85 24 C6 94 AB 3C 05 13 84 8C
0060 | 60 FA 69 8A D5 65 49 11 39 EE 51 8E F1 7D 2E 8B
0070 | 88 97 35 5D 05 9D DA E1 EF B3 AE A8 84 40 87 1C
0080 | 2D C3 45 85 CB 87 08 77 61 66 46 E4 6D 8D 39 6F
0090 | 53 87 63 E3 2A 61 1E 20 ED 1D B0 4C ED 11 D0 EA
00A0 | 04 D3 19 D5 15 A5 96 DD 65 BF F6 DD 59 38 66 8F
00B0 | B2 EC 30 67 19 E6 48 E5 EB 5A 60 EB CA C4 1D C2
00C0 | 4E 9C 8E A7 B7 44 46 10 1B 8C AF A3 D2 06 A5 DF
00D0 | BB 95 B2 03 F3 8E 00 24 79 3D D1 12 79 0D 07 6B
00E0 | 93 36 B4 2F 96 D9 A8 66 96 C9 78 EE 98 F1 54 45
00F0 | 73 F4 64 06 6F 2F AC F6 77 95 67 69 27 FC 3A BA
0100 | DE DD 66 E3 F0 CB E0 63 41 48 ED FC 6B 2D F2 09
0110 | 50 22 D0 1C 4E 7D 34 8B 9F 23 A2 1B 25 D7 1E 16
0120 | A1 F2 D5 2D A8 54 A0 A8 ED 87 59 2B 78 A3 22 3C
0130 | 88 56 96 0B A2 A0 CE BB 40 AD 3F FD FF A1 68 50
0140 | 03 4F 7F 67 5D DD FD E6 55 C5 79 0D 60 EC A4 05
0150 | E7 32 CC CF 21 2B BD 0D 54 21 07 AE A8 90 13 BD
0160 | 9E B3 6E 21 F8 63 D1 CC 59 5E 96 4F 63 C2 A2 49
0170 | AB 88 10 D5 F2 DB 7A 32 23 A5 C9 B9 12 88 5A 4D
0180 | A8 4B 82 B0 21 0C AF DF 39 8C 9D 7D</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>E0100A007D67D268</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE5001001360EF06804B9ACA859C8ACB</code> <code>56A420F45C33188CEB0C684B608C8524</code> <code>C694AB3C0513848C60FA698AD5654911</code> <code>39EE518EF17D2E8B8897355D059DDAE1</code> <code>EFB3AEA88440871C2DC34585CB870877</code> <code>616646E46D8D396F538763E32A611E20</code> <code>ED1DB04CED11D0EA04D319D515A596DD</code> <code>65BFF6DD5938668FB2EC306719E648E5</code> <code>EB5A60EBCAC41DC24E9C8EA7B7444610</code> <code>1B8CAFA3D206A5DFBB95B203F38E0024</code> <code>793DD112790D076B9336B42F96D9A866</code> <code>96C978EE98F1544573F464066F2FACF6</code> <code>7795676927FC3ABADEDD66E3F0CBE063</code> <code>4148EDFC6B2DF2095022D01C4E7D348B</code> <code>9F23A21B25D71E16A1F2D52DA854A0A8</code> <code>ED87592B78A3223C8856960BA2A0CEBB</code> <code>40AD3FFDFFA16850034F7F675DDDFDE6</code> <code>55C5790D60ECA405E732CCCF212BBD0D</code> <code>542107AEA89013BD9EB36E21F863D1CC</code> <code>595E964F63C2A249AB8810D5F2DB7A32</code> <code>23A5C9B912885A4DA84B82B0210CAFDF</code><br> <code>398C9D7D</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 0B2AF3A70DB44436F924721D3AC716BAEE18140EA16FA1399D68BCF06BC228751570C185B5078DE9486135BF1464DF0B31370264BFEB1979C7B1EB316DEE6B700EEDE163072E9EAF51FD88040F3D615C6A023AC28225B85B7D3752B409231AA5EFB5F632C0080ADD52A4F275813742CD9ECE9A173056FE4F9A25F0686F5D110949C8EE386C55564E4F6559C4F9AFE693F456E2533E1199F517F36F6311F15CB35A31DB82918413907666160810F7882C5AA63660632274689CC4382C79C5D62D3E61FC3FF8B1218508394D753344A49AE72AEB200D33317F4BD0A886E37D6ACDD860F55ACA025B6995E339C7A8F8B3FAFF5014B24BDD838D1FE19937F8D99BBD</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 94 54 EF 7E 67 D2 68
0010 | 34 00 00 00 34 F7 CB 3B 42 2B 39 5C 3B 39 10 F0
0020 | 9E 3B 55 90 AC E0 DE 74 F2 A8 61 62 89 31 E0 42
0030 | B3 DA B3 B2 63 62 34 18 3F 2A C4 B1 6E 73 B3 55
0040 | 05 46 FE A0 FA 25 DB B0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>019454EF7E67D268</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>422B395C3B3910F09E3B5590ACE0DE74</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F2A861628931E042B3DAB3B263623418</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>3F2AC4B16E73B3550546FEA0FA25DBB0</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

