<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 18 95 08 00 38 4F D4 68
0010 | 14 00 00 00 F1 8E 7E BE 6A 67 74 12 33 79 13 5D
0020 | 7F 96 F0 DB 86 22 E9 6F</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>18950800384FD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 F0 56 97 38 4F D4 68
0010 | 50 00 00 00 63 24 16 05 6A 67 74 12 33 79 13 5D
0020 | 7F 96 F0 DB 86 22 E9 6F 30 05 2C 76 1C DF 42 DC
0030 | 72 A8 2D D2 6D 37 A6 1B 08 11 A0 20 72 A1 A0 3C
0040 | DB 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01F05697384FD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>0811A02072A1A03CDB000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1270050771628473563</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 1270050771628473563</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>1270050771628473563 = 1023260093 * 1241180791</code></p>
<pre><code>p = 1023260093
q = 1241180791</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 11 A0 20 72 A1 A0 3C DB 00 00 00
0010 | 04 3C FD B5 BD 00 00 00 04 49 FA EA 77 00 00 00
0020 | 6A 67 74 12 33 79 13 5D 7F 96 F0 DB 86 22 E9 6F
0030 | 30 05 2C 76 1C DF 42 DC 72 A8 2D D2 6D 37 A6 1B
0040 | F8 C9 F9 F8 79 41 C9 CD 5B 08 B2 A8 F2 8C 1D EB
0050 | CC E5 2A D2 CB 6A D0 BA 87 94 4D CB 23 9E 5E A5
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>0811A02072A1A03CDB000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1270050771628473563</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>043CFDB5BD000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1023260093</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>0449FAEA77000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1241180791</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>F8C9F9F87941C9CD5B08B2A8F28C1DEB</code> <code>CCE52AD2CB6AD0BA87944DCB239E5EA5</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A90811A02072A1A03CDB000000043CFDB5BD0000000449FAEA770000006A6774123379135D7F96F0DB8622E96F30052C761CDF42DC72A82DD26D37A61BF8C9F9F87941C9CD5B08B2A8F28C1DEBCCE52AD2CB6AD0BA87944DCB239E5EA502000000
random_padding_bytes = 95A80F82760A992E11244A9BB876FEE4B7F01DB7D091B48338AAB5018E5F48172E2A45020C78088F75FAFED8B61DE437C00E480E13AD672E36E0249A9043078BA372EC410FF3C428C480BD4938D84F744C6A5CBD07EB570148E245FD</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 94312FC78DE901D429472B289A72E66D6B86A7F031F2F970859ED1CF5B93A481AF628D01E5D5C3472B0CD5A77C804AFD38C046A98785286FA682BA37B5D21F274E1FFCED1B184F2AB0A3A9ECAE83AB738000E6B48445D4BC857AEBE8ED6898BBCD1EEA312A22A645C2890CA5A21FD0B8500A9458D1B164FBC2060F77C29C5B72E0A0B8DEFACE5B1F21E1EBC5BA3A37EE00722C546E7F75DD7D9AE86811C836D55CA4E3F02B9B0C22D2E58674C770801B71226442BBF363D0E207DEE4887D3FCC9C36A5235AA1AB7A16F755D9310631AAC8A9FF7E1F061952499C8487F1A8E6CF1331CB454E7DA1C0FC7989CE3355306B6B8E78AC2BEC8C9333E3C667854F32B7</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 F8 3D 09 00 38 4F D4 68
0010 | 40 01 00 00 BE E4 12 D7 6A 67 74 12 33 79 13 5D
0020 | 7F 96 F0 DB 86 22 E9 6F 30 05 2C 76 1C DF 42 DC
0030 | 72 A8 2D D2 6D 37 A6 1B 04 3C FD B5 BD 00 00 00
0040 | 04 49 FA EA 77 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 94 31 2F C7 8D E9 01 D4 29 47 2B 28
0060 | 9A 72 E6 6D 6B 86 A7 F0 31 F2 F9 70 85 9E D1 CF
0070 | 5B 93 A4 81 AF 62 8D 01 E5 D5 C3 47 2B 0C D5 A7
0080 | 7C 80 4A FD 38 C0 46 A9 87 85 28 6F A6 82 BA 37
0090 | B5 D2 1F 27 4E 1F FC ED 1B 18 4F 2A B0 A3 A9 EC
00A0 | AE 83 AB 73 80 00 E6 B4 84 45 D4 BC 85 7A EB E8
00B0 | ED 68 98 BB CD 1E EA 31 2A 22 A6 45 C2 89 0C A5
00C0 | A2 1F D0 B8 50 0A 94 58 D1 B1 64 FB C2 06 0F 77
00D0 | C2 9C 5B 72 E0 A0 B8 DE FA CE 5B 1F 21 E1 EB C5
00E0 | BA 3A 37 EE 00 72 2C 54 6E 7F 75 DD 7D 9A E8 68
00F0 | 11 C8 36 D5 5C A4 E3 F0 2B 9B 0C 22 D2 E5 86 74
0100 | C7 70 80 1B 71 22 64 42 BB F3 63 D0 E2 07 DE E4
0110 | 88 7D 3F CC 9C 36 A5 23 5A A1 AB 7A 16 F7 55 D9
0120 | 31 06 31 AA C8 A9 FF 7E 1F 06 19 52 49 9C 84 87
0130 | F1 A8 E6 CF 13 31 CB 45 4E 7D A1 C0 FC 79 89 CE
0140 | 33 55 30 6B 6B 8E 78 AC 2B EC 8C 93 33 E3 C6 67
0150 | 85 4F 32 B7</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>F83D0900384FD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>043CFDB5BD000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1023260093</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>0449FAEA77000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1241180791</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE00010094312FC78DE901D429472B28</code> <code>9A72E66D6B86A7F031F2F970859ED1CF</code> <code>5B93A481AF628D01E5D5C3472B0CD5A7</code> <code>7C804AFD38C046A98785286FA682BA37</code> <code>B5D21F274E1FFCED1B184F2AB0A3A9EC</code> <code>AE83AB738000E6B48445D4BC857AEBE8</code> <code>ED6898BBCD1EEA312A22A645C2890CA5</code> <code>A21FD0B8500A9458D1B164FBC2060F77</code> <code>C29C5B72E0A0B8DEFACE5B1F21E1EBC5</code> <code>BA3A37EE00722C546E7F75DD7D9AE868</code> <code>11C836D55CA4E3F02B9B0C22D2E58674</code> <code>C770801B71226442BBF363D0E207DEE4</code> <code>887D3FCC9C36A5235AA1AB7A16F755D9</code> <code>310631AAC8A9FF7E1F061952499C8487</code> <code>F1A8E6CF1331CB454E7DA1C0FC7989CE</code> <code>3355306B6B8E78AC2BEC8C9333E3C667</code><br> <code>854F32B7</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 1C 07 C1 38 4F D4 68
0010 | 78 02 00 00 5C 07 E8 D0 6A 67 74 12 33 79 13 5D
0020 | 7F 96 F0 DB 86 22 E9 6F 30 05 2C 76 1C DF 42 DC
0030 | 72 A8 2D D2 6D 37 A6 1B FE 50 02 00 B7 C1 3B BB
0040 | 1E DC A6 A1 68 CF E3 2D 6A 01 0C A1 AE AB 52 2B
0050 | 2C DE FC 16 33 D5 84 76 80 94 E4 E0 F9 87 30 39
0060 | D5 2E 80 41 DD 5B 71 E2 47 2B C2 6D 2A 5C 83 E6
0070 | 8F 96 D6 93 6A 1E 25 99 2D B9 E1 2C DB 29 29 96
0080 | 55 00 59 18 C3 A2 C3 4E 78 DD BC 7C 24 1D 8F F6
0090 | B7 DE EB 6D C6 45 29 EF 43 46 8E 45 ED 57 BD 84
00A0 | 41 B8 AB DF 8F 04 24 F5 7E 58 58 98 5E 65 4F B3
00B0 | BE 5D 3F 86 3E 7A 2C B1 A9 AE 00 A1 8A 01 7B 6E
00C0 | C4 4A 0D F4 C7 EB FC 36 3A 62 BF 27 F5 7C 6F C3
00D0 | 20 F0 92 B4 CF 5D EB BF C2 0E 91 EB 30 FC 25 FF
00E0 | A2 EB C9 79 16 1E 71 28 10 8F 7C D8 1E 42 68 09
00F0 | E3 47 F7 17 80 23 A8 77 5F 3A 59 FA C3 67 79 D2
0100 | F7 F0 38 99 BA E9 8F 35 1D 75 64 86 CB 66 B9 F6
0110 | 84 28 DA DA 5B 7B 4E 65 69 4D B8 56 CF FE 18 3B
0120 | 99 0C BF 17 26 03 E5 B2 35 FC B0 D1 25 DE BF 04
0130 | EE BB F8 55 BC 11 75 96 9A 6E 7C 13 78 6A F5 16
0140 | A0 DE 00 52 37 19 53 53 FF 88 E5 32 FA C6 6A 15
0150 | 9F 1B 2A 3B 09 F9 8B 05 0B 24 89 03 1A AB 64 13
0160 | C8 4A 5D 3E 8B 9F 49 EB 9D 4A DD FC 8E A7 FC 71
0170 | 18 13 BC A6 59 13 E2 CF 13 E2 D1 3D 20 AE BD 5E
0180 | D1 93 66 46 40 72 DD 6D F4 EA 12 02 BA 76 A3 B5
0190 | 61 AB BD 9F 8C 43 3F 6A CE 3C 7E 5B 98 88 13 60
01A0 | C4 6D 70 0C 76 14 78 51 72 F4 99 78 10 3D 3A 31
01B0 | 42 09 9E 9B 57 B5 72 F6 AA FE 4E 8B DC 2E C6 BF
01C0 | 09 9E B2 10 1A F9 7B 16 FC 85 59 47 EA 76 58 4B
01D0 | 50 84 03 7D BE B9 A7 CF D6 11 E3 83 11 4B F6 C6
01E0 | 0D D1 B7 68 2D 9E BC EB C8 A8 CD E0 2E 15 3A 4D
01F0 | CF CC AF 93 AF E0 20 BE 89 27 09 EB 7F 9E 6C 4D
0200 | 7C 36 10 BB A9 A2 36 40 5C 2D FD 29 66 5E 41 75
0210 | 9A 11 E2 E2 D6 BD B4 DF 25 13 C0 1E 9F 5D 2F AF
0220 | 6D 89 FC E7 25 D3 5A BD 81 8E 97 DC E3 78 BE E6
0230 | CC 9C 8E 92 6D 89 5E 2B 79 6E 63 EA 2A 29 8E 98
0240 | 01 35 2D 52 82 3A 9C 41 D6 FC 13 7C CD FD 23 C1
0250 | E5 3D 7C 17 79 AB 5E FC 9E CC 40 54 62 AB C7 87
0260 | A3 D7 B3 C9 C5 01 C9 B4 20 5C 22 0A 41 00 36 12
0270 | D6 96 B8 D9 4C 52 F3 58 85 58 1C 1E A7 8B 34 C4
0280 | CA 91 F3 E2 91 0D 4E EA 3A F5 DA 89</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>011C07C1384FD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200B7C13BBB1EDCA6A168CFE32D</code> <code>6A010CA1AEAB522B2CDEFC1633D58476</code> <code>8094E4E0F9873039D52E8041DD5B71E2</code> <code>472BC26D2A5C83E68F96D6936A1E2599</code> <code>2DB9E12CDB29299655005918C3A2C34E</code> <code>78DDBC7C241D8FF6B7DEEB6DC64529EF</code> <code>43468E45ED57BD8441B8ABDF8F0424F5</code> <code>7E5858985E654FB3BE5D3F863E7A2CB1</code> <code>A9AE00A18A017B6EC44A0DF4C7EBFC36</code> <code>3A62BF27F57C6FC320F092B4CF5DEBBF</code> <code>C20E91EB30FC25FFA2EBC979161E7128</code> <code>108F7CD81E426809E347F7178023A877</code> <code>5F3A59FAC36779D2F7F03899BAE98F35</code> <code>1D756486CB66B9F68428DADA5B7B4E65</code> <code>694DB856CFFE183B990CBF172603E5B2</code> <code>35FCB0D125DEBF04EEBBF855BC117596</code> <code>9A6E7C13786AF516A0DE005237195353</code> <code>FF88E532FAC66A159F1B2A3B09F98B05</code> <code>0B2489031AAB6413C84A5D3E8B9F49EB</code> <code>9D4ADDFC8EA7FC711813BCA65913E2CF</code> <code>13E2D13D20AEBD5ED19366464072DD6D</code> <code>F4EA1202BA76A3B561ABBD9F8C433F6A</code> <code>CE3C7E5B98881360C46D700C76147851</code> <code>72F49978103D3A3142099E9B57B572F6</code> <code>AAFE4E8BDC2EC6BF099EB2101AF97B16</code> <code>FC855947EA76584B5084037DBEB9A7CF</code> <code>D611E383114BF6C60DD1B7682D9EBCEB</code> <code>C8A8CDE02E153A4DCFCCAF93AFE020BE</code> <code>892709EB7F9E6C4D7C3610BBA9A23640</code> <code>5C2DFD29665E41759A11E2E2D6BDB4DF</code> <code>2513C01E9F5D2FAF6D89FCE725D35ABD</code> <code>818E97DCE378BEE6CC9C8E926D895E2B</code> <code>796E63EA2A298E9801352D52823A9C41</code> <code>D6FC137CCDFD23C1E53D7C1779AB5EFC</code> <code>9ECC405462ABC787A3D7B3C9C501C9B4</code> <code>205C220A41003612D696B8D94C52F358</code> <code>85581C1EA78B34C4CA91F3E2910D4EEA</code><br> <code>3AF5DA89</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = B7C13BBB1EDCA6A168CFE32D6A010CA1AEAB522B2CDEFC1633D584768094E4E0F9873039D52E8041DD5B71E2472BC26D2A5C83E68F96D6936A1E25992DB9E12CDB29299655005918C3A2C34E78DDBC7C241D8FF6B7DEEB6DC64529EF43468E45ED57BD8441B8ABDF8F0424F57E5858985E654FB3BE5D3F863E7A2CB1A9AE00A18A017B6EC44A0DF4C7EBFC363A62BF27F57C6FC320F092B4CF5DEBBFC20E91EB30FC25FFA2EBC979161E7128108F7CD81E426809E347F7178023A8775F3A59FAC36779D2F7F03899BAE98F351D756486CB66B9F68428DADA5B7B4E65694DB856CFFE183B990CBF172603E5B235FCB0D125DEBF04EEBBF855BC1175969A6E7C13786AF516A0DE005237195353FF88E532FAC66A159F1B2A3B09F98B050B2489031AAB6413C84A5D3E8B9F49EB9D4ADDFC8EA7FC711813BCA65913E2CF13E2D13D20AEBD5ED19366464072DD6DF4EA1202BA76A3B561ABBD9F8C433F6ACE3C7E5B98881360C46D700C7614785172F49978103D3A3142099E9B57B572F6AAFE4E8BDC2EC6BF099EB2101AF97B16FC855947EA76584B5084037DBEB9A7CFD611E383114BF6C60DD1B7682D9EBCEBC8A8CDE02E153A4DCFCCAF93AFE020BE892709EB7F9E6C4D7C3610BBA9A236405C2DFD29665E41759A11E2E2D6BDB4DF2513C01E9F5D2FAF6D89FCE725D35ABD818E97DCE378BEE6CC9C8E926D895E2B796E63EA2A298E9801352D52823A9C41D6FC137CCDFD23C1E53D7C1779AB5EFC9ECC405462ABC787A3D7B3C9C501C9B4205C220A41003612D696B8D94C52F35885581C1EA78B34C4CA91F3E2910D4EEA3AF5DA89
tmp_aes_key = 53F50E50695B0C050BF3555A44FAF84D2059423B6CBFE32A81FE74E62CE44459
tmp_aes_iv = C581587EF2C3FDCE09DCC2032ED5531220CE52AD1FA4BFF0F39447C2F8C9F9F8</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 395D24C2A5CCD77A5EFDE0FCA456871682843E76BA0D89B56A6774123379135D7F96F0DB8622E96F30052C761CDF42DC72A82DD26D37A61B03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100058222678B7B29F5CCE91722EB2D12A367FF4D8C327B2D8187AC67F4E0E37A94D817684C65F273EF8C7507A930EF2946C26854EA879F023E378205FF08E2EE09E08CBB3274BA2A062A13742C2DBB04D3D74EA2F64F9DDCB2D2505C42091DFFAC9B4F6D7075678BB9EEF0A29B475888310002EA8CB0DEC0AD273022A3F5594D7FFD2BD8FB02D9090FF11BC5A8B89A07F1EC164846926A6E9380ADDCDF33D5C861A6A6DE1E2033D31B821EFEE0D273EAB6CB2EFAB3CD797C92F2C047A8AEE42C97E7D20971A02E654539892D702DFC9E7B4AECD676A0A9FE42E0A65D689ED497FCA31110BD2A6C49C835AEBECDC4303BB598485AA64A8AB40C99B9215608836D6E384FD468079A7B447013ACB9
answer = BA0D89B56A6774123379135D7F96F0DB8622E96F30052C761CDF42DC72A82DD26D37A61B03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100058222678B7B29F5CCE91722EB2D12A367FF4D8C327B2D8187AC67F4E0E37A94D817684C65F273EF8C7507A930EF2946C26854EA879F023E378205FF08E2EE09E08CBB3274BA2A062A13742C2DBB04D3D74EA2F64F9DDCB2D2505C42091DFFAC9B4F6D7075678BB9EEF0A29B475888310002EA8CB0DEC0AD273022A3F5594D7FFD2BD8FB02D9090FF11BC5A8B89A07F1EC164846926A6E9380ADDCDF33D5C861A6A6DE1E2033D31B821EFEE0D273EAB6CB2EFAB3CD797C92F2C047A8AEE42C97E7D20971A02E654539892D702DFC9E7B4AECD676A0A9FE42E0A65D689ED497FCA31110BD2A6C49C835AEBECDC4303BB598485AA64A8AB40C99B9215608836D6E384FD468079A7B447013ACB9</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 6A 67 74 12 33 79 13 5D 7F 96 F0 DB
0010 | 86 22 E9 6F 30 05 2C 76 1C DF 42 DC 72 A8 2D D2
0020 | 6D 37 A6 1B 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 05 82 22 67 8B 7B 29 F5 CC E9 17 22 EB 2D 12 A3
0140 | 67 FF 4D 8C 32 7B 2D 81 87 AC 67 F4 E0 E3 7A 94
0150 | D8 17 68 4C 65 F2 73 EF 8C 75 07 A9 30 EF 29 46
0160 | C2 68 54 EA 87 9F 02 3E 37 82 05 FF 08 E2 EE 09
0170 | E0 8C BB 32 74 BA 2A 06 2A 13 74 2C 2D BB 04 D3
0180 | D7 4E A2 F6 4F 9D DC B2 D2 50 5C 42 09 1D FF AC
0190 | 9B 4F 6D 70 75 67 8B B9 EE F0 A2 9B 47 58 88 31
01A0 | 00 02 EA 8C B0 DE C0 AD 27 30 22 A3 F5 59 4D 7F
01B0 | FD 2B D8 FB 02 D9 09 0F F1 1B C5 A8 B8 9A 07 F1
01C0 | EC 16 48 46 92 6A 6E 93 80 AD DC DF 33 D5 C8 61
01D0 | A6 A6 DE 1E 20 33 D3 1B 82 1E FE E0 D2 73 EA B6
01E0 | CB 2E FA B3 CD 79 7C 92 F2 C0 47 A8 AE E4 2C 97
01F0 | E7 D2 09 71 A0 2E 65 45 39 89 2D 70 2D FC 9E 7B
0200 | 4A EC D6 76 A0 A9 FE 42 E0 A6 5D 68 9E D4 97 FC
0210 | A3 11 10 BD 2A 6C 49 C8 35 AE BE CD C4 30 3B B5
0220 | 98 48 5A A6 4A 8A B4 0C 99 B9 21 56 08 83 6D 6E
0230 | 38 4F D4 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE000100058222678B7B29F5CCE91722</code> <code>EB2D12A367FF4D8C327B2D8187AC67F4</code> <code>E0E37A94D817684C65F273EF8C7507A9</code> <code>30EF2946C26854EA879F023E378205FF</code> <code>08E2EE09E08CBB3274BA2A062A13742C</code> <code>2DBB04D3D74EA2F64F9DDCB2D2505C42</code> <code>091DFFAC9B4F6D7075678BB9EEF0A29B</code> <code>475888310002EA8CB0DEC0AD273022A3</code> <code>F5594D7FFD2BD8FB02D9090FF11BC5A8</code> <code>B89A07F1EC164846926A6E9380ADDCDF</code> <code>33D5C861A6A6DE1E2033D31B821EFEE0</code> <code>D273EAB6CB2EFAB3CD797C92F2C047A8</code> <code>AEE42C97E7D20971A02E654539892D70</code> <code>2DFC9E7B4AECD676A0A9FE42E0A65D68</code> <code>9ED497FCA31110BD2A6C49C835AEBECD</code> <code>C4303BB598485AA64A8AB40C99B92156</code><br> <code>08836D6E</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>384FD468</code> (1758744376 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 337C5916BE26EE612A63B98D074123BBF9BDE53BED3937F55492A416616FB793F39C2757B414D9B63FD920819BE9B88512F1EE7412B62B8B11688BF151D0D10EF95CF58136DA6321DDE3270346B833F3EF87E4F7A3CD1765B496048B371C56B879F43A3630C7D0911B83831259920229C8F193EFFCF0A897844710C4979D75725416694871ED4C03D9238347CBFD6DCABDEA46A1E7DD4A5C21BDB9BB164B62D975FE124C700470DCF6FAF186A083CB0B74FAECBE5EFB3D2970D71F36AB15127BB43F29F8E4DF3295A62EE73870D7AA7DF11E067DE24460F1A20A2C517F0ECB365C123DBACC92983A7E7AF57A62B9863A0377E874476FF62DA7437F865083A42D</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 5361BF2E07C33C381BD2D08146C734EAE5DA20FD738E82DD5602A0E8F45EB55A8FC3949E89D0A2E13F3AFA99BBAA54B11EE1AD6CD795DA2434711A0895622D17A39841FDA84B95584366F1A7AB6484A3D73B7E6E4F41CA962DA4FF68D0261D0CABBAB1644871DA2A6EF0E3A95CECDC16B5863EEDBCC22C7B41657E57C98261F3F45466243063E83965B92A2EBEB9E2779310BA8DF594F9704D9BE6722EB877CE07D7F5C2790F0843DE5815D03F90B18C0511D6E1E8812D289A41A055AED7AB2A1C68E016F6886E0DF95F7A8442F6EA9536BF77F86430C31D228CAA8BE46CCC0EF9525C244BD77123A5BB94F8122DDE0A7ECF0F9FD02527427ED1582713683A86</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 6A 67 74 12 33 79 13 5D 7F 96 F0 DB
0010 | 86 22 E9 6F 30 05 2C 76 1C DF 42 DC 72 A8 2D D2
0020 | 6D 37 A6 1B 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 53 61 BF 2E 07 C3 3C 38 1B D2 D0 81 46 C7 34 EA
0040 | E5 DA 20 FD 73 8E 82 DD 56 02 A0 E8 F4 5E B5 5A
0050 | 8F C3 94 9E 89 D0 A2 E1 3F 3A FA 99 BB AA 54 B1
0060 | 1E E1 AD 6C D7 95 DA 24 34 71 1A 08 95 62 2D 17
0070 | A3 98 41 FD A8 4B 95 58 43 66 F1 A7 AB 64 84 A3
0080 | D7 3B 7E 6E 4F 41 CA 96 2D A4 FF 68 D0 26 1D 0C
0090 | AB BA B1 64 48 71 DA 2A 6E F0 E3 A9 5C EC DC 16
00A0 | B5 86 3E ED BC C2 2C 7B 41 65 7E 57 C9 82 61 F3
00B0 | F4 54 66 24 30 63 E8 39 65 B9 2A 2E BE B9 E2 77
00C0 | 93 10 BA 8D F5 94 F9 70 4D 9B E6 72 2E B8 77 CE
00D0 | 07 D7 F5 C2 79 0F 08 43 DE 58 15 D0 3F 90 B1 8C
00E0 | 05 11 D6 E1 E8 81 2D 28 9A 41 A0 55 AE D7 AB 2A
00F0 | 1C 68 E0 16 F6 88 6E 0D F9 5F 7A 84 42 F6 EA 95
0100 | 36 BF 77 F8 64 30 C3 1D 22 8C AA 8B E4 6C CC 0E
0110 | F9 52 5C 24 4B D7 71 23 A5 BB 94 F8 12 2D DE 0A
0120 | 7E CF 0F 9F D0 25 27 42 7E D1 58 27 13 68 3A 86</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE0001005361BF2E07C33C381BD2D081</code> <code>46C734EAE5DA20FD738E82DD5602A0E8</code> <code>F45EB55A8FC3949E89D0A2E13F3AFA99</code> <code>BBAA54B11EE1AD6CD795DA2434711A08</code> <code>95622D17A39841FDA84B95584366F1A7</code> <code>AB6484A3D73B7E6E4F41CA962DA4FF68</code> <code>D0261D0CABBAB1644871DA2A6EF0E3A9</code> <code>5CECDC16B5863EEDBCC22C7B41657E57</code> <code>C98261F3F45466243063E83965B92A2E</code> <code>BEB9E2779310BA8DF594F9704D9BE672</code> <code>2EB877CE07D7F5C2790F0843DE5815D0</code> <code>3F90B18C0511D6E1E8812D289A41A055</code> <code>AED7AB2A1C68E016F6886E0DF95F7A84</code> <code>42F6EA9536BF77F86430C31D228CAA8B</code> <code>E46CCC0EF9525C244BD77123A5BB94F8</code> <code>122DDE0A7ECF0F9FD02527427ED15827</code><br> <code>13683A86</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B643666A6774123379135D7F96F0DB8622E96F30052C761CDF42DC72A82DD26D37A61B0000000000000000FE0001005361BF2E07C33C381BD2D08146C734EAE5DA20FD738E82DD5602A0E8F45EB55A8FC3949E89D0A2E13F3AFA99BBAA54B11EE1AD6CD795DA2434711A0895622D17A39841FDA84B95584366F1A7AB6484A3D73B7E6E4F41CA962DA4FF68D0261D0CABBAB1644871DA2A6EF0E3A95CECDC16B5863EEDBCC22C7B41657E57C98261F3F45466243063E83965B92A2EBEB9E2779310BA8DF594F9704D9BE6722EB877CE07D7F5C2790F0843DE5815D03F90B18C0511D6E1E8812D289A41A055AED7AB2A1C68E016F6886E0DF95F7A8442F6EA9536BF77F86430C31D228CAA8BE46CCC0EF9525C244BD77123A5BB94F8122DDE0A7ECF0F9FD02527427ED1582713683A86
padding = 100A24E8C8C2C73F7FA3356D
tmp_aes_key = 53F50E50695B0C050BF3555A44FAF84D2059423B6CBFE32A81FE74E62CE44459
tmp_aes_iv = C581587EF2C3FDCE09DCC2032ED5531220CE52AD1FA4BFF0F39447C2F8C9F9F8</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = AFCD3FCEC9DA1D526D148BC3828702E048B9EE53677CEE8306C66415B330A2427CEF41E1182A5056E50AD73C2694F03CBCE5D8192F9A966CC72D51DCC818F9F5A2442E340E0E801F14E310FA38F1EED0FFE12022756DAF151489641E48EC60947B1D0162847847863CF6E388FCB831DC76BF32FFB7FD9E8624F79B829C788B4D765EBDE7178DC4871A8E4C006F627A5A7AC78AA3573C983086165A820E5662B2A031047E454565CA0ECBFE2D2CE76A1E2CF68FFF069826D9A6F4835CD209C43708616BABB52CEC57A6919D10543167C665ECBB6C45F408793DF39C7DDD6C7C982A4B327B16CDB421A91AFA372D411E4E88C1332E16A7217DB5DDA00FDAF0CC2FBBB89837B698F2482D3443E5922BCC070A60CBA3DDA01CF71A616457F404439C3B4DDBBD8AE51993BF11D3AFC2C051F8BA39A36B1D3B1C55BBEF48F832ADF71B13141E8157DE7DE85A5E00DAE154D8C8</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 FC 3D 09 00 38 4F D4 68
0010 | 78 01 00 00 1F 5F 04 F5 6A 67 74 12 33 79 13 5D
0020 | 7F 96 F0 DB 86 22 E9 6F 30 05 2C 76 1C DF 42 DC
0030 | 72 A8 2D D2 6D 37 A6 1B FE 50 01 00 AF CD 3F CE
0040 | C9 DA 1D 52 6D 14 8B C3 82 87 02 E0 48 B9 EE 53
0050 | 67 7C EE 83 06 C6 64 15 B3 30 A2 42 7C EF 41 E1
0060 | 18 2A 50 56 E5 0A D7 3C 26 94 F0 3C BC E5 D8 19
0070 | 2F 9A 96 6C C7 2D 51 DC C8 18 F9 F5 A2 44 2E 34
0080 | 0E 0E 80 1F 14 E3 10 FA 38 F1 EE D0 FF E1 20 22
0090 | 75 6D AF 15 14 89 64 1E 48 EC 60 94 7B 1D 01 62
00A0 | 84 78 47 86 3C F6 E3 88 FC B8 31 DC 76 BF 32 FF
00B0 | B7 FD 9E 86 24 F7 9B 82 9C 78 8B 4D 76 5E BD E7
00C0 | 17 8D C4 87 1A 8E 4C 00 6F 62 7A 5A 7A C7 8A A3
00D0 | 57 3C 98 30 86 16 5A 82 0E 56 62 B2 A0 31 04 7E
00E0 | 45 45 65 CA 0E CB FE 2D 2C E7 6A 1E 2C F6 8F FF
00F0 | 06 98 26 D9 A6 F4 83 5C D2 09 C4 37 08 61 6B AB
0100 | B5 2C EC 57 A6 91 9D 10 54 31 67 C6 65 EC BB 6C
0110 | 45 F4 08 79 3D F3 9C 7D DD 6C 7C 98 2A 4B 32 7B
0120 | 16 CD B4 21 A9 1A FA 37 2D 41 1E 4E 88 C1 33 2E
0130 | 16 A7 21 7D B5 DD A0 0F DA F0 CC 2F BB B8 98 37
0140 | B6 98 F2 48 2D 34 43 E5 92 2B CC 07 0A 60 CB A3
0150 | DD A0 1C F7 1A 61 64 57 F4 04 43 9C 3B 4D DB BD
0160 | 8A E5 19 93 BF 11 D3 AF C2 C0 51 F8 BA 39 A3 6B
0170 | 1D 3B 1C 55 BB EF 48 F8 32 AD F7 1B 13 14 1E 81
0180 | 57 DE 7D E8 5A 5E 00 DA E1 54 D8 C8</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>FC3D0900384FD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100AFCD3FCEC9DA1D526D148BC3</code> <code>828702E048B9EE53677CEE8306C66415</code> <code>B330A2427CEF41E1182A5056E50AD73C</code> <code>2694F03CBCE5D8192F9A966CC72D51DC</code> <code>C818F9F5A2442E340E0E801F14E310FA</code> <code>38F1EED0FFE12022756DAF151489641E</code> <code>48EC60947B1D0162847847863CF6E388</code> <code>FCB831DC76BF32FFB7FD9E8624F79B82</code> <code>9C788B4D765EBDE7178DC4871A8E4C00</code> <code>6F627A5A7AC78AA3573C983086165A82</code> <code>0E5662B2A031047E454565CA0ECBFE2D</code> <code>2CE76A1E2CF68FFF069826D9A6F4835C</code> <code>D209C43708616BABB52CEC57A6919D10</code> <code>543167C665ECBB6C45F408793DF39C7D</code> <code>DD6C7C982A4B327B16CDB421A91AFA37</code> <code>2D411E4E88C1332E16A7217DB5DDA00F</code> <code>DAF0CC2FBBB89837B698F2482D3443E5</code> <code>922BCC070A60CBA3DDA01CF71A616457</code> <code>F404439C3B4DDBBD8AE51993BF11D3AF</code> <code>C2C051F8BA39A36B1D3B1C55BBEF48F8</code> <code>32ADF71B13141E8157DE7DE85A5E00DA</code><br> <code>E154D8C8</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 0604D97A477D01E21657FADAD0FB74D1EF05CDD7912787AF9BC73FD790CE91870CF7DAF66CF402F224A30A1141DDE436E7ABD28B4F007BBDF41ADC5C768A0B8A591115EC61433954E85596980B86293405A669054E5F0B61427B385D01DCC52A88F255718809FF949D7754590D08031BD95BE40020F983147981A0204A49D6A1159AC3DF0B3CF571E669DE6552DCB878E0BC29D7C852B07E32431CE9965BAC1AF02FC299A01CA938AF28E065F0184E8F24A4D9BC9C0E4568A22D1D97077F6359FF2247E9B6E55863DFD51E20F1F1A2148D8ED2A38781542ABB7492B5EC58BE5268919BC7EEEB4094520D013A0BD8E16FB4A230B1B635601D0A4FF2E65F205F5A</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 18 57 09 3A 4F D4 68
0010 | 34 00 00 00 34 F7 CB 3B 6A 67 74 12 33 79 13 5D
0020 | 7F 96 F0 DB 86 22 E9 6F 30 05 2C 76 1C DF 42 DC
0030 | 72 A8 2D D2 6D 37 A6 1B B7 A4 7F DE 82 54 54 3A
0040 | B8 B6 23 78 B8 6D F1 D7</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>011857093A4FD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>6A6774123379135D7F96F0DB8622E96F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>30052C761CDF42DC72A82DD26D37A61B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>B7A47FDE8254543AB8B62378B86DF1D7</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

