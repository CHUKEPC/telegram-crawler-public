<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 20 08 08 00 44 CE BA 68
0010 | 14 00 00 00 F1 8E 7E BE 19 05 53 13 D5 EA 88 FA
0020 | D7 17 64 1C A6 25 EF 2F</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>2008080044CEBA68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 A8 07 FA 44 CE BA 68
0010 | 50 00 00 00 63 24 16 05 19 05 53 13 D5 EA 88 FA
0020 | D7 17 64 1C A6 25 EF 2F 43 0D 78 E4 27 52 1D 51
0030 | E2 B6 C0 1B DB 5C 53 F7 08 1A EB 85 D5 46 AD 5F
0040 | 53 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01A807FA44CEBA68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081AEB85D546AD5F53000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1939791215573426003</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 1939791215573426003</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>1939791215573426003 = 1071895159 * 1809683717</code></p>
<pre><code>p = 1071895159
q = 1809683717</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1A EB 85 D5 46 AD 5F 53 00 00 00
0010 | 04 3F E3 D2 77 00 00 00 04 6B DD 95 05 00 00 00
0020 | 19 05 53 13 D5 EA 88 FA D7 17 64 1C A6 25 EF 2F
0030 | 43 0D 78 E4 27 52 1D 51 E2 B6 C0 1B DB 5C 53 F7
0040 | D9 00 84 84 6C 75 31 44 60 4D 40 DC 21 52 98 19
0050 | 0E 94 2D 29 B3 2A 24 FB 09 37 BC 12 73 AB 2F C1
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081AEB85D546AD5F53000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1939791215573426003</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>043FE3D277000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1071895159</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046BDD9505000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1809683717</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>D90084846C753144604D40DC21529819</code> <code>0E942D29B32A24FB0937BC1273AB2FC1</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081AEB85D546AD5F53000000043FE3D277000000046BDD950500000019055313D5EA88FAD717641CA625EF2F430D78E427521D51E2B6C01BDB5C53F7D90084846C753144604D40DC215298190E942D29B32A24FB0937BC1273AB2FC102000000
random_padding_bytes = 2AF153B19E161A5E751FCC0E954A99D44314468BB4DCE45E9C974A7ADF5201E3E87C5C75035BB0FC238AEAAB016EB581E45C70B013296B21A100CD1008384571B5C422F006C6E89E4D93636DFF72049D42F4F103F27BC0F9BA509CAE</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 20A4A1CF014F5D2680F4F59084FF1B37D64A8B856BFE50A1B3931543EC5C22F1F91CEC7F249091634D9CD782997B2ECE746B602344FCE00D7BC365644E68834810AB54A6EEADD4293795C7D48434A0310826FF703F6C124A4C7CE4548FA82CFBE34FB6216A0A2AD971DF06A01C0CB7EBE4D98B117C8A699AEF762AD17B063E5C69809EF0755A5C00CA55CD4D258560FD07776345EBFF66279430D2EA12975B07775C6F51581FD616F72A8F5CBC4A2569B9C29A2E92C23C20A3E1D3339758EDB0F5D11E60822844C29F398F6EC584FCC42D269134D7C20E00FBC8684122B47AA4536DA9BF4A0DB6B3CD986BD499CA438379355A4B980C6B1B463317B30CC38183</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 DC 54 02 00 45 CE BA 68
0010 | 40 01 00 00 BE E4 12 D7 19 05 53 13 D5 EA 88 FA
0020 | D7 17 64 1C A6 25 EF 2F 43 0D 78 E4 27 52 1D 51
0030 | E2 B6 C0 1B DB 5C 53 F7 04 3F E3 D2 77 00 00 00
0040 | 04 6B DD 95 05 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 20 A4 A1 CF 01 4F 5D 26 80 F4 F5 90
0060 | 84 FF 1B 37 D6 4A 8B 85 6B FE 50 A1 B3 93 15 43
0070 | EC 5C 22 F1 F9 1C EC 7F 24 90 91 63 4D 9C D7 82
0080 | 99 7B 2E CE 74 6B 60 23 44 FC E0 0D 7B C3 65 64
0090 | 4E 68 83 48 10 AB 54 A6 EE AD D4 29 37 95 C7 D4
00A0 | 84 34 A0 31 08 26 FF 70 3F 6C 12 4A 4C 7C E4 54
00B0 | 8F A8 2C FB E3 4F B6 21 6A 0A 2A D9 71 DF 06 A0
00C0 | 1C 0C B7 EB E4 D9 8B 11 7C 8A 69 9A EF 76 2A D1
00D0 | 7B 06 3E 5C 69 80 9E F0 75 5A 5C 00 CA 55 CD 4D
00E0 | 25 85 60 FD 07 77 63 45 EB FF 66 27 94 30 D2 EA
00F0 | 12 97 5B 07 77 5C 6F 51 58 1F D6 16 F7 2A 8F 5C
0100 | BC 4A 25 69 B9 C2 9A 2E 92 C2 3C 20 A3 E1 D3 33
0110 | 97 58 ED B0 F5 D1 1E 60 82 28 44 C2 9F 39 8F 6E
0120 | C5 84 FC C4 2D 26 91 34 D7 C2 0E 00 FB C8 68 41
0130 | 22 B4 7A A4 53 6D A9 BF 4A 0D B6 B3 CD 98 6B D4
0140 | 99 CA 43 83 79 35 5A 4B 98 0C 6B 1B 46 33 17 B3
0150 | 0C C3 81 83</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>DC54020045CEBA68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>043FE3D277000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1071895159</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046BDD9505000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1809683717</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE00010020A4A1CF014F5D2680F4F590</code> <code>84FF1B37D64A8B856BFE50A1B3931543</code> <code>EC5C22F1F91CEC7F249091634D9CD782</code> <code>997B2ECE746B602344FCE00D7BC36564</code> <code>4E68834810AB54A6EEADD4293795C7D4</code> <code>8434A0310826FF703F6C124A4C7CE454</code> <code>8FA82CFBE34FB6216A0A2AD971DF06A0</code> <code>1C0CB7EBE4D98B117C8A699AEF762AD1</code> <code>7B063E5C69809EF0755A5C00CA55CD4D</code> <code>258560FD07776345EBFF66279430D2EA</code> <code>12975B07775C6F51581FD616F72A8F5C</code> <code>BC4A2569B9C29A2E92C23C20A3E1D333</code> <code>9758EDB0F5D11E60822844C29F398F6E</code> <code>C584FCC42D269134D7C20E00FBC86841</code> <code>22B47AA4536DA9BF4A0DB6B3CD986BD4</code> <code>99CA438379355A4B980C6B1B463317B3</code><br> <code>0CC38183</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 AC 21 21 45 CE BA 68
0010 | 78 02 00 00 5C 07 E8 D0 19 05 53 13 D5 EA 88 FA
0020 | D7 17 64 1C A6 25 EF 2F 43 0D 78 E4 27 52 1D 51
0030 | E2 B6 C0 1B DB 5C 53 F7 FE 50 02 00 FB E4 96 BF
0040 | 2C 0D AE 90 AD 23 C0 4A 77 1F 1C 55 3E 1E CB 18
0050 | F8 8C 62 BA 7D 1D 1F F4 9C 33 72 5B 15 22 58 8D
0060 | 59 EC F8 E0 16 C0 66 66 06 17 2C D4 C2 9E 2D 97
0070 | A3 A3 96 CA 0C 75 6E F4 0E 59 36 D4 C0 04 C5 CB
0080 | 31 50 4D D3 C5 3D BB 15 92 A6 EA 34 0D 0E FC 8A
0090 | A2 64 05 37 BC 6F A2 5E F3 B6 B2 A4 E8 67 A3 E8
00A0 | 11 6F DF 29 BC CD DE 29 0A 47 45 4D 0A 4B 43 EC
00B0 | EC 26 B3 CA B8 D7 90 51 A6 AD C8 A8 5B 4C 54 BE
00C0 | D6 6E D7 98 33 08 70 FC AA 35 C4 A5 E0 CD E0 D3
00D0 | A1 27 3F DA 2A F3 2E F6 C1 AB 39 29 F6 3A 1F 2A
00E0 | E9 0B C9 B5 35 57 AF DD CA 0C 0B F2 36 7A 10 F5
00F0 | C1 80 BB 3B 9F 98 4C 88 BE 6F 8B C3 82 B0 3D 24
0100 | 8C 96 86 20 83 EE CE 6F AB B4 3B A8 73 57 04 B9
0110 | 58 33 E6 9C E3 BF 00 07 4F DF B7 33 85 1D A8 EB
0120 | 2D 77 28 C7 5F 15 4C 15 C9 4E 52 40 E5 85 A2 F6
0130 | B6 D2 18 90 54 6A 9A 9D 6D 11 9A 54 B8 5C B3 D6
0140 | 7F C1 8B 65 9E 39 DA 1A A0 F9 CF 3A 3B 6E 23 58
0150 | 4C 99 7B 14 A2 84 91 92 BA 63 17 6B 8F E5 46 25
0160 | 74 6B E4 42 71 B9 AF 36 28 EF A1 A5 E9 7E C7 09
0170 | DA 62 33 B5 3F 58 E8 9A A2 2A 50 15 47 88 2D 59
0180 | 31 D7 B3 80 78 A6 0E 08 B7 2D 2F 9C 40 98 7E 5F
0190 | C2 C6 94 A1 8F D8 E5 7D 13 47 E9 2F 5F D5 10 19
01A0 | 6B 92 24 66 5F EB 2A 1A 98 C4 E2 8D C9 40 71 66
01B0 | 0B 23 9D 31 B3 A5 4E 61 DF FA 26 C7 D2 7D 44 82
01C0 | 63 BE B9 22 C4 E2 5D 6C BD 97 8E D9 54 F8 74 A0
01D0 | 68 E0 2C C9 7D 29 3C C7 53 16 5E 89 2C 14 80 5A
01E0 | C4 E5 BA 5C 87 8F 1F 30 1B 04 F3 53 C9 1D 8C CB
01F0 | 8F 94 8D 52 79 1C B2 77 20 18 9A DB 8E 98 4E 1D
0200 | E7 C1 D9 14 52 8F F4 82 7A 14 18 54 9F F1 DC D1
0210 | 63 3F 1F 6B 9E D0 B8 31 F3 49 99 BB 35 0D 48 5B
0220 | 75 23 43 AE FF 78 35 7E 2A 67 B9 28 50 24 BC F6
0230 | 2E 1F 6A 66 50 8F 02 54 1D 49 E2 F7 C5 C5 62 2D
0240 | CF BB 54 82 73 C4 DE 40 44 01 F1 EE 01 D3 DA 77
0250 | B1 E9 91 C7 46 E6 9E 6A DA 23 1B B8 7D D4 04 3C
0260 | 80 F5 D8 3C C2 6A 51 66 F4 A8 A8 61 8A C9 32 8B
0270 | 59 88 40 D7 0E 08 31 5A B7 41 D6 F7 F9 F0 55 C0
0280 | 8F 65 29 63 40 91 36 56 24 8D 04 1A</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01AC212145CEBA68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200FBE496BF2C0DAE90AD23C04A</code> <code>771F1C553E1ECB18F88C62BA7D1D1FF4</code> <code>9C33725B1522588D59ECF8E016C06666</code> <code>06172CD4C29E2D97A3A396CA0C756EF4</code> <code>0E5936D4C004C5CB31504DD3C53DBB15</code> <code>92A6EA340D0EFC8AA2640537BC6FA25E</code> <code>F3B6B2A4E867A3E8116FDF29BCCDDE29</code> <code>0A47454D0A4B43ECEC26B3CAB8D79051</code> <code>A6ADC8A85B4C54BED66ED798330870FC</code> <code>AA35C4A5E0CDE0D3A1273FDA2AF32EF6</code> <code>C1AB3929F63A1F2AE90BC9B53557AFDD</code> <code>CA0C0BF2367A10F5C180BB3B9F984C88</code> <code>BE6F8BC382B03D248C96862083EECE6F</code> <code>ABB43BA8735704B95833E69CE3BF0007</code> <code>4FDFB733851DA8EB2D7728C75F154C15</code> <code>C94E5240E585A2F6B6D21890546A9A9D</code> <code>6D119A54B85CB3D67FC18B659E39DA1A</code> <code>A0F9CF3A3B6E23584C997B14A2849192</code> <code>BA63176B8FE54625746BE44271B9AF36</code> <code>28EFA1A5E97EC709DA6233B53F58E89A</code> <code>A22A501547882D5931D7B38078A60E08</code> <code>B72D2F9C40987E5FC2C694A18FD8E57D</code> <code>1347E92F5FD510196B9224665FEB2A1A</code> <code>98C4E28DC94071660B239D31B3A54E61</code> <code>DFFA26C7D27D448263BEB922C4E25D6C</code> <code>BD978ED954F874A068E02CC97D293CC7</code> <code>53165E892C14805AC4E5BA5C878F1F30</code> <code>1B04F353C91D8CCB8F948D52791CB277</code> <code>20189ADB8E984E1DE7C1D914528FF482</code> <code>7A1418549FF1DCD1633F1F6B9ED0B831</code> <code>F34999BB350D485B752343AEFF78357E</code> <code>2A67B9285024BCF62E1F6A66508F0254</code> <code>1D49E2F7C5C5622DCFBB548273C4DE40</code> <code>4401F1EE01D3DA77B1E991C746E69E6A</code> <code>DA231BB87DD4043C80F5D83CC26A5166</code> <code>F4A8A8618AC9328B598840D70E08315A</code> <code>B741D6F7F9F055C08F65296340913656</code><br> <code>248D041A</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = FBE496BF2C0DAE90AD23C04A771F1C553E1ECB18F88C62BA7D1D1FF49C33725B1522588D59ECF8E016C0666606172CD4C29E2D97A3A396CA0C756EF40E5936D4C004C5CB31504DD3C53DBB1592A6EA340D0EFC8AA2640537BC6FA25EF3B6B2A4E867A3E8116FDF29BCCDDE290A47454D0A4B43ECEC26B3CAB8D79051A6ADC8A85B4C54BED66ED798330870FCAA35C4A5E0CDE0D3A1273FDA2AF32EF6C1AB3929F63A1F2AE90BC9B53557AFDDCA0C0BF2367A10F5C180BB3B9F984C88BE6F8BC382B03D248C96862083EECE6FABB43BA8735704B95833E69CE3BF00074FDFB733851DA8EB2D7728C75F154C15C94E5240E585A2F6B6D21890546A9A9D6D119A54B85CB3D67FC18B659E39DA1AA0F9CF3A3B6E23584C997B14A2849192BA63176B8FE54625746BE44271B9AF3628EFA1A5E97EC709DA6233B53F58E89AA22A501547882D5931D7B38078A60E08B72D2F9C40987E5FC2C694A18FD8E57D1347E92F5FD510196B9224665FEB2A1A98C4E28DC94071660B239D31B3A54E61DFFA26C7D27D448263BEB922C4E25D6CBD978ED954F874A068E02CC97D293CC753165E892C14805AC4E5BA5C878F1F301B04F353C91D8CCB8F948D52791CB27720189ADB8E984E1DE7C1D914528FF4827A1418549FF1DCD1633F1F6B9ED0B831F34999BB350D485B752343AEFF78357E2A67B9285024BCF62E1F6A66508F02541D49E2F7C5C5622DCFBB548273C4DE404401F1EE01D3DA77B1E991C746E69E6ADA231BB87DD4043C80F5D83CC26A5166F4A8A8618AC9328B598840D70E08315AB741D6F7F9F055C08F65296340913656248D041A
tmp_aes_key = 6A6240BDA926B5D0E1FAD22EC0B9AB49346264E8A1A50B60D16617CD9CF0E0BD
tmp_aes_iv = 6511D663B536A5DEE234320E7DEB431863746CC5F50FE9C67680696ED9008484</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 37DE442A4FE02FB61E022D5C36FD0D53136EDAF2BA0D89B519055313D5EA88FAD717641CA625EF2F430D78E427521D51E2B6C01BDB5C53F703000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010080C2C588C08D1AFB91CE8B01FC75F1B4A2F293E79E77BC826066181F16D2A52E22B755EAF1A7C21164AA15E56419F33CBAD943BA0EC90FFFC0234EB776744A686FA71C8B97299601CCA54F16CA038AC6236A935AFCCAF93A483E16347BE68C0B16D3C693E7720A496295DD8512F51B36A978BF4EB96D7038FC75AC3C4BB5561D902D10109C6E563C98F325D41C726EBEA7A6F576BE7E6342DAFCB3CB3E6599CD66CC0C00875268CF300B0BA7725EE7B2A51B30E49F845A3AC103040919CC5E16FF8D2D7DEB1959E85BD637015CC6438E439BB63721EA7EFF82AEF1D5858A411B1C8363A498624273694A0680326A23FBFFB02C75EFB910BFC4FC9B1EA51560F945CEBA68D170D5DA0EA73999
answer = BA0D89B519055313D5EA88FAD717641CA625EF2F430D78E427521D51E2B6C01BDB5C53F703000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010080C2C588C08D1AFB91CE8B01FC75F1B4A2F293E79E77BC826066181F16D2A52E22B755EAF1A7C21164AA15E56419F33CBAD943BA0EC90FFFC0234EB776744A686FA71C8B97299601CCA54F16CA038AC6236A935AFCCAF93A483E16347BE68C0B16D3C693E7720A496295DD8512F51B36A978BF4EB96D7038FC75AC3C4BB5561D902D10109C6E563C98F325D41C726EBEA7A6F576BE7E6342DAFCB3CB3E6599CD66CC0C00875268CF300B0BA7725EE7B2A51B30E49F845A3AC103040919CC5E16FF8D2D7DEB1959E85BD637015CC6438E439BB63721EA7EFF82AEF1D5858A411B1C8363A498624273694A0680326A23FBFFB02C75EFB910BFC4FC9B1EA51560F945CEBA68D170D5DA0EA73999</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 19 05 53 13 D5 EA 88 FA D7 17 64 1C
0010 | A6 25 EF 2F 43 0D 78 E4 27 52 1D 51 E2 B6 C0 1B
0020 | DB 5C 53 F7 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 80 C2 C5 88 C0 8D 1A FB 91 CE 8B 01 FC 75 F1 B4
0140 | A2 F2 93 E7 9E 77 BC 82 60 66 18 1F 16 D2 A5 2E
0150 | 22 B7 55 EA F1 A7 C2 11 64 AA 15 E5 64 19 F3 3C
0160 | BA D9 43 BA 0E C9 0F FF C0 23 4E B7 76 74 4A 68
0170 | 6F A7 1C 8B 97 29 96 01 CC A5 4F 16 CA 03 8A C6
0180 | 23 6A 93 5A FC CA F9 3A 48 3E 16 34 7B E6 8C 0B
0190 | 16 D3 C6 93 E7 72 0A 49 62 95 DD 85 12 F5 1B 36
01A0 | A9 78 BF 4E B9 6D 70 38 FC 75 AC 3C 4B B5 56 1D
01B0 | 90 2D 10 10 9C 6E 56 3C 98 F3 25 D4 1C 72 6E BE
01C0 | A7 A6 F5 76 BE 7E 63 42 DA FC B3 CB 3E 65 99 CD
01D0 | 66 CC 0C 00 87 52 68 CF 30 0B 0B A7 72 5E E7 B2
01E0 | A5 1B 30 E4 9F 84 5A 3A C1 03 04 09 19 CC 5E 16
01F0 | FF 8D 2D 7D EB 19 59 E8 5B D6 37 01 5C C6 43 8E
0200 | 43 9B B6 37 21 EA 7E FF 82 AE F1 D5 85 8A 41 1B
0210 | 1C 83 63 A4 98 62 42 73 69 4A 06 80 32 6A 23 FB
0220 | FF B0 2C 75 EF B9 10 BF C4 FC 9B 1E A5 15 60 F9
0230 | 45 CE BA 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE00010080C2C588C08D1AFB91CE8B01</code> <code>FC75F1B4A2F293E79E77BC826066181F</code> <code>16D2A52E22B755EAF1A7C21164AA15E5</code> <code>6419F33CBAD943BA0EC90FFFC0234EB7</code> <code>76744A686FA71C8B97299601CCA54F16</code> <code>CA038AC6236A935AFCCAF93A483E1634</code> <code>7BE68C0B16D3C693E7720A496295DD85</code> <code>12F51B36A978BF4EB96D7038FC75AC3C</code> <code>4BB5561D902D10109C6E563C98F325D4</code> <code>1C726EBEA7A6F576BE7E6342DAFCB3CB</code> <code>3E6599CD66CC0C00875268CF300B0BA7</code> <code>725EE7B2A51B30E49F845A3AC1030409</code> <code>19CC5E16FF8D2D7DEB1959E85BD63701</code> <code>5CC6438E439BB63721EA7EFF82AEF1D5</code> <code>858A411B1C8363A498624273694A0680</code> <code>326A23FBFFB02C75EFB910BFC4FC9B1E</code><br> <code>A51560F9</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>45CEBA68</code> (1757072965 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = ECBD582B55F0FEFB52AAF91A121C930EF6EF25B6953298FB1B82B78E55AC4E1A2CB5A4DD2AEBB9E24844D46794A9BD96BD389DC50305B063EECC923E021D06E0CE218FAA90D9AD4B8B833F81C09B2F0E1FB793FC162E432C328682C59273CB07E4E03352B5AE143DF9B62A0C51E8ED92762F2431BC50DEF62E6BDA0DD85F54F87F38496D3092AA5063323C7A086362CD32C7B2F320552E32EABC493B8E1BAB4ED2D71B03A8CB6907E5003E14E0B4C2DBE8214C530C5398B85B497299AB5681F9B6138EDDF07ABEC47ECDC91BDC71B874F56E28CDDCCE9EF8F663E3DB86FEECC7CE7935A1EB592CC1293735746B3090E3BA567D42E4F20F00D7D8AE997BCCFF50</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 43E3DEA662C0409DB43185999366898C472600C60978D62F524729B94B42798AC4E602A3B0769D242AF07F07741ACBE29D7232263926E0832FE2A38B1C28984BBF82E817686BD222EF81234B34F5DDE4E1F476828F4A6D51A4F56C8EB51969AB183C9D964F58437DD054DADCA647CFAB330F057F01D2869C632754010E3EA494AA29A2255752C04BBCC9B690849BA428D0DA02CF894E6D3F9C53496D78552852765CB60160FF46A28664E38A6831D9ED8FC3A98FC800C283E5729D2FF5FECE0AD7EA28A8443EB53333037EA3F6EE60C43024F9E330D4A751C53AE8DC5CADF0C9334EED4A9EB9BD8B6C66567D061CC63B680A2BFFE8B0EB3896D06EF629544A43</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 19 05 53 13 D5 EA 88 FA D7 17 64 1C
0010 | A6 25 EF 2F 43 0D 78 E4 27 52 1D 51 E2 B6 C0 1B
0020 | DB 5C 53 F7 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 43 E3 DE A6 62 C0 40 9D B4 31 85 99 93 66 89 8C
0040 | 47 26 00 C6 09 78 D6 2F 52 47 29 B9 4B 42 79 8A
0050 | C4 E6 02 A3 B0 76 9D 24 2A F0 7F 07 74 1A CB E2
0060 | 9D 72 32 26 39 26 E0 83 2F E2 A3 8B 1C 28 98 4B
0070 | BF 82 E8 17 68 6B D2 22 EF 81 23 4B 34 F5 DD E4
0080 | E1 F4 76 82 8F 4A 6D 51 A4 F5 6C 8E B5 19 69 AB
0090 | 18 3C 9D 96 4F 58 43 7D D0 54 DA DC A6 47 CF AB
00A0 | 33 0F 05 7F 01 D2 86 9C 63 27 54 01 0E 3E A4 94
00B0 | AA 29 A2 25 57 52 C0 4B BC C9 B6 90 84 9B A4 28
00C0 | D0 DA 02 CF 89 4E 6D 3F 9C 53 49 6D 78 55 28 52
00D0 | 76 5C B6 01 60 FF 46 A2 86 64 E3 8A 68 31 D9 ED
00E0 | 8F C3 A9 8F C8 00 C2 83 E5 72 9D 2F F5 FE CE 0A
00F0 | D7 EA 28 A8 44 3E B5 33 33 03 7E A3 F6 EE 60 C4
0100 | 30 24 F9 E3 30 D4 A7 51 C5 3A E8 DC 5C AD F0 C9
0110 | 33 4E ED 4A 9E B9 BD 8B 6C 66 56 7D 06 1C C6 3B
0120 | 68 0A 2B FF E8 B0 EB 38 96 D0 6E F6 29 54 4A 43</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE00010043E3DEA662C0409DB4318599</code> <code>9366898C472600C60978D62F524729B9</code> <code>4B42798AC4E602A3B0769D242AF07F07</code> <code>741ACBE29D7232263926E0832FE2A38B</code> <code>1C28984BBF82E817686BD222EF81234B</code> <code>34F5DDE4E1F476828F4A6D51A4F56C8E</code> <code>B51969AB183C9D964F58437DD054DADC</code> <code>A647CFAB330F057F01D2869C63275401</code> <code>0E3EA494AA29A2255752C04BBCC9B690</code> <code>849BA428D0DA02CF894E6D3F9C53496D</code> <code>78552852765CB60160FF46A28664E38A</code> <code>6831D9ED8FC3A98FC800C283E5729D2F</code> <code>F5FECE0AD7EA28A8443EB53333037EA3</code> <code>F6EE60C43024F9E330D4A751C53AE8DC</code> <code>5CADF0C9334EED4A9EB9BD8B6C66567D</code> <code>061CC63B680A2BFFE8B0EB3896D06EF6</code><br> <code>29544A43</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B6436619055313D5EA88FAD717641CA625EF2F430D78E427521D51E2B6C01BDB5C53F70000000000000000FE00010043E3DEA662C0409DB43185999366898C472600C60978D62F524729B94B42798AC4E602A3B0769D242AF07F07741ACBE29D7232263926E0832FE2A38B1C28984BBF82E817686BD222EF81234B34F5DDE4E1F476828F4A6D51A4F56C8EB51969AB183C9D964F58437DD054DADCA647CFAB330F057F01D2869C632754010E3EA494AA29A2255752C04BBCC9B690849BA428D0DA02CF894E6D3F9C53496D78552852765CB60160FF46A28664E38A6831D9ED8FC3A98FC800C283E5729D2FF5FECE0AD7EA28A8443EB53333037EA3F6EE60C43024F9E330D4A751C53AE8DC5CADF0C9334EED4A9EB9BD8B6C66567D061CC63B680A2BFFE8B0EB3896D06EF629544A43
padding = E4F36064FA0924AC5A74FFDD
tmp_aes_key = 6A6240BDA926B5D0E1FAD22EC0B9AB49346264E8A1A50B60D16617CD9CF0E0BD
tmp_aes_iv = 6511D663B536A5DEE234320E7DEB431863746CC5F50FE9C67680696ED9008484</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 1737CDA0C8E5978E330F525CF0B04C61B1EE90CDFC165AEAC2145EA6F7BE7666357D573DBCB640A086D303F2E10621C57F4F07D6533D8A0D34B5BF05BD7D998A57DE96B6FE45B36270F16E43D06C69ED56A5F737BDBCA55AD753B817096E84DA1B2A622F28CC8AFA910A54F68DC5F508CC7CE1F883A49CDBD4DEA98504B23AC7BC69A4BA624CCAC2AAA54A93CFAA49B9D9003973F28897FDEA905D2E72C8404BBBF7C797F15C97744D7CB1AA94AA4C345C14BA9F699ACAEB8CA18FB4C51DBDF6FAE4011824719C36B11CF21BCCD3893160E19D263574A56B6A17D1C016548A976996371F7DF49EB422210B2C01A233426AE1C2F657160A0CC9F5700609B7EACC0352C9066BDB132A05A1671522F3EB14FF02A9BD3C580D539AF8B561A875F4BC7F113F19E350B4732CA34B1E773038CA182CF8A5081CC1DFE08CE22AECC602C1EC0E3EA5548D37694243154C4D83109A</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 FC 7A 04 00 46 CE BA 68
0010 | 78 01 00 00 1F 5F 04 F5 19 05 53 13 D5 EA 88 FA
0020 | D7 17 64 1C A6 25 EF 2F 43 0D 78 E4 27 52 1D 51
0030 | E2 B6 C0 1B DB 5C 53 F7 FE 50 01 00 17 37 CD A0
0040 | C8 E5 97 8E 33 0F 52 5C F0 B0 4C 61 B1 EE 90 CD
0050 | FC 16 5A EA C2 14 5E A6 F7 BE 76 66 35 7D 57 3D
0060 | BC B6 40 A0 86 D3 03 F2 E1 06 21 C5 7F 4F 07 D6
0070 | 53 3D 8A 0D 34 B5 BF 05 BD 7D 99 8A 57 DE 96 B6
0080 | FE 45 B3 62 70 F1 6E 43 D0 6C 69 ED 56 A5 F7 37
0090 | BD BC A5 5A D7 53 B8 17 09 6E 84 DA 1B 2A 62 2F
00A0 | 28 CC 8A FA 91 0A 54 F6 8D C5 F5 08 CC 7C E1 F8
00B0 | 83 A4 9C DB D4 DE A9 85 04 B2 3A C7 BC 69 A4 BA
00C0 | 62 4C CA C2 AA A5 4A 93 CF AA 49 B9 D9 00 39 73
00D0 | F2 88 97 FD EA 90 5D 2E 72 C8 40 4B BB F7 C7 97
00E0 | F1 5C 97 74 4D 7C B1 AA 94 AA 4C 34 5C 14 BA 9F
00F0 | 69 9A CA EB 8C A1 8F B4 C5 1D BD F6 FA E4 01 18
0100 | 24 71 9C 36 B1 1C F2 1B CC D3 89 31 60 E1 9D 26
0110 | 35 74 A5 6B 6A 17 D1 C0 16 54 8A 97 69 96 37 1F
0120 | 7D F4 9E B4 22 21 0B 2C 01 A2 33 42 6A E1 C2 F6
0130 | 57 16 0A 0C C9 F5 70 06 09 B7 EA CC 03 52 C9 06
0140 | 6B DB 13 2A 05 A1 67 15 22 F3 EB 14 FF 02 A9 BD
0150 | 3C 58 0D 53 9A F8 B5 61 A8 75 F4 BC 7F 11 3F 19
0160 | E3 50 B4 73 2C A3 4B 1E 77 30 38 CA 18 2C F8 A5
0170 | 08 1C C1 DF E0 8C E2 2A EC C6 02 C1 EC 0E 3E A5
0180 | 54 8D 37 69 42 43 15 4C 4D 83 10 9A</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>FC7A040046CEBA68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE5001001737CDA0C8E5978E330F525C</code> <code>F0B04C61B1EE90CDFC165AEAC2145EA6</code> <code>F7BE7666357D573DBCB640A086D303F2</code> <code>E10621C57F4F07D6533D8A0D34B5BF05</code> <code>BD7D998A57DE96B6FE45B36270F16E43</code> <code>D06C69ED56A5F737BDBCA55AD753B817</code> <code>096E84DA1B2A622F28CC8AFA910A54F6</code> <code>8DC5F508CC7CE1F883A49CDBD4DEA985</code> <code>04B23AC7BC69A4BA624CCAC2AAA54A93</code> <code>CFAA49B9D9003973F28897FDEA905D2E</code> <code>72C8404BBBF7C797F15C97744D7CB1AA</code> <code>94AA4C345C14BA9F699ACAEB8CA18FB4</code> <code>C51DBDF6FAE4011824719C36B11CF21B</code> <code>CCD3893160E19D263574A56B6A17D1C0</code> <code>16548A976996371F7DF49EB422210B2C</code> <code>01A233426AE1C2F657160A0CC9F57006</code> <code>09B7EACC0352C9066BDB132A05A16715</code> <code>22F3EB14FF02A9BD3C580D539AF8B561</code> <code>A875F4BC7F113F19E350B4732CA34B1E</code> <code>773038CA182CF8A5081CC1DFE08CE22A</code> <code>ECC602C1EC0E3EA5548D37694243154C</code><br> <code>4D83109A</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 255270ADB85D3EB27BC8A0D687EF491B2D550EF75B4AD514000BCDBE6C69F81D25BC80004E36C01F7ABDA5B4051FE2A58E7BCF037E15B2A367EF8CF39EA00B5F4360F0A9B40D7DD169CDB194CCEE6D9ECF9B19D02AAF4033F0123935E8CB3709082447CA241F6C783F5592C4AC547B54AE52D712C2C7F4D2CBD9931C5E24D8F1EBA53896F56C02CDB4C53C9B73AC63A699AEC13425E449128A424A7D4DD04147642B98C71118EC2C0FE2349F2169E16A1C51898C20A26E690C28DB2982ED476C4CF15A83048770335A8BAF30BB0632078F06EB0D17A4B7AB9DEA3D2E66BE875BCC133A6A157451E0E813B4860D7B7C543698064A8E05AB07E5F1015375AE1E94</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 94 09 DE 46 CE BA 68
0010 | 34 00 00 00 34 F7 CB 3B 19 05 53 13 D5 EA 88 FA
0020 | D7 17 64 1C A6 25 EF 2F 43 0D 78 E4 27 52 1D 51
0030 | E2 B6 C0 1B DB 5C 53 F7 EC 10 5E 27 2E 2C A9 DA
0040 | B5 09 3E CE A1 BD 3D 2D</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>019409DE46CEBA68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>19055313D5EA88FAD717641CA625EF2F</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>430D78E427521D51E2B6C01BDB5C53F7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>EC105E272E2CA9DAB5093ECEA1BD3D2D</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

