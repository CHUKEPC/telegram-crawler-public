<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?239" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 08 CF 03 00 8D 3C A1 66
0010 | 14 00 00 00 F1 8E 7E BE F6 08 5A 66 81 25 75 E2
0020 | 81 12 E1 29 9D 0F 62 6E</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>08CF03008D3CA166</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 A8 63 1A 8D 3C A1 66
0010 | 9C 00 00 00 63 24 16 05 F6 08 5A 66 81 25 75 E2
0020 | 81 12 E1 29 9D 0F 62 6E 0E 48 CD 96 A1 86 60 61
0030 | 97 46 58 A4 30 BD 77 33 08 1B 0A AA EA F9 D1 22
0040 | 31 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01A8631A8D3CA166</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>9C000000</code> (156 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081B0AAAEAF9D12231000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1948557714981462577</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 1948557714981462577</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>1948557714981462577 = 1002516773 * 1943665949</code></p>
<pre><code>p = 1002516773
q = 1943665949</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1B 0A AA EA F9 D1 22 31 00 00 00
0010 | 04 3B C1 31 25 00 00 00 04 73 D9 FD 1D 00 00 00
0020 | F6 08 5A 66 81 25 75 E2 81 12 E1 29 9D 0F 62 6E
0030 | 0E 48 CD 96 A1 86 60 61 97 46 58 A4 30 BD 77 33
0040 | 81 EC 6A 3B 1F 98 EB 9B 15 EF E5 F4 6D AE 0A 5E
0050 | 82 55 3C DE 98 C6 8B E6 45 CA 91 19 8C F2 C1 0A
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081B0AAAEAF9D12231000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1948557714981462577</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>043BC13125000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1002516773</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>0473D9FD1D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1943665949</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>81EC6A3B1F98EB9B15EFE5F46DAE0A5E</code> <code>82553CDE98C68BE645CA91198CF2C10A</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081B0AAAEAF9D12231000000043BC131250000000473D9FD1D000000F6085A66812575E28112E1299D0F626E0E48CD96A1866061974658A430BD773381EC6A3B1F98EB9B15EFE5F46DAE0A5E82553CDE98C68BE645CA91198CF2C10A02000000
random_padding_bytes = 9974885E29BF30E5A7A603D93DD9B75472468573892E3F78AF14233B04CDE84B1246870EC2FEEF7D78ADE2660AD534FE3D95957C2011A03BAB201C309E9A67E0A123A4770D4BF5E8756566390431834AB836DB3EDB7E6D81140D21BD</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 51DD24B756C4BDC6DFBF81F1F6A1B2F38562AC8DC7F6C32C624AE8FA7856C8D1A5756B2D10BFB8B1E2C702F69907CECA6B161C1575E4CE4E85A9BA48C4B63B678B62A1D56027D39C92C37D6656C771F761BC4ED1073B43EC07064B9D0173143711E34189C24AAD72128FF9D4E688E807CBC555A76B830E30313D209991A860D1392436F471A761D8566EE2A357A2EF9CAD8AA3A741EEAA29431B263F5CC00C4C5AB00F45AB4BA1938C1F198D4A69225BE94554CB7F84C428535F79206C876DF2FC84EA7AB21D26DEF3C26BAFC01EFB17CA2C39D29050821D0FF05AAC653794F0B3D916E978A4FD077C63F268F6ADFDFF2980D42E3D5C5F86954A123AC2D3067B</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 9C 10 07 00 8D 3C A1 66
0010 | 40 01 00 00 BE E4 12 D7 F6 08 5A 66 81 25 75 E2
0020 | 81 12 E1 29 9D 0F 62 6E 0E 48 CD 96 A1 86 60 61
0030 | 97 46 58 A4 30 BD 77 33 04 3B C1 31 25 00 00 00
0040 | 04 73 D9 FD 1D 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 51 DD 24 B7 56 C4 BD C6 DF BF 81 F1
0060 | F6 A1 B2 F3 85 62 AC 8D C7 F6 C3 2C 62 4A E8 FA
0070 | 78 56 C8 D1 A5 75 6B 2D 10 BF B8 B1 E2 C7 02 F6
0080 | 99 07 CE CA 6B 16 1C 15 75 E4 CE 4E 85 A9 BA 48
0090 | C4 B6 3B 67 8B 62 A1 D5 60 27 D3 9C 92 C3 7D 66
00A0 | 56 C7 71 F7 61 BC 4E D1 07 3B 43 EC 07 06 4B 9D
00B0 | 01 73 14 37 11 E3 41 89 C2 4A AD 72 12 8F F9 D4
00C0 | E6 88 E8 07 CB C5 55 A7 6B 83 0E 30 31 3D 20 99
00D0 | 91 A8 60 D1 39 24 36 F4 71 A7 61 D8 56 6E E2 A3
00E0 | 57 A2 EF 9C AD 8A A3 A7 41 EE AA 29 43 1B 26 3F
00F0 | 5C C0 0C 4C 5A B0 0F 45 AB 4B A1 93 8C 1F 19 8D
0100 | 4A 69 22 5B E9 45 54 CB 7F 84 C4 28 53 5F 79 20
0110 | 6C 87 6D F2 FC 84 EA 7A B2 1D 26 DE F3 C2 6B AF
0120 | C0 1E FB 17 CA 2C 39 D2 90 50 82 1D 0F F0 5A AC
0130 | 65 37 94 F0 B3 D9 16 E9 78 A4 FD 07 7C 63 F2 68
0140 | F6 AD FD FF 29 80 D4 2E 3D 5C 5F 86 95 4A 12 3A
0150 | C2 D3 06 7B</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>9C1007008D3CA166</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>043BC13125000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1002516773</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>0473D9FD1D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1943665949</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE00010051DD24B756C4BDC6DFBF81F1</code> <code>F6A1B2F38562AC8DC7F6C32C624AE8FA</code> <code>7856C8D1A5756B2D10BFB8B1E2C702F6</code> <code>9907CECA6B161C1575E4CE4E85A9BA48</code> <code>C4B63B678B62A1D56027D39C92C37D66</code> <code>56C771F761BC4ED1073B43EC07064B9D</code> <code>0173143711E34189C24AAD72128FF9D4</code> <code>E688E807CBC555A76B830E30313D2099</code> <code>91A860D1392436F471A761D8566EE2A3</code> <code>57A2EF9CAD8AA3A741EEAA29431B263F</code> <code>5CC00C4C5AB00F45AB4BA1938C1F198D</code> <code>4A69225BE94554CB7F84C428535F7920</code> <code>6C876DF2FC84EA7AB21D26DEF3C26BAF</code> <code>C01EFB17CA2C39D29050821D0FF05AAC</code> <code>653794F0B3D916E978A4FD077C63F268</code> <code>F6ADFDFF2980D42E3D5C5F86954A123A</code><br> <code>C2D3067B</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 C4 CD D4 8D 3C A1 66
0010 | BC 02 00 00 5C 07 E8 D0 F6 08 5A 66 81 25 75 E2
0020 | 81 12 E1 29 9D 0F 62 6E 0E 48 CD 96 A1 86 60 61
0030 | 97 46 58 A4 30 BD 77 33 FE 50 02 00 5A CB 29 7F
0040 | 7F AB E4 AE A1 B0 28 32 EB D4 11 B0 E5 42 3E EC
0050 | 0E E4 40 B9 43 1E 23 F7 76 34 7E 2E 33 32 0F 46
0060 | 0F 0B 0F B4 29 67 8B 42 3A 82 AF 8C 4D 8F AC 05
0070 | 0C 30 0C 50 15 42 79 D6 84 1D DC 1B 5F 91 AE 00
0080 | 40 C3 80 A1 12 69 C4 68 4A 66 F0 46 75 EA 25 7B
0090 | F6 34 60 BF 27 26 EE E7 3B 68 8F B3 0B D0 C5 7E
00A0 | F7 AA F3 8B D6 46 12 9C 6B DE 80 B3 D0 3B CD C6
00B0 | 7B 94 7A E4 D3 D0 75 22 C1 1A D2 BE A8 E9 54 9F
00C0 | D5 F4 14 0F C9 6D B6 62 50 DA B8 36 83 9C 89 F3
00D0 | 38 3E 1C CA BC 27 61 54 87 93 09 FD 6E 50 8B EA
00E0 | D4 7C 21 0E A7 49 AD D4 9E 82 E2 3B 08 51 36 F3
00F0 | 1A 7A 14 4D 6B F1 C7 FC E2 6E 47 9D CB 0A 5A 3F
0100 | DD 79 61 DC CF 34 E0 72 2E 89 81 03 F7 27 73 4D
0110 | E3 B1 8D 76 44 99 65 80 1F 0F 91 2B D6 0F 1C AE
0120 | 66 4C FC 8B 52 D8 65 F9 33 07 53 5A 5D A9 9A 36
0130 | DF 2A F6 48 8F EB D3 E8 68 FA 2E 84 2C 54 35 D7
0140 | 1C 4F BE B1 0E 07 F4 40 B1 39 7B 46 E3 EB F7 71
0150 | 95 68 97 76 40 B2 94 47 43 89 C8 AD 1F 2C 54 B5
0160 | 55 98 20 F1 3F E0 3D AE 8D D1 9A 09 E3 C0 EA 97
0170 | 7B 98 D2 2F 6F E9 C9 9C 22 EB 98 F6 A6 87 BA 0C
0180 | 16 66 48 3F AD 6A 71 22 87 32 28 05 20 0A 93 B8
0190 | 70 ED 19 DE 0C D5 7F A4 B8 78 68 A3 B0 A7 41 A5
01A0 | A9 28 52 DF 2E 60 4F E8 91 9C DC 2D F0 A3 80 02
01B0 | CA FA 7A 50 1F 1B D6 83 70 B9 BF DB A8 E9 8B FC
01C0 | B2 17 4B 35 29 43 D4 A8 2E 3E 9F C3 AF 3A F7 B0
01D0 | 59 72 10 35 D7 21 13 96 7A 2E D6 4D EE 0E 78 A0
01E0 | 0A AD 09 72 58 65 03 32 A9 65 FC 48 9A 3F ED 2D
01F0 | B3 AA 9A F4 8D D3 2A C3 69 B5 7C A0 DB 0D 5B 54
0200 | 8F A0 C2 F6 96 5D 2C 5B 46 22 DC 97 72 86 B6 E0
0210 | 30 5F D9 F0 7C BC 59 83 82 BF 3C AB 0D 70 F2 CD
0220 | 59 AA 5F CB 37 0C FF CF FF A8 A8 CA E2 35 9F E9
0230 | BE 35 86 2A F2 45 FD 30 D6 44 1A 6B 89 91 DD 1B
0240 | 8B F8 1C 14 9C 31 7F D6 55 B3 C6 7B EC EF 93 82
0250 | 65 55 ED 07 E8 7A 96 18 47 A1 42 05 9C 42 E3 26
0260 | 85 27 9D 15 A0 71 DF BA D5 C5 9B C2 46 28 76 9C
0270 | 16 91 D7 7A EC 24 DA FA 76 B2 FE B5 1C 40 EE 1A
0280 | B3 1A 7E 0A 39 24 1A 6B 23 08 9C CB</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01C4CDD48D3CA166</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>BC020000</code> (700 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002005ACB297F7FABE4AEA1B02832</code> <code>EBD411B0E5423EEC0EE440B9431E23F7</code> <code>76347E2E33320F460F0B0FB429678B42</code> <code>3A82AF8C4D8FAC050C300C50154279D6</code> <code>841DDC1B5F91AE0040C380A11269C468</code> <code>4A66F04675EA257BF63460BF2726EEE7</code> <code>3B688FB30BD0C57EF7AAF38BD646129C</code> <code>6BDE80B3D03BCDC67B947AE4D3D07522</code> <code>C11AD2BEA8E9549FD5F4140FC96DB662</code> <code>50DAB836839C89F3383E1CCABC276154</code> <code>879309FD6E508BEAD47C210EA749ADD4</code> <code>9E82E23B085136F31A7A144D6BF1C7FC</code> <code>E26E479DCB0A5A3FDD7961DCCF34E072</code> <code>2E898103F727734DE3B18D7644996580</code> <code>1F0F912BD60F1CAE664CFC8B52D865F9</code> <code>3307535A5DA99A36DF2AF6488FEBD3E8</code> <code>68FA2E842C5435D71C4FBEB10E07F440</code> <code>B1397B46E3EBF7719568977640B29447</code> <code>4389C8AD1F2C54B5559820F13FE03DAE</code> <code>8DD19A09E3C0EA977B98D22F6FE9C99C</code> <code>22EB98F6A687BA0C1666483FAD6A7122</code> <code>87322805200A93B870ED19DE0CD57FA4</code> <code>B87868A3B0A741A5A92852DF2E604FE8</code> <code>919CDC2DF0A38002CAFA7A501F1BD683</code> <code>70B9BFDBA8E98BFCB2174B352943D4A8</code> <code>2E3E9FC3AF3AF7B059721035D7211396</code> <code>7A2ED64DEE0E78A00AAD097258650332</code> <code>A965FC489A3FED2DB3AA9AF48DD32AC3</code> <code>69B57CA0DB0D5B548FA0C2F6965D2C5B</code> <code>4622DC977286B6E0305FD9F07CBC5983</code> <code>82BF3CAB0D70F2CD59AA5FCB370CFFCF</code> <code>FFA8A8CAE2359FE9BE35862AF245FD30</code> <code>D6441A6B8991DD1B8BF81C149C317FD6</code> <code>55B3C67BECEF93826555ED07E87A9618</code> <code>47A142059C42E32685279D15A071DFBA</code> <code>D5C59BC24628769C1691D77AEC24DAFA</code> <code>76B2FEB51C40EE1AB31A7E0A39241A6B</code><br> <code>23089CCB</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 5ACB297F7FABE4AEA1B02832EBD411B0E5423EEC0EE440B9431E23F776347E2E33320F460F0B0FB429678B423A82AF8C4D8FAC050C300C50154279D6841DDC1B5F91AE0040C380A11269C4684A66F04675EA257BF63460BF2726EEE73B688FB30BD0C57EF7AAF38BD646129C6BDE80B3D03BCDC67B947AE4D3D07522C11AD2BEA8E9549FD5F4140FC96DB66250DAB836839C89F3383E1CCABC276154879309FD6E508BEAD47C210EA749ADD49E82E23B085136F31A7A144D6BF1C7FCE26E479DCB0A5A3FDD7961DCCF34E0722E898103F727734DE3B18D76449965801F0F912BD60F1CAE664CFC8B52D865F93307535A5DA99A36DF2AF6488FEBD3E868FA2E842C5435D71C4FBEB10E07F440B1397B46E3EBF7719568977640B294474389C8AD1F2C54B5559820F13FE03DAE8DD19A09E3C0EA977B98D22F6FE9C99C22EB98F6A687BA0C1666483FAD6A712287322805200A93B870ED19DE0CD57FA4B87868A3B0A741A5A92852DF2E604FE8919CDC2DF0A38002CAFA7A501F1BD68370B9BFDBA8E98BFCB2174B352943D4A82E3E9FC3AF3AF7B059721035D72113967A2ED64DEE0E78A00AAD097258650332A965FC489A3FED2DB3AA9AF48DD32AC369B57CA0DB0D5B548FA0C2F6965D2C5B4622DC977286B6E0305FD9F07CBC598382BF3CAB0D70F2CD59AA5FCB370CFFCFFFA8A8CAE2359FE9BE35862AF245FD30D6441A6B8991DD1B8BF81C149C317FD655B3C67BECEF93826555ED07E87A961847A142059C42E32685279D15A071DFBAD5C59BC24628769C1691D77AEC24DAFA76B2FEB51C40EE1AB31A7E0A39241A6B23089CCB
tmp_aes_key = 174BB7DE1552D7E4A81205A0A423C492A6935F82DF6DC6334CAE2C306CD60137
tmp_aes_iv = 44C5026626D067174BA9CDFDCF7D7091E4F40F256F7FE12A8C857F3581EC6A3B</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 7335E0952695FE66EF25E4DDE351725C35C310D6BA0D89B5F6085A66812575E28112E1299D0F626E0E48CD96A1866061974658A430BD773303000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010032F36F957997386EAF11A538C81CFBAA3BEF08528257C8D1E2BD9BE5359D00A6D20C56E74DE8E9E245451B2CB4A16CD58BA711F076848CB61779AFE8760D2F60BC99886887ABE04E8EB616E23EA0015467E98E35D6EC3D2A01E6523EC0CB5D75E9F6EBAC67C9131EE89BD91828F7C1A727D0AB19888E826E4A08B121D3AC3D8450FC53FE9C35C389081279297D5912B7878E071F7BD14D7916BFFFD8C402C106CD8784C12EFC79ECF20F65ABAEF8E72C8878BF8BC21418CB406775CEA752671EAF6DAB7ABCB0692A93180A93906A911FFF6AD161433630897F18CC5A7D4CBEAF20793336756FDE2098F001CFE820A6D0FB863E873DAA54E95269F50CFF9922638D3CA1660493879370953445
answer = BA0D89B5F6085A66812575E28112E1299D0F626E0E48CD96A1866061974658A430BD773303000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010032F36F957997386EAF11A538C81CFBAA3BEF08528257C8D1E2BD9BE5359D00A6D20C56E74DE8E9E245451B2CB4A16CD58BA711F076848CB61779AFE8760D2F60BC99886887ABE04E8EB616E23EA0015467E98E35D6EC3D2A01E6523EC0CB5D75E9F6EBAC67C9131EE89BD91828F7C1A727D0AB19888E826E4A08B121D3AC3D8450FC53FE9C35C389081279297D5912B7878E071F7BD14D7916BFFFD8C402C106CD8784C12EFC79ECF20F65ABAEF8E72C8878BF8BC21418CB406775CEA752671EAF6DAB7ABCB0692A93180A93906A911FFF6AD161433630897F18CC5A7D4CBEAF20793336756FDE2098F001CFE820A6D0FB863E873DAA54E95269F50CFF9922638D3CA1660493879370953445</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 F6 08 5A 66 81 25 75 E2 81 12 E1 29
0010 | 9D 0F 62 6E 0E 48 CD 96 A1 86 60 61 97 46 58 A4
0020 | 30 BD 77 33 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 32 F3 6F 95 79 97 38 6E AF 11 A5 38 C8 1C FB AA
0140 | 3B EF 08 52 82 57 C8 D1 E2 BD 9B E5 35 9D 00 A6
0150 | D2 0C 56 E7 4D E8 E9 E2 45 45 1B 2C B4 A1 6C D5
0160 | 8B A7 11 F0 76 84 8C B6 17 79 AF E8 76 0D 2F 60
0170 | BC 99 88 68 87 AB E0 4E 8E B6 16 E2 3E A0 01 54
0180 | 67 E9 8E 35 D6 EC 3D 2A 01 E6 52 3E C0 CB 5D 75
0190 | E9 F6 EB AC 67 C9 13 1E E8 9B D9 18 28 F7 C1 A7
01A0 | 27 D0 AB 19 88 8E 82 6E 4A 08 B1 21 D3 AC 3D 84
01B0 | 50 FC 53 FE 9C 35 C3 89 08 12 79 29 7D 59 12 B7
01C0 | 87 8E 07 1F 7B D1 4D 79 16 BF FF D8 C4 02 C1 06
01D0 | CD 87 84 C1 2E FC 79 EC F2 0F 65 AB AE F8 E7 2C
01E0 | 88 78 BF 8B C2 14 18 CB 40 67 75 CE A7 52 67 1E
01F0 | AF 6D AB 7A BC B0 69 2A 93 18 0A 93 90 6A 91 1F
0200 | FF 6A D1 61 43 36 30 89 7F 18 CC 5A 7D 4C BE AF
0210 | 20 79 33 36 75 6F DE 20 98 F0 01 CF E8 20 A6 D0
0220 | FB 86 3E 87 3D AA 54 E9 52 69 F5 0C FF 99 22 63
0230 | 8D 3C A1 66</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE00010032F36F957997386EAF11A538</code> <code>C81CFBAA3BEF08528257C8D1E2BD9BE5</code> <code>359D00A6D20C56E74DE8E9E245451B2C</code> <code>B4A16CD58BA711F076848CB61779AFE8</code> <code>760D2F60BC99886887ABE04E8EB616E2</code> <code>3EA0015467E98E35D6EC3D2A01E6523E</code> <code>C0CB5D75E9F6EBAC67C9131EE89BD918</code> <code>28F7C1A727D0AB19888E826E4A08B121</code> <code>D3AC3D8450FC53FE9C35C38908127929</code> <code>7D5912B7878E071F7BD14D7916BFFFD8</code> <code>C402C106CD8784C12EFC79ECF20F65AB</code> <code>AEF8E72C8878BF8BC21418CB406775CE</code> <code>A752671EAF6DAB7ABCB0692A93180A93</code> <code>906A911FFF6AD161433630897F18CC5A</code> <code>7D4CBEAF20793336756FDE2098F001CF</code> <code>E820A6D0FB863E873DAA54E95269F50C</code><br> <code>FF992263</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>8D3CA166</code> (1721842829 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 47C6293E96DCA931575A926C2BA7DB887F7463B4E5A5C54AAE9D693B1359D618B40F264DF4AC47F2CC6EFBC6DA31EDA8779E4B9654898ADF0632BBB707709C5395B6930F4076EFB7FBF09F47AA0E89D784C81161F1AC13FE051E996631586C3C50688C90B00A549F129DF9F42472E4F596A9F3547B9C4B94C0D7BA9CDBA8A006E1F4965BAB3841CA6B77CF7BC1107B8DADCA5BBBA8B913B57F1B2C87298E2B3F4C3D83F76514447739A58311C18356B57A3793CBD57812386D32961ECBF32DCD574A202106E18E41D24F75EDC80D66795FB4B4825D34CD16E5F02578613593751BB2BA05FE48FE6048F68CE9D28E91C6BA686B7F3E6F7E09B661FC54809DA290</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = BC6AF6A9EFC35949F0F6695B7148242A282D45E2F28BCE2184414F0E1210C9179ADCB715964979BDE3101270BBF8FDB8EF17DE5ADC25386293668D13580CB275A7F56A14140E9110EAD1D5C22F02159CFFBCF8C113E57A48E4F8C2368B282133043B92E9817C967BB4F562AABEBD0FEF8DB3E87D1653BD3835C2906A593EF384F209A564C0BFBCB7E036141C8F9F1A48F42FBFE2A5090BBD95E32E0C6990C7BE974BD9A9C1EB983917A602EA6ADBA03582899F8DA52F2E588B91AF45D1703AEADE35232DA9A0BAC3EE8DD7A8BE5FAECC1AC0A2C24C951A717A8E07A1793995644B60F96F769FD08655D6154F472D74B176834D656C48FC3F30C9A1820729CD5B</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 F6 08 5A 66 81 25 75 E2 81 12 E1 29
0010 | 9D 0F 62 6E 0E 48 CD 96 A1 86 60 61 97 46 58 A4
0020 | 30 BD 77 33 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | BC 6A F6 A9 EF C3 59 49 F0 F6 69 5B 71 48 24 2A
0040 | 28 2D 45 E2 F2 8B CE 21 84 41 4F 0E 12 10 C9 17
0050 | 9A DC B7 15 96 49 79 BD E3 10 12 70 BB F8 FD B8
0060 | EF 17 DE 5A DC 25 38 62 93 66 8D 13 58 0C B2 75
0070 | A7 F5 6A 14 14 0E 91 10 EA D1 D5 C2 2F 02 15 9C
0080 | FF BC F8 C1 13 E5 7A 48 E4 F8 C2 36 8B 28 21 33
0090 | 04 3B 92 E9 81 7C 96 7B B4 F5 62 AA BE BD 0F EF
00A0 | 8D B3 E8 7D 16 53 BD 38 35 C2 90 6A 59 3E F3 84
00B0 | F2 09 A5 64 C0 BF BC B7 E0 36 14 1C 8F 9F 1A 48
00C0 | F4 2F BF E2 A5 09 0B BD 95 E3 2E 0C 69 90 C7 BE
00D0 | 97 4B D9 A9 C1 EB 98 39 17 A6 02 EA 6A DB A0 35
00E0 | 82 89 9F 8D A5 2F 2E 58 8B 91 AF 45 D1 70 3A EA
00F0 | DE 35 23 2D A9 A0 BA C3 EE 8D D7 A8 BE 5F AE CC
0100 | 1A C0 A2 C2 4C 95 1A 71 7A 8E 07 A1 79 39 95 64
0110 | 4B 60 F9 6F 76 9F D0 86 55 D6 15 4F 47 2D 74 B1
0120 | 76 83 4D 65 6C 48 FC 3F 30 C9 A1 82 07 29 CD 5B</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100BC6AF6A9EFC35949F0F6695B</code> <code>7148242A282D45E2F28BCE2184414F0E</code> <code>1210C9179ADCB715964979BDE3101270</code> <code>BBF8FDB8EF17DE5ADC25386293668D13</code> <code>580CB275A7F56A14140E9110EAD1D5C2</code> <code>2F02159CFFBCF8C113E57A48E4F8C236</code> <code>8B282133043B92E9817C967BB4F562AA</code> <code>BEBD0FEF8DB3E87D1653BD3835C2906A</code> <code>593EF384F209A564C0BFBCB7E036141C</code> <code>8F9F1A48F42FBFE2A5090BBD95E32E0C</code> <code>6990C7BE974BD9A9C1EB983917A602EA</code> <code>6ADBA03582899F8DA52F2E588B91AF45</code> <code>D1703AEADE35232DA9A0BAC3EE8DD7A8</code> <code>BE5FAECC1AC0A2C24C951A717A8E07A1</code> <code>793995644B60F96F769FD08655D6154F</code> <code>472D74B176834D656C48FC3F30C9A182</code><br> <code>0729CD5B</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366F6085A66812575E28112E1299D0F626E0E48CD96A1866061974658A430BD77330000000000000000FE000100BC6AF6A9EFC35949F0F6695B7148242A282D45E2F28BCE2184414F0E1210C9179ADCB715964979BDE3101270BBF8FDB8EF17DE5ADC25386293668D13580CB275A7F56A14140E9110EAD1D5C22F02159CFFBCF8C113E57A48E4F8C2368B282133043B92E9817C967BB4F562AABEBD0FEF8DB3E87D1653BD3835C2906A593EF384F209A564C0BFBCB7E036141C8F9F1A48F42FBFE2A5090BBD95E32E0C6990C7BE974BD9A9C1EB983917A602EA6ADBA03582899F8DA52F2E588B91AF45D1703AEADE35232DA9A0BAC3EE8DD7A8BE5FAECC1AC0A2C24C951A717A8E07A1793995644B60F96F769FD08655D6154F472D74B176834D656C48FC3F30C9A1820729CD5B
padding = DAE32D43BBB2AF152A9A7456
tmp_aes_key = 174BB7DE1552D7E4A81205A0A423C492A6935F82DF6DC6334CAE2C306CD60137
tmp_aes_iv = 44C5026626D067174BA9CDFDCF7D7091E4F40F256F7FE12A8C857F3581EC6A3B</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = DBC5D7D540BD682F97D3F0E7A4807759E7EF315D17972BBB694B9A7A857EDDF9B937312FAA6CA829F8FAE60FBBAD1ADFD03643DCB9591A1A3E73AE09DC2692DCD9E505D055EEACC482C8636058745323BCB1F2934D8D6DAFB8C1FABE02B55B6F65113F29B7B5FC1C66E7CC9426803AD2706820DF20B7E150C3E60A1521067106E8D79842186ABDCE37055658FF056FA02A332611C31A8BC501D8E10986E24DE9D27EE31E57B40E1B9841B1B52734CDDD2227B7DD144AC7C0EC8917160092AC385C122E2CD9D7CD728DF982B12B2619DA7871302BE67C877490FF798A7FAD49FCABFF72B56991C6BB4CC23B04AC3A3E3689DD76940152D717AAE842916FD174451809CCE5B30FEFE196DC0D2E839CE55653B206D7EE292C609F2A94CB171AB953751ABEA675BC5BD148358E68E780291C79840DBC609B09D2AF1684012DB2564839E3ED2CCE13E25E506C4BE5E1A25C29</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 A0 10 07 00 8D 3C A1 66
0010 | 78 01 00 00 1F 5F 04 F5 F6 08 5A 66 81 25 75 E2
0020 | 81 12 E1 29 9D 0F 62 6E 0E 48 CD 96 A1 86 60 61
0030 | 97 46 58 A4 30 BD 77 33 FE 50 01 00 DB C5 D7 D5
0040 | 40 BD 68 2F 97 D3 F0 E7 A4 80 77 59 E7 EF 31 5D
0050 | 17 97 2B BB 69 4B 9A 7A 85 7E DD F9 B9 37 31 2F
0060 | AA 6C A8 29 F8 FA E6 0F BB AD 1A DF D0 36 43 DC
0070 | B9 59 1A 1A 3E 73 AE 09 DC 26 92 DC D9 E5 05 D0
0080 | 55 EE AC C4 82 C8 63 60 58 74 53 23 BC B1 F2 93
0090 | 4D 8D 6D AF B8 C1 FA BE 02 B5 5B 6F 65 11 3F 29
00A0 | B7 B5 FC 1C 66 E7 CC 94 26 80 3A D2 70 68 20 DF
00B0 | 20 B7 E1 50 C3 E6 0A 15 21 06 71 06 E8 D7 98 42
00C0 | 18 6A BD CE 37 05 56 58 FF 05 6F A0 2A 33 26 11
00D0 | C3 1A 8B C5 01 D8 E1 09 86 E2 4D E9 D2 7E E3 1E
00E0 | 57 B4 0E 1B 98 41 B1 B5 27 34 CD DD 22 27 B7 DD
00F0 | 14 4A C7 C0 EC 89 17 16 00 92 AC 38 5C 12 2E 2C
0100 | D9 D7 CD 72 8D F9 82 B1 2B 26 19 DA 78 71 30 2B
0110 | E6 7C 87 74 90 FF 79 8A 7F AD 49 FC AB FF 72 B5
0120 | 69 91 C6 BB 4C C2 3B 04 AC 3A 3E 36 89 DD 76 94
0130 | 01 52 D7 17 AA E8 42 91 6F D1 74 45 18 09 CC E5
0140 | B3 0F EF E1 96 DC 0D 2E 83 9C E5 56 53 B2 06 D7
0150 | EE 29 2C 60 9F 2A 94 CB 17 1A B9 53 75 1A BE A6
0160 | 75 BC 5B D1 48 35 8E 68 E7 80 29 1C 79 84 0D BC
0170 | 60 9B 09 D2 AF 16 84 01 2D B2 56 48 39 E3 ED 2C
0180 | CE 13 E2 5E 50 6C 4B E5 E1 A2 5C 29</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>A01007008D3CA166</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100DBC5D7D540BD682F97D3F0E7</code> <code>A4807759E7EF315D17972BBB694B9A7A</code> <code>857EDDF9B937312FAA6CA829F8FAE60F</code> <code>BBAD1ADFD03643DCB9591A1A3E73AE09</code> <code>DC2692DCD9E505D055EEACC482C86360</code> <code>58745323BCB1F2934D8D6DAFB8C1FABE</code> <code>02B55B6F65113F29B7B5FC1C66E7CC94</code> <code>26803AD2706820DF20B7E150C3E60A15</code> <code>21067106E8D79842186ABDCE37055658</code> <code>FF056FA02A332611C31A8BC501D8E109</code> <code>86E24DE9D27EE31E57B40E1B9841B1B5</code> <code>2734CDDD2227B7DD144AC7C0EC891716</code> <code>0092AC385C122E2CD9D7CD728DF982B1</code> <code>2B2619DA7871302BE67C877490FF798A</code> <code>7FAD49FCABFF72B56991C6BB4CC23B04</code> <code>AC3A3E3689DD76940152D717AAE84291</code> <code>6FD174451809CCE5B30FEFE196DC0D2E</code> <code>839CE55653B206D7EE292C609F2A94CB</code> <code>171AB953751ABEA675BC5BD148358E68</code> <code>E780291C79840DBC609B09D2AF168401</code> <code>2DB2564839E3ED2CCE13E25E506C4BE5</code><br> <code>E1A25C29</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = B21BC86B00EFACE4D700F53D8D9B9C30831CEF75BAED9A3CD1A2CEA3929D9359DF321456E5734F9E45B2136A82621DC20666DCF1261992CF69F94CF8A4C9897FBA6F3D31FDBD370327ECD661BAF577774F3908A12C1A5ABAABB6ED2A3B32B97AD0EB32F0AD57E9A33711B565864D92A9D8455B667FAEA42885C4E66BE527662892C5C9CC657156CEF4CC798E2EEF98BB0BF2E1671FC083C35F9E813848EE01967CEDF40877D5233F16E63EAB044F0099FCD251D5930DF83D6EAB15682B44069C399368FF21BD99377C4921C8BDB35E4640AD071AD28D6E0C891364122654D6116945B9C050119DAAA055D1AE61D52709713DD9B6D894548402F6A05578DCD5F7</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 48 34 6A 8E 3C A1 66
0010 | 38 00 00 00 34 F7 CB 3B F6 08 5A 66 81 25 75 E2
0020 | 81 12 E1 29 9D 0F 62 6E 0E 48 CD 96 A1 86 60 61
0030 | 97 46 58 A4 30 BD 77 33 62 45 C2 E2 B1 61 A5 D3
0040 | 38 1A 77 0D 75 66 6C 2E</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0148346A8E3CA166</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>38000000</code> (56 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F6085A66812575E28112E1299D0F626E</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>0E48CD96A1866061974658A430BD7733</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>6245C2E2B161A5D3381A770D75666C2E</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

