<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 14 8B 01 00 BA 43 D4 68
0010 | 14 00 00 00 F1 8E 7E BE B1 41 FC 15 0D 17 1C 04
0020 | 8F 0F F5 E6 3C D0 D9 E3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>148B0100BA43D468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 A0 CA 76 BA 43 D4 68
0010 | 50 00 00 00 63 24 16 05 B1 41 FC 15 0D 17 1C 04
0020 | 8F 0F F5 E6 3C D0 D9 E3 92 37 45 AF 0F F1 9D B8
0030 | C3 A2 AA B7 B0 83 CD 14 08 1B E2 C0 1A 7A CD 74
0040 | A5 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01A0CA76BA43D468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081BE2C01A7ACD74A5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2009379603722630309</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2009379603722630309</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2009379603722630309 = 1183948739 * 1697184631</code></p>
<pre><code>p = 1183948739
q = 1697184631</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1B E2 C0 1A 7A CD 74 A5 00 00 00
0010 | 04 46 91 9F C3 00 00 00 04 65 28 FB 77 00 00 00
0020 | B1 41 FC 15 0D 17 1C 04 8F 0F F5 E6 3C D0 D9 E3
0030 | 92 37 45 AF 0F F1 9D B8 C3 A2 AA B7 B0 83 CD 14
0040 | 54 7F E6 43 43 D2 75 9B E8 2F 68 EC F7 29 0E D2
0050 | E9 85 6E 76 BB DD 25 CA 46 E8 DE 47 C5 F2 4E B2
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081BE2C01A7ACD74A5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2009379603722630309</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>0446919FC3000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1183948739</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046528FB77000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1697184631</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>547FE64343D2759BE82F68ECF7290ED2</code> <code>E9856E76BBDD25CA46E8DE47C5F24EB2</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081BE2C01A7ACD74A50000000446919FC3000000046528FB77000000B141FC150D171C048F0FF5E63CD0D9E3923745AF0FF19DB8C3A2AAB7B083CD14547FE64343D2759BE82F68ECF7290ED2E9856E76BBDD25CA46E8DE47C5F24EB202000000
random_padding_bytes = 26D64D94F5DF60F20581D39EC12D245CD50F10FC81ED7B6D1BC130CEE1B130CA11EAA38F7ABEB6E83BAFA60879F737EE6481D9D19DB6976629C83B23CD875FD5643B32B2D15F47E82930C01DA38DEA11C6072D79B10A5983D84C00A1</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 2BBEF89DDF6C8424DDDB692F43764C69D14E469FCE6093CE31270A450E690AF88583F77AF259D5475C42856B3C173131FA6FFF1E1A1B55DA339C1F551C94A366A61D553C838C03ABD867CA8BAD3F20A9631CB6084910EA0DBCE1E594E8DFB8F0C07AD7DF9D61EDF5E60A878512BC4C566CF2889AC4D695DD2C0C870EF7BFB8A1CD1DD4E5F90734491F3200E349BCF1405C7B302B8600893DFB24DD577899F7706D15B412491B55C507410FB5CA791E38ABBD35177337B12ACD2AE087B74D4C6D64AB4FF0F0DF8BA4D492BDE819731595B5666E1B99A982BD4766C30A244BD0CA40C66B667FC617482630F111341784FDE1CAC68FFA56F9A81D5C037E3073634B</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 EC 1E 0A 00 BA 43 D4 68
0010 | 40 01 00 00 BE E4 12 D7 B1 41 FC 15 0D 17 1C 04
0020 | 8F 0F F5 E6 3C D0 D9 E3 92 37 45 AF 0F F1 9D B8
0030 | C3 A2 AA B7 B0 83 CD 14 04 46 91 9F C3 00 00 00
0040 | 04 65 28 FB 77 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 2B BE F8 9D DF 6C 84 24 DD DB 69 2F
0060 | 43 76 4C 69 D1 4E 46 9F CE 60 93 CE 31 27 0A 45
0070 | 0E 69 0A F8 85 83 F7 7A F2 59 D5 47 5C 42 85 6B
0080 | 3C 17 31 31 FA 6F FF 1E 1A 1B 55 DA 33 9C 1F 55
0090 | 1C 94 A3 66 A6 1D 55 3C 83 8C 03 AB D8 67 CA 8B
00A0 | AD 3F 20 A9 63 1C B6 08 49 10 EA 0D BC E1 E5 94
00B0 | E8 DF B8 F0 C0 7A D7 DF 9D 61 ED F5 E6 0A 87 85
00C0 | 12 BC 4C 56 6C F2 88 9A C4 D6 95 DD 2C 0C 87 0E
00D0 | F7 BF B8 A1 CD 1D D4 E5 F9 07 34 49 1F 32 00 E3
00E0 | 49 BC F1 40 5C 7B 30 2B 86 00 89 3D FB 24 DD 57
00F0 | 78 99 F7 70 6D 15 B4 12 49 1B 55 C5 07 41 0F B5
0100 | CA 79 1E 38 AB BD 35 17 73 37 B1 2A CD 2A E0 87
0110 | B7 4D 4C 6D 64 AB 4F F0 F0 DF 8B A4 D4 92 BD E8
0120 | 19 73 15 95 B5 66 6E 1B 99 A9 82 BD 47 66 C3 0A
0130 | 24 4B D0 CA 40 C6 6B 66 7F C6 17 48 26 30 F1 11
0140 | 34 17 84 FD E1 CA C6 8F FA 56 F9 A8 1D 5C 03 7E
0150 | 30 73 63 4B</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>EC1E0A00BA43D468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>0446919FC3000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1183948739</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046528FB77000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1697184631</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE0001002BBEF89DDF6C8424DDDB692F</code> <code>43764C69D14E469FCE6093CE31270A45</code> <code>0E690AF88583F77AF259D5475C42856B</code> <code>3C173131FA6FFF1E1A1B55DA339C1F55</code> <code>1C94A366A61D553C838C03ABD867CA8B</code> <code>AD3F20A9631CB6084910EA0DBCE1E594</code> <code>E8DFB8F0C07AD7DF9D61EDF5E60A8785</code> <code>12BC4C566CF2889AC4D695DD2C0C870E</code> <code>F7BFB8A1CD1DD4E5F90734491F3200E3</code> <code>49BCF1405C7B302B8600893DFB24DD57</code> <code>7899F7706D15B412491B55C507410FB5</code> <code>CA791E38ABBD35177337B12ACD2AE087</code> <code>B74D4C6D64AB4FF0F0DF8BA4D492BDE8</code> <code>19731595B5666E1B99A982BD4766C30A</code> <code>244BD0CA40C66B667FC617482630F111</code> <code>341784FDE1CAC68FFA56F9A81D5C037E</code><br> <code>3073634B</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 50 E7 9E BA 43 D4 68
0010 | 78 02 00 00 5C 07 E8 D0 B1 41 FC 15 0D 17 1C 04
0020 | 8F 0F F5 E6 3C D0 D9 E3 92 37 45 AF 0F F1 9D B8
0030 | C3 A2 AA B7 B0 83 CD 14 FE 50 02 00 F3 2F 91 AF
0040 | 8D 9D 7A D1 50 12 84 56 99 7A FD BA 88 1C B5 08
0050 | 30 B4 A4 45 7B B1 C9 1F 3E 8B 23 15 92 5A 99 C7
0060 | 5D 62 A0 D2 A1 68 4D 94 85 05 F2 AE 08 CD 93 12
0070 | 97 0E 4A 11 36 09 62 50 41 C6 7C 3F A0 22 04 D7
0080 | B2 C1 0A 26 DC 10 E2 F2 C7 1E 65 6D D3 0E 90 B0
0090 | E7 3B 30 0B 98 67 40 14 36 C6 31 35 14 9D 1A 81
00A0 | 08 09 15 44 90 E9 CD 39 1A E6 68 E2 12 87 70 22
00B0 | 23 1D 32 59 BE 2F 93 3C F7 54 6A DC A1 CD 76 DA
00C0 | 60 1E C9 2B CD 25 EC 82 9B 56 67 1A 98 C9 6D 82
00D0 | 37 98 BC F8 21 16 D2 75 AD C4 59 C1 B6 52 F1 BD
00E0 | 3B 16 5D 0D D6 47 F8 FC 1F 77 E4 0F 86 D9 33 EA
00F0 | A1 CF 98 D4 8C EE A3 58 E2 FC 1F 4A 73 A6 FC 08
0100 | 8F 52 C6 68 BC 90 69 75 95 50 51 74 4D 68 4E EB
0110 | 6D C9 9C B1 BE 5A 26 90 26 FD A2 E3 1C 47 FD 69
0120 | DF 84 A7 55 14 8D 85 B6 74 22 BA 10 DB BC 86 05
0130 | CC 17 72 AB AD 22 14 3F D8 FB D5 C7 BB 52 37 48
0140 | 8E 68 E7 44 59 D2 EB 84 E5 6A 16 B2 0D DE FD E1
0150 | C8 67 04 3F 55 5D 44 1C E4 A2 27 D8 D4 13 31 98
0160 | 68 74 C4 F4 5C 2A EB 5D 43 23 47 13 43 5A 36 F2
0170 | DC 32 E7 78 9E F7 77 16 A3 2E D0 3E 18 59 71 0F
0180 | 3B 83 68 B5 79 B7 3B D3 7E 52 84 EF 6C C8 11 E1
0190 | A0 2A 55 1A 81 A2 55 FE A6 98 D3 5D 2B 2F FB E8
01A0 | 4C 5D 36 FD 84 FA 06 8D 66 4F 0B BF BF 1F C1 37
01B0 | 89 C4 D1 57 FF 86 C1 25 CF 6A 22 43 85 6C 62 6E
01C0 | B6 B3 80 30 73 0B B2 70 89 02 CB 6C 12 61 9E 86
01D0 | F0 36 D0 49 F4 DB 40 17 79 7C 1E C5 AF FD 16 A6
01E0 | D1 D1 EA 8E BE C9 9B E9 AF A3 59 D3 E8 71 AA 01
01F0 | 57 25 47 9A E7 94 A3 D8 24 0E 3F 00 35 60 10 45
0200 | 1A 2D 21 3E 30 1B 42 81 22 AA E5 2E 0A D7 73 AC
0210 | 67 41 18 A0 C4 CF BB FD E0 8E A4 53 89 3C 7C CB
0220 | EF 51 45 EE 15 D1 42 47 D4 4C FA 0D 86 EE F9 27
0230 | 02 29 1F 56 E6 86 A5 15 EE 20 21 44 A1 31 69 D0
0240 | A4 FE F8 3E 10 65 CB DA EE 64 F0 BB 6F B3 9B 5D
0250 | C8 82 1C A4 07 FC C2 AA 43 71 AE 31 28 54 F1 EC
0260 | AC 49 06 75 6E 52 C7 41 0C 67 88 36 FC 1F 19 7C
0270 | 2A 71 07 39 54 76 09 1F F0 4C 07 7D 5E 5C 11 29
0280 | 7E 15 D2 98 75 E8 04 27 54 A1 A6 0C</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0150E79EBA43D468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200F32F91AF8D9D7AD150128456</code> <code>997AFDBA881CB50830B4A4457BB1C91F</code> <code>3E8B2315925A99C75D62A0D2A1684D94</code> <code>8505F2AE08CD9312970E4A1136096250</code> <code>41C67C3FA02204D7B2C10A26DC10E2F2</code> <code>C71E656DD30E90B0E73B300B98674014</code> <code>36C63135149D1A810809154490E9CD39</code> <code>1AE668E212877022231D3259BE2F933C</code> <code>F7546ADCA1CD76DA601EC92BCD25EC82</code> <code>9B56671A98C96D823798BCF82116D275</code> <code>ADC459C1B652F1BD3B165D0DD647F8FC</code> <code>1F77E40F86D933EAA1CF98D48CEEA358</code> <code>E2FC1F4A73A6FC088F52C668BC906975</code> <code>955051744D684EEB6DC99CB1BE5A2690</code> <code>26FDA2E31C47FD69DF84A755148D85B6</code> <code>7422BA10DBBC8605CC1772ABAD22143F</code> <code>D8FBD5C7BB5237488E68E74459D2EB84</code> <code>E56A16B20DDEFDE1C867043F555D441C</code> <code>E4A227D8D41331986874C4F45C2AEB5D</code> <code>43234713435A36F2DC32E7789EF77716</code> <code>A32ED03E1859710F3B8368B579B73BD3</code> <code>7E5284EF6CC811E1A02A551A81A255FE</code> <code>A698D35D2B2FFBE84C5D36FD84FA068D</code> <code>664F0BBFBF1FC13789C4D157FF86C125</code> <code>CF6A2243856C626EB6B38030730BB270</code> <code>8902CB6C12619E86F036D049F4DB4017</code> <code>797C1EC5AFFD16A6D1D1EA8EBEC99BE9</code> <code>AFA359D3E871AA015725479AE794A3D8</code> <code>240E3F00356010451A2D213E301B4281</code> <code>22AAE52E0AD773AC674118A0C4CFBBFD</code> <code>E08EA453893C7CCBEF5145EE15D14247</code> <code>D44CFA0D86EEF92702291F56E686A515</code> <code>EE202144A13169D0A4FEF83E1065CBDA</code> <code>EE64F0BB6FB39B5DC8821CA407FCC2AA</code> <code>4371AE312854F1ECAC4906756E52C741</code> <code>0C678836FC1F197C2A7107395476091F</code> <code>F04C077D5E5C11297E15D29875E80427</code><br> <code>54A1A60C</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = F32F91AF8D9D7AD150128456997AFDBA881CB50830B4A4457BB1C91F3E8B2315925A99C75D62A0D2A1684D948505F2AE08CD9312970E4A113609625041C67C3FA02204D7B2C10A26DC10E2F2C71E656DD30E90B0E73B300B9867401436C63135149D1A810809154490E9CD391AE668E212877022231D3259BE2F933CF7546ADCA1CD76DA601EC92BCD25EC829B56671A98C96D823798BCF82116D275ADC459C1B652F1BD3B165D0DD647F8FC1F77E40F86D933EAA1CF98D48CEEA358E2FC1F4A73A6FC088F52C668BC906975955051744D684EEB6DC99CB1BE5A269026FDA2E31C47FD69DF84A755148D85B67422BA10DBBC8605CC1772ABAD22143FD8FBD5C7BB5237488E68E74459D2EB84E56A16B20DDEFDE1C867043F555D441CE4A227D8D41331986874C4F45C2AEB5D43234713435A36F2DC32E7789EF77716A32ED03E1859710F3B8368B579B73BD37E5284EF6CC811E1A02A551A81A255FEA698D35D2B2FFBE84C5D36FD84FA068D664F0BBFBF1FC13789C4D157FF86C125CF6A2243856C626EB6B38030730BB2708902CB6C12619E86F036D049F4DB4017797C1EC5AFFD16A6D1D1EA8EBEC99BE9AFA359D3E871AA015725479AE794A3D8240E3F00356010451A2D213E301B428122AAE52E0AD773AC674118A0C4CFBBFDE08EA453893C7CCBEF5145EE15D14247D44CFA0D86EEF92702291F56E686A515EE202144A13169D0A4FEF83E1065CBDAEE64F0BB6FB39B5DC8821CA407FCC2AA4371AE312854F1ECAC4906756E52C7410C678836FC1F197C2A7107395476091FF04C077D5E5C11297E15D29875E8042754A1A60C
tmp_aes_key = 9102D90C56627AECDFE6A4A8F6E332F76D8BF286A6BA0A99A5A8CFAFC3A31664
tmp_aes_iv = A6152F97EFAB58E897551385CF7F6D70542E75841F7A0DBE30D9959C547FE643</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 1F64C44B41FA6498A906DE2624CE0B7463000872BA0D89B5B141FC150D171C048F0FF5E63CD0D9E3923745AF0FF19DB8C3A2AAB7B083CD1403000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010022CD26C865CCAE8691C48010319C89F3BCE3D6054E5DBAFA5C28CE156B0CD73665E24A8381A67B30EAA917FB5C70F15EA8703B9F9A5D4F7673799F2CCDCE2B51A2FCA2E4EF921D1309F02483AF55B43A0F671CF89D10D81372B7270DB72CA03EF22CADAD4F606D5418D36D85E331FCBD5381ECF4C87824E7C49281E539D21EDBC1A01375F0324445A328FDFF135FFD0841ADBFEEF036C49D211495DA0B93B2A390D33C7AA7641E1C04C8B8A4B6344BB59CE2C090299892277F3720A4355B602213CCE03ECDBAD3B23147B9FBEC93BEFF4B2EBAE9D3AAF5B391F70672028AF103AB68535756798594991FDA3518085CEADFAD46F5406A4141C373C1B4E65764B4BA43D46815BEEC6AFEB875A7
answer = BA0D89B5B141FC150D171C048F0FF5E63CD0D9E3923745AF0FF19DB8C3A2AAB7B083CD1403000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010022CD26C865CCAE8691C48010319C89F3BCE3D6054E5DBAFA5C28CE156B0CD73665E24A8381A67B30EAA917FB5C70F15EA8703B9F9A5D4F7673799F2CCDCE2B51A2FCA2E4EF921D1309F02483AF55B43A0F671CF89D10D81372B7270DB72CA03EF22CADAD4F606D5418D36D85E331FCBD5381ECF4C87824E7C49281E539D21EDBC1A01375F0324445A328FDFF135FFD0841ADBFEEF036C49D211495DA0B93B2A390D33C7AA7641E1C04C8B8A4B6344BB59CE2C090299892277F3720A4355B602213CCE03ECDBAD3B23147B9FBEC93BEFF4B2EBAE9D3AAF5B391F70672028AF103AB68535756798594991FDA3518085CEADFAD46F5406A4141C373C1B4E65764B4BA43D46815BEEC6AFEB875A7</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 B1 41 FC 15 0D 17 1C 04 8F 0F F5 E6
0010 | 3C D0 D9 E3 92 37 45 AF 0F F1 9D B8 C3 A2 AA B7
0020 | B0 83 CD 14 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 22 CD 26 C8 65 CC AE 86 91 C4 80 10 31 9C 89 F3
0140 | BC E3 D6 05 4E 5D BA FA 5C 28 CE 15 6B 0C D7 36
0150 | 65 E2 4A 83 81 A6 7B 30 EA A9 17 FB 5C 70 F1 5E
0160 | A8 70 3B 9F 9A 5D 4F 76 73 79 9F 2C CD CE 2B 51
0170 | A2 FC A2 E4 EF 92 1D 13 09 F0 24 83 AF 55 B4 3A
0180 | 0F 67 1C F8 9D 10 D8 13 72 B7 27 0D B7 2C A0 3E
0190 | F2 2C AD AD 4F 60 6D 54 18 D3 6D 85 E3 31 FC BD
01A0 | 53 81 EC F4 C8 78 24 E7 C4 92 81 E5 39 D2 1E DB
01B0 | C1 A0 13 75 F0 32 44 45 A3 28 FD FF 13 5F FD 08
01C0 | 41 AD BF EE F0 36 C4 9D 21 14 95 DA 0B 93 B2 A3
01D0 | 90 D3 3C 7A A7 64 1E 1C 04 C8 B8 A4 B6 34 4B B5
01E0 | 9C E2 C0 90 29 98 92 27 7F 37 20 A4 35 5B 60 22
01F0 | 13 CC E0 3E CD BA D3 B2 31 47 B9 FB EC 93 BE FF
0200 | 4B 2E BA E9 D3 AA F5 B3 91 F7 06 72 02 8A F1 03
0210 | AB 68 53 57 56 79 85 94 99 1F DA 35 18 08 5C EA
0220 | DF AD 46 F5 40 6A 41 41 C3 73 C1 B4 E6 57 64 B4
0230 | BA 43 D4 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE00010022CD26C865CCAE8691C48010</code> <code>319C89F3BCE3D6054E5DBAFA5C28CE15</code> <code>6B0CD73665E24A8381A67B30EAA917FB</code> <code>5C70F15EA8703B9F9A5D4F7673799F2C</code> <code>CDCE2B51A2FCA2E4EF921D1309F02483</code> <code>AF55B43A0F671CF89D10D81372B7270D</code> <code>B72CA03EF22CADAD4F606D5418D36D85</code> <code>E331FCBD5381ECF4C87824E7C49281E5</code> <code>39D21EDBC1A01375F0324445A328FDFF</code> <code>135FFD0841ADBFEEF036C49D211495DA</code> <code>0B93B2A390D33C7AA7641E1C04C8B8A4</code> <code>B6344BB59CE2C090299892277F3720A4</code> <code>355B602213CCE03ECDBAD3B23147B9FB</code> <code>EC93BEFF4B2EBAE9D3AAF5B391F70672</code> <code>028AF103AB68535756798594991FDA35</code> <code>18085CEADFAD46F5406A4141C373C1B4</code><br> <code>E65764B4</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>BA43D468</code> (1758741434 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 6201706BF2136DE0CF43AF85E09C4CEF80578BDE88A647CC08EBB37AB58A3DC7A437C24A0F31BE8EB4D5904919D28C553181DD168767DF73303C545C91ED73095EFAB066FDECAB0A65CEC5436CFA93FBE0BC8DE247499F2832779BF18207236BEDB689709F3DD872EE2EF305F6118B0D9C1ECA5277ADC1B8AAA5A8EB3815922255DC0BB7815234B18C41D6B833375F20BFB8012A8EE0720F4A4717F92ADCEB22A9B83E23153DAD98703DA32D7ED348B5EFE8DB596AECEB0D2461D3F2B8198F9CD492CC324353F1340F268B913D5DFE528556BCC65FF54CABBC30EF78AD7F7530CCB9ADA390C9633E3FD6C6CCD49B671C0FDB524B165B3ACFD7EE018E314458DB</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 654D32BB1120CDBAF2A42E7C5FD3675FF0B3941393839495BAC52033A713CBFC0857EECADEAEDEF97F515AF75FD63EE942A15C87FEFA7EA9E06C4A7BAA54148F23A262C67C65C8C8D9675F704F05D8D0B4C05D9326CD768B7231C63C646BEE42358B2C83A35885B5E17F5E0E5885B66ACBF4778DD6918EE6F4C6C26821019454369B0B774CC1ADE44E9714E1D758882CFD97BEAB4B50DFE518B1E6D2B164B5D8B27C02ECE3B3376EBFEE13EF529EAD01DBD101F95821939E10238EA439DD55024A0EE4D473C419CE90A192C86FC09B0CD05DCDA274883E524526464A6D952528C2927E10F021E8513BFB38CDAEA3432BBADEB8E115464D123E73BF915EBF9C17</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 B1 41 FC 15 0D 17 1C 04 8F 0F F5 E6
0010 | 3C D0 D9 E3 92 37 45 AF 0F F1 9D B8 C3 A2 AA B7
0020 | B0 83 CD 14 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 65 4D 32 BB 11 20 CD BA F2 A4 2E 7C 5F D3 67 5F
0040 | F0 B3 94 13 93 83 94 95 BA C5 20 33 A7 13 CB FC
0050 | 08 57 EE CA DE AE DE F9 7F 51 5A F7 5F D6 3E E9
0060 | 42 A1 5C 87 FE FA 7E A9 E0 6C 4A 7B AA 54 14 8F
0070 | 23 A2 62 C6 7C 65 C8 C8 D9 67 5F 70 4F 05 D8 D0
0080 | B4 C0 5D 93 26 CD 76 8B 72 31 C6 3C 64 6B EE 42
0090 | 35 8B 2C 83 A3 58 85 B5 E1 7F 5E 0E 58 85 B6 6A
00A0 | CB F4 77 8D D6 91 8E E6 F4 C6 C2 68 21 01 94 54
00B0 | 36 9B 0B 77 4C C1 AD E4 4E 97 14 E1 D7 58 88 2C
00C0 | FD 97 BE AB 4B 50 DF E5 18 B1 E6 D2 B1 64 B5 D8
00D0 | B2 7C 02 EC E3 B3 37 6E BF EE 13 EF 52 9E AD 01
00E0 | DB D1 01 F9 58 21 93 9E 10 23 8E A4 39 DD 55 02
00F0 | 4A 0E E4 D4 73 C4 19 CE 90 A1 92 C8 6F C0 9B 0C
0100 | D0 5D CD A2 74 88 3E 52 45 26 46 4A 6D 95 25 28
0110 | C2 92 7E 10 F0 21 E8 51 3B FB 38 CD AE A3 43 2B
0120 | BA DE B8 E1 15 46 4D 12 3E 73 BF 91 5E BF 9C 17</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100654D32BB1120CDBAF2A42E7C</code> <code>5FD3675FF0B3941393839495BAC52033</code> <code>A713CBFC0857EECADEAEDEF97F515AF7</code> <code>5FD63EE942A15C87FEFA7EA9E06C4A7B</code> <code>AA54148F23A262C67C65C8C8D9675F70</code> <code>4F05D8D0B4C05D9326CD768B7231C63C</code> <code>646BEE42358B2C83A35885B5E17F5E0E</code> <code>5885B66ACBF4778DD6918EE6F4C6C268</code> <code>21019454369B0B774CC1ADE44E9714E1</code> <code>D758882CFD97BEAB4B50DFE518B1E6D2</code> <code>B164B5D8B27C02ECE3B3376EBFEE13EF</code> <code>529EAD01DBD101F95821939E10238EA4</code> <code>39DD55024A0EE4D473C419CE90A192C8</code> <code>6FC09B0CD05DCDA274883E524526464A</code> <code>6D952528C2927E10F021E8513BFB38CD</code> <code>AEA3432BBADEB8E115464D123E73BF91</code><br> <code>5EBF9C17</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366B141FC150D171C048F0FF5E63CD0D9E3923745AF0FF19DB8C3A2AAB7B083CD140000000000000000FE000100654D32BB1120CDBAF2A42E7C5FD3675FF0B3941393839495BAC52033A713CBFC0857EECADEAEDEF97F515AF75FD63EE942A15C87FEFA7EA9E06C4A7BAA54148F23A262C67C65C8C8D9675F704F05D8D0B4C05D9326CD768B7231C63C646BEE42358B2C83A35885B5E17F5E0E5885B66ACBF4778DD6918EE6F4C6C26821019454369B0B774CC1ADE44E9714E1D758882CFD97BEAB4B50DFE518B1E6D2B164B5D8B27C02ECE3B3376EBFEE13EF529EAD01DBD101F95821939E10238EA439DD55024A0EE4D473C419CE90A192C86FC09B0CD05DCDA274883E524526464A6D952528C2927E10F021E8513BFB38CDAEA3432BBADEB8E115464D123E73BF915EBF9C17
padding = 1C1DDE38DD3654B28B42AE2B
tmp_aes_key = 9102D90C56627AECDFE6A4A8F6E332F76D8BF286A6BA0A99A5A8CFAFC3A31664
tmp_aes_iv = A6152F97EFAB58E897551385CF7F6D70542E75841F7A0DBE30D9959C547FE643</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = B3CCCE378B7E07E11D82866A262953E86B5374434E327C3076ED3C5399F7841370F9B65A2DD320E1BBDF41ADDB4E4F4B20385C283C72C55E1A8FEF6A032FF9C225FBCAC19E5FBEA8F626FE9101DCACE9529F27AC5AAB42D4485C1ED110C8EEC118646C15AF53FF2B2CCA238AF986EDDF634C8A29DA77E1F4F79ACF34CB7643DB12CD6CA28273D2E7D9C2FF947D6F553B18DD29327E95EBC597FA64CE009A7C7721F9FEBB7417B6E2BB55A75915522BD1547F187E81D32C0DD02BB495F2D394F54F257A107E668545C800ABC9C39C70B58512E0539606A59FBFF976DF3882D8730308ECED5A8A657C8B8A286E666BEFB5D3145E34FCCA978FCD9A25772EEA80DD038331D1A20A1CC7DD8125EC0BD6A39127F535E9B9C066385ADD34916657F330E0B017E7CEF9408A817EDC0D7CDE8E526BA96835356BE97466B1EBBF17FA3FE551CD8889D77B72660106538C2735259F</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 F0 1E 0A 00 BA 43 D4 68
0010 | 78 01 00 00 1F 5F 04 F5 B1 41 FC 15 0D 17 1C 04
0020 | 8F 0F F5 E6 3C D0 D9 E3 92 37 45 AF 0F F1 9D B8
0030 | C3 A2 AA B7 B0 83 CD 14 FE 50 01 00 B3 CC CE 37
0040 | 8B 7E 07 E1 1D 82 86 6A 26 29 53 E8 6B 53 74 43
0050 | 4E 32 7C 30 76 ED 3C 53 99 F7 84 13 70 F9 B6 5A
0060 | 2D D3 20 E1 BB DF 41 AD DB 4E 4F 4B 20 38 5C 28
0070 | 3C 72 C5 5E 1A 8F EF 6A 03 2F F9 C2 25 FB CA C1
0080 | 9E 5F BE A8 F6 26 FE 91 01 DC AC E9 52 9F 27 AC
0090 | 5A AB 42 D4 48 5C 1E D1 10 C8 EE C1 18 64 6C 15
00A0 | AF 53 FF 2B 2C CA 23 8A F9 86 ED DF 63 4C 8A 29
00B0 | DA 77 E1 F4 F7 9A CF 34 CB 76 43 DB 12 CD 6C A2
00C0 | 82 73 D2 E7 D9 C2 FF 94 7D 6F 55 3B 18 DD 29 32
00D0 | 7E 95 EB C5 97 FA 64 CE 00 9A 7C 77 21 F9 FE BB
00E0 | 74 17 B6 E2 BB 55 A7 59 15 52 2B D1 54 7F 18 7E
00F0 | 81 D3 2C 0D D0 2B B4 95 F2 D3 94 F5 4F 25 7A 10
0100 | 7E 66 85 45 C8 00 AB C9 C3 9C 70 B5 85 12 E0 53
0110 | 96 06 A5 9F BF F9 76 DF 38 82 D8 73 03 08 EC ED
0120 | 5A 8A 65 7C 8B 8A 28 6E 66 6B EF B5 D3 14 5E 34
0130 | FC CA 97 8F CD 9A 25 77 2E EA 80 DD 03 83 31 D1
0140 | A2 0A 1C C7 DD 81 25 EC 0B D6 A3 91 27 F5 35 E9
0150 | B9 C0 66 38 5A DD 34 91 66 57 F3 30 E0 B0 17 E7
0160 | CE F9 40 8A 81 7E DC 0D 7C DE 8E 52 6B A9 68 35
0170 | 35 6B E9 74 66 B1 EB BF 17 FA 3F E5 51 CD 88 89
0180 | D7 7B 72 66 01 06 53 8C 27 35 25 9F</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>F01E0A00BA43D468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100B3CCCE378B7E07E11D82866A</code> <code>262953E86B5374434E327C3076ED3C53</code> <code>99F7841370F9B65A2DD320E1BBDF41AD</code> <code>DB4E4F4B20385C283C72C55E1A8FEF6A</code> <code>032FF9C225FBCAC19E5FBEA8F626FE91</code> <code>01DCACE9529F27AC5AAB42D4485C1ED1</code> <code>10C8EEC118646C15AF53FF2B2CCA238A</code> <code>F986EDDF634C8A29DA77E1F4F79ACF34</code> <code>CB7643DB12CD6CA28273D2E7D9C2FF94</code> <code>7D6F553B18DD29327E95EBC597FA64CE</code> <code>009A7C7721F9FEBB7417B6E2BB55A759</code> <code>15522BD1547F187E81D32C0DD02BB495</code> <code>F2D394F54F257A107E668545C800ABC9</code> <code>C39C70B58512E0539606A59FBFF976DF</code> <code>3882D8730308ECED5A8A657C8B8A286E</code> <code>666BEFB5D3145E34FCCA978FCD9A2577</code> <code>2EEA80DD038331D1A20A1CC7DD8125EC</code> <code>0BD6A39127F535E9B9C066385ADD3491</code> <code>6657F330E0B017E7CEF9408A817EDC0D</code> <code>7CDE8E526BA96835356BE97466B1EBBF</code> <code>17FA3FE551CD8889D77B72660106538C</code><br> <code>2735259F</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 7F25150D0F9DE369AD261F2980BCB45F9D61876CB7703F6FE82A818D5071B31C3BF651E69887A83BA449392F7DD3EAE66F03395E262ECA5C834916512F9A07A86C6D114D9E5B7D869E98F9B21AE6826F9AA1EDFD4D32D0449F52D6BD912AE1DA6A7DE41376215A0B66FA3DCBE9640FF9BE02E9A02705A02AF934FDAD42510414C471AF6ABF8C36DC126846DA443946AA8BCC905777AF6B0DF87DBD9FF16826B4A14929744C3EC2E83BBA63D2EF1B24EC97BFC8D86ACD0A03962AEFEAC34794CA1B03C0044A8E1DE4CB683E2E376B441902801530CBB7BAEE1AB3B84E88ED6196E00412769996340A316D3470CC94588CBD16BD8FEAD1DB555C49B02A65A2B711</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 C0 C5 45 BC 43 D4 68
0010 | 34 00 00 00 34 F7 CB 3B B1 41 FC 15 0D 17 1C 04
0020 | 8F 0F F5 E6 3C D0 D9 E3 92 37 45 AF 0F F1 9D B8
0030 | C3 A2 AA B7 B0 83 CD 14 87 16 31 5E D7 31 72 BC
0040 | 73 E3 19 B5 F0 16 88 E8</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01C0C545BC43D468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>B141FC150D171C048F0FF5E63CD0D9E3</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>923745AF0FF19DB8C3A2AAB7B083CD14</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>8716315ED73172BC73E319B5F01688E8</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

