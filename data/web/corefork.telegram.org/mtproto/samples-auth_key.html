<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?240" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 E0 F6 02 00 2B 15 AD 66
0010 | 14 00 00 00 F1 8E 7E BE 84 05 86 8C 6A F5 1C 60
0020 | EE DA B4 E2 E3 5D 8F 62</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>E0F602002B15AD66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 5C 12 CF 2B 15 AD 66
0010 | C8 00 00 00 63 24 16 05 84 05 86 8C 6A F5 1C 60
0020 | EE DA B4 E2 E3 5D 8F 62 36 87 B7 62 03 12 9A 48
0030 | 85 4F 7D B1 C4 67 19 E7 08 29 65 71 63 31 36 BF
0040 | 8B 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>015C12CF2B15AD66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>C8000000</code> (200 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>08296571633136BF8B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2982914999044194187</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2982914999044194187</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2982914999044194187 = 1575493681 * 1893320827</code></p>
<pre><code>p = 1575493681
q = 1893320827</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 29 65 71 63 31 36 BF 8B 00 00 00
0010 | 04 5D E8 20 31 00 00 00 04 70 D9 C8 7B 00 00 00
0020 | 84 05 86 8C 6A F5 1C 60 EE DA B4 E2 E3 5D 8F 62
0030 | 36 87 B7 62 03 12 9A 48 85 4F 7D B1 C4 67 19 E7
0040 | 23 3E 32 A4 FB AA EC C5 15 30 C7 EA 05 9A DD 39
0050 | 5D 81 4A 75 4A 04 BB 12 6F 2B 42 53 AB 14 7B 16
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>08296571633136BF8B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2982914999044194187</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>045DE82031000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1575493681</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>0470D9C87B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1893320827</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>233E32A4FBAAECC51530C7EA059ADD39</code> <code>5D814A754A04BB126F2B4253AB147B16</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A908296571633136BF8B000000045DE820310000000470D9C87B0000008405868C6AF51C60EEDAB4E2E35D8F623687B76203129A48854F7DB1C46719E7233E32A4FBAAECC51530C7EA059ADD395D814A754A04BB126F2B4253AB147B1602000000
random_padding_bytes = 0203D03BB3F34D7592F44F38B79C2A2905B56B71995C2FEDCBBB1E825585F756FA5546E50431F1362A0F006630540D4487AC9C233559FF2D25236B4A945BB60FC64EA312D18A27708C8CFB620B9E1203EBC9484983DFCAE2CF39A5EC</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 2BE67D929331B31C99982B1DB3E44E800D9A15C4B5732DB411BBC0CD6E936DED789411CC297722AD7EB99C44C7D0B0BE5CAA6141A9AA54FBF7043E23E4075F2C174951358FBE4CD386D8FAB60A12AAAC14A10506C330C3E02E3183209FDEFE6754576903261A556D8D911D4238D2C31B37034EE81FFD5AE937F701A4D5169A6F8AE8B301A5C334E74B5FCEFCC5D8D277506417754598890DA783B08512925A4CCC91E2709D169B9952F3F176B5779F21B3CAC9A399545A6B858DB3033695F8F5E6E5C2595E44AC225EDD45E94CFB4E147EEC441A81218C0BE8CC599923FFC249DF0E50E91F909B0475D6935EBE70DC1641C7C5CA6BDD93263A1F51939B3C867C</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 E4 F6 02 00 2B 15 AD 66
0010 | 40 01 00 00 BE E4 12 D7 84 05 86 8C 6A F5 1C 60
0020 | EE DA B4 E2 E3 5D 8F 62 36 87 B7 62 03 12 9A 48
0030 | 85 4F 7D B1 C4 67 19 E7 04 5D E8 20 31 00 00 00
0040 | 04 70 D9 C8 7B 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 2B E6 7D 92 93 31 B3 1C 99 98 2B 1D
0060 | B3 E4 4E 80 0D 9A 15 C4 B5 73 2D B4 11 BB C0 CD
0070 | 6E 93 6D ED 78 94 11 CC 29 77 22 AD 7E B9 9C 44
0080 | C7 D0 B0 BE 5C AA 61 41 A9 AA 54 FB F7 04 3E 23
0090 | E4 07 5F 2C 17 49 51 35 8F BE 4C D3 86 D8 FA B6
00A0 | 0A 12 AA AC 14 A1 05 06 C3 30 C3 E0 2E 31 83 20
00B0 | 9F DE FE 67 54 57 69 03 26 1A 55 6D 8D 91 1D 42
00C0 | 38 D2 C3 1B 37 03 4E E8 1F FD 5A E9 37 F7 01 A4
00D0 | D5 16 9A 6F 8A E8 B3 01 A5 C3 34 E7 4B 5F CE FC
00E0 | C5 D8 D2 77 50 64 17 75 45 98 89 0D A7 83 B0 85
00F0 | 12 92 5A 4C CC 91 E2 70 9D 16 9B 99 52 F3 F1 76
0100 | B5 77 9F 21 B3 CA C9 A3 99 54 5A 6B 85 8D B3 03
0110 | 36 95 F8 F5 E6 E5 C2 59 5E 44 AC 22 5E DD 45 E9
0120 | 4C FB 4E 14 7E EC 44 1A 81 21 8C 0B E8 CC 59 99
0130 | 23 FF C2 49 DF 0E 50 E9 1F 90 9B 04 75 D6 93 5E
0140 | BE 70 DC 16 41 C7 C5 CA 6B DD 93 26 3A 1F 51 93
0150 | 9B 3C 86 7C</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>E4F602002B15AD66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>045DE82031000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1575493681</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>0470D9C87B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1893320827</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE0001002BE67D929331B31C99982B1D</code> <code>B3E44E800D9A15C4B5732DB411BBC0CD</code> <code>6E936DED789411CC297722AD7EB99C44</code> <code>C7D0B0BE5CAA6141A9AA54FBF7043E23</code> <code>E4075F2C174951358FBE4CD386D8FAB6</code> <code>0A12AAAC14A10506C330C3E02E318320</code> <code>9FDEFE6754576903261A556D8D911D42</code> <code>38D2C31B37034EE81FFD5AE937F701A4</code> <code>D5169A6F8AE8B301A5C334E74B5FCEFC</code> <code>C5D8D277506417754598890DA783B085</code> <code>12925A4CCC91E2709D169B9952F3F176</code> <code>B5779F21B3CAC9A399545A6B858DB303</code> <code>3695F8F5E6E5C2595E44AC225EDD45E9</code> <code>4CFB4E147EEC441A81218C0BE8CC5999</code> <code>23FFC249DF0E50E91F909B0475D6935E</code> <code>BE70DC1641C7C5CA6BDD93263A1F5193</code><br> <code>9B3C867C</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 2C 33 95 2C 15 AD 66
0010 | 8C 02 00 00 5C 07 E8 D0 84 05 86 8C 6A F5 1C 60
0020 | EE DA B4 E2 E3 5D 8F 62 36 87 B7 62 03 12 9A 48
0030 | 85 4F 7D B1 C4 67 19 E7 FE 50 02 00 3E AE A0 66
0040 | D8 F1 E4 3D B7 F7 55 E0 B5 92 E6 C9 00 75 41 7C
0050 | 60 7E F3 20 1C C7 E6 A0 15 91 14 B8 77 AC 73 E1
0060 | 71 39 E7 2B 71 AF 24 35 26 F6 C2 EC 7A C1 73 D5
0070 | D9 76 E3 7B B3 4A 3B BE D9 76 D1 27 4F 5F 08 B5
0080 | F6 78 BC 29 58 8F 56 73 50 F5 A6 90 1E 4F DB 21
0090 | 01 13 6C 26 47 C3 E0 5C B2 0D 85 6B 25 C4 4D C5
00A0 | D1 BA 23 31 73 1E 12 74 DA 31 58 D6 9A F3 62 A4
00B0 | 43 40 E6 E8 7D F4 BB 8A 6F E4 E6 D7 74 28 D0 15
00C0 | EE 5E B9 D5 7F E8 A7 57 86 60 DD 95 67 E6 4B E5
00D0 | 66 CC 4E 80 F8 9D 17 09 14 B6 C3 0B 37 2B 23 22
00E0 | 9E C2 04 A0 7D D9 A4 72 90 42 A5 B4 EC BF B8 10
00F0 | B7 1B 62 48 FA 29 B9 D9 E3 0B 30 1E AC B2 E5 D8
0100 | F4 CF F0 A0 A3 C1 C9 87 63 2D 26 64 C6 10 16 71
0110 | 90 7A 7A C2 0C FC 83 8E FC 58 83 45 5C 04 47 6B
0120 | 6A 83 E8 74 61 D4 52 75 60 04 3C D4 11 DA 29 C6
0130 | 5F 66 E2 89 A4 D3 7C 40 48 9A 4D 0E 80 06 86 64
0140 | 51 01 AD 7D EB 1E 8E 29 66 9C 9E 3C 95 5F D9 11
0150 | 2F B6 45 4E D2 C2 B0 B0 18 91 62 DB 78 E8 5A 56
0160 | AA 63 F0 7C 66 20 3F 3A D8 5F 00 EB D6 DF 37 8E
0170 | 66 F9 86 A0 C4 CD 25 F3 AF D7 4B 22 22 DE E0 A0
0180 | E5 BD C2 D6 48 A9 CB FB 58 7C D5 B0 62 77 40 92
0190 | 9E 45 F1 C2 11 BB 6E 5B 95 24 AC 54 35 4F B3 F2
01A0 | 25 79 88 3C 7F 77 EE 62 37 F2 18 38 0B F9 99 DE
01B0 | 4D A1 80 FB C7 45 D0 4F 60 7A 92 A4 3B 06 EE 33
01C0 | 11 91 39 9C AF B1 92 7A 09 C3 C0 6E CA D7 A2 07
01D0 | 37 01 61 13 51 71 09 74 A5 73 E3 3A E1 64 E5 22
01E0 | A9 5B 1A 97 F0 69 09 2A EF FA A8 A1 5D 6C E0 05
01F0 | 1E 26 CE F5 6C 4F 94 9B C2 15 AF 8F 02 D6 4C AE
0200 | A9 9E AA 38 C9 F6 50 4E 8B C8 9D 51 C7 12 03 15
0210 | 27 FE 55 15 6C 58 82 B1 67 46 EB 54 78 3F 2D 5C
0220 | BD BF 15 FC A2 68 FF 07 91 2B 0B 32 C1 78 CF D7
0230 | E8 70 33 5C C4 77 67 1C E3 20 47 50 CF 29 F8 BE
0240 | A9 E2 E7 89 3E B4 3B 1F 35 F8 BE A8 AA 66 78 A8
0250 | A5 0F 52 E9 2B 6B 8A BD 2B 06 E1 F8 61 F8 41 1E
0260 | DE D8 3A ED BE 0D 7B BB CB FD F9 39 A1 DD 25 B3
0270 | B1 36 DD A2 07 CD E1 47 37 F5 67 F0 04 54 C2 B1
0280 | AA 1F 67 E6 2B 4C E8 8E D4 8B E9 46</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>012C33952C15AD66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>8C020000</code> (652 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002003EAEA066D8F1E43DB7F755E0</code> <code>B592E6C90075417C607EF3201CC7E6A0</code> <code>159114B877AC73E17139E72B71AF2435</code> <code>26F6C2EC7AC173D5D976E37BB34A3BBE</code> <code>D976D1274F5F08B5F678BC29588F5673</code> <code>50F5A6901E4FDB2101136C2647C3E05C</code> <code>B20D856B25C44DC5D1BA2331731E1274</code> <code>DA3158D69AF362A44340E6E87DF4BB8A</code> <code>6FE4E6D77428D015EE5EB9D57FE8A757</code> <code>8660DD9567E64BE566CC4E80F89D1709</code> <code>14B6C30B372B23229EC204A07DD9A472</code> <code>9042A5B4ECBFB810B71B6248FA29B9D9</code> <code>E30B301EACB2E5D8F4CFF0A0A3C1C987</code> <code>632D2664C6101671907A7AC20CFC838E</code> <code>FC5883455C04476B6A83E87461D45275</code> <code>60043CD411DA29C65F66E289A4D37C40</code> <code>489A4D0E800686645101AD7DEB1E8E29</code> <code>669C9E3C955FD9112FB6454ED2C2B0B0</code> <code>189162DB78E85A56AA63F07C66203F3A</code> <code>D85F00EBD6DF378E66F986A0C4CD25F3</code> <code>AFD74B2222DEE0A0E5BDC2D648A9CBFB</code> <code>587CD5B0627740929E45F1C211BB6E5B</code> <code>9524AC54354FB3F22579883C7F77EE62</code> <code>37F218380BF999DE4DA180FBC745D04F</code> <code>607A92A43B06EE331191399CAFB1927A</code> <code>09C3C06ECAD7A2073701611351710974</code> <code>A573E33AE164E522A95B1A97F069092A</code> <code>EFFAA8A15D6CE0051E26CEF56C4F949B</code> <code>C215AF8F02D64CAEA99EAA38C9F6504E</code> <code>8BC89D51C712031527FE55156C5882B1</code> <code>6746EB54783F2D5CBDBF15FCA268FF07</code> <code>912B0B32C178CFD7E870335CC477671C</code> <code>E3204750CF29F8BEA9E2E7893EB43B1F</code> <code>35F8BEA8AA6678A8A50F52E92B6B8ABD</code> <code>2B06E1F861F8411EDED83AEDBE0D7BBB</code> <code>CBFDF939A1DD25B3B136DDA207CDE147</code> <code>37F567F00454C2B1AA1F67E62B4CE88E</code><br> <code>D48BE946</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 3EAEA066D8F1E43DB7F755E0B592E6C90075417C607EF3201CC7E6A0159114B877AC73E17139E72B71AF243526F6C2EC7AC173D5D976E37BB34A3BBED976D1274F5F08B5F678BC29588F567350F5A6901E4FDB2101136C2647C3E05CB20D856B25C44DC5D1BA2331731E1274DA3158D69AF362A44340E6E87DF4BB8A6FE4E6D77428D015EE5EB9D57FE8A7578660DD9567E64BE566CC4E80F89D170914B6C30B372B23229EC204A07DD9A4729042A5B4ECBFB810B71B6248FA29B9D9E30B301EACB2E5D8F4CFF0A0A3C1C987632D2664C6101671907A7AC20CFC838EFC5883455C04476B6A83E87461D4527560043CD411DA29C65F66E289A4D37C40489A4D0E800686645101AD7DEB1E8E29669C9E3C955FD9112FB6454ED2C2B0B0189162DB78E85A56AA63F07C66203F3AD85F00EBD6DF378E66F986A0C4CD25F3AFD74B2222DEE0A0E5BDC2D648A9CBFB587CD5B0627740929E45F1C211BB6E5B9524AC54354FB3F22579883C7F77EE6237F218380BF999DE4DA180FBC745D04F607A92A43B06EE331191399CAFB1927A09C3C06ECAD7A2073701611351710974A573E33AE164E522A95B1A97F069092AEFFAA8A15D6CE0051E26CEF56C4F949BC215AF8F02D64CAEA99EAA38C9F6504E8BC89D51C712031527FE55156C5882B16746EB54783F2D5CBDBF15FCA268FF07912B0B32C178CFD7E870335CC477671CE3204750CF29F8BEA9E2E7893EB43B1F35F8BEA8AA6678A8A50F52E92B6B8ABD2B06E1F861F8411EDED83AEDBE0D7BBBCBFDF939A1DD25B3B136DDA207CDE14737F567F00454C2B1AA1F67E62B4CE88ED48BE946
tmp_aes_key = CAAA386C8996AF8549A7FD7EA2DEA9CAACA298F3A7235AD0C24EA1C2671398A0
tmp_aes_iv = 80B4E4587896E5DF12D94DA6D820055B54C1F39EFFE44BFCA8374351233E32A4</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 61A02AC89583209552173E91365A9BD569A28DAABA0D89B58405868C6AF51C60EEDAB4E2E35D8F623687B76203129A48854F7DB1C46719E703000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100497EE07350DDE83D682BDEB16F7CA5D0D3EC7F0EF5FF24BFB3C1BECD3894853AE1A1B752C8737E9848AC1D897296C25AC38D3F6BF8EF3035E8A8AD42E27B5561577ED5E2570F26D45FE42A2275B761E9FA0C1667D7EAA62E745E8EA1CA787F48F7C2444D67F74E46BB5BE2B2F77CE804F5D950843411A1C0C2946209E2A2BA9A2E8754A8A7B73A5A2CA19C84B477BF78945D5EA95616D2D89B7A11F7EBBE465523B8A37AFFA8C44C009387B140755D7EB072518073DD6E6F412EA610C225320DB477DAA2EC3C441450656CCF5966FA82DF7CD03C11D8BC7AD2B23A4C074D438D6FAF67162241E5DD156C26CE4C262C52C8B2BB559FDB8E149CAC5B822CDD59C22C15AD667D0652BCC1D6C5E4
answer = BA0D89B58405868C6AF51C60EEDAB4E2E35D8F623687B76203129A48854F7DB1C46719E703000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100497EE07350DDE83D682BDEB16F7CA5D0D3EC7F0EF5FF24BFB3C1BECD3894853AE1A1B752C8737E9848AC1D897296C25AC38D3F6BF8EF3035E8A8AD42E27B5561577ED5E2570F26D45FE42A2275B761E9FA0C1667D7EAA62E745E8EA1CA787F48F7C2444D67F74E46BB5BE2B2F77CE804F5D950843411A1C0C2946209E2A2BA9A2E8754A8A7B73A5A2CA19C84B477BF78945D5EA95616D2D89B7A11F7EBBE465523B8A37AFFA8C44C009387B140755D7EB072518073DD6E6F412EA610C225320DB477DAA2EC3C441450656CCF5966FA82DF7CD03C11D8BC7AD2B23A4C074D438D6FAF67162241E5DD156C26CE4C262C52C8B2BB559FDB8E149CAC5B822CDD59C22C15AD667D0652BCC1D6C5E4</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 84 05 86 8C 6A F5 1C 60 EE DA B4 E2
0010 | E3 5D 8F 62 36 87 B7 62 03 12 9A 48 85 4F 7D B1
0020 | C4 67 19 E7 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 49 7E E0 73 50 DD E8 3D 68 2B DE B1 6F 7C A5 D0
0140 | D3 EC 7F 0E F5 FF 24 BF B3 C1 BE CD 38 94 85 3A
0150 | E1 A1 B7 52 C8 73 7E 98 48 AC 1D 89 72 96 C2 5A
0160 | C3 8D 3F 6B F8 EF 30 35 E8 A8 AD 42 E2 7B 55 61
0170 | 57 7E D5 E2 57 0F 26 D4 5F E4 2A 22 75 B7 61 E9
0180 | FA 0C 16 67 D7 EA A6 2E 74 5E 8E A1 CA 78 7F 48
0190 | F7 C2 44 4D 67 F7 4E 46 BB 5B E2 B2 F7 7C E8 04
01A0 | F5 D9 50 84 34 11 A1 C0 C2 94 62 09 E2 A2 BA 9A
01B0 | 2E 87 54 A8 A7 B7 3A 5A 2C A1 9C 84 B4 77 BF 78
01C0 | 94 5D 5E A9 56 16 D2 D8 9B 7A 11 F7 EB BE 46 55
01D0 | 23 B8 A3 7A FF A8 C4 4C 00 93 87 B1 40 75 5D 7E
01E0 | B0 72 51 80 73 DD 6E 6F 41 2E A6 10 C2 25 32 0D
01F0 | B4 77 DA A2 EC 3C 44 14 50 65 6C CF 59 66 FA 82
0200 | DF 7C D0 3C 11 D8 BC 7A D2 B2 3A 4C 07 4D 43 8D
0210 | 6F AF 67 16 22 41 E5 DD 15 6C 26 CE 4C 26 2C 52
0220 | C8 B2 BB 55 9F DB 8E 14 9C AC 5B 82 2C DD 59 C2
0230 | 2C 15 AD 66</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE000100497EE07350DDE83D682BDEB1</code> <code>6F7CA5D0D3EC7F0EF5FF24BFB3C1BECD</code> <code>3894853AE1A1B752C8737E9848AC1D89</code> <code>7296C25AC38D3F6BF8EF3035E8A8AD42</code> <code>E27B5561577ED5E2570F26D45FE42A22</code> <code>75B761E9FA0C1667D7EAA62E745E8EA1</code> <code>CA787F48F7C2444D67F74E46BB5BE2B2</code> <code>F77CE804F5D950843411A1C0C2946209</code> <code>E2A2BA9A2E8754A8A7B73A5A2CA19C84</code> <code>B477BF78945D5EA95616D2D89B7A11F7</code> <code>EBBE465523B8A37AFFA8C44C009387B1</code> <code>40755D7EB072518073DD6E6F412EA610</code> <code>C225320DB477DAA2EC3C441450656CCF</code> <code>5966FA82DF7CD03C11D8BC7AD2B23A4C</code> <code>074D438D6FAF67162241E5DD156C26CE</code> <code>4C262C52C8B2BB559FDB8E149CAC5B82</code><br> <code>2CDD59C2</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>2C15AD66</code> (1722619180 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 93B445C01C9006A9CBB244751539B5E69FE9F848193FA75876CD18A59B33AE0DE83E0DB260BA6D81A90EDE4D11AB47756418E459ACC909D1D7DA4F198F024565D86662F6E0A052E67C77B5DB145A54AE176DC072E2771F89E73742722772BEDAB93B0D1921C2933DBB6CE6C17783C0F673BEAB325584E112A1DDF02BF778059185FECB66A3613C539247D055BCF9FE3A0B4A764213ACD1A52F8C836F1C885E969A8865FD0BE170E581B8FD2EA3E8EF5E45433C45159FE57ACB101F090029F18AEA06D79DA3A4475D0A5801C9CD94FAF1725ECBA9254F3C24E5AB619C3EB4FFA0FBCF6869E8BBBAAC6CD633791ABBCA01D9B7FCBEB87E5A3B70E3B088E1A7E33D</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 5063278946679FE2F2A2642B8FA6659D5FA00EBE8BA1B30A724BD47CEA323F860C1A4948B6355DEA182CD3F6DA3CD33142162C2E84910A47D69CA5C767C84185BD9964B78CD36FAB427AFEC0447CD40F347E17D23D67FC8132C6B5B00BA22D13F85605E74918F242108DACFD724E4BF90D8708BCB20B3A681BA48FD494248AAFC3577A1B47D6FB806342B21A15D74CE61DD64526493F6CDB8965D0E8AC1C78457F003F934318B3F16DFFD0E4151D87B4F1D328DB9F14D1F785A2AF469E9B76EE7B5B64F3FC62AF1BD8BD18333F27B41D07D643BD0C6385578DA56F0E0CDA9AF0FE6DBCB9246F158140B0B161104C972BE07632F98764CE3C40B98EDA499D8663</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 84 05 86 8C 6A F5 1C 60 EE DA B4 E2
0010 | E3 5D 8F 62 36 87 B7 62 03 12 9A 48 85 4F 7D B1
0020 | C4 67 19 E7 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 50 63 27 89 46 67 9F E2 F2 A2 64 2B 8F A6 65 9D
0040 | 5F A0 0E BE 8B A1 B3 0A 72 4B D4 7C EA 32 3F 86
0050 | 0C 1A 49 48 B6 35 5D EA 18 2C D3 F6 DA 3C D3 31
0060 | 42 16 2C 2E 84 91 0A 47 D6 9C A5 C7 67 C8 41 85
0070 | BD 99 64 B7 8C D3 6F AB 42 7A FE C0 44 7C D4 0F
0080 | 34 7E 17 D2 3D 67 FC 81 32 C6 B5 B0 0B A2 2D 13
0090 | F8 56 05 E7 49 18 F2 42 10 8D AC FD 72 4E 4B F9
00A0 | 0D 87 08 BC B2 0B 3A 68 1B A4 8F D4 94 24 8A AF
00B0 | C3 57 7A 1B 47 D6 FB 80 63 42 B2 1A 15 D7 4C E6
00C0 | 1D D6 45 26 49 3F 6C DB 89 65 D0 E8 AC 1C 78 45
00D0 | 7F 00 3F 93 43 18 B3 F1 6D FF D0 E4 15 1D 87 B4
00E0 | F1 D3 28 DB 9F 14 D1 F7 85 A2 AF 46 9E 9B 76 EE
00F0 | 7B 5B 64 F3 FC 62 AF 1B D8 BD 18 33 3F 27 B4 1D
0100 | 07 D6 43 BD 0C 63 85 57 8D A5 6F 0E 0C DA 9A F0
0110 | FE 6D BC B9 24 6F 15 81 40 B0 B1 61 10 4C 97 2B
0120 | E0 76 32 F9 87 64 CE 3C 40 B9 8E DA 49 9D 86 63</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE0001005063278946679FE2F2A2642B</code> <code>8FA6659D5FA00EBE8BA1B30A724BD47C</code> <code>EA323F860C1A4948B6355DEA182CD3F6</code> <code>DA3CD33142162C2E84910A47D69CA5C7</code> <code>67C84185BD9964B78CD36FAB427AFEC0</code> <code>447CD40F347E17D23D67FC8132C6B5B0</code> <code>0BA22D13F85605E74918F242108DACFD</code> <code>724E4BF90D8708BCB20B3A681BA48FD4</code> <code>94248AAFC3577A1B47D6FB806342B21A</code> <code>15D74CE61DD64526493F6CDB8965D0E8</code> <code>AC1C78457F003F934318B3F16DFFD0E4</code> <code>151D87B4F1D328DB9F14D1F785A2AF46</code> <code>9E9B76EE7B5B64F3FC62AF1BD8BD1833</code> <code>3F27B41D07D643BD0C6385578DA56F0E</code> <code>0CDA9AF0FE6DBCB9246F158140B0B161</code> <code>104C972BE07632F98764CE3C40B98EDA</code><br> <code>499D8663</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B643668405868C6AF51C60EEDAB4E2E35D8F623687B76203129A48854F7DB1C46719E70000000000000000FE0001005063278946679FE2F2A2642B8FA6659D5FA00EBE8BA1B30A724BD47CEA323F860C1A4948B6355DEA182CD3F6DA3CD33142162C2E84910A47D69CA5C767C84185BD9964B78CD36FAB427AFEC0447CD40F347E17D23D67FC8132C6B5B00BA22D13F85605E74918F242108DACFD724E4BF90D8708BCB20B3A681BA48FD494248AAFC3577A1B47D6FB806342B21A15D74CE61DD64526493F6CDB8965D0E8AC1C78457F003F934318B3F16DFFD0E4151D87B4F1D328DB9F14D1F785A2AF469E9B76EE7B5B64F3FC62AF1BD8BD18333F27B41D07D643BD0C6385578DA56F0E0CDA9AF0FE6DBCB9246F158140B0B161104C972BE07632F98764CE3C40B98EDA499D8663
padding = 4788453480F6342FCA009400
tmp_aes_key = CAAA386C8996AF8549A7FD7EA2DEA9CAACA298F3A7235AD0C24EA1C2671398A0
tmp_aes_iv = 80B4E4587896E5DF12D94DA6D820055B54C1F39EFFE44BFCA8374351233E32A4</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 3199357C80569C8868E8B25F6C57535A898118F564D4662D06BA5BCBD458232A7A0214AE93E2FE0609382164494B22A22059906FA01663BCA20BEA013D2DC9B1C7AB5BAE21F528C802C40F13D45A6014CD0E2AC3AB40CFE7F7D23A812B37E7DD19AE4C1A1CD6487505F7F208596FFAEE0C338A47F5571CB20321473BF2BB65AE77030DE2575E20F3D1CA44DEC42CC0A9126CE95689B8F251C0B231CC5A0D0B14B6DBF37C7A247B7ACB8EB8284A40C9BD72F9A78F4DBC12D4F528E1CC0BF1FB3E0A7C62C61E410B7E83D87D42C293FA28634B34C06E22EC98C1565D85D385BD2698CF5F167C5A008B251E8E00026A79907DD95A3940A5E100316632EE71C0F60CC5D66445605535C567B53EDBF65B0D445128B5D25C995FC8048EDF47F0760349E132D27CED0FB491A9C6A7D4480E7B4B9B79B06DB20ABB7901A0D5FA8D35CD9C4F67E96B2BE07E8D64A8A4C00F94073E</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 F8 27 05 00 2C 15 AD 66
0010 | 78 01 00 00 1F 5F 04 F5 84 05 86 8C 6A F5 1C 60
0020 | EE DA B4 E2 E3 5D 8F 62 36 87 B7 62 03 12 9A 48
0030 | 85 4F 7D B1 C4 67 19 E7 FE 50 01 00 31 99 35 7C
0040 | 80 56 9C 88 68 E8 B2 5F 6C 57 53 5A 89 81 18 F5
0050 | 64 D4 66 2D 06 BA 5B CB D4 58 23 2A 7A 02 14 AE
0060 | 93 E2 FE 06 09 38 21 64 49 4B 22 A2 20 59 90 6F
0070 | A0 16 63 BC A2 0B EA 01 3D 2D C9 B1 C7 AB 5B AE
0080 | 21 F5 28 C8 02 C4 0F 13 D4 5A 60 14 CD 0E 2A C3
0090 | AB 40 CF E7 F7 D2 3A 81 2B 37 E7 DD 19 AE 4C 1A
00A0 | 1C D6 48 75 05 F7 F2 08 59 6F FA EE 0C 33 8A 47
00B0 | F5 57 1C B2 03 21 47 3B F2 BB 65 AE 77 03 0D E2
00C0 | 57 5E 20 F3 D1 CA 44 DE C4 2C C0 A9 12 6C E9 56
00D0 | 89 B8 F2 51 C0 B2 31 CC 5A 0D 0B 14 B6 DB F3 7C
00E0 | 7A 24 7B 7A CB 8E B8 28 4A 40 C9 BD 72 F9 A7 8F
00F0 | 4D BC 12 D4 F5 28 E1 CC 0B F1 FB 3E 0A 7C 62 C6
0100 | 1E 41 0B 7E 83 D8 7D 42 C2 93 FA 28 63 4B 34 C0
0110 | 6E 22 EC 98 C1 56 5D 85 D3 85 BD 26 98 CF 5F 16
0120 | 7C 5A 00 8B 25 1E 8E 00 02 6A 79 90 7D D9 5A 39
0130 | 40 A5 E1 00 31 66 32 EE 71 C0 F6 0C C5 D6 64 45
0140 | 60 55 35 C5 67 B5 3E DB F6 5B 0D 44 51 28 B5 D2
0150 | 5C 99 5F C8 04 8E DF 47 F0 76 03 49 E1 32 D2 7C
0160 | ED 0F B4 91 A9 C6 A7 D4 48 0E 7B 4B 9B 79 B0 6D
0170 | B2 0A BB 79 01 A0 D5 FA 8D 35 CD 9C 4F 67 E9 6B
0180 | 2B E0 7E 8D 64 A8 A4 C0 0F 94 07 3E</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>F82705002C15AD66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE5001003199357C80569C8868E8B25F</code> <code>6C57535A898118F564D4662D06BA5BCB</code> <code>D458232A7A0214AE93E2FE0609382164</code> <code>494B22A22059906FA01663BCA20BEA01</code> <code>3D2DC9B1C7AB5BAE21F528C802C40F13</code> <code>D45A6014CD0E2AC3AB40CFE7F7D23A81</code> <code>2B37E7DD19AE4C1A1CD6487505F7F208</code> <code>596FFAEE0C338A47F5571CB20321473B</code> <code>F2BB65AE77030DE2575E20F3D1CA44DE</code> <code>C42CC0A9126CE95689B8F251C0B231CC</code> <code>5A0D0B14B6DBF37C7A247B7ACB8EB828</code> <code>4A40C9BD72F9A78F4DBC12D4F528E1CC</code> <code>0BF1FB3E0A7C62C61E410B7E83D87D42</code> <code>C293FA28634B34C06E22EC98C1565D85</code> <code>D385BD2698CF5F167C5A008B251E8E00</code> <code>026A79907DD95A3940A5E100316632EE</code> <code>71C0F60CC5D66445605535C567B53EDB</code> <code>F65B0D445128B5D25C995FC8048EDF47</code> <code>F0760349E132D27CED0FB491A9C6A7D4</code> <code>480E7B4B9B79B06DB20ABB7901A0D5FA</code> <code>8D35CD9C4F67E96B2BE07E8D64A8A4C0</code><br> <code>0F94073E</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = BBC2E2B5108649272C2FAF6FECA64FE0881A2ECD86CD68A6F698E4056A4361229CA5D3BF26F4E24B01C296D63B66CCA1C46EDB5F6FAF476ECEF47460691D8D0816EA63AC560BF872D836A7624BA9075A7D7B3C0F132700935DEC01EC8C45791A75D3CC12462D3D87B973BEC4E6545D9CA502B348F5BFAB99B376D13CE52A5F03DC7F477AE83B07A30347DC214D84D2BD6B964B6B9BB204D9B9D0AB50AE00BA1D10FF640B16EAC3C3C127D90660EE549018BCCF7384C0A5B100B21A82002BD312FA0B4C4670E35C5B903477CA08C236A39B9995D6C7186120881A54E3D32FFAD7E98188AFB2351188E66B00D8FCD28B575262891DF9D32A48E29D3D707124C6C0</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 68 F9 31 2D 15 AD 66
0010 | 84 00 00 00 34 F7 CB 3B 84 05 86 8C 6A F5 1C 60
0020 | EE DA B4 E2 E3 5D 8F 62 36 87 B7 62 03 12 9A 48
0030 | 85 4F 7D B1 C4 67 19 E7 61 9C 61 4F 85 83 56 90
0040 | 1F 83 A4 04 6B A6 71 B1</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0168F9312D15AD66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>84000000</code> (132 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8405868C6AF51C60EEDAB4E2E35D8F62</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>3687B76203129A48854F7DB1C46719E7</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>619C614F858356901F83A4046BA671B1</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

