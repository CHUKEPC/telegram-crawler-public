<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?237" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 FC 37 09 00 E9 29 7B 66
0010 | 14 00 00 00 F1 8E 7E BE 2C 22 11 12 85 A5 5F FA
0020 | 5D BF 7A DF B7 C0 C0 44</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>FC370900E9297B66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 8C AA 62 E9 29 7B 66
0010 | 5C 00 00 00 63 24 16 05 2C 22 11 12 85 A5 5F FA
0020 | 5D BF 7A DF B7 C0 C0 44 A0 A2 EE 29 93 D9 C7 A4
0030 | 75 68 9A C7 B8 F6 7C F3 08 1F 43 95 81 FA E5 38
0040 | CF 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>018CAA62E9297B66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>5C000000</code> (92 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081F439581FAE538CF000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2252808624108026063</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2252808624108026063</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2252808624108026063 = 1198987549 * 1878925787</code></p>
<pre><code>p = 1198987549
q = 1878925787</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1F 43 95 81 FA E5 38 CF 00 00 00
0010 | 04 47 77 19 1D 00 00 00 04 6F FE 21 DB 00 00 00
0020 | 2C 22 11 12 85 A5 5F FA 5D BF 7A DF B7 C0 C0 44
0030 | A0 A2 EE 29 93 D9 C7 A4 75 68 9A C7 B8 F6 7C F3
0040 | 7A CF E5 4A 85 8A 75 CF D7 FC EB 54 DB E4 9C 33
0050 | 34 AC DE 42 C9 F5 61 8E 1F 32 DB 2D CF AC 91 2E
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081F439581FAE538CF000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2252808624108026063</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>044777191D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1198987549</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046FFE21DB000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1878925787</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>7ACFE54A858A75CFD7FCEB54DBE49C33</code> <code>34ACDE42C9F5618E1F32DB2DCFAC912E</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081F439581FAE538CF000000044777191D000000046FFE21DB0000002C22111285A55FFA5DBF7ADFB7C0C044A0A2EE2993D9C7A475689AC7B8F67CF37ACFE54A858A75CFD7FCEB54DBE49C3334ACDE42C9F5618E1F32DB2DCFAC912E02000000
random_padding_bytes = 6CCE48F774BFB5A7C5E8D1A44DA3568D986E320F8A4A248C01E8556C425474B697D5D6AA7DFFB9837C0A9FE3292EFFBC9FC89AC619868C482DD2E598833893D5837789F7ADB2A09FBD7104B3F1CE746245514CE885DF885D9A77DD51</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 10AA0856A0F68268D91ED14DB9837F46D190A2E41C7877F278D7B71AAB04826A20C6A167D23F6BBA860D1462D119DA96513E44E4E36A57F592F4518F9BC3325076A24DF938D2AF4FA1181D65367CF9F5BD2611E31EF33830FCDE657072A7520BB167FD7499AE00C89C49A54B14284B01422D8259DBE8C58D5C74AA740FF1DD68C22613435DDFB5827F798D7F9B5265DF22D584B10B320925550036155A1D9755CDFFA1EA37BBE0B19CF5B82CBAC1DD6D796AC19F7BA21DF1E9107317469DA9A445D6EB1D955F0A60AB8D85AC3D72AA48B99B925A391E85A9623DE2C9AF970B9749CC8B9ED1E61058745E9487891DF060D2637CD1E3984DDD644E48E67DD1193B</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 00 38 09 00 E9 29 7B 66
0010 | 40 01 00 00 BE E4 12 D7 2C 22 11 12 85 A5 5F FA
0020 | 5D BF 7A DF B7 C0 C0 44 A0 A2 EE 29 93 D9 C7 A4
0030 | 75 68 9A C7 B8 F6 7C F3 04 47 77 19 1D 00 00 00
0040 | 04 6F FE 21 DB 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 10 AA 08 56 A0 F6 82 68 D9 1E D1 4D
0060 | B9 83 7F 46 D1 90 A2 E4 1C 78 77 F2 78 D7 B7 1A
0070 | AB 04 82 6A 20 C6 A1 67 D2 3F 6B BA 86 0D 14 62
0080 | D1 19 DA 96 51 3E 44 E4 E3 6A 57 F5 92 F4 51 8F
0090 | 9B C3 32 50 76 A2 4D F9 38 D2 AF 4F A1 18 1D 65
00A0 | 36 7C F9 F5 BD 26 11 E3 1E F3 38 30 FC DE 65 70
00B0 | 72 A7 52 0B B1 67 FD 74 99 AE 00 C8 9C 49 A5 4B
00C0 | 14 28 4B 01 42 2D 82 59 DB E8 C5 8D 5C 74 AA 74
00D0 | 0F F1 DD 68 C2 26 13 43 5D DF B5 82 7F 79 8D 7F
00E0 | 9B 52 65 DF 22 D5 84 B1 0B 32 09 25 55 00 36 15
00F0 | 5A 1D 97 55 CD FF A1 EA 37 BB E0 B1 9C F5 B8 2C
0100 | BA C1 DD 6D 79 6A C1 9F 7B A2 1D F1 E9 10 73 17
0110 | 46 9D A9 A4 45 D6 EB 1D 95 5F 0A 60 AB 8D 85 AC
0120 | 3D 72 AA 48 B9 9B 92 5A 39 1E 85 A9 62 3D E2 C9
0130 | AF 97 0B 97 49 CC 8B 9E D1 E6 10 58 74 5E 94 87
0140 | 89 1D F0 60 D2 63 7C D1 E3 98 4D DD 64 4E 48 E6
0150 | 7D D1 19 3B</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>00380900E9297B66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>044777191D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1198987549</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046FFE21DB000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1878925787</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE00010010AA0856A0F68268D91ED14D</code> <code>B9837F46D190A2E41C7877F278D7B71A</code> <code>AB04826A20C6A167D23F6BBA860D1462</code> <code>D119DA96513E44E4E36A57F592F4518F</code> <code>9BC3325076A24DF938D2AF4FA1181D65</code> <code>367CF9F5BD2611E31EF33830FCDE6570</code> <code>72A7520BB167FD7499AE00C89C49A54B</code> <code>14284B01422D8259DBE8C58D5C74AA74</code> <code>0FF1DD68C22613435DDFB5827F798D7F</code> <code>9B5265DF22D584B10B32092555003615</code> <code>5A1D9755CDFFA1EA37BBE0B19CF5B82C</code> <code>BAC1DD6D796AC19F7BA21DF1E9107317</code> <code>469DA9A445D6EB1D955F0A60AB8D85AC</code> <code>3D72AA48B99B925A391E85A9623DE2C9</code> <code>AF970B9749CC8B9ED1E61058745E9487</code> <code>891DF060D2637CD1E3984DDD644E48E6</code><br> <code>7DD1193B</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 F0 2C 22 EA 29 7B 66
0010 | B4 02 00 00 5C 07 E8 D0 2C 22 11 12 85 A5 5F FA
0020 | 5D BF 7A DF B7 C0 C0 44 A0 A2 EE 29 93 D9 C7 A4
0030 | 75 68 9A C7 B8 F6 7C F3 FE 50 02 00 6F B8 75 96
0040 | A5 61 C2 23 B6 F1 40 5E 13 EC 1D 6B 9B 6D 56 EF
0050 | 53 B6 9D 3A FC AD 71 4F AF 87 23 3A 76 D1 DA 61
0060 | B3 8C 82 1E 77 67 3D FC E2 43 D8 20 49 14 3F F1
0070 | 00 34 13 D2 97 10 7C 7C 62 CE C5 25 9C 13 A1 B5
0080 | 27 7C B5 4B 38 11 FA 26 1C 77 19 6A 90 C7 1D BD
0090 | 97 2D F7 35 F1 F7 F8 E2 36 0B 52 16 7F 91 07 2F
00A0 | 0C 42 91 88 AE 73 D3 63 53 8B AC 43 E0 BB BB 21
00B0 | A6 BA 42 D2 F0 7D 86 76 0D 48 B0 9A 02 ED F0 70
00C0 | 1A AE A5 11 67 4F 66 63 86 EB 16 10 9C CB 50 48
00D0 | 34 63 01 4A E4 8E B5 EC 23 59 96 80 00 5E 9D B6
00E0 | EC FD 8C A2 AE 61 42 1E 1A 6F 9B 4F FF 8D 79 DE
00F0 | B7 B7 6E DB 26 2B 96 74 18 91 85 CB 24 8F DB 38
0100 | DA 8E 19 21 AC EE 84 40 16 73 EA C6 53 DD 08 B9
0110 | 93 86 99 8E 18 4E 15 5D AD 6C D3 46 2F B1 FF 3C
0120 | BB 1C 51 4C AF 4B 98 D5 FB 7B AB E1 13 3E CF 22
0130 | 48 85 77 F4 3E E7 41 6A D9 82 F9 27 00 F0 F7 4D
0140 | 3B 82 1E 38 2C 73 00 66 B3 C5 F3 AE 1F DC 3B AA
0150 | 3D 62 63 92 BB 7A 66 DA A8 17 32 CA 2A E0 B8 5A
0160 | D6 E1 74 1C 59 BC 31 17 63 66 33 85 70 C7 C4 ED
0170 | D4 A2 62 A2 C3 47 25 A4 73 C3 37 43 18 2B BB 8E
0180 | E0 3E 4E 62 36 6E D9 0E B7 20 9B FA A5 ED F7 07
0190 | D5 A0 3F 79 C2 6C 05 AF D4 E8 E2 CB 69 64 57 F3
01A0 | 8F 7E 39 0C 57 06 4A 6F 0B EC CA 0B 2A 80 22 AD
01B0 | B3 15 22 3B F6 87 31 E9 3A 8C 01 C2 A8 4A 10 2D
01C0 | 39 D1 25 1C F4 61 6D D8 6D 4E 15 FE 89 5F D3 A8
01D0 | A7 6C 56 26 71 92 94 66 AF F6 08 A0 2F 2D 07 13
01E0 | 48 FD 02 93 CE 11 00 52 DB F4 D9 A2 4A C9 47 B0
01F0 | D8 60 8D AA A0 1B D0 40 8E 55 AD A4 3C 4C 10 65
0200 | EC 20 15 AE C8 5E E6 19 FB 4D 4A 60 14 BB 51 99
0210 | 7C 6F 46 88 87 ED E2 DB 48 52 DC 60 BE D4 84 2A
0220 | 48 A9 8F 33 56 D2 DE 20 8D 94 31 9C E8 4E 64 14
0230 | FA 44 6B 62 F3 2B 78 87 23 94 3E E5 31 A7 5B E1
0240 | 9E F6 13 00 CE F5 23 91 8B A7 61 4B C2 B3 46 E6
0250 | 08 9B 90 3C A4 1E E0 16 61 B0 00 E2 27 0F EB 46
0260 | D4 7C 43 CC 19 B9 D9 0C 32 C8 E6 DB 4E FF 4F 58
0270 | B6 0E F3 30 75 14 FD 35 64 A3 47 06 E9 D8 BA 29
0280 | E0 D7 4E 4D 86 FB 1E 42 B9 CF 5A B1</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01F02C22EA297B66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>B4020000</code> (692 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002006FB87596A561C223B6F1405E</code> <code>13EC1D6B9B6D56EF53B69D3AFCAD714F</code> <code>AF87233A76D1DA61B38C821E77673DFC</code> <code>E243D82049143FF1003413D297107C7C</code> <code>62CEC5259C13A1B5277CB54B3811FA26</code> <code>1C77196A90C71DBD972DF735F1F7F8E2</code> <code>360B52167F91072F0C429188AE73D363</code> <code>538BAC43E0BBBB21A6BA42D2F07D8676</code> <code>0D48B09A02EDF0701AAEA511674F6663</code> <code>86EB16109CCB50483463014AE48EB5EC</code> <code>23599680005E9DB6ECFD8CA2AE61421E</code> <code>1A6F9B4FFF8D79DEB7B76EDB262B9674</code> <code>189185CB248FDB38DA8E1921ACEE8440</code> <code>1673EAC653DD08B99386998E184E155D</code> <code>AD6CD3462FB1FF3CBB1C514CAF4B98D5</code> <code>FB7BABE1133ECF22488577F43EE7416A</code> <code>D982F92700F0F74D3B821E382C730066</code> <code>B3C5F3AE1FDC3BAA3D626392BB7A66DA</code> <code>A81732CA2AE0B85AD6E1741C59BC3117</code> <code>6366338570C7C4EDD4A262A2C34725A4</code> <code>73C33743182BBB8EE03E4E62366ED90E</code> <code>B7209BFAA5EDF707D5A03F79C26C05AF</code> <code>D4E8E2CB696457F38F7E390C57064A6F</code> <code>0BECCA0B2A8022ADB315223BF68731E9</code> <code>3A8C01C2A84A102D39D1251CF4616DD8</code> <code>6D4E15FE895FD3A8A76C562671929466</code> <code>AFF608A02F2D071348FD0293CE110052</code> <code>DBF4D9A24AC947B0D8608DAAA01BD040</code> <code>8E55ADA43C4C1065EC2015AEC85EE619</code> <code>FB4D4A6014BB51997C6F468887EDE2DB</code> <code>4852DC60BED4842A48A98F3356D2DE20</code> <code>8D94319CE84E6414FA446B62F32B7887</code> <code>23943EE531A75BE19EF61300CEF52391</code> <code>8BA7614BC2B346E6089B903CA41EE016</code> <code>61B000E2270FEB46D47C43CC19B9D90C</code> <code>32C8E6DB4EFF4F58B60EF3307514FD35</code> <code>64A34706E9D8BA29E0D74E4D86FB1E42</code><br> <code>B9CF5AB1</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 6FB87596A561C223B6F1405E13EC1D6B9B6D56EF53B69D3AFCAD714FAF87233A76D1DA61B38C821E77673DFCE243D82049143FF1003413D297107C7C62CEC5259C13A1B5277CB54B3811FA261C77196A90C71DBD972DF735F1F7F8E2360B52167F91072F0C429188AE73D363538BAC43E0BBBB21A6BA42D2F07D86760D48B09A02EDF0701AAEA511674F666386EB16109CCB50483463014AE48EB5EC23599680005E9DB6ECFD8CA2AE61421E1A6F9B4FFF8D79DEB7B76EDB262B9674189185CB248FDB38DA8E1921ACEE84401673EAC653DD08B99386998E184E155DAD6CD3462FB1FF3CBB1C514CAF4B98D5FB7BABE1133ECF22488577F43EE7416AD982F92700F0F74D3B821E382C730066B3C5F3AE1FDC3BAA3D626392BB7A66DAA81732CA2AE0B85AD6E1741C59BC31176366338570C7C4EDD4A262A2C34725A473C33743182BBB8EE03E4E62366ED90EB7209BFAA5EDF707D5A03F79C26C05AFD4E8E2CB696457F38F7E390C57064A6F0BECCA0B2A8022ADB315223BF68731E93A8C01C2A84A102D39D1251CF4616DD86D4E15FE895FD3A8A76C562671929466AFF608A02F2D071348FD0293CE110052DBF4D9A24AC947B0D8608DAAA01BD0408E55ADA43C4C1065EC2015AEC85EE619FB4D4A6014BB51997C6F468887EDE2DB4852DC60BED4842A48A98F3356D2DE208D94319CE84E6414FA446B62F32B788723943EE531A75BE19EF61300CEF523918BA7614BC2B346E6089B903CA41EE01661B000E2270FEB46D47C43CC19B9D90C32C8E6DB4EFF4F58B60EF3307514FD3564A34706E9D8BA29E0D74E4D86FB1E42B9CF5AB1
tmp_aes_key = 19581A6606A51B4D64B6965A1576485CA19F65F37C34AF91728670A4BE3EEC40
tmp_aes_iv = FF9918EEF27701B049AD105054D9DC0AC33189635D5217C82E11B4AB7ACFE54A</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 6CBDF8247F6DF12109DE6F90719F8CE13D85343CBA0D89B52C22111285A55FFA5DBF7ADFB7C0C044A0A2EE2993D9C7A475689AC7B8F67CF303000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010013A776883E6EF3EADE80AB1E49C79E236D8EF659E6A9C4B8985C5BC7E4C11BAF98478F3F3F8CA0535F7A02938EA0FB8CF60B0AB79D469248001DB79705E42D2D79A2845647EE4EC9B617A8E68A54A33F2E5C8F7751AD6FCD1CE232BA6BDFDAD55C5A815E8AB2178FC5ED00325118522BBD07D4C62A44567F3AF8B27F3B4ABB578AE6B6631B2AE48D0DEB1C688FF13C8A60E2369C0782387476FDC76461EFDA24A6BAB9970DB8D7349244F13FBB6D208D92A6BB8518E01A46C87FD78C1898F90F5545BBB1381892F39286A039315C97E4C252D8DCBA8A6395E9FA1BE43B3AE8D94880CC46F45957236650D4B763EFC2AE2AAF296C42854FCDDB68CAFCBF91D6A9EA297B66582169B7E24CBEE9
answer = BA0D89B52C22111285A55FFA5DBF7ADFB7C0C044A0A2EE2993D9C7A475689AC7B8F67CF303000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010013A776883E6EF3EADE80AB1E49C79E236D8EF659E6A9C4B8985C5BC7E4C11BAF98478F3F3F8CA0535F7A02938EA0FB8CF60B0AB79D469248001DB79705E42D2D79A2845647EE4EC9B617A8E68A54A33F2E5C8F7751AD6FCD1CE232BA6BDFDAD55C5A815E8AB2178FC5ED00325118522BBD07D4C62A44567F3AF8B27F3B4ABB578AE6B6631B2AE48D0DEB1C688FF13C8A60E2369C0782387476FDC76461EFDA24A6BAB9970DB8D7349244F13FBB6D208D92A6BB8518E01A46C87FD78C1898F90F5545BBB1381892F39286A039315C97E4C252D8DCBA8A6395E9FA1BE43B3AE8D94880CC46F45957236650D4B763EFC2AE2AAF296C42854FCDDB68CAFCBF91D6A9EA297B66582169B7E24CBEE9</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 2C 22 11 12 85 A5 5F FA 5D BF 7A DF
0010 | B7 C0 C0 44 A0 A2 EE 29 93 D9 C7 A4 75 68 9A C7
0020 | B8 F6 7C F3 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 13 A7 76 88 3E 6E F3 EA DE 80 AB 1E 49 C7 9E 23
0140 | 6D 8E F6 59 E6 A9 C4 B8 98 5C 5B C7 E4 C1 1B AF
0150 | 98 47 8F 3F 3F 8C A0 53 5F 7A 02 93 8E A0 FB 8C
0160 | F6 0B 0A B7 9D 46 92 48 00 1D B7 97 05 E4 2D 2D
0170 | 79 A2 84 56 47 EE 4E C9 B6 17 A8 E6 8A 54 A3 3F
0180 | 2E 5C 8F 77 51 AD 6F CD 1C E2 32 BA 6B DF DA D5
0190 | 5C 5A 81 5E 8A B2 17 8F C5 ED 00 32 51 18 52 2B
01A0 | BD 07 D4 C6 2A 44 56 7F 3A F8 B2 7F 3B 4A BB 57
01B0 | 8A E6 B6 63 1B 2A E4 8D 0D EB 1C 68 8F F1 3C 8A
01C0 | 60 E2 36 9C 07 82 38 74 76 FD C7 64 61 EF DA 24
01D0 | A6 BA B9 97 0D B8 D7 34 92 44 F1 3F BB 6D 20 8D
01E0 | 92 A6 BB 85 18 E0 1A 46 C8 7F D7 8C 18 98 F9 0F
01F0 | 55 45 BB B1 38 18 92 F3 92 86 A0 39 31 5C 97 E4
0200 | C2 52 D8 DC BA 8A 63 95 E9 FA 1B E4 3B 3A E8 D9
0210 | 48 80 CC 46 F4 59 57 23 66 50 D4 B7 63 EF C2 AE
0220 | 2A AF 29 6C 42 85 4F CD DB 68 CA FC BF 91 D6 A9
0230 | EA 29 7B 66</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE00010013A776883E6EF3EADE80AB1E</code> <code>49C79E236D8EF659E6A9C4B8985C5BC7</code> <code>E4C11BAF98478F3F3F8CA0535F7A0293</code> <code>8EA0FB8CF60B0AB79D469248001DB797</code> <code>05E42D2D79A2845647EE4EC9B617A8E6</code> <code>8A54A33F2E5C8F7751AD6FCD1CE232BA</code> <code>6BDFDAD55C5A815E8AB2178FC5ED0032</code> <code>5118522BBD07D4C62A44567F3AF8B27F</code> <code>3B4ABB578AE6B6631B2AE48D0DEB1C68</code> <code>8FF13C8A60E2369C0782387476FDC764</code> <code>61EFDA24A6BAB9970DB8D7349244F13F</code> <code>BB6D208D92A6BB8518E01A46C87FD78C</code> <code>1898F90F5545BBB1381892F39286A039</code> <code>315C97E4C252D8DCBA8A6395E9FA1BE4</code> <code>3B3AE8D94880CC46F45957236650D4B7</code> <code>63EFC2AE2AAF296C42854FCDDB68CAFC</code><br> <code>BF91D6A9</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>EA297B66</code> (1719347690 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = BBE774D3966DF0FB036AFAF8ED130D717A11C2E0B0BFAED55AADF4BDDCBDE72682E8251A8C796E6C8A70E1398F5B13CAFDD51ED3FF63052C2C3DFB4274BB43397BC820CBC8B8592CC23D36437F8B7F57F62952E7A7473ABF09A5648E15F2129FC69C7D4610219202211879F79D0018273195244C3B1BB1ED377CA02BB4BE3D8024EAC492745A08557C824D39EC465C25D93B76BE4CF3AA433DBDEE953E2153F7E1405ECA5F438754FA20A727F1EAC86928B0DCFD2FBCB8C1BAAF185FB315EC4473C4D788DD12B2499F9C1D798D8F3CEF7197C0D1AD7CD4B99CBE109520EFF0A1ED32793B9A502A8DC5298467C594B3ADC57ACC8F8E48A6FBE455AA8BC5CA65DA</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = B0B4090020ECC9906C9A78314F45C0272C4E2783CE9CF7708759BE8D56D991E8A5F2173B3B770A264E937EFF8A5D48F66B51A0708E0FC5D1E614935ECB81D83024B02E4BD41D430A2095447F71FF225A02010F97A617E69B03A48C71291D4ADC53C5AF6503A8634545AC2A2834AD2B585093615473E76FD5E880B0E640A34FB94753ACC7DE65BF55CC999984F266F773F8A44814567EF47C929EFCA309A16D1E2B0F4D7A30F7FB2A2119A2ABE51AA8C780BDC89FE34E34D5C9C88161B6F93C52FAA8BBB3D69F410971D7ED6314793D5A78AFA1D71EFF7430A28EE27AB50859888E0C6B311024F1EC2AF4B83124AAC0778B5014316D20764969FCE8E9D95FCCD5</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 2C 22 11 12 85 A5 5F FA 5D BF 7A DF
0010 | B7 C0 C0 44 A0 A2 EE 29 93 D9 C7 A4 75 68 9A C7
0020 | B8 F6 7C F3 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | B0 B4 09 00 20 EC C9 90 6C 9A 78 31 4F 45 C0 27
0040 | 2C 4E 27 83 CE 9C F7 70 87 59 BE 8D 56 D9 91 E8
0050 | A5 F2 17 3B 3B 77 0A 26 4E 93 7E FF 8A 5D 48 F6
0060 | 6B 51 A0 70 8E 0F C5 D1 E6 14 93 5E CB 81 D8 30
0070 | 24 B0 2E 4B D4 1D 43 0A 20 95 44 7F 71 FF 22 5A
0080 | 02 01 0F 97 A6 17 E6 9B 03 A4 8C 71 29 1D 4A DC
0090 | 53 C5 AF 65 03 A8 63 45 45 AC 2A 28 34 AD 2B 58
00A0 | 50 93 61 54 73 E7 6F D5 E8 80 B0 E6 40 A3 4F B9
00B0 | 47 53 AC C7 DE 65 BF 55 CC 99 99 84 F2 66 F7 73
00C0 | F8 A4 48 14 56 7E F4 7C 92 9E FC A3 09 A1 6D 1E
00D0 | 2B 0F 4D 7A 30 F7 FB 2A 21 19 A2 AB E5 1A A8 C7
00E0 | 80 BD C8 9F E3 4E 34 D5 C9 C8 81 61 B6 F9 3C 52
00F0 | FA A8 BB B3 D6 9F 41 09 71 D7 ED 63 14 79 3D 5A
0100 | 78 AF A1 D7 1E FF 74 30 A2 8E E2 7A B5 08 59 88
0110 | 8E 0C 6B 31 10 24 F1 EC 2A F4 B8 31 24 AA C0 77
0120 | 8B 50 14 31 6D 20 76 49 69 FC E8 E9 D9 5F CC D5</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100B0B4090020ECC9906C9A7831</code> <code>4F45C0272C4E2783CE9CF7708759BE8D</code> <code>56D991E8A5F2173B3B770A264E937EFF</code> <code>8A5D48F66B51A0708E0FC5D1E614935E</code> <code>CB81D83024B02E4BD41D430A2095447F</code> <code>71FF225A02010F97A617E69B03A48C71</code> <code>291D4ADC53C5AF6503A8634545AC2A28</code> <code>34AD2B585093615473E76FD5E880B0E6</code> <code>40A34FB94753ACC7DE65BF55CC999984</code> <code>F266F773F8A44814567EF47C929EFCA3</code> <code>09A16D1E2B0F4D7A30F7FB2A2119A2AB</code> <code>E51AA8C780BDC89FE34E34D5C9C88161</code> <code>B6F93C52FAA8BBB3D69F410971D7ED63</code> <code>14793D5A78AFA1D71EFF7430A28EE27A</code> <code>B50859888E0C6B311024F1EC2AF4B831</code> <code>24AAC0778B5014316D20764969FCE8E9</code><br> <code>D95FCCD5</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B643662C22111285A55FFA5DBF7ADFB7C0C044A0A2EE2993D9C7A475689AC7B8F67CF30000000000000000FE000100B0B4090020ECC9906C9A78314F45C0272C4E2783CE9CF7708759BE8D56D991E8A5F2173B3B770A264E937EFF8A5D48F66B51A0708E0FC5D1E614935ECB81D83024B02E4BD41D430A2095447F71FF225A02010F97A617E69B03A48C71291D4ADC53C5AF6503A8634545AC2A2834AD2B585093615473E76FD5E880B0E640A34FB94753ACC7DE65BF55CC999984F266F773F8A44814567EF47C929EFCA309A16D1E2B0F4D7A30F7FB2A2119A2ABE51AA8C780BDC89FE34E34D5C9C88161B6F93C52FAA8BBB3D69F410971D7ED6314793D5A78AFA1D71EFF7430A28EE27AB50859888E0C6B311024F1EC2AF4B83124AAC0778B5014316D20764969FCE8E9D95FCCD5
padding = C1D4CE31DFAFF631C655A6CC
tmp_aes_key = 19581A6606A51B4D64B6965A1576485CA19F65F37C34AF91728670A4BE3EEC40
tmp_aes_iv = FF9918EEF27701B049AD105054D9DC0AC33189635D5217C82E11B4AB7ACFE54A</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 209DE500B5117602CA83A0FA23E26A693FEF63E38673E7FB427550CBB9BC585971825707D7F369FA4F63512F29636F4F7A4740566D0E388359BBF9162136180467F1EE537A0ECF6BB05F9C91369651D8A1A5B6D0886AE1157CC8464BF7AB57D818AA865561CF8B0A34BE9B33F5C2A27F1F755E083FE7B416255B40488A6776AFE4ADB3E3BD4CC16116CAD25192C25EB761D60B6B18A9905223B160FB79A806634D1B6E98F717D7EB24B3643C303F924C4B65902C45AB84575B8F58627F51BD3A4AE5DCE9E31E5827AD292CFBEFF827F64120F0C90CF0F00681F60B7E1CCD593B78967601A8C1549CEBFE1C80B540861CE64B2F60419A14023B4204FBECB97EE1A43FB390AB1F5AD608EDF73CFDE71F45732051FFD3B516250179591440E86327D5D3B8AE49D6D8FEF0B430843A35A46AE61EB254A34CA93CE21EDBEFE1E6536925552C46D5D65731F47E75D8139AD3E5</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 D0 DB 06 00 EA 29 7B 66
0010 | 78 01 00 00 1F 5F 04 F5 2C 22 11 12 85 A5 5F FA
0020 | 5D BF 7A DF B7 C0 C0 44 A0 A2 EE 29 93 D9 C7 A4
0030 | 75 68 9A C7 B8 F6 7C F3 FE 50 01 00 20 9D E5 00
0040 | B5 11 76 02 CA 83 A0 FA 23 E2 6A 69 3F EF 63 E3
0050 | 86 73 E7 FB 42 75 50 CB B9 BC 58 59 71 82 57 07
0060 | D7 F3 69 FA 4F 63 51 2F 29 63 6F 4F 7A 47 40 56
0070 | 6D 0E 38 83 59 BB F9 16 21 36 18 04 67 F1 EE 53
0080 | 7A 0E CF 6B B0 5F 9C 91 36 96 51 D8 A1 A5 B6 D0
0090 | 88 6A E1 15 7C C8 46 4B F7 AB 57 D8 18 AA 86 55
00A0 | 61 CF 8B 0A 34 BE 9B 33 F5 C2 A2 7F 1F 75 5E 08
00B0 | 3F E7 B4 16 25 5B 40 48 8A 67 76 AF E4 AD B3 E3
00C0 | BD 4C C1 61 16 CA D2 51 92 C2 5E B7 61 D6 0B 6B
00D0 | 18 A9 90 52 23 B1 60 FB 79 A8 06 63 4D 1B 6E 98
00E0 | F7 17 D7 EB 24 B3 64 3C 30 3F 92 4C 4B 65 90 2C
00F0 | 45 AB 84 57 5B 8F 58 62 7F 51 BD 3A 4A E5 DC E9
0100 | E3 1E 58 27 AD 29 2C FB EF F8 27 F6 41 20 F0 C9
0110 | 0C F0 F0 06 81 F6 0B 7E 1C CD 59 3B 78 96 76 01
0120 | A8 C1 54 9C EB FE 1C 80 B5 40 86 1C E6 4B 2F 60
0130 | 41 9A 14 02 3B 42 04 FB EC B9 7E E1 A4 3F B3 90
0140 | AB 1F 5A D6 08 ED F7 3C FD E7 1F 45 73 20 51 FF
0150 | D3 B5 16 25 01 79 59 14 40 E8 63 27 D5 D3 B8 AE
0160 | 49 D6 D8 FE F0 B4 30 84 3A 35 A4 6A E6 1E B2 54
0170 | A3 4C A9 3C E2 1E DB EF E1 E6 53 69 25 55 2C 46
0180 | D5 D6 57 31 F4 7E 75 D8 13 9A D3 E5</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>D0DB0600EA297B66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100209DE500B5117602CA83A0FA</code> <code>23E26A693FEF63E38673E7FB427550CB</code> <code>B9BC585971825707D7F369FA4F63512F</code> <code>29636F4F7A4740566D0E388359BBF916</code> <code>2136180467F1EE537A0ECF6BB05F9C91</code> <code>369651D8A1A5B6D0886AE1157CC8464B</code> <code>F7AB57D818AA865561CF8B0A34BE9B33</code> <code>F5C2A27F1F755E083FE7B416255B4048</code> <code>8A6776AFE4ADB3E3BD4CC16116CAD251</code> <code>92C25EB761D60B6B18A9905223B160FB</code> <code>79A806634D1B6E98F717D7EB24B3643C</code> <code>303F924C4B65902C45AB84575B8F5862</code> <code>7F51BD3A4AE5DCE9E31E5827AD292CFB</code> <code>EFF827F64120F0C90CF0F00681F60B7E</code> <code>1CCD593B78967601A8C1549CEBFE1C80</code> <code>B540861CE64B2F60419A14023B4204FB</code> <code>ECB97EE1A43FB390AB1F5AD608EDF73C</code> <code>FDE71F45732051FFD3B5162501795914</code> <code>40E86327D5D3B8AE49D6D8FEF0B43084</code> <code>3A35A46AE61EB254A34CA93CE21EDBEF</code> <code>E1E6536925552C46D5D65731F47E75D8</code><br> <code>139AD3E5</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 2200FD813F2533FCD1AC335388B7B8AEC03C3EE5E774CD1CEFC06254CA14086B8ECC0E1280B9CDB4798F945BC8AE0165D3ECD185E867515EB2ABFFA1470E6B9FE62DE0E944E7A7BE8CAB9F3F365066C47BE9179C2A6099D8E3B1D4FA9206E1196E9EDD667C843A00EC731940FC79AACE38F2337683020BEB736C690EDE09517F522EDFB9E1863D7C1A334A4815D3EC6C27BBE5434969BE76BD0533F78CE2B6EF94C74A96DD8BA02D81992DE47167A25543F45FAB1D470EAB69986A92EB276FBC049325642DA76DF0A3290C887FC44C6C4C456D3943BB1395A294145200DEB13C1FBE1C6BDDD541AEE2433870F936C6CB875BDB69F4C607D47D856FF1778A0906</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 48 7A 86 EA 29 7B 66
0010 | 58 00 00 00 34 F7 CB 3B 2C 22 11 12 85 A5 5F FA
0020 | 5D BF 7A DF B7 C0 C0 44 A0 A2 EE 29 93 D9 C7 A4
0030 | 75 68 9A C7 B8 F6 7C F3 FF 2E 0D 83 FE 87 25 8C
0040 | 80 16 DA 9E A9 19 E1 1C</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01487A86EA297B66</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>58000000</code> (88 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>2C22111285A55FFA5DBF7ADFB7C0C044</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>A0A2EE2993D9C7A475689AC7B8F67CF3</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>FF2E0D83FE87258C8016DA9EA919E11C</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

