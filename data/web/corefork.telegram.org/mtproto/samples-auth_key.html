<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?242" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 14 22 0D 00 66 B2 69 67
0010 | 14 00 00 00 F1 8E 7E BE F1 69 0F 45 6F F8 8F DE
0020 | C2 2E 0E 9C E6 E0 1F AC</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>14220D0066B26967</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 E4 DE CB 66 B2 69 67
0010 | 50 00 00 00 63 24 16 05 F1 69 0F 45 6F F8 8F DE
0020 | C2 2E 0E 9C E6 E0 1F AC F6 ED 15 5F C4 A4 6B 2E
0030 | ED 7D 59 B8 99 D0 3C C0 08 28 C9 F2 AF 00 77 0E
0040 | F5 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01E4DECB66B26967</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>0828C9F2AF00770EF5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2939147065276960501</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2939147065276960501</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2939147065276960501 = 1627344233 * 1806100397</code></p>
<pre><code>p = 1627344233
q = 1806100397</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 28 C9 F2 AF 00 77 0E F5 00 00 00
0010 | 04 60 FF 4D 69 00 00 00 04 6B A6 E7 AD 00 00 00
0020 | F1 69 0F 45 6F F8 8F DE C2 2E 0E 9C E6 E0 1F AC
0030 | F6 ED 15 5F C4 A4 6B 2E ED 7D 59 B8 99 D0 3C C0
0040 | AE A6 87 48 FB 84 FB CE CC A2 B8 E5 8A C9 43 7F
0050 | 3E FC EE 96 49 AE F9 CB 9D 90 F2 2E 22 B9 18 5A
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>0828C9F2AF00770EF5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2939147065276960501</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>0460FF4D69000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1627344233</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046BA6E7AD000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1806100397</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>AEA68748FB84FBCECCA2B8E58AC9437F</code> <code>3EFCEE9649AEF9CB9D90F22E22B9185A</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A90828C9F2AF00770EF50000000460FF4D69000000046BA6E7AD000000F1690F456FF88FDEC22E0E9CE6E01FACF6ED155FC4A46B2EED7D59B899D03CC0AEA68748FB84FBCECCA2B8E58AC9437F3EFCEE9649AEF9CB9D90F22E22B9185A02000000
random_padding_bytes = 16CAED1A9849AE8E80694EB20F35D574584602F0524E4B60D00F69B4EFADA10F37BEA0DC264FDCA0413EEC15AE69D46373EAF858E88078BCC3EB3D57532A192E2E1993A53E5263AEBA7843FADDEE82395AD17469A9C2B8529A1BCFA4</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = ABC374BB38090545A8F8EEA370855FD2F83EE95CD533F406DC8E90F1CC6369CD8C6A88FBEEE170F9EF26ADD7CBF5EFDCCB41247344AFE129EDA04E09D8D9C4C0E9D179653F2107457133328B26EF4483FBAA669EB2CA52C1DFCE70CB5413D9B9AD864BAAC83A8B15F8DE14E2A39C6718711B88F919329494264DC5CDB4B178D68DBB8DA21B79BE72CB4420413DA01EBBE52ACD383113B0604154DEFBFEF5C89924F607A7725249BF54977E7C0EBE4E72A6EEFC4A5AF77636FD4BE1F3059325C5C89566DF1471AB81D24A5A37B773950E9FA1CE2475671C3C54F119940BB2771A51F04844EFC0F9BC56022C7D7C0EA52ABABEB1AC68A25DB57CAFE1BD7D765040</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 18 22 0D 00 66 B2 69 67
0010 | 40 01 00 00 BE E4 12 D7 F1 69 0F 45 6F F8 8F DE
0020 | C2 2E 0E 9C E6 E0 1F AC F6 ED 15 5F C4 A4 6B 2E
0030 | ED 7D 59 B8 99 D0 3C C0 04 60 FF 4D 69 00 00 00
0040 | 04 6B A6 E7 AD 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 AB C3 74 BB 38 09 05 45 A8 F8 EE A3
0060 | 70 85 5F D2 F8 3E E9 5C D5 33 F4 06 DC 8E 90 F1
0070 | CC 63 69 CD 8C 6A 88 FB EE E1 70 F9 EF 26 AD D7
0080 | CB F5 EF DC CB 41 24 73 44 AF E1 29 ED A0 4E 09
0090 | D8 D9 C4 C0 E9 D1 79 65 3F 21 07 45 71 33 32 8B
00A0 | 26 EF 44 83 FB AA 66 9E B2 CA 52 C1 DF CE 70 CB
00B0 | 54 13 D9 B9 AD 86 4B AA C8 3A 8B 15 F8 DE 14 E2
00C0 | A3 9C 67 18 71 1B 88 F9 19 32 94 94 26 4D C5 CD
00D0 | B4 B1 78 D6 8D BB 8D A2 1B 79 BE 72 CB 44 20 41
00E0 | 3D A0 1E BB E5 2A CD 38 31 13 B0 60 41 54 DE FB
00F0 | FE F5 C8 99 24 F6 07 A7 72 52 49 BF 54 97 7E 7C
0100 | 0E BE 4E 72 A6 EE FC 4A 5A F7 76 36 FD 4B E1 F3
0110 | 05 93 25 C5 C8 95 66 DF 14 71 AB 81 D2 4A 5A 37
0120 | B7 73 95 0E 9F A1 CE 24 75 67 1C 3C 54 F1 19 94
0130 | 0B B2 77 1A 51 F0 48 44 EF C0 F9 BC 56 02 2C 7D
0140 | 7C 0E A5 2A BA BE B1 AC 68 A2 5D B5 7C AF E1 BD
0150 | 7D 76 50 40</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>18220D0066B26967</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>0460FF4D69000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1627344233</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046BA6E7AD000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1806100397</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE000100ABC374BB38090545A8F8EEA3</code> <code>70855FD2F83EE95CD533F406DC8E90F1</code> <code>CC6369CD8C6A88FBEEE170F9EF26ADD7</code> <code>CBF5EFDCCB41247344AFE129EDA04E09</code> <code>D8D9C4C0E9D179653F2107457133328B</code> <code>26EF4483FBAA669EB2CA52C1DFCE70CB</code> <code>5413D9B9AD864BAAC83A8B15F8DE14E2</code> <code>A39C6718711B88F919329494264DC5CD</code> <code>B4B178D68DBB8DA21B79BE72CB442041</code> <code>3DA01EBBE52ACD383113B0604154DEFB</code> <code>FEF5C89924F607A7725249BF54977E7C</code> <code>0EBE4E72A6EEFC4A5AF77636FD4BE1F3</code> <code>059325C5C89566DF1471AB81D24A5A37</code> <code>B773950E9FA1CE2475671C3C54F11994</code> <code>0BB2771A51F04844EFC0F9BC56022C7D</code> <code>7C0EA52ABABEB1AC68A25DB57CAFE1BD</code><br> <code>7D765040</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 A0 20 F1 66 B2 69 67
0010 | 78 02 00 00 5C 07 E8 D0 F1 69 0F 45 6F F8 8F DE
0020 | C2 2E 0E 9C E6 E0 1F AC F6 ED 15 5F C4 A4 6B 2E
0030 | ED 7D 59 B8 99 D0 3C C0 FE 50 02 00 2D 02 12 7A
0040 | A0 D0 54 5E FC 31 DF 54 10 44 92 84 EA BC A7 30
0050 | E6 5D 28 2A 39 48 20 6E 57 00 96 C6 41 BB F9 95
0060 | 16 1E A9 13 7F C5 C6 11 A4 52 B4 81 F1 E9 1F 6A
0070 | 65 F6 EE 80 70 3A 0E F6 B6 7B DA 85 72 D2 9C B8
0080 | D8 4A 22 82 92 0F 7A 38 8D 95 48 EE 7C 27 00 66
0090 | BA B8 3A BD 49 D1 39 BF CA 1C 71 14 EA D3 3E 83
00A0 | 77 EC 3A 23 7D BC 41 8C 1F 42 45 3D 31 02 30 2E
00B0 | 2B 5F F5 36 4C 80 75 B5 8C 4C 5A 26 D8 B1 E0 C6
00C0 | F2 5E 7A DE AA 1B 6C 86 A2 6E 32 67 2D 9C DE E8
00D0 | DF 2C 03 0A 0F 67 6B 09 E1 8D AD B1 85 E1 3A 0D
00E0 | 46 B1 E1 CE F8 A3 BA BC 0E 64 3D 8F 8C 79 43 CF
00F0 | 84 98 C3 76 23 F5 39 5F AE C3 09 F2 08 8E 66 54
0100 | F6 7B 68 03 B4 49 26 B6 0B 07 24 E4 45 FB 40 AC
0110 | E4 E6 4D 6B 5D 14 3E D2 FB A1 05 66 C2 32 C9 FD
0120 | 42 57 73 79 42 5D 8C 5C 2E 97 1F 2A 86 0F 07 55
0130 | 63 7D E8 AF F2 2C 54 54 B6 49 1D E2 3B BA 60 5E
0140 | 3A 74 5E 50 ED 4C 47 03 7C 37 F8 F7 C2 7D 78 56
0150 | E5 72 C0 FA 9A D9 7D BE DF 61 09 FC 5A EE 23 64
0160 | 7E EF CD C8 22 97 DE 00 FE A7 16 8A 41 8F 8A 4D
0170 | 0D 5C 64 8F 27 10 8D 76 6D F8 6B DB D1 B3 58 F8
0180 | 60 E6 BF E8 5F 25 E5 81 4B BC 54 1C 87 69 41 3A
0190 | C1 FC 7A 49 AD 23 44 D6 2E 38 8C 55 72 29 2D 7E
01A0 | 5A 6B 91 A9 29 9A E3 D3 E8 33 9B F4 4E A4 29 B6
01B0 | 91 CA 29 6F F1 41 B0 5F E2 13 8D 26 FF 98 80 8A
01C0 | 2A F2 2F 07 69 6E 7F 34 DA DF 3A 98 12 99 78 4D
01D0 | 56 86 B5 FA 19 4F C2 FC EE 27 38 36 88 2B BC 0C
01E0 | 50 A3 A8 D5 85 DC 93 0E 29 B4 3B EA 87 6A 83 E0
01F0 | B0 18 4C 5C E7 40 AA 79 A7 A5 B6 80 AC 55 DA C1
0200 | 22 E8 C2 16 AB DA CA 37 85 06 16 75 18 3C AA 95
0210 | 25 58 A8 0A EC 9B D6 2A 2C 83 B2 91 3D DB 86 97
0220 | B0 03 2B F2 C6 F8 FD 8D A4 F1 EB AA 16 5F A6 44
0230 | 86 EA 22 2B 7E 3D 17 67 B7 20 DF A0 09 C3 77 41
0240 | 74 D8 C4 79 B6 08 97 97 0A FF DE B9 77 60 2B BF
0250 | 71 0C 2B C2 BB 3B A6 3C 2F C5 CF E5 C6 F3 2C C5
0260 | C6 8F 9B 02 F0 65 F9 15 F0 2B 66 BF 48 02 80 B6
0270 | C1 67 F3 33 0B F8 3C 85 D0 76 76 C3 C4 FA 3A 3F
0280 | 82 1B A1 EC 27 70 67 9E FD E3 FB F8</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01A020F166B26967</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002002D02127AA0D0545EFC31DF54</code> <code>10449284EABCA730E65D282A3948206E</code> <code>570096C641BBF995161EA9137FC5C611</code> <code>A452B481F1E91F6A65F6EE80703A0EF6</code> <code>B67BDA8572D29CB8D84A2282920F7A38</code> <code>8D9548EE7C270066BAB83ABD49D139BF</code> <code>CA1C7114EAD33E8377EC3A237DBC418C</code> <code>1F42453D3102302E2B5FF5364C8075B5</code> <code>8C4C5A26D8B1E0C6F25E7ADEAA1B6C86</code> <code>A26E32672D9CDEE8DF2C030A0F676B09</code> <code>E18DADB185E13A0D46B1E1CEF8A3BABC</code> <code>0E643D8F8C7943CF8498C37623F5395F</code> <code>AEC309F2088E6654F67B6803B44926B6</code> <code>0B0724E445FB40ACE4E64D6B5D143ED2</code> <code>FBA10566C232C9FD42577379425D8C5C</code> <code>2E971F2A860F0755637DE8AFF22C5454</code> <code>B6491DE23BBA605E3A745E50ED4C4703</code> <code>7C37F8F7C27D7856E572C0FA9AD97DBE</code> <code>DF6109FC5AEE23647EEFCDC82297DE00</code> <code>FEA7168A418F8A4D0D5C648F27108D76</code> <code>6DF86BDBD1B358F860E6BFE85F25E581</code> <code>4BBC541C8769413AC1FC7A49AD2344D6</code> <code>2E388C5572292D7E5A6B91A9299AE3D3</code> <code>E8339BF44EA429B691CA296FF141B05F</code> <code>E2138D26FF98808A2AF22F07696E7F34</code> <code>DADF3A981299784D5686B5FA194FC2FC</code> <code>EE273836882BBC0C50A3A8D585DC930E</code> <code>29B43BEA876A83E0B0184C5CE740AA79</code> <code>A7A5B680AC55DAC122E8C216ABDACA37</code> <code>85061675183CAA952558A80AEC9BD62A</code> <code>2C83B2913DDB8697B0032BF2C6F8FD8D</code> <code>A4F1EBAA165FA64486EA222B7E3D1767</code> <code>B720DFA009C3774174D8C479B6089797</code> <code>0AFFDEB977602BBF710C2BC2BB3BA63C</code> <code>2FC5CFE5C6F32CC5C68F9B02F065F915</code> <code>F02B66BF480280B6C167F3330BF83C85</code> <code>D07676C3C4FA3A3F821BA1EC2770679E</code><br> <code>FDE3FBF8</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 2D02127AA0D0545EFC31DF5410449284EABCA730E65D282A3948206E570096C641BBF995161EA9137FC5C611A452B481F1E91F6A65F6EE80703A0EF6B67BDA8572D29CB8D84A2282920F7A388D9548EE7C270066BAB83ABD49D139BFCA1C7114EAD33E8377EC3A237DBC418C1F42453D3102302E2B5FF5364C8075B58C4C5A26D8B1E0C6F25E7ADEAA1B6C86A26E32672D9CDEE8DF2C030A0F676B09E18DADB185E13A0D46B1E1CEF8A3BABC0E643D8F8C7943CF8498C37623F5395FAEC309F2088E6654F67B6803B44926B60B0724E445FB40ACE4E64D6B5D143ED2FBA10566C232C9FD42577379425D8C5C2E971F2A860F0755637DE8AFF22C5454B6491DE23BBA605E3A745E50ED4C47037C37F8F7C27D7856E572C0FA9AD97DBEDF6109FC5AEE23647EEFCDC82297DE00FEA7168A418F8A4D0D5C648F27108D766DF86BDBD1B358F860E6BFE85F25E5814BBC541C8769413AC1FC7A49AD2344D62E388C5572292D7E5A6B91A9299AE3D3E8339BF44EA429B691CA296FF141B05FE2138D26FF98808A2AF22F07696E7F34DADF3A981299784D5686B5FA194FC2FCEE273836882BBC0C50A3A8D585DC930E29B43BEA876A83E0B0184C5CE740AA79A7A5B680AC55DAC122E8C216ABDACA3785061675183CAA952558A80AEC9BD62A2C83B2913DDB8697B0032BF2C6F8FD8DA4F1EBAA165FA64486EA222B7E3D1767B720DFA009C3774174D8C479B60897970AFFDEB977602BBF710C2BC2BB3BA63C2FC5CFE5C6F32CC5C68F9B02F065F915F02B66BF480280B6C167F3330BF83C85D07676C3C4FA3A3F821BA1EC2770679EFDE3FBF8
tmp_aes_key = 0EB56AB9E058A84E071D85CBC33F3B00D0C0ECE6E3573258E06050060F80C9E7
tmp_aes_iv = B90FF6A60838ABE8D336CBF05037902D8DC06D84081CC99591B5FF6EAEA68748</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 2018797726542508006FDC51A70FB076546ABD93BA0D89B5F1690F456FF88FDEC22E0E9CE6E01FACF6ED155FC4A46B2EED7D59B899D03CC003000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001000B57732E11693C24236AC7D9E076F9DE1DD2FEA0297BA0676995642B45307ED2B9B47A4E51D7FFD1BC37DCDC7201E16B776B34CF98D76647DD206E65BBD7D0DE1C954214F90149E3BF709D5C0F7AFA3A34E56EB2B7534EF814B3F69C5F0EC87EA7BD087AD9435263EB97AC1C16E9BE306E5C5836FE71720F09590CAD2942E6C35D9ED8561B846CBB88AA1B78253D80FB36E1F1D8B6EC7D5F62146079FC4967EF17F1B9125CB4C42754EBC4948E67A88244EEF17531BC70305DF4CA3DBAE42C274B85037D66211B4CB9250241560939EE18C8D0C3299F0D04923EDEFA67C9AB69605821E0D4CBC6FBD98BEDCE36333A9F1ED389633D65165C918DD355AF02839466B269675E874AF9F859B23F
answer = BA0D89B5F1690F456FF88FDEC22E0E9CE6E01FACF6ED155FC4A46B2EED7D59B899D03CC003000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001000B57732E11693C24236AC7D9E076F9DE1DD2FEA0297BA0676995642B45307ED2B9B47A4E51D7FFD1BC37DCDC7201E16B776B34CF98D76647DD206E65BBD7D0DE1C954214F90149E3BF709D5C0F7AFA3A34E56EB2B7534EF814B3F69C5F0EC87EA7BD087AD9435263EB97AC1C16E9BE306E5C5836FE71720F09590CAD2942E6C35D9ED8561B846CBB88AA1B78253D80FB36E1F1D8B6EC7D5F62146079FC4967EF17F1B9125CB4C42754EBC4948E67A88244EEF17531BC70305DF4CA3DBAE42C274B85037D66211B4CB9250241560939EE18C8D0C3299F0D04923EDEFA67C9AB69605821E0D4CBC6FBD98BEDCE36333A9F1ED389633D65165C918DD355AF02839466B269675E874AF9F859B23F</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 F1 69 0F 45 6F F8 8F DE C2 2E 0E 9C
0010 | E6 E0 1F AC F6 ED 15 5F C4 A4 6B 2E ED 7D 59 B8
0020 | 99 D0 3C C0 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 0B 57 73 2E 11 69 3C 24 23 6A C7 D9 E0 76 F9 DE
0140 | 1D D2 FE A0 29 7B A0 67 69 95 64 2B 45 30 7E D2
0150 | B9 B4 7A 4E 51 D7 FF D1 BC 37 DC DC 72 01 E1 6B
0160 | 77 6B 34 CF 98 D7 66 47 DD 20 6E 65 BB D7 D0 DE
0170 | 1C 95 42 14 F9 01 49 E3 BF 70 9D 5C 0F 7A FA 3A
0180 | 34 E5 6E B2 B7 53 4E F8 14 B3 F6 9C 5F 0E C8 7E
0190 | A7 BD 08 7A D9 43 52 63 EB 97 AC 1C 16 E9 BE 30
01A0 | 6E 5C 58 36 FE 71 72 0F 09 59 0C AD 29 42 E6 C3
01B0 | 5D 9E D8 56 1B 84 6C BB 88 AA 1B 78 25 3D 80 FB
01C0 | 36 E1 F1 D8 B6 EC 7D 5F 62 14 60 79 FC 49 67 EF
01D0 | 17 F1 B9 12 5C B4 C4 27 54 EB C4 94 8E 67 A8 82
01E0 | 44 EE F1 75 31 BC 70 30 5D F4 CA 3D BA E4 2C 27
01F0 | 4B 85 03 7D 66 21 1B 4C B9 25 02 41 56 09 39 EE
0200 | 18 C8 D0 C3 29 9F 0D 04 92 3E DE FA 67 C9 AB 69
0210 | 60 58 21 E0 D4 CB C6 FB D9 8B ED CE 36 33 3A 9F
0220 | 1E D3 89 63 3D 65 16 5C 91 8D D3 55 AF 02 83 94
0230 | 66 B2 69 67</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE0001000B57732E11693C24236AC7D9</code> <code>E076F9DE1DD2FEA0297BA0676995642B</code> <code>45307ED2B9B47A4E51D7FFD1BC37DCDC</code> <code>7201E16B776B34CF98D76647DD206E65</code> <code>BBD7D0DE1C954214F90149E3BF709D5C</code> <code>0F7AFA3A34E56EB2B7534EF814B3F69C</code> <code>5F0EC87EA7BD087AD9435263EB97AC1C</code> <code>16E9BE306E5C5836FE71720F09590CAD</code> <code>2942E6C35D9ED8561B846CBB88AA1B78</code> <code>253D80FB36E1F1D8B6EC7D5F62146079</code> <code>FC4967EF17F1B9125CB4C42754EBC494</code> <code>8E67A88244EEF17531BC70305DF4CA3D</code> <code>BAE42C274B85037D66211B4CB9250241</code> <code>560939EE18C8D0C3299F0D04923EDEFA</code> <code>67C9AB69605821E0D4CBC6FBD98BEDCE</code> <code>36333A9F1ED389633D65165C918DD355</code><br> <code>AF028394</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>66B26967</code> (1734980198 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = C9E6022780ADB857A202A6F110B6900BEDE540228D0F73D1EC4614B9A74E87442AF60807E9E99D09DAAC2491E712671E88895D4A4E718476729CA2B0E40EA4633A16929C3F52E9954C4A5344C07183A00F06A1891950C5BF240C4C9C673FCFF602D697D3C4855666851054E5A7D8919D4215535EDCE98EB2CE7D393910826104CA134B02E1AF5ADAB027CB8D0EBC6F97C39415107BFF4125F59C540154BE0F04C147D0D8325BB7758A9898EAFDB8502A9319EF4724C0D451A9628108D59C5F31CC276671595A342A7F3D5B3677CECA1CFD31CE679ADC2F3C9C9378C31B11857A883D0DF0FF922D3D048A047574975893945D9472D11C78D41B29A2B7594B468E</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 71B4B83D38178A54CAB0FA1B8382791B532A4D6578F539462449C334CC585753FF1E3C63B26736D3FE8919565BE78129F43D2BA9258954CFF3D64874C1CA7E26F0A2910C5332A61CE5AB52F7B4BE46C0BD3F66138683ABF7013117EDB7B6E56D507E225AD1286ED530762FF7DF60286E937F83B077493BB0F033FF44F54E6FD4BD203171D7756CB508C3A664E8F93443C67E5E5E9F83C6EC2702C388B8897E39542F8AC294277C9C786975229114F72F4CECF706E8F18C04518B42B85B7AD6CEA9EAD611E7C80854B01F77CB160260B1B0BBCD74A24FCB3AFA9D27280567008B90F91810971684D00C691E7CB23F796268B6EF6A809D57E7F285103DF355C153</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 F1 69 0F 45 6F F8 8F DE C2 2E 0E 9C
0010 | E6 E0 1F AC F6 ED 15 5F C4 A4 6B 2E ED 7D 59 B8
0020 | 99 D0 3C C0 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 71 B4 B8 3D 38 17 8A 54 CA B0 FA 1B 83 82 79 1B
0040 | 53 2A 4D 65 78 F5 39 46 24 49 C3 34 CC 58 57 53
0050 | FF 1E 3C 63 B2 67 36 D3 FE 89 19 56 5B E7 81 29
0060 | F4 3D 2B A9 25 89 54 CF F3 D6 48 74 C1 CA 7E 26
0070 | F0 A2 91 0C 53 32 A6 1C E5 AB 52 F7 B4 BE 46 C0
0080 | BD 3F 66 13 86 83 AB F7 01 31 17 ED B7 B6 E5 6D
0090 | 50 7E 22 5A D1 28 6E D5 30 76 2F F7 DF 60 28 6E
00A0 | 93 7F 83 B0 77 49 3B B0 F0 33 FF 44 F5 4E 6F D4
00B0 | BD 20 31 71 D7 75 6C B5 08 C3 A6 64 E8 F9 34 43
00C0 | C6 7E 5E 5E 9F 83 C6 EC 27 02 C3 88 B8 89 7E 39
00D0 | 54 2F 8A C2 94 27 7C 9C 78 69 75 22 91 14 F7 2F
00E0 | 4C EC F7 06 E8 F1 8C 04 51 8B 42 B8 5B 7A D6 CE
00F0 | A9 EA D6 11 E7 C8 08 54 B0 1F 77 CB 16 02 60 B1
0100 | B0 BB CD 74 A2 4F CB 3A FA 9D 27 28 05 67 00 8B
0110 | 90 F9 18 10 97 16 84 D0 0C 69 1E 7C B2 3F 79 62
0120 | 68 B6 EF 6A 80 9D 57 E7 F2 85 10 3D F3 55 C1 53</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE00010071B4B83D38178A54CAB0FA1B</code> <code>8382791B532A4D6578F539462449C334</code> <code>CC585753FF1E3C63B26736D3FE891956</code> <code>5BE78129F43D2BA9258954CFF3D64874</code> <code>C1CA7E26F0A2910C5332A61CE5AB52F7</code> <code>B4BE46C0BD3F66138683ABF7013117ED</code> <code>B7B6E56D507E225AD1286ED530762FF7</code> <code>DF60286E937F83B077493BB0F033FF44</code> <code>F54E6FD4BD203171D7756CB508C3A664</code> <code>E8F93443C67E5E5E9F83C6EC2702C388</code> <code>B8897E39542F8AC294277C9C78697522</code> <code>9114F72F4CECF706E8F18C04518B42B8</code> <code>5B7AD6CEA9EAD611E7C80854B01F77CB</code> <code>160260B1B0BBCD74A24FCB3AFA9D2728</code> <code>0567008B90F91810971684D00C691E7C</code> <code>B23F796268B6EF6A809D57E7F285103D</code><br> <code>F355C153</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366F1690F456FF88FDEC22E0E9CE6E01FACF6ED155FC4A46B2EED7D59B899D03CC00000000000000000FE00010071B4B83D38178A54CAB0FA1B8382791B532A4D6578F539462449C334CC585753FF1E3C63B26736D3FE8919565BE78129F43D2BA9258954CFF3D64874C1CA7E26F0A2910C5332A61CE5AB52F7B4BE46C0BD3F66138683ABF7013117EDB7B6E56D507E225AD1286ED530762FF7DF60286E937F83B077493BB0F033FF44F54E6FD4BD203171D7756CB508C3A664E8F93443C67E5E5E9F83C6EC2702C388B8897E39542F8AC294277C9C786975229114F72F4CECF706E8F18C04518B42B85B7AD6CEA9EAD611E7C80854B01F77CB160260B1B0BBCD74A24FCB3AFA9D27280567008B90F91810971684D00C691E7CB23F796268B6EF6A809D57E7F285103DF355C153
padding = F4720253CA2A30C423553DEC
tmp_aes_key = 0EB56AB9E058A84E071D85CBC33F3B00D0C0ECE6E3573258E06050060F80C9E7
tmp_aes_iv = B90FF6A60838ABE8D336CBF05037902D8DC06D84081CC99591B5FF6EAEA68748</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 10A26A12F44033332FD908ECAC1765D042F04046A5007607C4EEAF1AA1F06D4C116F17478CABD2360371842AB6C634DFCD34A68828DB104FAC36D7FFFE0468C9A2F85815434B0ED1F753E51DB829867B6074423DE60A1C8FE59DA246C8690A0D9F6162C7EDBED33D754116E3A82F66DE39DA1FA4108A28D722A7F4E035716CB16533D2C33A738093F29C50B8A1BE371F6E1B2E90B868FC28C0965D871D88E75248655E32412C245446731350344688CB16D7DEC889EE41995BF95847677F6C8DE1DE7ED5C193A8D01FE1F60EF7C5636759FB5DA2348AAD15ED8EDA664CDDC37CA854237B511AF30037FBB0C43FC076CD29078157D92BCA1CB0F030CD169BA0272F0B40F0B7388FB0F909C86D0191B8514C79E587B5289FD2C0FC1BA61A05656ADBC17C22044C09D06BF06284DEF25518F378D9299E1A0FD1844DD028E25841E26D5DB37C5F698602900598BCB4AC6D58</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 00 63 0C 00 67 B2 69 67
0010 | 78 01 00 00 1F 5F 04 F5 F1 69 0F 45 6F F8 8F DE
0020 | C2 2E 0E 9C E6 E0 1F AC F6 ED 15 5F C4 A4 6B 2E
0030 | ED 7D 59 B8 99 D0 3C C0 FE 50 01 00 10 A2 6A 12
0040 | F4 40 33 33 2F D9 08 EC AC 17 65 D0 42 F0 40 46
0050 | A5 00 76 07 C4 EE AF 1A A1 F0 6D 4C 11 6F 17 47
0060 | 8C AB D2 36 03 71 84 2A B6 C6 34 DF CD 34 A6 88
0070 | 28 DB 10 4F AC 36 D7 FF FE 04 68 C9 A2 F8 58 15
0080 | 43 4B 0E D1 F7 53 E5 1D B8 29 86 7B 60 74 42 3D
0090 | E6 0A 1C 8F E5 9D A2 46 C8 69 0A 0D 9F 61 62 C7
00A0 | ED BE D3 3D 75 41 16 E3 A8 2F 66 DE 39 DA 1F A4
00B0 | 10 8A 28 D7 22 A7 F4 E0 35 71 6C B1 65 33 D2 C3
00C0 | 3A 73 80 93 F2 9C 50 B8 A1 BE 37 1F 6E 1B 2E 90
00D0 | B8 68 FC 28 C0 96 5D 87 1D 88 E7 52 48 65 5E 32
00E0 | 41 2C 24 54 46 73 13 50 34 46 88 CB 16 D7 DE C8
00F0 | 89 EE 41 99 5B F9 58 47 67 7F 6C 8D E1 DE 7E D5
0100 | C1 93 A8 D0 1F E1 F6 0E F7 C5 63 67 59 FB 5D A2
0110 | 34 8A AD 15 ED 8E DA 66 4C DD C3 7C A8 54 23 7B
0120 | 51 1A F3 00 37 FB B0 C4 3F C0 76 CD 29 07 81 57
0130 | D9 2B CA 1C B0 F0 30 CD 16 9B A0 27 2F 0B 40 F0
0140 | B7 38 8F B0 F9 09 C8 6D 01 91 B8 51 4C 79 E5 87
0150 | B5 28 9F D2 C0 FC 1B A6 1A 05 65 6A DB C1 7C 22
0160 | 04 4C 09 D0 6B F0 62 84 DE F2 55 18 F3 78 D9 29
0170 | 9E 1A 0F D1 84 4D D0 28 E2 58 41 E2 6D 5D B3 7C
0180 | 5F 69 86 02 90 05 98 BC B4 AC 6D 58</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>00630C0067B26967</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE50010010A26A12F44033332FD908EC</code> <code>AC1765D042F04046A5007607C4EEAF1A</code> <code>A1F06D4C116F17478CABD2360371842A</code> <code>B6C634DFCD34A68828DB104FAC36D7FF</code> <code>FE0468C9A2F85815434B0ED1F753E51D</code> <code>B829867B6074423DE60A1C8FE59DA246</code> <code>C8690A0D9F6162C7EDBED33D754116E3</code> <code>A82F66DE39DA1FA4108A28D722A7F4E0</code> <code>35716CB16533D2C33A738093F29C50B8</code> <code>A1BE371F6E1B2E90B868FC28C0965D87</code> <code>1D88E75248655E32412C245446731350</code> <code>344688CB16D7DEC889EE41995BF95847</code> <code>677F6C8DE1DE7ED5C193A8D01FE1F60E</code> <code>F7C5636759FB5DA2348AAD15ED8EDA66</code> <code>4CDDC37CA854237B511AF30037FBB0C4</code> <code>3FC076CD29078157D92BCA1CB0F030CD</code> <code>169BA0272F0B40F0B7388FB0F909C86D</code> <code>0191B8514C79E587B5289FD2C0FC1BA6</code> <code>1A05656ADBC17C22044C09D06BF06284</code> <code>DEF25518F378D9299E1A0FD1844DD028</code> <code>E25841E26D5DB37C5F698602900598BC</code><br> <code>B4AC6D58</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 6635B38E331344B983F41B91C148B25D5C68663A562790FB6FBAEFFBC0B981A96EBBECDDB93443D78688018DB38A7733CCCDE7C4581493CA1D1D79719FE45DADBA34B509227F806997662D9AA577822C4758F8303B771AFDB95A0F7DC4F0C0C861AE88086324FE2988FFA7E8B9450911FBE1ADB9C941132D779142A68220293FF13827D5276E1B782A0E2D87A925E53F97AB68899B5246259965D47FC7B83CD2AFA83F090B3D44500CC5DFFA1345F6B9C6F8A7FFD927D88EEBFEAE229555F6388D5320A1817D2699A0539C34CFAF7E894A6E12D0B717D0006C346C8989E11C3A4CDD4461751845FACC18599B624DE4EDEE670C08BB19C0DA0A35BF4A9F41E017</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 B4 8F 78 68 B2 69 67
0010 | 34 00 00 00 34 F7 CB 3B F1 69 0F 45 6F F8 8F DE
0020 | C2 2E 0E 9C E6 E0 1F AC F6 ED 15 5F C4 A4 6B 2E
0030 | ED 7D 59 B8 99 D0 3C C0 6B C4 5C 35 5F BB 59 85
0040 | 8E A6 62 92 59 28 F9 F7</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01B48F7868B26967</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>F1690F456FF88FDEC22E0E9CE6E01FAC</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>F6ED155FC4A46B2EED7D59B899D03CC0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>6BC45C355FBB59858EA662925928F9F7</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

