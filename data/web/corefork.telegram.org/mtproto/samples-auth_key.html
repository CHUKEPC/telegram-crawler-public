<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?242" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 E8 5B 06 00 77 B0 5E 67
0010 | 14 00 00 00 F1 8E 7E BE 84 F4 11 73 18 BB DB 96
0020 | 45 65 C1 F9 3A E9 5E 12</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>E85B060077B05E67</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 74 74 E6 77 B0 5E 67
0010 | 50 00 00 00 63 24 16 05 84 F4 11 73 18 BB DB 96
0020 | 45 65 C1 F9 3A E9 5E 12 C3 D0 92 3C 66 E0 C7 E7
0030 | 6B 06 41 C1 84 F9 9B 2B 08 26 35 AF EE A1 7A 17
0040 | 1D 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>017474E677B05E67</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>082635AFEEA17A171D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2753300186653136669</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2753300186653136669</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2753300186653136669 = 1652284399 * 1666359731</code></p>
<pre><code>p = 1652284399
q = 1666359731</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 26 35 AF EE A1 7A 17 1D 00 00 00
0010 | 04 62 7B DB EF 00 00 00 04 63 52 A1 B3 00 00 00
0020 | 84 F4 11 73 18 BB DB 96 45 65 C1 F9 3A E9 5E 12
0030 | C3 D0 92 3C 66 E0 C7 E7 6B 06 41 C1 84 F9 9B 2B
0040 | C2 7F E7 5D 92 64 D6 87 26 55 11 DF 7E 6C D4 A2
0050 | 8A 96 8F 68 52 61 09 8A 76 EF EA E8 67 D5 05 13
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>082635AFEEA17A171D000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2753300186653136669</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>04627BDBEF000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1652284399</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046352A1B3000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1666359731</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>C27FE75D9264D687265511DF7E6CD4A2</code> <code>8A968F685261098A76EFEAE867D50513</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9082635AFEEA17A171D00000004627BDBEF000000046352A1B300000084F4117318BBDB964565C1F93AE95E12C3D0923C66E0C7E76B0641C184F99B2BC27FE75D9264D687265511DF7E6CD4A28A968F685261098A76EFEAE867D5051302000000
random_padding_bytes = 37BDB8FEB07F7476A843499254DD9DECC9B96EB18631E36261D72D8916460E61E0E42450F4295BBA5B61C35854BA8A0F6CAB0EF264DE6AB9FA5FCE45D71942743F7A5CBED4A0E34DBC0CD115BC3A62E4CBEEAE8AA9D9A984EDA84160</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 5D352C5B1996C2A8F033BEA57FAC89BD3F79E198D0B50262B36DAF5F200C35FEFB5DE468443881CA01B2BA6FAFA184D28CECE732AE2D16E38CFCF70F7053AB92939D22FAFC0BD52A8DC448DF8E368041463815D07E9DA2A1DD53F571E2805E652A8F8105F9D58709366FAB3440C861BD52313B2BDFD89B2DA3FCF654624961A285FD1735F87B508FCBF8A80312A53B49D0BD86E26CDFDA7958E7771421C0FC593175DE3320FCA90CE13713DEECFCE970D116910E510839503E84BA0EF50C7CD74E47558FC5E326E4568541C71550C5B959906C75C069A99DCC66CAF6B24ACD472FFDDD6262C8424B5CABAC19BBDD16987628A5342103758CAE930EC31CA084DB</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 EC 5B 06 00 77 B0 5E 67
0010 | 40 01 00 00 BE E4 12 D7 84 F4 11 73 18 BB DB 96
0020 | 45 65 C1 F9 3A E9 5E 12 C3 D0 92 3C 66 E0 C7 E7
0030 | 6B 06 41 C1 84 F9 9B 2B 04 62 7B DB EF 00 00 00
0040 | 04 63 52 A1 B3 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 5D 35 2C 5B 19 96 C2 A8 F0 33 BE A5
0060 | 7F AC 89 BD 3F 79 E1 98 D0 B5 02 62 B3 6D AF 5F
0070 | 20 0C 35 FE FB 5D E4 68 44 38 81 CA 01 B2 BA 6F
0080 | AF A1 84 D2 8C EC E7 32 AE 2D 16 E3 8C FC F7 0F
0090 | 70 53 AB 92 93 9D 22 FA FC 0B D5 2A 8D C4 48 DF
00A0 | 8E 36 80 41 46 38 15 D0 7E 9D A2 A1 DD 53 F5 71
00B0 | E2 80 5E 65 2A 8F 81 05 F9 D5 87 09 36 6F AB 34
00C0 | 40 C8 61 BD 52 31 3B 2B DF D8 9B 2D A3 FC F6 54
00D0 | 62 49 61 A2 85 FD 17 35 F8 7B 50 8F CB F8 A8 03
00E0 | 12 A5 3B 49 D0 BD 86 E2 6C DF DA 79 58 E7 77 14
00F0 | 21 C0 FC 59 31 75 DE 33 20 FC A9 0C E1 37 13 DE
0100 | EC FC E9 70 D1 16 91 0E 51 08 39 50 3E 84 BA 0E
0110 | F5 0C 7C D7 4E 47 55 8F C5 E3 26 E4 56 85 41 C7
0120 | 15 50 C5 B9 59 90 6C 75 C0 69 A9 9D CC 66 CA F6
0130 | B2 4A CD 47 2F FD DD 62 62 C8 42 4B 5C AB AC 19
0140 | BB DD 16 98 76 28 A5 34 21 03 75 8C AE 93 0E C3
0150 | 1C A0 84 DB</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>EC5B060077B05E67</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>04627BDBEF000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1652284399</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046352A1B3000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1666359731</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE0001005D352C5B1996C2A8F033BEA5</code> <code>7FAC89BD3F79E198D0B50262B36DAF5F</code> <code>200C35FEFB5DE468443881CA01B2BA6F</code> <code>AFA184D28CECE732AE2D16E38CFCF70F</code> <code>7053AB92939D22FAFC0BD52A8DC448DF</code> <code>8E368041463815D07E9DA2A1DD53F571</code> <code>E2805E652A8F8105F9D58709366FAB34</code> <code>40C861BD52313B2BDFD89B2DA3FCF654</code> <code>624961A285FD1735F87B508FCBF8A803</code> <code>12A53B49D0BD86E26CDFDA7958E77714</code> <code>21C0FC593175DE3320FCA90CE13713DE</code> <code>ECFCE970D116910E510839503E84BA0E</code> <code>F50C7CD74E47558FC5E326E4568541C7</code> <code>1550C5B959906C75C069A99DCC66CAF6</code> <code>B24ACD472FFDDD6262C8424B5CABAC19</code> <code>BBDD16987628A5342103758CAE930EC3</code><br> <code>1CA084DB</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 00 43 05 78 B0 5E 67
0010 | 78 02 00 00 5C 07 E8 D0 84 F4 11 73 18 BB DB 96
0020 | 45 65 C1 F9 3A E9 5E 12 C3 D0 92 3C 66 E0 C7 E7
0030 | 6B 06 41 C1 84 F9 9B 2B FE 50 02 00 3C 1E FE 65
0040 | AF A3 0E 21 05 BD E6 C9 6C BB 81 DE 25 F5 D5 17
0050 | B6 BC 52 CA EE 6C 8B CF 1A E7 73 B1 76 35 DF 11
0060 | 75 ED DC E0 0F B5 6F C5 A5 5F 05 2B 63 93 A2 7E
0070 | E3 38 79 0F 9E CD 25 68 08 9D 23 04 F8 BB 77 69
0080 | 76 D3 26 AF 34 EF 64 59 A6 14 BE 48 C6 F0 B3 94
0090 | 1F 7E 84 3B 74 22 7F C9 E2 25 1B 2D C9 E4 6F CB
00A0 | 96 0B 72 D1 89 F1 CF 4E F9 D9 C4 92 0D BC B1 00
00B0 | D9 71 66 2B 45 9D 49 B6 88 1B AC 5B 56 0E E1 8D
00C0 | 24 02 F1 C9 AE 2D 28 B9 AF 25 29 00 E1 F3 67 2A
00D0 | C9 84 84 34 2B 61 2B A1 DA 52 9B 1D B0 15 31 3A
00E0 | BC 10 E0 2B 22 CD 95 11 BF 6D EF 27 06 00 12 3F
00F0 | BC A6 17 C1 75 E7 7B 06 7A 17 35 E9 94 12 04 3E
0100 | 99 65 AD 36 9C A3 D0 65 B7 E5 56 96 3B 3F A3 68
0110 | 3D C2 92 2F 67 2D FD 11 2C D9 8D DA 46 FE 1D 57
0120 | A6 10 79 58 AC FE 28 B9 5F 18 CB 3B A1 E5 7D 06
0130 | F9 5F 22 A7 79 9A EE 17 08 07 7F 81 39 0E D8 3D
0140 | BB 71 F3 4E EE 11 E7 8F 1E FB 22 54 4F FE 33 4A
0150 | 81 ED 25 77 11 F5 12 88 3B D2 00 24 D2 A6 8E 93
0160 | 2F 8F 14 AF E1 8F E4 C3 EB A8 34 6F 70 35 3A 90
0170 | B9 D0 F9 C5 51 8C FF 98 CA 59 76 A8 69 0E 90 BE
0180 | AC 20 B4 DF 3E 9C BA 37 EE 30 1D D9 68 C6 5F 6F
0190 | B6 CB 48 FB 5F E7 F9 37 9E EC 20 B2 2F 41 54 24
01A0 | A8 31 88 20 9D 97 54 DA E2 7C 98 35 B7 B8 CE 5F
01B0 | 85 87 2E B0 1E 51 53 86 7C 7F 35 09 85 A8 F0 FD
01C0 | 21 54 C3 19 26 CB 64 FB 2E DD 55 D7 60 0C 93 27
01D0 | 74 9D F9 63 9E F2 5F 6E 52 70 E0 A7 7E 60 41 DC
01E0 | A1 60 7A EA 0E 56 24 4F 1B 4E 97 DA 70 A9 36 CE
01F0 | 23 BA 61 51 89 D9 54 24 80 FD C3 93 57 35 3B 83
0200 | CE CF 6A 0D FC CD C5 60 CD A5 07 87 35 0C 23 C4
0210 | 26 C5 68 AD 15 24 B3 54 B4 59 56 F5 5B 65 3B 38
0220 | C4 0C 3C 93 5B E6 68 0E 33 AC 2A B1 23 5F B6 6D
0230 | D9 A8 F6 1F 4E 09 69 0A C1 D1 D5 C2 D1 5F 3B F7
0240 | FB 99 02 C8 AF 04 44 8B E1 47 8B E0 26 2E EA A8
0250 | BE 10 C8 9D 86 9D 39 76 D1 55 BD EA BF 46 72 73
0260 | D0 7A 54 82 F8 AD CD CB 01 43 8C E4 5A 0E 39 24
0270 | 72 DB 12 CE C3 1B DF A7 6F 4C AC 48 26 59 62 C3
0280 | BD 06 0B 9E 94 E7 F8 B7 D3 F9 A7 6E</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0100430578B05E67</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002003C1EFE65AFA30E2105BDE6C9</code> <code>6CBB81DE25F5D517B6BC52CAEE6C8BCF</code> <code>1AE773B17635DF1175EDDCE00FB56FC5</code> <code>A55F052B6393A27EE338790F9ECD2568</code> <code>089D2304F8BB776976D326AF34EF6459</code> <code>A614BE48C6F0B3941F7E843B74227FC9</code> <code>E2251B2DC9E46FCB960B72D189F1CF4E</code> <code>F9D9C4920DBCB100D971662B459D49B6</code> <code>881BAC5B560EE18D2402F1C9AE2D28B9</code> <code>AF252900E1F3672AC98484342B612BA1</code> <code>DA529B1DB015313ABC10E02B22CD9511</code> <code>BF6DEF270600123FBCA617C175E77B06</code> <code>7A1735E99412043E9965AD369CA3D065</code> <code>B7E556963B3FA3683DC2922F672DFD11</code> <code>2CD98DDA46FE1D57A6107958ACFE28B9</code> <code>5F18CB3BA1E57D06F95F22A7799AEE17</code> <code>08077F81390ED83DBB71F34EEE11E78F</code> <code>1EFB22544FFE334A81ED257711F51288</code> <code>3BD20024D2A68E932F8F14AFE18FE4C3</code> <code>EBA8346F70353A90B9D0F9C5518CFF98</code> <code>CA5976A8690E90BEAC20B4DF3E9CBA37</code> <code>EE301DD968C65F6FB6CB48FB5FE7F937</code> <code>9EEC20B22F415424A83188209D9754DA</code> <code>E27C9835B7B8CE5F85872EB01E515386</code> <code>7C7F350985A8F0FD2154C31926CB64FB</code> <code>2EDD55D7600C9327749DF9639EF25F6E</code> <code>5270E0A77E6041DCA1607AEA0E56244F</code> <code>1B4E97DA70A936CE23BA615189D95424</code> <code>80FDC39357353B83CECF6A0DFCCDC560</code> <code>CDA50787350C23C426C568AD1524B354</code> <code>B45956F55B653B38C40C3C935BE6680E</code> <code>33AC2AB1235FB66DD9A8F61F4E09690A</code> <code>C1D1D5C2D15F3BF7FB9902C8AF04448B</code> <code>E1478BE0262EEAA8BE10C89D869D3976</code> <code>D155BDEABF467273D07A5482F8ADCDCB</code> <code>01438CE45A0E392472DB12CEC31BDFA7</code> <code>6F4CAC48265962C3BD060B9E94E7F8B7</code><br> <code>D3F9A76E</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 3C1EFE65AFA30E2105BDE6C96CBB81DE25F5D517B6BC52CAEE6C8BCF1AE773B17635DF1175EDDCE00FB56FC5A55F052B6393A27EE338790F9ECD2568089D2304F8BB776976D326AF34EF6459A614BE48C6F0B3941F7E843B74227FC9E2251B2DC9E46FCB960B72D189F1CF4EF9D9C4920DBCB100D971662B459D49B6881BAC5B560EE18D2402F1C9AE2D28B9AF252900E1F3672AC98484342B612BA1DA529B1DB015313ABC10E02B22CD9511BF6DEF270600123FBCA617C175E77B067A1735E99412043E9965AD369CA3D065B7E556963B3FA3683DC2922F672DFD112CD98DDA46FE1D57A6107958ACFE28B95F18CB3BA1E57D06F95F22A7799AEE1708077F81390ED83DBB71F34EEE11E78F1EFB22544FFE334A81ED257711F512883BD20024D2A68E932F8F14AFE18FE4C3EBA8346F70353A90B9D0F9C5518CFF98CA5976A8690E90BEAC20B4DF3E9CBA37EE301DD968C65F6FB6CB48FB5FE7F9379EEC20B22F415424A83188209D9754DAE27C9835B7B8CE5F85872EB01E5153867C7F350985A8F0FD2154C31926CB64FB2EDD55D7600C9327749DF9639EF25F6E5270E0A77E6041DCA1607AEA0E56244F1B4E97DA70A936CE23BA615189D9542480FDC39357353B83CECF6A0DFCCDC560CDA50787350C23C426C568AD1524B354B45956F55B653B38C40C3C935BE6680E33AC2AB1235FB66DD9A8F61F4E09690AC1D1D5C2D15F3BF7FB9902C8AF04448BE1478BE0262EEAA8BE10C89D869D3976D155BDEABF467273D07A5482F8ADCDCB01438CE45A0E392472DB12CEC31BDFA76F4CAC48265962C3BD060B9E94E7F8B7D3F9A76E
tmp_aes_key = 57A3851B271E6426850D3943099BFD033C8F225D358832279BCA55D1167466E1
tmp_aes_iv = 7C369E569E90EB7E27198E1444DAD030CFBE98AB190656244D450089C27FE75D</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 78ACCA4EE3AF133086B2646959937BF998FA736ABA0D89B584F4117318BBDB964565C1F93AE95E12C3D0923C66E0C7E76B0641C184F99B2B03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001002FD57B6DE79191A9704A5ED2A50058BB2181FE41B10D0ADDAADF8826C87E8C4240DFC4FC8EC4BCB8AD8DCB4040FF7523B29844FFB1BBBDE6B246E11134C2D0007F76F0D62BBD7A76343B4E5A3198A2916AB99BAF518C4400C94EEFE1A87787BDFC5DA32A343E90A0A1864D0C4F518473B4454FC1888A36652F3863A0E99CB87448E0F5A180DCA9F06DD6F55C61CAD40FB6A722DEB7F45601087E9262F92E7FC94FEA0B2B474DC691B396DA787F8FC481D923440D18C3F5EAA137D381FD59FA0BBA61F6E95AB3BF245894D75F6C4F9A95870CAB46017E3EF8AB680DBE1C3E5FC25E3BC58944BA1EADAE231FE32A6203C688981B29AE81CCA7CAB57981AF8FB72378B05E678D6FAC72972E41C6
answer = BA0D89B584F4117318BBDB964565C1F93AE95E12C3D0923C66E0C7E76B0641C184F99B2B03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001002FD57B6DE79191A9704A5ED2A50058BB2181FE41B10D0ADDAADF8826C87E8C4240DFC4FC8EC4BCB8AD8DCB4040FF7523B29844FFB1BBBDE6B246E11134C2D0007F76F0D62BBD7A76343B4E5A3198A2916AB99BAF518C4400C94EEFE1A87787BDFC5DA32A343E90A0A1864D0C4F518473B4454FC1888A36652F3863A0E99CB87448E0F5A180DCA9F06DD6F55C61CAD40FB6A722DEB7F45601087E9262F92E7FC94FEA0B2B474DC691B396DA787F8FC481D923440D18C3F5EAA137D381FD59FA0BBA61F6E95AB3BF245894D75F6C4F9A95870CAB46017E3EF8AB680DBE1C3E5FC25E3BC58944BA1EADAE231FE32A6203C688981B29AE81CCA7CAB57981AF8FB72378B05E678D6FAC72972E41C6</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 84 F4 11 73 18 BB DB 96 45 65 C1 F9
0010 | 3A E9 5E 12 C3 D0 92 3C 66 E0 C7 E7 6B 06 41 C1
0020 | 84 F9 9B 2B 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 2F D5 7B 6D E7 91 91 A9 70 4A 5E D2 A5 00 58 BB
0140 | 21 81 FE 41 B1 0D 0A DD AA DF 88 26 C8 7E 8C 42
0150 | 40 DF C4 FC 8E C4 BC B8 AD 8D CB 40 40 FF 75 23
0160 | B2 98 44 FF B1 BB BD E6 B2 46 E1 11 34 C2 D0 00
0170 | 7F 76 F0 D6 2B BD 7A 76 34 3B 4E 5A 31 98 A2 91
0180 | 6A B9 9B AF 51 8C 44 00 C9 4E EF E1 A8 77 87 BD
0190 | FC 5D A3 2A 34 3E 90 A0 A1 86 4D 0C 4F 51 84 73
01A0 | B4 45 4F C1 88 8A 36 65 2F 38 63 A0 E9 9C B8 74
01B0 | 48 E0 F5 A1 80 DC A9 F0 6D D6 F5 5C 61 CA D4 0F
01C0 | B6 A7 22 DE B7 F4 56 01 08 7E 92 62 F9 2E 7F C9
01D0 | 4F EA 0B 2B 47 4D C6 91 B3 96 DA 78 7F 8F C4 81
01E0 | D9 23 44 0D 18 C3 F5 EA A1 37 D3 81 FD 59 FA 0B
01F0 | BA 61 F6 E9 5A B3 BF 24 58 94 D7 5F 6C 4F 9A 95
0200 | 87 0C AB 46 01 7E 3E F8 AB 68 0D BE 1C 3E 5F C2
0210 | 5E 3B C5 89 44 BA 1E AD AE 23 1F E3 2A 62 03 C6
0220 | 88 98 1B 29 AE 81 CC A7 CA B5 79 81 AF 8F B7 23
0230 | 78 B0 5E 67</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE0001002FD57B6DE79191A9704A5ED2</code> <code>A50058BB2181FE41B10D0ADDAADF8826</code> <code>C87E8C4240DFC4FC8EC4BCB8AD8DCB40</code> <code>40FF7523B29844FFB1BBBDE6B246E111</code> <code>34C2D0007F76F0D62BBD7A76343B4E5A</code> <code>3198A2916AB99BAF518C4400C94EEFE1</code> <code>A87787BDFC5DA32A343E90A0A1864D0C</code> <code>4F518473B4454FC1888A36652F3863A0</code> <code>E99CB87448E0F5A180DCA9F06DD6F55C</code> <code>61CAD40FB6A722DEB7F45601087E9262</code> <code>F92E7FC94FEA0B2B474DC691B396DA78</code> <code>7F8FC481D923440D18C3F5EAA137D381</code> <code>FD59FA0BBA61F6E95AB3BF245894D75F</code> <code>6C4F9A95870CAB46017E3EF8AB680DBE</code> <code>1C3E5FC25E3BC58944BA1EADAE231FE3</code> <code>2A6203C688981B29AE81CCA7CAB57981</code><br> <code>AF8FB723</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>78B05E67</code> (1734258808 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 152A37D4E47BF0F692ACF7B4264D88C90F57713C29BC3E8025D958268453FE89C4EDB384424970E03E26848189EFD5777B0BCC3E56EAF8BF5C50CFE388311608CD10ACC5D5095E038269131378BF5AA027A1DE55954E7B9B239A13F2E3DB74390BEF0B14429E515318F65AE6D6E16DD7C91183EF3A9622372F33033CC663BA15736DD25EA3EF12201F5BA872BF9EB7834BADD74B6B32EDD99E9C086F69B39E33D8699780D2D22ADC580FD33ECDFCF91CCAC415417397CEE2CCD43907305C05DEA8D2844421FF2C89727745A2CA7DAD1F156847FC54282147C3207F97BF7759801A27F7A3FD671D76DB96E7D9CC51633E1C1E09CC23E5842FC44A94B8427FC83C</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = B764167B2334A978511E94D1F5CFC716EB379733840A8D431959946726BF36F0E0989EA76FE1C3B7D31CE2D779F980C07C2BC435F6511F90E4F747B084C036F8B906E4EE474770AB200E4D70FDF24A47D6F71A963D6BBD65B86466D8B78189E1A429011D50101F25FC818DD1BD3BAC425FE545D4D542DA5412A04D0B3D90530E0CA46F57E05C7FAD5FF428C6B19AE31EF97A79768E99695502AFBB7FACAC2236A043D13D85A2669C60D314FFFBE9F6A24A4572B99D57C05A0AD6AE8FD89AF89A5239762DDC6CDA2DF3C39085E81AD9389789FE3D49D5A0BC2408E507A00039B320CF74C2A59C2E6D2EC111FBB6295779BBD9A3EDCFB3EBB9F5C00744AA2B3B7B</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 84 F4 11 73 18 BB DB 96 45 65 C1 F9
0010 | 3A E9 5E 12 C3 D0 92 3C 66 E0 C7 E7 6B 06 41 C1
0020 | 84 F9 9B 2B 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | B7 64 16 7B 23 34 A9 78 51 1E 94 D1 F5 CF C7 16
0040 | EB 37 97 33 84 0A 8D 43 19 59 94 67 26 BF 36 F0
0050 | E0 98 9E A7 6F E1 C3 B7 D3 1C E2 D7 79 F9 80 C0
0060 | 7C 2B C4 35 F6 51 1F 90 E4 F7 47 B0 84 C0 36 F8
0070 | B9 06 E4 EE 47 47 70 AB 20 0E 4D 70 FD F2 4A 47
0080 | D6 F7 1A 96 3D 6B BD 65 B8 64 66 D8 B7 81 89 E1
0090 | A4 29 01 1D 50 10 1F 25 FC 81 8D D1 BD 3B AC 42
00A0 | 5F E5 45 D4 D5 42 DA 54 12 A0 4D 0B 3D 90 53 0E
00B0 | 0C A4 6F 57 E0 5C 7F AD 5F F4 28 C6 B1 9A E3 1E
00C0 | F9 7A 79 76 8E 99 69 55 02 AF BB 7F AC AC 22 36
00D0 | A0 43 D1 3D 85 A2 66 9C 60 D3 14 FF FB E9 F6 A2
00E0 | 4A 45 72 B9 9D 57 C0 5A 0A D6 AE 8F D8 9A F8 9A
00F0 | 52 39 76 2D DC 6C DA 2D F3 C3 90 85 E8 1A D9 38
0100 | 97 89 FE 3D 49 D5 A0 BC 24 08 E5 07 A0 00 39 B3
0110 | 20 CF 74 C2 A5 9C 2E 6D 2E C1 11 FB B6 29 57 79
0120 | BB D9 A3 ED CF B3 EB B9 F5 C0 07 44 AA 2B 3B 7B</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE000100B764167B2334A978511E94D1</code> <code>F5CFC716EB379733840A8D4319599467</code> <code>26BF36F0E0989EA76FE1C3B7D31CE2D7</code> <code>79F980C07C2BC435F6511F90E4F747B0</code> <code>84C036F8B906E4EE474770AB200E4D70</code> <code>FDF24A47D6F71A963D6BBD65B86466D8</code> <code>B78189E1A429011D50101F25FC818DD1</code> <code>BD3BAC425FE545D4D542DA5412A04D0B</code> <code>3D90530E0CA46F57E05C7FAD5FF428C6</code> <code>B19AE31EF97A79768E99695502AFBB7F</code> <code>ACAC2236A043D13D85A2669C60D314FF</code> <code>FBE9F6A24A4572B99D57C05A0AD6AE8F</code> <code>D89AF89A5239762DDC6CDA2DF3C39085</code> <code>E81AD9389789FE3D49D5A0BC2408E507</code> <code>A00039B320CF74C2A59C2E6D2EC111FB</code> <code>B6295779BBD9A3EDCFB3EBB9F5C00744</code><br> <code>AA2B3B7B</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B6436684F4117318BBDB964565C1F93AE95E12C3D0923C66E0C7E76B0641C184F99B2B0000000000000000FE000100B764167B2334A978511E94D1F5CFC716EB379733840A8D431959946726BF36F0E0989EA76FE1C3B7D31CE2D779F980C07C2BC435F6511F90E4F747B084C036F8B906E4EE474770AB200E4D70FDF24A47D6F71A963D6BBD65B86466D8B78189E1A429011D50101F25FC818DD1BD3BAC425FE545D4D542DA5412A04D0B3D90530E0CA46F57E05C7FAD5FF428C6B19AE31EF97A79768E99695502AFBB7FACAC2236A043D13D85A2669C60D314FFFBE9F6A24A4572B99D57C05A0AD6AE8FD89AF89A5239762DDC6CDA2DF3C39085E81AD9389789FE3D49D5A0BC2408E507A00039B320CF74C2A59C2E6D2EC111FBB6295779BBD9A3EDCFB3EBB9F5C00744AA2B3B7B
padding = 7387F65BBD5FA6FDA349729B
tmp_aes_key = 57A3851B271E6426850D3943099BFD033C8F225D358832279BCA55D1167466E1
tmp_aes_iv = 7C369E569E90EB7E27198E1444DAD030CFBE98AB190656244D450089C27FE75D</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = 6288BBFF8FCB43CF9F4232DFAA62F072A075D59189F2DFE512C59DE43BD18C805C05ABBA0C31ACC0AC5B0F0E2EC6B63E410FE54A59BC8C23CC54D638A5F3B0146C752167E21B4965BC9A7A37761DC92BB0770732DA17615E50B53E5BA8E01D40C85DF7B100C8C3E2538AF20247F5185C722B50D854F5D2D0D6B57711024606CD8FC324DE67073740FB6B99C8BB9D429A38459D197E35BA56F039977814E2EF4450C5C777F498032E43CFE286974E058EF373016488A183AB32C471A66C5CB18D57AB3693130FBBEB5E0EDE1FD7EA4767EF40166D12BF5675F5096A6E446445110779B0135CAECAC695118E928D06F9AA11A3B151DE53EFE79A10297BBB83D60400A82253764BC31068F1820255C190DFC868E5C3358E813BDE38FE37C6CD577303F8F62BFDF9A45DA66C79C85C14B8F2BD38EC222CFAA0ECA9667CC68672DED792A7D485C14A21AC730011A67F62613D</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 A8 02 03 00 78 B0 5E 67
0010 | 78 01 00 00 1F 5F 04 F5 84 F4 11 73 18 BB DB 96
0020 | 45 65 C1 F9 3A E9 5E 12 C3 D0 92 3C 66 E0 C7 E7
0030 | 6B 06 41 C1 84 F9 9B 2B FE 50 01 00 62 88 BB FF
0040 | 8F CB 43 CF 9F 42 32 DF AA 62 F0 72 A0 75 D5 91
0050 | 89 F2 DF E5 12 C5 9D E4 3B D1 8C 80 5C 05 AB BA
0060 | 0C 31 AC C0 AC 5B 0F 0E 2E C6 B6 3E 41 0F E5 4A
0070 | 59 BC 8C 23 CC 54 D6 38 A5 F3 B0 14 6C 75 21 67
0080 | E2 1B 49 65 BC 9A 7A 37 76 1D C9 2B B0 77 07 32
0090 | DA 17 61 5E 50 B5 3E 5B A8 E0 1D 40 C8 5D F7 B1
00A0 | 00 C8 C3 E2 53 8A F2 02 47 F5 18 5C 72 2B 50 D8
00B0 | 54 F5 D2 D0 D6 B5 77 11 02 46 06 CD 8F C3 24 DE
00C0 | 67 07 37 40 FB 6B 99 C8 BB 9D 42 9A 38 45 9D 19
00D0 | 7E 35 BA 56 F0 39 97 78 14 E2 EF 44 50 C5 C7 77
00E0 | F4 98 03 2E 43 CF E2 86 97 4E 05 8E F3 73 01 64
00F0 | 88 A1 83 AB 32 C4 71 A6 6C 5C B1 8D 57 AB 36 93
0100 | 13 0F BB EB 5E 0E DE 1F D7 EA 47 67 EF 40 16 6D
0110 | 12 BF 56 75 F5 09 6A 6E 44 64 45 11 07 79 B0 13
0120 | 5C AE CA C6 95 11 8E 92 8D 06 F9 AA 11 A3 B1 51
0130 | DE 53 EF E7 9A 10 29 7B BB 83 D6 04 00 A8 22 53
0140 | 76 4B C3 10 68 F1 82 02 55 C1 90 DF C8 68 E5 C3
0150 | 35 8E 81 3B DE 38 FE 37 C6 CD 57 73 03 F8 F6 2B
0160 | FD F9 A4 5D A6 6C 79 C8 5C 14 B8 F2 BD 38 EC 22
0170 | 2C FA A0 EC A9 66 7C C6 86 72 DE D7 92 A7 D4 85
0180 | C1 4A 21 AC 73 00 11 A6 7F 62 61 3D</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>A802030078B05E67</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE5001006288BBFF8FCB43CF9F4232DF</code> <code>AA62F072A075D59189F2DFE512C59DE4</code> <code>3BD18C805C05ABBA0C31ACC0AC5B0F0E</code> <code>2EC6B63E410FE54A59BC8C23CC54D638</code> <code>A5F3B0146C752167E21B4965BC9A7A37</code> <code>761DC92BB0770732DA17615E50B53E5B</code> <code>A8E01D40C85DF7B100C8C3E2538AF202</code> <code>47F5185C722B50D854F5D2D0D6B57711</code> <code>024606CD8FC324DE67073740FB6B99C8</code> <code>BB9D429A38459D197E35BA56F0399778</code> <code>14E2EF4450C5C777F498032E43CFE286</code> <code>974E058EF373016488A183AB32C471A6</code> <code>6C5CB18D57AB3693130FBBEB5E0EDE1F</code> <code>D7EA4767EF40166D12BF5675F5096A6E</code> <code>446445110779B0135CAECAC695118E92</code> <code>8D06F9AA11A3B151DE53EFE79A10297B</code> <code>BB83D60400A82253764BC31068F18202</code> <code>55C190DFC868E5C3358E813BDE38FE37</code> <code>C6CD577303F8F62BFDF9A45DA66C79C8</code> <code>5C14B8F2BD38EC222CFAA0ECA9667CC6</code> <code>8672DED792A7D485C14A21AC730011A6</code><br> <code>7F62613D</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 174DDC5D0519FE7ECEE8408529FB0CADF7AC0C149323AB77A6F0E7C32F30EA68B42CCAD89E3F260E185FBCCFBD8041358F3A93F07777B2849B593AAAEF322524A4EE5DED94D2CBF7DE91870964A4A30E56F65E8F09DDD3FB734EBE0483E734601255A5E92BF1CF2308C146B8F458F95D49323A6C24D5870D8D43AE3D0637EE410B430EB265A9E89FFE1D44A9BCCABD6767D15D7A19F82A49C4F0EFD9E01DF7FB6E0F42A69CC205F717BF3CE1D42AB41B1114B79761D46ADF4E9FF81E7726FC2E19A889E9C7F3A6BAA32F7BBC1F8196245B47225E8FBF79D9287C87FBE3B26BAE9973F87788C7D2044EAD8F85F20C52D331986FA7DCB4610C908D0F4B2ED5C42B</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 10 80 9C 79 B0 5E 67
0010 | 34 00 00 00 34 F7 CB 3B 84 F4 11 73 18 BB DB 96
0020 | 45 65 C1 F9 3A E9 5E 12 C3 D0 92 3C 66 E0 C7 E7
0030 | 6B 06 41 C1 84 F9 9B 2B B2 24 0F 1E 31 79 01 0F
0040 | 50 5C 18 9B 1D EC 0F 83</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0110809C79B05E67</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>84F4117318BBDB964565C1F93AE95E12</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>C3D0923C66E0C7E76B0641C184F99B2B</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>B2240F1E3179010F505C189B1DEC0F83</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

