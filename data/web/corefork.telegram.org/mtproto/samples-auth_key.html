<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 48 16 03 00 3C 4D D4 68
0010 | 14 00 00 00 F1 8E 7E BE 87 2E 20 95 5C 67 E7 9B
0020 | 1A 24 03 51 36 7A 11 49</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>481603003C4DD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 14 BD 0E 3D 4D D4 68
0010 | 50 00 00 00 63 24 16 05 87 2E 20 95 5C 67 E7 9B
0020 | 1A 24 03 51 36 7A 11 49 FD C7 63 73 BA 4A 0B 4B
0030 | 44 29 06 AE C8 2B 82 76 08 1E A9 61 D0 D0 3B 39
0040 | 35 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0114BD0E3D4DD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081EA961D0D03B3935000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2209404641676572981</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2209404641676572981</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2209404641676572981 = 1230512837 * 1795515313</code></p>
<pre><code>p = 1230512837
q = 1795515313</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1E A9 61 D0 D0 3B 39 35 00 00 00
0010 | 04 49 58 22 C5 00 00 00 04 6B 05 63 B1 00 00 00
0020 | 87 2E 20 95 5C 67 E7 9B 1A 24 03 51 36 7A 11 49
0030 | FD C7 63 73 BA 4A 0B 4B 44 29 06 AE C8 2B 82 76
0040 | D2 4D F8 96 BE 1F 7F 1D A5 27 86 6D 9E 37 CE 13
0050 | CB A5 E6 0C CB 2E 7B 87 03 31 6F D2 2A 8E 0A C0
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081EA961D0D03B3935000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2209404641676572981</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>04495822C5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1230512837</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046B0563B1000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1795515313</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>D24DF896BE1F7F1DA527866D9E37CE13</code> <code>CBA5E60CCB2E7B8703316FD22A8E0AC0</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081EA961D0D03B393500000004495822C5000000046B0563B1000000872E20955C67E79B1A240351367A1149FDC76373BA4A0B4B442906AEC82B8276D24DF896BE1F7F1DA527866D9E37CE13CBA5E60CCB2E7B8703316FD22A8E0AC002000000
random_padding_bytes = 7D0155FDC2461DA2879EEA355381F04CBF31A6BA0E54C0BF3EB8F1E7B2C18E1D630A2432988110147DD9536F48FD6F23177C99F0EAAC813032762C41CDD44435FD4B698F79DD9B7A16CFE1689D7577FE6D02F00C9E169AEBA96A23A4</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = DE8018E5FB489EE0683617B5531F479F5D61CE5427087E42C4973D245EF75B501F555BE41B0E849E082B069FE1965C2DF29C48F6B353DA3743008EEF297A0D7BA642C9208E23D5614FDAF384EA803B830D86A7F06570DD1AAC37E2A505A859DADC3D1442F8660DE3AD9DF9E8214568DF0FD176A1065FF2A447F24343D43C209F7359699FBF866758C5982F9F9008FF494B833954BD67B90D9298171E53A75D879129148E320AD6C9F58E90C9B5CEF5485228A370EC78C6F49B5EF2F0438A0D02F3D94EA16C66AEED7A5AFEA15A6D275ABE1ED29A1ED151929B4C46D45CC963B9102AE1CD25946A920A3E4EC001AE0ADC6EBD4D0644394CC2AE2DC9CBF4580176</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 4C BF 05 00 3D 4D D4 68
0010 | 40 01 00 00 BE E4 12 D7 87 2E 20 95 5C 67 E7 9B
0020 | 1A 24 03 51 36 7A 11 49 FD C7 63 73 BA 4A 0B 4B
0030 | 44 29 06 AE C8 2B 82 76 04 49 58 22 C5 00 00 00
0040 | 04 6B 05 63 B1 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 DE 80 18 E5 FB 48 9E E0 68 36 17 B5
0060 | 53 1F 47 9F 5D 61 CE 54 27 08 7E 42 C4 97 3D 24
0070 | 5E F7 5B 50 1F 55 5B E4 1B 0E 84 9E 08 2B 06 9F
0080 | E1 96 5C 2D F2 9C 48 F6 B3 53 DA 37 43 00 8E EF
0090 | 29 7A 0D 7B A6 42 C9 20 8E 23 D5 61 4F DA F3 84
00A0 | EA 80 3B 83 0D 86 A7 F0 65 70 DD 1A AC 37 E2 A5
00B0 | 05 A8 59 DA DC 3D 14 42 F8 66 0D E3 AD 9D F9 E8
00C0 | 21 45 68 DF 0F D1 76 A1 06 5F F2 A4 47 F2 43 43
00D0 | D4 3C 20 9F 73 59 69 9F BF 86 67 58 C5 98 2F 9F
00E0 | 90 08 FF 49 4B 83 39 54 BD 67 B9 0D 92 98 17 1E
00F0 | 53 A7 5D 87 91 29 14 8E 32 0A D6 C9 F5 8E 90 C9
0100 | B5 CE F5 48 52 28 A3 70 EC 78 C6 F4 9B 5E F2 F0
0110 | 43 8A 0D 02 F3 D9 4E A1 6C 66 AE ED 7A 5A FE A1
0120 | 5A 6D 27 5A BE 1E D2 9A 1E D1 51 92 9B 4C 46 D4
0130 | 5C C9 63 B9 10 2A E1 CD 25 94 6A 92 0A 3E 4E C0
0140 | 01 AE 0A DC 6E BD 4D 06 44 39 4C C2 AE 2D C9 CB
0150 | F4 58 01 76</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>4CBF05003D4DD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>04495822C5000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1230512837</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046B0563B1000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1795515313</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE000100DE8018E5FB489EE0683617B5</code> <code>531F479F5D61CE5427087E42C4973D24</code> <code>5EF75B501F555BE41B0E849E082B069F</code> <code>E1965C2DF29C48F6B353DA3743008EEF</code> <code>297A0D7BA642C9208E23D5614FDAF384</code> <code>EA803B830D86A7F06570DD1AAC37E2A5</code> <code>05A859DADC3D1442F8660DE3AD9DF9E8</code> <code>214568DF0FD176A1065FF2A447F24343</code> <code>D43C209F7359699FBF866758C5982F9F</code> <code>9008FF494B833954BD67B90D9298171E</code> <code>53A75D879129148E320AD6C9F58E90C9</code> <code>B5CEF5485228A370EC78C6F49B5EF2F0</code> <code>438A0D02F3D94EA16C66AEED7A5AFEA1</code> <code>5A6D275ABE1ED29A1ED151929B4C46D4</code> <code>5CC963B9102AE1CD25946A920A3E4EC0</code> <code>01AE0ADC6EBD4D0644394CC2AE2DC9CB</code><br> <code>F4580176</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 F0 5D 46 3D 4D D4 68
0010 | 78 02 00 00 5C 07 E8 D0 87 2E 20 95 5C 67 E7 9B
0020 | 1A 24 03 51 36 7A 11 49 FD C7 63 73 BA 4A 0B 4B
0030 | 44 29 06 AE C8 2B 82 76 FE 50 02 00 67 86 60 1F
0040 | 53 62 17 ED BC E6 F7 D4 4D 25 AA 14 BC 1F 38 6B
0050 | AA 77 F2 1D 24 57 A9 08 1B 3F 2C 9B 26 DD 96 D5
0060 | 71 4C CF 7C 62 64 8E 87 C0 46 D8 3D 74 56 9A 0F
0070 | 02 7D C2 02 A2 CC 6E 2F 6D B0 CB EA 45 83 E1 27
0080 | 63 68 33 A5 97 76 EA C3 30 1A 37 16 CD 7B BF 85
0090 | 26 3D 4D 8F 10 6C 99 A3 43 F9 D4 12 F2 3A 90 3F
00A0 | 33 42 B3 6C 3A 79 87 03 04 F9 00 24 DF D8 83 F5
00B0 | DA FB 8B A1 AE 88 97 CF 0B 80 CC D6 79 7D B8 C1
00C0 | 37 74 39 46 EE 6C 5B 7C B9 46 B8 7A FF 87 8D D2
00D0 | 71 F4 20 B8 D2 50 61 9C 3A E6 6B 8A 23 A6 FF 3A
00E0 | 65 FD FF 43 1F 09 9B 2B DD 0A 49 2E D7 3B A8 76
00F0 | 7F CB B7 39 FC D1 60 42 21 6D 3B 5E 1C 70 82 A0
0100 | 0F 75 6B 0C 6C 1D F1 97 48 C0 E7 E6 D5 94 8B A7
0110 | 85 5D F8 23 0E 01 36 D5 0B 36 70 D4 F4 0A 42 7A
0120 | 8F 4E A6 FA 33 AE A2 79 E0 E3 E2 11 80 E2 B6 48
0130 | 58 6A 7D 4F E3 03 FE 95 2D 01 B9 C1 CC D5 F0 B0
0140 | 1E AF AC B1 57 B5 EA 34 1D AE BB 8D 49 E5 A4 6A
0150 | 0E 64 F0 33 35 89 DE 3D 37 55 3A 67 10 65 BD D9
0160 | D7 12 2F 41 C1 24 C7 8B C3 4E 6B F9 28 EF 3A 8C
0170 | 4D C7 95 DB E9 20 DD 3E 7B 31 88 18 E5 1B B9 67
0180 | 58 9E 36 CC C5 FF 68 6B 4D 54 26 14 02 9A 63 3A
0190 | A6 FD 46 C5 BD F1 16 43 E0 04 30 0A 49 20 AB 4C
01A0 | E8 A4 47 28 F0 98 60 64 38 3B 6B 03 1F D2 0B 15
01B0 | 22 B8 E4 2A E8 67 C7 68 66 A9 05 F6 07 50 F2 12
01C0 | 01 B7 0E CB E0 75 3F F0 F5 4E 20 6A A7 D4 59 82
01D0 | 06 16 F8 3C FC 39 1A 3C 41 14 C6 A1 FD E6 39 F2
01E0 | 56 48 13 10 5F 29 F2 7D 5A 7A 85 3C 29 D7 C1 FE
01F0 | 91 54 91 AA 2D 23 77 B3 C9 08 4F 79 4B 7C F9 E5
0200 | 6A 0B C1 E0 66 31 40 13 CE 52 E3 A6 8B 95 D8 EC
0210 | 77 A0 71 EB 30 2F 63 FE 19 B5 33 1A 56 41 A7 E1
0220 | 6F B8 5A 53 4F EA 1A AE AB 49 70 1D 12 AC CF A1
0230 | 42 0D 37 F8 1C 2A 0E FA 00 DF 99 FE BA 5B A8 93
0240 | 23 0A FA AC 8E C9 F6 19 77 30 8E 08 15 D5 1E 66
0250 | FB 2E 8A 50 10 82 F6 52 1B 3F DF 91 47 94 53 38
0260 | 73 F9 DB 1B 69 97 C9 66 0B 1B 98 5C 52 48 F9 E1
0270 | 53 5D 07 40 49 80 1D DE D5 95 2C 5B 2E AC A9 6C
0280 | 39 F2 E9 F5 C6 D9 F1 48 10 58 91 2F</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01F05D463D4DD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002006786601F536217EDBCE6F7D4</code> <code>4D25AA14BC1F386BAA77F21D2457A908</code> <code>1B3F2C9B26DD96D5714CCF7C62648E87</code> <code>C046D83D74569A0F027DC202A2CC6E2F</code> <code>6DB0CBEA4583E127636833A59776EAC3</code> <code>301A3716CD7BBF85263D4D8F106C99A3</code> <code>43F9D412F23A903F3342B36C3A798703</code> <code>04F90024DFD883F5DAFB8BA1AE8897CF</code> <code>0B80CCD6797DB8C137743946EE6C5B7C</code> <code>B946B87AFF878DD271F420B8D250619C</code> <code>3AE66B8A23A6FF3A65FDFF431F099B2B</code> <code>DD0A492ED73BA8767FCBB739FCD16042</code> <code>216D3B5E1C7082A00F756B0C6C1DF197</code> <code>48C0E7E6D5948BA7855DF8230E0136D5</code> <code>0B3670D4F40A427A8F4EA6FA33AEA279</code> <code>E0E3E21180E2B648586A7D4FE303FE95</code> <code>2D01B9C1CCD5F0B01EAFACB157B5EA34</code> <code>1DAEBB8D49E5A46A0E64F0333589DE3D</code> <code>37553A671065BDD9D7122F41C124C78B</code> <code>C34E6BF928EF3A8C4DC795DBE920DD3E</code> <code>7B318818E51BB967589E36CCC5FF686B</code> <code>4D542614029A633AA6FD46C5BDF11643</code> <code>E004300A4920AB4CE8A44728F0986064</code> <code>383B6B031FD20B1522B8E42AE867C768</code> <code>66A905F60750F21201B70ECBE0753FF0</code> <code>F54E206AA7D459820616F83CFC391A3C</code> <code>4114C6A1FDE639F2564813105F29F27D</code> <code>5A7A853C29D7C1FE915491AA2D2377B3</code> <code>C9084F794B7CF9E56A0BC1E066314013</code> <code>CE52E3A68B95D8EC77A071EB302F63FE</code> <code>19B5331A5641A7E16FB85A534FEA1AAE</code> <code>AB49701D12ACCFA1420D37F81C2A0EFA</code> <code>00DF99FEBA5BA893230AFAAC8EC9F619</code> <code>77308E0815D51E66FB2E8A501082F652</code> <code>1B3FDF914794533873F9DB1B6997C966</code> <code>0B1B985C5248F9E1535D074049801DDE</code> <code>D5952C5B2EACA96C39F2E9F5C6D9F148</code><br> <code>1058912F</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 6786601F536217EDBCE6F7D44D25AA14BC1F386BAA77F21D2457A9081B3F2C9B26DD96D5714CCF7C62648E87C046D83D74569A0F027DC202A2CC6E2F6DB0CBEA4583E127636833A59776EAC3301A3716CD7BBF85263D4D8F106C99A343F9D412F23A903F3342B36C3A79870304F90024DFD883F5DAFB8BA1AE8897CF0B80CCD6797DB8C137743946EE6C5B7CB946B87AFF878DD271F420B8D250619C3AE66B8A23A6FF3A65FDFF431F099B2BDD0A492ED73BA8767FCBB739FCD16042216D3B5E1C7082A00F756B0C6C1DF19748C0E7E6D5948BA7855DF8230E0136D50B3670D4F40A427A8F4EA6FA33AEA279E0E3E21180E2B648586A7D4FE303FE952D01B9C1CCD5F0B01EAFACB157B5EA341DAEBB8D49E5A46A0E64F0333589DE3D37553A671065BDD9D7122F41C124C78BC34E6BF928EF3A8C4DC795DBE920DD3E7B318818E51BB967589E36CCC5FF686B4D542614029A633AA6FD46C5BDF11643E004300A4920AB4CE8A44728F0986064383B6B031FD20B1522B8E42AE867C76866A905F60750F21201B70ECBE0753FF0F54E206AA7D459820616F83CFC391A3C4114C6A1FDE639F2564813105F29F27D5A7A853C29D7C1FE915491AA2D2377B3C9084F794B7CF9E56A0BC1E066314013CE52E3A68B95D8EC77A071EB302F63FE19B5331A5641A7E16FB85A534FEA1AAEAB49701D12ACCFA1420D37F81C2A0EFA00DF99FEBA5BA893230AFAAC8EC9F61977308E0815D51E66FB2E8A501082F6521B3FDF914794533873F9DB1B6997C9660B1B985C5248F9E1535D074049801DDED5952C5B2EACA96C39F2E9F5C6D9F1481058912F
tmp_aes_key = 6B526B8C33B45B710AB8AF55E05C9CBFCF5623103510328F23A18A3BE74D5AF6
tmp_aes_iv = 80DEFC8FD40F85B0A5CB3BD994778FE0FBC430BAE81747F5CBF2EAE1D24DF896</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = E0DEA23038489E07647F49D3A66876BC75E8F89CBA0D89B5872E20955C67E79B1A240351367A1149FDC76373BA4A0B4B442906AEC82B827603000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100A907782152F1CCBA15F76E1421A6CC0902E08A2587FEEB93BD9CF141D7AE6B747B770A4AF2E2BD3F895CD797EBB6326CF3386473687B4BE6F42040AF59948A924681BCA30E59A0C1A46747106A515544C9EBEE0DE572E2F1B13157112BC7D1A96DEB8248F4432628ADE3D76C08A3AB25086F12575A684D5B6E35DB43E6D56DA68F245B4505A84B402EFFE884B88CAC53D40C93EFF4DE865DB35AF95A90966B82AC54620E1BDAA9963668B5D3F4B20F6A3E13FC890BAA453E0A2E84B09E70F80F1969EAAF4042974FFBF64F6EF2D3F3CFE561DABA665001DA810FD6EC79EFA3B460B3EC640AD3993B6ACD6D15A1332CB53D7339F129F08F4D619F7C715A205DFD3D4DD468D1C7093992F4BB94
answer = BA0D89B5872E20955C67E79B1A240351367A1149FDC76373BA4A0B4B442906AEC82B827603000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100A907782152F1CCBA15F76E1421A6CC0902E08A2587FEEB93BD9CF141D7AE6B747B770A4AF2E2BD3F895CD797EBB6326CF3386473687B4BE6F42040AF59948A924681BCA30E59A0C1A46747106A515544C9EBEE0DE572E2F1B13157112BC7D1A96DEB8248F4432628ADE3D76C08A3AB25086F12575A684D5B6E35DB43E6D56DA68F245B4505A84B402EFFE884B88CAC53D40C93EFF4DE865DB35AF95A90966B82AC54620E1BDAA9963668B5D3F4B20F6A3E13FC890BAA453E0A2E84B09E70F80F1969EAAF4042974FFBF64F6EF2D3F3CFE561DABA665001DA810FD6EC79EFA3B460B3EC640AD3993B6ACD6D15A1332CB53D7339F129F08F4D619F7C715A205DFD3D4DD468D1C7093992F4BB94</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 87 2E 20 95 5C 67 E7 9B 1A 24 03 51
0010 | 36 7A 11 49 FD C7 63 73 BA 4A 0B 4B 44 29 06 AE
0020 | C8 2B 82 76 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | A9 07 78 21 52 F1 CC BA 15 F7 6E 14 21 A6 CC 09
0140 | 02 E0 8A 25 87 FE EB 93 BD 9C F1 41 D7 AE 6B 74
0150 | 7B 77 0A 4A F2 E2 BD 3F 89 5C D7 97 EB B6 32 6C
0160 | F3 38 64 73 68 7B 4B E6 F4 20 40 AF 59 94 8A 92
0170 | 46 81 BC A3 0E 59 A0 C1 A4 67 47 10 6A 51 55 44
0180 | C9 EB EE 0D E5 72 E2 F1 B1 31 57 11 2B C7 D1 A9
0190 | 6D EB 82 48 F4 43 26 28 AD E3 D7 6C 08 A3 AB 25
01A0 | 08 6F 12 57 5A 68 4D 5B 6E 35 DB 43 E6 D5 6D A6
01B0 | 8F 24 5B 45 05 A8 4B 40 2E FF E8 84 B8 8C AC 53
01C0 | D4 0C 93 EF F4 DE 86 5D B3 5A F9 5A 90 96 6B 82
01D0 | AC 54 62 0E 1B DA A9 96 36 68 B5 D3 F4 B2 0F 6A
01E0 | 3E 13 FC 89 0B AA 45 3E 0A 2E 84 B0 9E 70 F8 0F
01F0 | 19 69 EA AF 40 42 97 4F FB F6 4F 6E F2 D3 F3 CF
0200 | E5 61 DA BA 66 50 01 DA 81 0F D6 EC 79 EF A3 B4
0210 | 60 B3 EC 64 0A D3 99 3B 6A CD 6D 15 A1 33 2C B5
0220 | 3D 73 39 F1 29 F0 8F 4D 61 9F 7C 71 5A 20 5D FD
0230 | 3D 4D D4 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE000100A907782152F1CCBA15F76E14</code> <code>21A6CC0902E08A2587FEEB93BD9CF141</code> <code>D7AE6B747B770A4AF2E2BD3F895CD797</code> <code>EBB6326CF3386473687B4BE6F42040AF</code> <code>59948A924681BCA30E59A0C1A4674710</code> <code>6A515544C9EBEE0DE572E2F1B1315711</code> <code>2BC7D1A96DEB8248F4432628ADE3D76C</code> <code>08A3AB25086F12575A684D5B6E35DB43</code> <code>E6D56DA68F245B4505A84B402EFFE884</code> <code>B88CAC53D40C93EFF4DE865DB35AF95A</code> <code>90966B82AC54620E1BDAA9963668B5D3</code> <code>F4B20F6A3E13FC890BAA453E0A2E84B0</code> <code>9E70F80F1969EAAF4042974FFBF64F6E</code> <code>F2D3F3CFE561DABA665001DA810FD6EC</code> <code>79EFA3B460B3EC640AD3993B6ACD6D15</code> <code>A1332CB53D7339F129F08F4D619F7C71</code><br> <code>5A205DFD</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>3D4DD468</code> (1758743869 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 0637D338C59C8A4FD69CB42038BFA58E1802EC382B267CF9500AA605B8C8ACFD8C1EE4CB9A9DC9210A743FCFA42BA4657D4200051A96BBE64068BF27FCF91326798EB90C1DDF3DB6D5A7F1DE909BAB47D9B49760282169C2DF1DBE7F0EEAC80EF548780DBCE0843C86E6D68940C52B53D08238C5C11FC49A8122BF8872BC11A76CE74679EA3CBB4991DAE7EC77AB4771F659C66CE53A4B856736976747F75CCA98344A790E1CDF6D47CD3C8801615DE35062154B93A8F9E9D5CA2876710A28A3615239B9FE907E234A14BBC95579A791F4B299469677680F7973736F0813514D60170CE6A9475ACDB8317AF713B3564D9BE97158250BC77235A3DB188A127AF4</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 51E0EB47E3372B3FFA7CF36865E874E4257C85109DC576D38E59ED2F033C889D2EA3854F28BEC06E9E198C1AE6C1FC7820AF30B4624CC1D040CEA9F1C0A4E6AE1E86D62F235BAF2BA6B945BF1950CDCF15D8A1687ED46A0AA435875D7A0A5B4EE6F63E1290BE22FDEAAE99289185D6B36E9B3D8BAABFE01994144B3464CD93E0C2728EC4F8E0BE402A936AE1E28B8BF4B45E5000F3108042B3B29312CD3846697A10414A24956C697C215CF770AB8700296D72FDCFDF8ADB37699E36F1F89C3F23615C9B2E654FDFE5563D4866E1527210A99150AC417F196F3AB46C0AEC866BF314772EE30B9B007CEE3930A9383C1496E34E6F62D12D4E3E7EBA7F2341E0CC</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 87 2E 20 95 5C 67 E7 9B 1A 24 03 51
0010 | 36 7A 11 49 FD C7 63 73 BA 4A 0B 4B 44 29 06 AE
0020 | C8 2B 82 76 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 51 E0 EB 47 E3 37 2B 3F FA 7C F3 68 65 E8 74 E4
0040 | 25 7C 85 10 9D C5 76 D3 8E 59 ED 2F 03 3C 88 9D
0050 | 2E A3 85 4F 28 BE C0 6E 9E 19 8C 1A E6 C1 FC 78
0060 | 20 AF 30 B4 62 4C C1 D0 40 CE A9 F1 C0 A4 E6 AE
0070 | 1E 86 D6 2F 23 5B AF 2B A6 B9 45 BF 19 50 CD CF
0080 | 15 D8 A1 68 7E D4 6A 0A A4 35 87 5D 7A 0A 5B 4E
0090 | E6 F6 3E 12 90 BE 22 FD EA AE 99 28 91 85 D6 B3
00A0 | 6E 9B 3D 8B AA BF E0 19 94 14 4B 34 64 CD 93 E0
00B0 | C2 72 8E C4 F8 E0 BE 40 2A 93 6A E1 E2 8B 8B F4
00C0 | B4 5E 50 00 F3 10 80 42 B3 B2 93 12 CD 38 46 69
00D0 | 7A 10 41 4A 24 95 6C 69 7C 21 5C F7 70 AB 87 00
00E0 | 29 6D 72 FD CF DF 8A DB 37 69 9E 36 F1 F8 9C 3F
00F0 | 23 61 5C 9B 2E 65 4F DF E5 56 3D 48 66 E1 52 72
0100 | 10 A9 91 50 AC 41 7F 19 6F 3A B4 6C 0A EC 86 6B
0110 | F3 14 77 2E E3 0B 9B 00 7C EE 39 30 A9 38 3C 14
0120 | 96 E3 4E 6F 62 D1 2D 4E 3E 7E BA 7F 23 41 E0 CC</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE00010051E0EB47E3372B3FFA7CF368</code> <code>65E874E4257C85109DC576D38E59ED2F</code> <code>033C889D2EA3854F28BEC06E9E198C1A</code> <code>E6C1FC7820AF30B4624CC1D040CEA9F1</code> <code>C0A4E6AE1E86D62F235BAF2BA6B945BF</code> <code>1950CDCF15D8A1687ED46A0AA435875D</code> <code>7A0A5B4EE6F63E1290BE22FDEAAE9928</code> <code>9185D6B36E9B3D8BAABFE01994144B34</code> <code>64CD93E0C2728EC4F8E0BE402A936AE1</code> <code>E28B8BF4B45E5000F3108042B3B29312</code> <code>CD3846697A10414A24956C697C215CF7</code> <code>70AB8700296D72FDCFDF8ADB37699E36</code> <code>F1F89C3F23615C9B2E654FDFE5563D48</code> <code>66E1527210A99150AC417F196F3AB46C</code> <code>0AEC866BF314772EE30B9B007CEE3930</code> <code>A9383C1496E34E6F62D12D4E3E7EBA7F</code><br> <code>2341E0CC</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B64366872E20955C67E79B1A240351367A1149FDC76373BA4A0B4B442906AEC82B82760000000000000000FE00010051E0EB47E3372B3FFA7CF36865E874E4257C85109DC576D38E59ED2F033C889D2EA3854F28BEC06E9E198C1AE6C1FC7820AF30B4624CC1D040CEA9F1C0A4E6AE1E86D62F235BAF2BA6B945BF1950CDCF15D8A1687ED46A0AA435875D7A0A5B4EE6F63E1290BE22FDEAAE99289185D6B36E9B3D8BAABFE01994144B3464CD93E0C2728EC4F8E0BE402A936AE1E28B8BF4B45E5000F3108042B3B29312CD3846697A10414A24956C697C215CF770AB8700296D72FDCFDF8ADB37699E36F1F89C3F23615C9B2E654FDFE5563D4866E1527210A99150AC417F196F3AB46C0AEC866BF314772EE30B9B007CEE3930A9383C1496E34E6F62D12D4E3E7EBA7F2341E0CC
padding = 2FE7F114B7623B9D8669D514
tmp_aes_key = 6B526B8C33B45B710AB8AF55E05C9CBFCF5623103510328F23A18A3BE74D5AF6
tmp_aes_iv = 80DEFC8FD40F85B0A5CB3BD994778FE0FBC430BAE81747F5CBF2EAE1D24DF896</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = AE9AF686E421A0601C8AF6F0F88D8A6C64AE402BB00F20AAFADAF84037031D257265C446DAFA92A827925159AA1AE2E76823B23582567AF4E9D2865FCCBAE33E9D833209E4468A5A21ACDACC40E0732BF3518C88E5F6774E1A9B35AAD1CE45E0ACD9C445E5D0D38793993A5A46A5B0A71A0CC3E92BDB066DEBD8AD0572385C1B7DA3E53FC3198803BC3D932A8A7B425114BFE02F810A730D6E6E4CEB948EBEA802B64B9767A584A2E6FDF73828ED1B0D2DA3E42243F6C97B0776B4D368271FC215DC6E5E26307B6CDFB578FC48F3A8229CF3FA5F7CA69A97D0DD38F16F283A8DFF5042173731B98D2E459461E4C15860A216D09147ADD53A955E4169AE3D3290E57DF0BE0F83D9FBB00B93096FD9496E6648C2E7D72D47CE4963297153A794512E1EBAC2D2785853005D156815B548C8774FE3AF467A2CF1C15A7E3302A72E259A3B45EAFD4602C0B45AAC8BA736FF5A</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 50 BF 05 00 3D 4D D4 68
0010 | 78 01 00 00 1F 5F 04 F5 87 2E 20 95 5C 67 E7 9B
0020 | 1A 24 03 51 36 7A 11 49 FD C7 63 73 BA 4A 0B 4B
0030 | 44 29 06 AE C8 2B 82 76 FE 50 01 00 AE 9A F6 86
0040 | E4 21 A0 60 1C 8A F6 F0 F8 8D 8A 6C 64 AE 40 2B
0050 | B0 0F 20 AA FA DA F8 40 37 03 1D 25 72 65 C4 46
0060 | DA FA 92 A8 27 92 51 59 AA 1A E2 E7 68 23 B2 35
0070 | 82 56 7A F4 E9 D2 86 5F CC BA E3 3E 9D 83 32 09
0080 | E4 46 8A 5A 21 AC DA CC 40 E0 73 2B F3 51 8C 88
0090 | E5 F6 77 4E 1A 9B 35 AA D1 CE 45 E0 AC D9 C4 45
00A0 | E5 D0 D3 87 93 99 3A 5A 46 A5 B0 A7 1A 0C C3 E9
00B0 | 2B DB 06 6D EB D8 AD 05 72 38 5C 1B 7D A3 E5 3F
00C0 | C3 19 88 03 BC 3D 93 2A 8A 7B 42 51 14 BF E0 2F
00D0 | 81 0A 73 0D 6E 6E 4C EB 94 8E BE A8 02 B6 4B 97
00E0 | 67 A5 84 A2 E6 FD F7 38 28 ED 1B 0D 2D A3 E4 22
00F0 | 43 F6 C9 7B 07 76 B4 D3 68 27 1F C2 15 DC 6E 5E
0100 | 26 30 7B 6C DF B5 78 FC 48 F3 A8 22 9C F3 FA 5F
0110 | 7C A6 9A 97 D0 DD 38 F1 6F 28 3A 8D FF 50 42 17
0120 | 37 31 B9 8D 2E 45 94 61 E4 C1 58 60 A2 16 D0 91
0130 | 47 AD D5 3A 95 5E 41 69 AE 3D 32 90 E5 7D F0 BE
0140 | 0F 83 D9 FB B0 0B 93 09 6F D9 49 6E 66 48 C2 E7
0150 | D7 2D 47 CE 49 63 29 71 53 A7 94 51 2E 1E BA C2
0160 | D2 78 58 53 00 5D 15 68 15 B5 48 C8 77 4F E3 AF
0170 | 46 7A 2C F1 C1 5A 7E 33 02 A7 2E 25 9A 3B 45 EA
0180 | FD 46 02 C0 B4 5A AC 8B A7 36 FF 5A</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>50BF05003D4DD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100AE9AF686E421A0601C8AF6F0</code> <code>F88D8A6C64AE402BB00F20AAFADAF840</code> <code>37031D257265C446DAFA92A827925159</code> <code>AA1AE2E76823B23582567AF4E9D2865F</code> <code>CCBAE33E9D833209E4468A5A21ACDACC</code> <code>40E0732BF3518C88E5F6774E1A9B35AA</code> <code>D1CE45E0ACD9C445E5D0D38793993A5A</code> <code>46A5B0A71A0CC3E92BDB066DEBD8AD05</code> <code>72385C1B7DA3E53FC3198803BC3D932A</code> <code>8A7B425114BFE02F810A730D6E6E4CEB</code> <code>948EBEA802B64B9767A584A2E6FDF738</code> <code>28ED1B0D2DA3E42243F6C97B0776B4D3</code> <code>68271FC215DC6E5E26307B6CDFB578FC</code> <code>48F3A8229CF3FA5F7CA69A97D0DD38F1</code> <code>6F283A8DFF5042173731B98D2E459461</code> <code>E4C15860A216D09147ADD53A955E4169</code> <code>AE3D3290E57DF0BE0F83D9FBB00B9309</code> <code>6FD9496E6648C2E7D72D47CE49632971</code> <code>53A794512E1EBAC2D2785853005D1568</code> <code>15B548C8774FE3AF467A2CF1C15A7E33</code> <code>02A72E259A3B45EAFD4602C0B45AAC8B</code><br> <code>A736FF5A</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 2146DFA4973A805420EBF19BA8D3C7B40E5703922E9036FF920EB8D89FCA5344D89F4CA38ACA1D8CF891C9876368FCB7EAE7056006FD2A4592895183A8F2BFCB6BDC6C79A51FD085A8D1ABE785100FEEC98B5BF89F0E0EDB535CFDF008A021825D4ECDF2E7BFA5AA9E054D0B73A5E882646F1AD6CBCE2EFD13FC622F4A78F3E43C0C214F6FCB4DCAFF427B40B8BF9E2495FA75EE753126AD68BF76044415998033EC15F2C8285D3F4DC4BE2B73ABDA07DB3D0D1DF9856F7EBE21BEC9444348CFAD0ABB5C23B0CDC03109A13D8E74A6035781C3382FD8D48AA95D44246EF3BDF41A3B5D8C2BC362DC7137B5A1031CBC74B81F66BF7BBF9AC5994CA03876BBD7B1</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 98 3F 5D 3E 4D D4 68
0010 | 34 00 00 00 34 F7 CB 3B 87 2E 20 95 5C 67 E7 9B
0020 | 1A 24 03 51 36 7A 11 49 FD C7 63 73 BA 4A 0B 4B
0030 | 44 29 06 AE C8 2B 82 76 8A 54 CC CB F0 1A B1 A3
0040 | 13 48 CC A4 40 2A D7 19</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01983F5D3E4DD468</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>872E20955C67E79B1A240351367A1149</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FDC76373BA4A0B4B442906AEC82B8276</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>8A54CCCBF01AB1A31348CCA4402AD719</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

