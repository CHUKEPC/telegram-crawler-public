<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 A0 DD 06 00 2B AB B9 68
0010 | 14 00 00 00 F1 8E 7E BE 8F 28 EE 3D 51 44 80 1B
0020 | 43 EB 55 4F 03 DF A3 AE</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>A0DD06002BABB968</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 94 24 E2 2B AB B9 68
0010 | 50 00 00 00 63 24 16 05 8F 28 EE 3D 51 44 80 1B
0020 | 43 EB 55 4F 03 DF A3 AE 6F 67 72 DB 78 01 BF 0D
0030 | EE 7E 40 FE F1 93 D8 41 08 19 2D 62 A2 0F 7A 54
0040 | 9B 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>019424E22BABB968</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>08192D62A20F7A549B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1814214673084077211</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 1814214673084077211</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>1814214673084077211 = 1280952557 * 1416301223</code></p>
<pre><code>p = 1280952557
q = 1416301223</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 19 2D 62 A2 0F 7A 54 9B 00 00 00
0010 | 04 4C 59 C8 ED 00 00 00 04 54 6B 0A A7 00 00 00
0020 | 8F 28 EE 3D 51 44 80 1B 43 EB 55 4F 03 DF A3 AE
0030 | 6F 67 72 DB 78 01 BF 0D EE 7E 40 FE F1 93 D8 41
0040 | D1 71 AE 1D A8 0D BD 51 C6 FF DD 80 EE DF 1B B6
0050 | C3 DA 98 D2 53 A5 B5 11 CE AC F8 8C 5B 12 25 37
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>08192D62A20F7A549B000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1814214673084077211</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>044C59C8ED000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1280952557</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>04546B0AA7000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1416301223</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>D171AE1DA80DBD51C6FFDD80EEDF1BB6</code> <code>C3DA98D253A5B511CEACF88C5B122537</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A908192D62A20F7A549B000000044C59C8ED00000004546B0AA70000008F28EE3D5144801B43EB554F03DFA3AE6F6772DB7801BF0DEE7E40FEF193D841D171AE1DA80DBD51C6FFDD80EEDF1BB6C3DA98D253A5B511CEACF88C5B12253702000000
random_padding_bytes = 6CF0A54B882F837495F5610C3E437E772EAF640EC630DFEBE41E1A8FEF29EB0984AD33513D04D4FB02D930BF1034714246C97BE04C98265B9ED366E74279AD8501C014610D0084C3B2887AF2186AEF07B8E7E4846FD9A1F2727D3745</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = A088821439DBF41B426904730B2802FA09995415960AC660BFD3E17A03ECEFCBFA618D1820E72040E6B0B65B9996E1EE2215D6CC644A4E7B9A99C957A4BAEA5E731246B5F6BE7A57E4339868B27770E094495BD12DB5144C0051946F4AACE003334658205D9AED350542FD238ADA6D424AA9D163D6697396C2C0B31FE86FDE104C369CE77FB85F756C295F3CF114C5647C575C2A1020A46D85CAAB8536648499613FBDB7F03305EB5DFA2BAF6C6DD84B4AB27B646BA430CB7B1C518BB4DE0C4D11720DA1FEE0B4BF814CEFCBE33318D588E88EB7720E42A42A0B356C7C2E20EF4A3EA3C4F56F30C7DD006244D2BD1C034F75D85D87EB62DA5C375C146BE9D546</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 2C CD 0B 00 2B AB B9 68
0010 | 40 01 00 00 BE E4 12 D7 8F 28 EE 3D 51 44 80 1B
0020 | 43 EB 55 4F 03 DF A3 AE 6F 67 72 DB 78 01 BF 0D
0030 | EE 7E 40 FE F1 93 D8 41 04 4C 59 C8 ED 00 00 00
0040 | 04 54 6B 0A A7 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 A0 88 82 14 39 DB F4 1B 42 69 04 73
0060 | 0B 28 02 FA 09 99 54 15 96 0A C6 60 BF D3 E1 7A
0070 | 03 EC EF CB FA 61 8D 18 20 E7 20 40 E6 B0 B6 5B
0080 | 99 96 E1 EE 22 15 D6 CC 64 4A 4E 7B 9A 99 C9 57
0090 | A4 BA EA 5E 73 12 46 B5 F6 BE 7A 57 E4 33 98 68
00A0 | B2 77 70 E0 94 49 5B D1 2D B5 14 4C 00 51 94 6F
00B0 | 4A AC E0 03 33 46 58 20 5D 9A ED 35 05 42 FD 23
00C0 | 8A DA 6D 42 4A A9 D1 63 D6 69 73 96 C2 C0 B3 1F
00D0 | E8 6F DE 10 4C 36 9C E7 7F B8 5F 75 6C 29 5F 3C
00E0 | F1 14 C5 64 7C 57 5C 2A 10 20 A4 6D 85 CA AB 85
00F0 | 36 64 84 99 61 3F BD B7 F0 33 05 EB 5D FA 2B AF
0100 | 6C 6D D8 4B 4A B2 7B 64 6B A4 30 CB 7B 1C 51 8B
0110 | B4 DE 0C 4D 11 72 0D A1 FE E0 B4 BF 81 4C EF CB
0120 | E3 33 18 D5 88 E8 8E B7 72 0E 42 A4 2A 0B 35 6C
0130 | 7C 2E 20 EF 4A 3E A3 C4 F5 6F 30 C7 DD 00 62 44
0140 | D2 BD 1C 03 4F 75 D8 5D 87 EB 62 DA 5C 37 5C 14
0150 | 6B E9 D5 46</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>2CCD0B002BABB968</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>044C59C8ED000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1280952557</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>04546B0AA7000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1416301223</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE000100A088821439DBF41B42690473</code> <code>0B2802FA09995415960AC660BFD3E17A</code> <code>03ECEFCBFA618D1820E72040E6B0B65B</code> <code>9996E1EE2215D6CC644A4E7B9A99C957</code> <code>A4BAEA5E731246B5F6BE7A57E4339868</code> <code>B27770E094495BD12DB5144C0051946F</code> <code>4AACE003334658205D9AED350542FD23</code> <code>8ADA6D424AA9D163D6697396C2C0B31F</code> <code>E86FDE104C369CE77FB85F756C295F3C</code> <code>F114C5647C575C2A1020A46D85CAAB85</code> <code>36648499613FBDB7F03305EB5DFA2BAF</code> <code>6C6DD84B4AB27B646BA430CB7B1C518B</code> <code>B4DE0C4D11720DA1FEE0B4BF814CEFCB</code> <code>E33318D588E88EB7720E42A42A0B356C</code> <code>7C2E20EF4A3EA3C4F56F30C7DD006244</code> <code>D2BD1C034F75D85D87EB62DA5C375C14</code><br> <code>6BE9D546</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 30 31 0B 2C AB B9 68
0010 | 78 02 00 00 5C 07 E8 D0 8F 28 EE 3D 51 44 80 1B
0020 | 43 EB 55 4F 03 DF A3 AE 6F 67 72 DB 78 01 BF 0D
0030 | EE 7E 40 FE F1 93 D8 41 FE 50 02 00 4B 90 C6 95
0040 | 14 34 9E F9 F4 A4 BC F4 DF E9 C7 57 D0 E1 76 46
0050 | 68 D6 02 74 1C BF 46 3C 2A 95 A5 62 3D 6B DE 66
0060 | 4E F8 73 A3 D9 D5 5E F8 5F 1E ED D1 1B 59 EC A8
0070 | 03 AB 23 BD 25 F6 25 9B D9 4F ED B0 BE B8 CD AD
0080 | 5C F1 C2 BF 43 0E 97 47 D6 FA D2 EB FD 44 21 EF
0090 | BE F9 38 97 97 7E C2 16 D3 03 69 AE FE 9A 4B 6D
00A0 | 3D 3F 5C 34 A1 ED E7 2C C6 E7 CF 94 17 32 C6 D1
00B0 | E6 A3 86 8A 4C F9 E2 14 9F 2D 5D 9D B5 9C 4A CA
00C0 | CC ED 2E 59 1B EF 34 72 BA 0E 92 11 7A 49 55 D9
00D0 | 7E 91 91 72 FB AB 4B 11 D5 00 8E DF FB 81 64 EB
00E0 | 76 1C 7C 00 12 3C 96 FA 9A DB 59 AA B9 C3 C4 8A
00F0 | 95 08 C5 13 FA EE 47 B1 AC 6E 0F 77 DC 10 33 86
0100 | 09 6B B3 BD B0 4C 6C B8 C6 E4 EC 72 60 38 61 40
0110 | EB A0 E5 1C 22 AD 03 1D 5C 32 75 71 9C 31 54 C9
0120 | 01 0F 1E C2 18 74 96 08 8B 33 26 12 53 7B 7F AC
0130 | 37 5C 54 A4 91 6D 72 9B 5C 94 32 95 50 B9 63 59
0140 | 1F 7F 86 69 4A C8 5B 92 C5 18 14 CB 05 09 E4 44
0150 | E7 30 D0 E2 42 B9 5A EC 00 24 C3 BC 2F F5 AC ED
0160 | BD 04 D1 0E 79 56 89 B7 54 BE AF 88 8B 23 35 7B
0170 | 88 C7 0B 13 8E 1E 5C E4 AA 5F A8 FE 09 7C 8B C4
0180 | C8 70 9C 13 67 C8 CD 1A EF EA FF F4 01 BA C2 40
0190 | 98 61 6A 84 EB 2F 50 1A B7 B3 3F 39 BE 78 3D FC
01A0 | CC 42 8A 6D 4F 60 2B 70 F9 8D 33 8A 14 AB 99 A9
01B0 | 0C F9 1D 4A 16 FA 5E 87 3A E0 F8 03 D7 53 01 0E
01C0 | CB E9 CD D0 83 48 5A 05 E0 D5 E8 F7 5F 89 C8 1C
01D0 | 1C 8D 7B 01 EB 0C 46 B7 D0 0E AF 69 EA 40 AB A6
01E0 | AA A4 81 87 5A 87 C5 2A 4F 98 23 19 71 18 A8 DB
01F0 | EC D2 F6 15 75 A4 48 3B 28 7D 7C B2 A2 B6 5E 8A
0200 | EA 17 D8 EB D8 4F 51 F8 A0 EC 87 D9 9D 7A 9C DD
0210 | 9A A4 E9 5D 37 95 E3 E0 DE 13 F5 39 AC 88 BE 8B
0220 | 09 04 CD 95 FA 65 1C ED 1B 5B BE 07 EA F3 BC BC
0230 | A6 9A 06 32 D1 67 B3 D2 88 57 5D 86 25 F2 71 02
0240 | 10 01 2E F3 41 60 7E 7B AE BD 45 00 93 FD 8F CF
0250 | 2F 85 14 B6 9D 02 49 B5 EC EB DD 01 91 69 87 56
0260 | 97 27 C8 6D 14 10 B2 D1 E0 24 AA 0C BC 18 7A 42
0270 | A4 E3 94 38 05 B5 2C 64 94 EB FF 05 F8 54 9A 7E
0280 | 03 40 68 15 18 9A 23 69 39 EE CD 41</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>0130310B2CABB968</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE5002004B90C69514349EF9F4A4BCF4</code> <code>DFE9C757D0E1764668D602741CBF463C</code> <code>2A95A5623D6BDE664EF873A3D9D55EF8</code> <code>5F1EEDD11B59ECA803AB23BD25F6259B</code> <code>D94FEDB0BEB8CDAD5CF1C2BF430E9747</code> <code>D6FAD2EBFD4421EFBEF93897977EC216</code> <code>D30369AEFE9A4B6D3D3F5C34A1EDE72C</code> <code>C6E7CF941732C6D1E6A3868A4CF9E214</code> <code>9F2D5D9DB59C4ACACCED2E591BEF3472</code> <code>BA0E92117A4955D97E919172FBAB4B11</code> <code>D5008EDFFB8164EB761C7C00123C96FA</code> <code>9ADB59AAB9C3C48A9508C513FAEE47B1</code> <code>AC6E0F77DC103386096BB3BDB04C6CB8</code> <code>C6E4EC7260386140EBA0E51C22AD031D</code> <code>5C3275719C3154C9010F1EC218749608</code> <code>8B332612537B7FAC375C54A4916D729B</code> <code>5C94329550B963591F7F86694AC85B92</code> <code>C51814CB0509E444E730D0E242B95AEC</code> <code>0024C3BC2FF5ACEDBD04D10E795689B7</code> <code>54BEAF888B23357B88C70B138E1E5CE4</code> <code>AA5FA8FE097C8BC4C8709C1367C8CD1A</code> <code>EFEAFFF401BAC24098616A84EB2F501A</code> <code>B7B33F39BE783DFCCC428A6D4F602B70</code> <code>F98D338A14AB99A90CF91D4A16FA5E87</code> <code>3AE0F803D753010ECBE9CDD083485A05</code> <code>E0D5E8F75F89C81C1C8D7B01EB0C46B7</code> <code>D00EAF69EA40ABA6AAA481875A87C52A</code> <code>4F9823197118A8DBECD2F61575A4483B</code> <code>287D7CB2A2B65E8AEA17D8EBD84F51F8</code> <code>A0EC87D99D7A9CDD9AA4E95D3795E3E0</code> <code>DE13F539AC88BE8B0904CD95FA651CED</code> <code>1B5BBE07EAF3BCBCA69A0632D167B3D2</code> <code>88575D8625F2710210012EF341607E7B</code> <code>AEBD450093FD8FCF2F8514B69D0249B5</code> <code>ECEBDD01916987569727C86D1410B2D1</code> <code>E024AA0CBC187A42A4E3943805B52C64</code> <code>94EBFF05F8549A7E03406815189A2369</code><br> <code>39EECD41</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = 4B90C69514349EF9F4A4BCF4DFE9C757D0E1764668D602741CBF463C2A95A5623D6BDE664EF873A3D9D55EF85F1EEDD11B59ECA803AB23BD25F6259BD94FEDB0BEB8CDAD5CF1C2BF430E9747D6FAD2EBFD4421EFBEF93897977EC216D30369AEFE9A4B6D3D3F5C34A1EDE72CC6E7CF941732C6D1E6A3868A4CF9E2149F2D5D9DB59C4ACACCED2E591BEF3472BA0E92117A4955D97E919172FBAB4B11D5008EDFFB8164EB761C7C00123C96FA9ADB59AAB9C3C48A9508C513FAEE47B1AC6E0F77DC103386096BB3BDB04C6CB8C6E4EC7260386140EBA0E51C22AD031D5C3275719C3154C9010F1EC2187496088B332612537B7FAC375C54A4916D729B5C94329550B963591F7F86694AC85B92C51814CB0509E444E730D0E242B95AEC0024C3BC2FF5ACEDBD04D10E795689B754BEAF888B23357B88C70B138E1E5CE4AA5FA8FE097C8BC4C8709C1367C8CD1AEFEAFFF401BAC24098616A84EB2F501AB7B33F39BE783DFCCC428A6D4F602B70F98D338A14AB99A90CF91D4A16FA5E873AE0F803D753010ECBE9CDD083485A05E0D5E8F75F89C81C1C8D7B01EB0C46B7D00EAF69EA40ABA6AAA481875A87C52A4F9823197118A8DBECD2F61575A4483B287D7CB2A2B65E8AEA17D8EBD84F51F8A0EC87D99D7A9CDD9AA4E95D3795E3E0DE13F539AC88BE8B0904CD95FA651CED1B5BBE07EAF3BCBCA69A0632D167B3D288575D8625F2710210012EF341607E7BAEBD450093FD8FCF2F8514B69D0249B5ECEBDD01916987569727C86D1410B2D1E024AA0CBC187A42A4E3943805B52C6494EBFF05F8549A7E03406815189A236939EECD41
tmp_aes_key = 13072DCC3E866C70CD00C1CCD134A53206BDD7B1FFD3AA4251850669A99747D3
tmp_aes_iv = 8E5D5278EA7125FED32A961F5ACF0A1BCB43AA53B487B7F7D5C363B4D171AE1D</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = CCFBE6908A1E98A3D408C97F6D5F7096159BA202BA0D89B58F28EE3D5144801B43EB554F03DFA3AE6F6772DB7801BF0DEE7E40FEF193D84103000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001007A7C6B721B378823DA7B2264820097368174BE2670E7A338E0B280ACD09B7951C2C26AC9B4EB7BA1343BBF3075F70459181FD8F4C262E1EE28242E413C9296A7050B799770EF179DCCF1E8E5CB0C09C3423FF1025CA76F3623F26B9B3612C46AC12438349CA2362861706E5BB5624E86C525FA433B4A91054F518320C300124FDC1B428B845A3D95CF8FA43932B7888228869E51B678CD07B4AA41352FD15EC6B68CE419724BF8F5347B0B609D72D3DB29C210472C0E83060272D190A9ACC1D09DA950BEC7196FCEF4A6C4BBFB42BB5DCD0BB1738FDEA33D2A499BA109C6BCB1933B546087C46517F2C53D63CF46F324F15D15DF2B67A8FC7C12FFA9C6AA5CD12CABB9683AEBF26AD1AF5920
answer = BA0D89B58F28EE3D5144801B43EB554F03DFA3AE6F6772DB7801BF0DEE7E40FEF193D84103000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE0001007A7C6B721B378823DA7B2264820097368174BE2670E7A338E0B280ACD09B7951C2C26AC9B4EB7BA1343BBF3075F70459181FD8F4C262E1EE28242E413C9296A7050B799770EF179DCCF1E8E5CB0C09C3423FF1025CA76F3623F26B9B3612C46AC12438349CA2362861706E5BB5624E86C525FA433B4A91054F518320C300124FDC1B428B845A3D95CF8FA43932B7888228869E51B678CD07B4AA41352FD15EC6B68CE419724BF8F5347B0B609D72D3DB29C210472C0E83060272D190A9ACC1D09DA950BEC7196FCEF4A6C4BBFB42BB5DCD0BB1738FDEA33D2A499BA109C6BCB1933B546087C46517F2C53D63CF46F324F15D15DF2B67A8FC7C12FFA9C6AA5CD12CABB9683AEBF26AD1AF5920</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 8F 28 EE 3D 51 44 80 1B 43 EB 55 4F
0010 | 03 DF A3 AE 6F 67 72 DB 78 01 BF 0D EE 7E 40 FE
0020 | F1 93 D8 41 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 7A 7C 6B 72 1B 37 88 23 DA 7B 22 64 82 00 97 36
0140 | 81 74 BE 26 70 E7 A3 38 E0 B2 80 AC D0 9B 79 51
0150 | C2 C2 6A C9 B4 EB 7B A1 34 3B BF 30 75 F7 04 59
0160 | 18 1F D8 F4 C2 62 E1 EE 28 24 2E 41 3C 92 96 A7
0170 | 05 0B 79 97 70 EF 17 9D CC F1 E8 E5 CB 0C 09 C3
0180 | 42 3F F1 02 5C A7 6F 36 23 F2 6B 9B 36 12 C4 6A
0190 | C1 24 38 34 9C A2 36 28 61 70 6E 5B B5 62 4E 86
01A0 | C5 25 FA 43 3B 4A 91 05 4F 51 83 20 C3 00 12 4F
01B0 | DC 1B 42 8B 84 5A 3D 95 CF 8F A4 39 32 B7 88 82
01C0 | 28 86 9E 51 B6 78 CD 07 B4 AA 41 35 2F D1 5E C6
01D0 | B6 8C E4 19 72 4B F8 F5 34 7B 0B 60 9D 72 D3 DB
01E0 | 29 C2 10 47 2C 0E 83 06 02 72 D1 90 A9 AC C1 D0
01F0 | 9D A9 50 BE C7 19 6F CE F4 A6 C4 BB FB 42 BB 5D
0200 | CD 0B B1 73 8F DE A3 3D 2A 49 9B A1 09 C6 BC B1
0210 | 93 3B 54 60 87 C4 65 17 F2 C5 3D 63 CF 46 F3 24
0220 | F1 5D 15 DF 2B 67 A8 FC 7C 12 FF A9 C6 AA 5C D1
0230 | 2C AB B9 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE0001007A7C6B721B378823DA7B2264</code> <code>820097368174BE2670E7A338E0B280AC</code> <code>D09B7951C2C26AC9B4EB7BA1343BBF30</code> <code>75F70459181FD8F4C262E1EE28242E41</code> <code>3C9296A7050B799770EF179DCCF1E8E5</code> <code>CB0C09C3423FF1025CA76F3623F26B9B</code> <code>3612C46AC12438349CA2362861706E5B</code> <code>B5624E86C525FA433B4A91054F518320</code> <code>C300124FDC1B428B845A3D95CF8FA439</code> <code>32B7888228869E51B678CD07B4AA4135</code> <code>2FD15EC6B68CE419724BF8F5347B0B60</code> <code>9D72D3DB29C210472C0E83060272D190</code> <code>A9ACC1D09DA950BEC7196FCEF4A6C4BB</code> <code>FB42BB5DCD0BB1738FDEA33D2A499BA1</code> <code>09C6BCB1933B546087C46517F2C53D63</code> <code>CF46F324F15D15DF2B67A8FC7C12FFA9</code><br> <code>C6AA5CD1</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>2CABB968</code> (1756998444 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 9781949C1B8D43764453775F85A4D3D244E352F97B2E555C7E0C73F0FE91747EF691C715E50C47B2C168F48B659A8AE45DE21832AC7588024A05BBF49A5249CCDBB07C934A28451EA42ECE37341095E5E697E404A1CCD493D62FC45A1F3A546544BB89426B56AB21538D5455E0E35F4B2680D5EF92ED8C4990DCA3EE0D0C20E8528B33B6E00E3591285AEFCCD188227F88995BFD7BE43340CCF9AA27853EE8AE12E7FF75587B92E20E95CA18574570F1F73EBC3E495D7C56FBA4982C8B75782263A18724C945233A8F69D30ABDFE691F40D1AB3DBFAA5BE2CFD4560D82F29AC09D33A511FA7C63BD32DBE0B87854F77BD8CC87878E6223B9E81D98344F264E76</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 43093F6FC13D7204C85880648FC8F56D50F0958D6BA9416752FEE70DB8496D554799FD38FDE29E191F9161AA3DAD8227EDCDE8AE4D78096957F7613AB66057BFEFEF8360B1447409C88D631CA7CF596916BC13FF1FAA5CECE2D0807FBB46FD417AFEC372DB10368D58CF20F8931631E8D2E44B764E732C1F642F0C6B6A2D50BCE6A312112AD70C2683C5221740EDD3CE09C4441F6A454DC7AD47E35B1038AEF708993AF7EF1FF6835720B4EC919678AA09D178BBE9D5EA0D47F02B7A97D1657AB1B5EFBBB02828B0167C438C0F2C77B46D74FEABC12A72E91E41862D8D49C97EF718F158BB4F6A424150FEDD6EF861AFC60B40229DDBE5159056C44A96BA889D</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 8F 28 EE 3D 51 44 80 1B 43 EB 55 4F
0010 | 03 DF A3 AE 6F 67 72 DB 78 01 BF 0D EE 7E 40 FE
0020 | F1 93 D8 41 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 43 09 3F 6F C1 3D 72 04 C8 58 80 64 8F C8 F5 6D
0040 | 50 F0 95 8D 6B A9 41 67 52 FE E7 0D B8 49 6D 55
0050 | 47 99 FD 38 FD E2 9E 19 1F 91 61 AA 3D AD 82 27
0060 | ED CD E8 AE 4D 78 09 69 57 F7 61 3A B6 60 57 BF
0070 | EF EF 83 60 B1 44 74 09 C8 8D 63 1C A7 CF 59 69
0080 | 16 BC 13 FF 1F AA 5C EC E2 D0 80 7F BB 46 FD 41
0090 | 7A FE C3 72 DB 10 36 8D 58 CF 20 F8 93 16 31 E8
00A0 | D2 E4 4B 76 4E 73 2C 1F 64 2F 0C 6B 6A 2D 50 BC
00B0 | E6 A3 12 11 2A D7 0C 26 83 C5 22 17 40 ED D3 CE
00C0 | 09 C4 44 1F 6A 45 4D C7 AD 47 E3 5B 10 38 AE F7
00D0 | 08 99 3A F7 EF 1F F6 83 57 20 B4 EC 91 96 78 AA
00E0 | 09 D1 78 BB E9 D5 EA 0D 47 F0 2B 7A 97 D1 65 7A
00F0 | B1 B5 EF BB B0 28 28 B0 16 7C 43 8C 0F 2C 77 B4
0100 | 6D 74 FE AB C1 2A 72 E9 1E 41 86 2D 8D 49 C9 7E
0110 | F7 18 F1 58 BB 4F 6A 42 41 50 FE DD 6E F8 61 AF
0120 | C6 0B 40 22 9D DB E5 15 90 56 C4 4A 96 BA 88 9D</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE00010043093F6FC13D7204C8588064</code> <code>8FC8F56D50F0958D6BA9416752FEE70D</code> <code>B8496D554799FD38FDE29E191F9161AA</code> <code>3DAD8227EDCDE8AE4D78096957F7613A</code> <code>B66057BFEFEF8360B1447409C88D631C</code> <code>A7CF596916BC13FF1FAA5CECE2D0807F</code> <code>BB46FD417AFEC372DB10368D58CF20F8</code> <code>931631E8D2E44B764E732C1F642F0C6B</code> <code>6A2D50BCE6A312112AD70C2683C52217</code> <code>40EDD3CE09C4441F6A454DC7AD47E35B</code> <code>1038AEF708993AF7EF1FF6835720B4EC</code> <code>919678AA09D178BBE9D5EA0D47F02B7A</code> <code>97D1657AB1B5EFBBB02828B0167C438C</code> <code>0F2C77B46D74FEABC12A72E91E41862D</code> <code>8D49C97EF718F158BB4F6A424150FEDD</code> <code>6EF861AFC60B40229DDBE5159056C44A</code><br> <code>96BA889D</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B643668F28EE3D5144801B43EB554F03DFA3AE6F6772DB7801BF0DEE7E40FEF193D8410000000000000000FE00010043093F6FC13D7204C85880648FC8F56D50F0958D6BA9416752FEE70DB8496D554799FD38FDE29E191F9161AA3DAD8227EDCDE8AE4D78096957F7613AB66057BFEFEF8360B1447409C88D631CA7CF596916BC13FF1FAA5CECE2D0807FBB46FD417AFEC372DB10368D58CF20F8931631E8D2E44B764E732C1F642F0C6B6A2D50BCE6A312112AD70C2683C5221740EDD3CE09C4441F6A454DC7AD47E35B1038AEF708993AF7EF1FF6835720B4EC919678AA09D178BBE9D5EA0D47F02B7A97D1657AB1B5EFBBB02828B0167C438C0F2C77B46D74FEABC12A72E91E41862D8D49C97EF718F158BB4F6A424150FEDD6EF861AFC60B40229DDBE5159056C44A96BA889D
padding = 148FBEAB2F93C226512BC634
tmp_aes_key = 13072DCC3E866C70CD00C1CCD134A53206BDD7B1FFD3AA4251850669A99747D3
tmp_aes_iv = 8E5D5278EA7125FED32A961F5ACF0A1BCB43AA53B487B7F7D5C363B4D171AE1D</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = E9AD8C46598CE28ED2A5D41140CEA8EBCDCBDCB6319CAA856C0D13293670F67E6F58A029EA41462E0BB3B5A9E5766B1A4E7914A062FE99C2462A0D23FA70E8000D537609EEEF13F39BF70731642C4F7B08A3936B2FBDB56DE89709F69B0A5F3104227CBAB95C09799E3DD54D5FF0EFACE95FCEE793EAB11AEDDF61D6F5A3FC21C3662305526CCA33A1232681C79E5599958502E9618F1E72F159B3FE988AB2A6FF4846CE684CDE8076936AA003F7C464EF3224AD1C2F06CF88E5D583F9BD92A42CED0F312B0A49877518C5176F88A9E3881CE12A92658E6D0E41A1B890D2EE5CC87CF630423BFB1316BB2141AAE729313645FFF85F92C0BEDBEFA2D326AAA527B252FC3DAC9BFFE014993B65DF0023352F8AEB97EDB9B43C38299EDF5B2C2336F4C7A400CA74FAB25879F5F16802B12B94EDA93C8FD76793029BF5597773C06DC393ECB2896E864A53130D04EB6EDF09</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 24 9E 0A 00 2C AB B9 68
0010 | 78 01 00 00 1F 5F 04 F5 8F 28 EE 3D 51 44 80 1B
0020 | 43 EB 55 4F 03 DF A3 AE 6F 67 72 DB 78 01 BF 0D
0030 | EE 7E 40 FE F1 93 D8 41 FE 50 01 00 E9 AD 8C 46
0040 | 59 8C E2 8E D2 A5 D4 11 40 CE A8 EB CD CB DC B6
0050 | 31 9C AA 85 6C 0D 13 29 36 70 F6 7E 6F 58 A0 29
0060 | EA 41 46 2E 0B B3 B5 A9 E5 76 6B 1A 4E 79 14 A0
0070 | 62 FE 99 C2 46 2A 0D 23 FA 70 E8 00 0D 53 76 09
0080 | EE EF 13 F3 9B F7 07 31 64 2C 4F 7B 08 A3 93 6B
0090 | 2F BD B5 6D E8 97 09 F6 9B 0A 5F 31 04 22 7C BA
00A0 | B9 5C 09 79 9E 3D D5 4D 5F F0 EF AC E9 5F CE E7
00B0 | 93 EA B1 1A ED DF 61 D6 F5 A3 FC 21 C3 66 23 05
00C0 | 52 6C CA 33 A1 23 26 81 C7 9E 55 99 95 85 02 E9
00D0 | 61 8F 1E 72 F1 59 B3 FE 98 8A B2 A6 FF 48 46 CE
00E0 | 68 4C DE 80 76 93 6A A0 03 F7 C4 64 EF 32 24 AD
00F0 | 1C 2F 06 CF 88 E5 D5 83 F9 BD 92 A4 2C ED 0F 31
0100 | 2B 0A 49 87 75 18 C5 17 6F 88 A9 E3 88 1C E1 2A
0110 | 92 65 8E 6D 0E 41 A1 B8 90 D2 EE 5C C8 7C F6 30
0120 | 42 3B FB 13 16 BB 21 41 AA E7 29 31 36 45 FF F8
0130 | 5F 92 C0 BE DB EF A2 D3 26 AA A5 27 B2 52 FC 3D
0140 | AC 9B FF E0 14 99 3B 65 DF 00 23 35 2F 8A EB 97
0150 | ED B9 B4 3C 38 29 9E DF 5B 2C 23 36 F4 C7 A4 00
0160 | CA 74 FA B2 58 79 F5 F1 68 02 B1 2B 94 ED A9 3C
0170 | 8F D7 67 93 02 9B F5 59 77 73 C0 6D C3 93 EC B2
0180 | 89 6E 86 4A 53 13 0D 04 EB 6E DF 09</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>249E0A002CABB968</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100E9AD8C46598CE28ED2A5D411</code> <code>40CEA8EBCDCBDCB6319CAA856C0D1329</code> <code>3670F67E6F58A029EA41462E0BB3B5A9</code> <code>E5766B1A4E7914A062FE99C2462A0D23</code> <code>FA70E8000D537609EEEF13F39BF70731</code> <code>642C4F7B08A3936B2FBDB56DE89709F6</code> <code>9B0A5F3104227CBAB95C09799E3DD54D</code> <code>5FF0EFACE95FCEE793EAB11AEDDF61D6</code> <code>F5A3FC21C3662305526CCA33A1232681</code> <code>C79E5599958502E9618F1E72F159B3FE</code> <code>988AB2A6FF4846CE684CDE8076936AA0</code> <code>03F7C464EF3224AD1C2F06CF88E5D583</code> <code>F9BD92A42CED0F312B0A49877518C517</code> <code>6F88A9E3881CE12A92658E6D0E41A1B8</code> <code>90D2EE5CC87CF630423BFB1316BB2141</code> <code>AAE729313645FFF85F92C0BEDBEFA2D3</code> <code>26AAA527B252FC3DAC9BFFE014993B65</code> <code>DF0023352F8AEB97EDB9B43C38299EDF</code> <code>5B2C2336F4C7A400CA74FAB25879F5F1</code> <code>6802B12B94EDA93C8FD76793029BF559</code> <code>7773C06DC393ECB2896E864A53130D04</code><br> <code>EB6EDF09</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 80285B6FD7FC5084F8D3FD8F64D0BB3159F03346B504A706CA1C3F21CDEABD9D73EB8E5B5A5982DB130DD436EE1A20396A42B9A8C476244CD10975E75138D46C072B806B1D902ACEF5E40E3A723F6C35483D586AA0FF85E9248B2811198978D7131CFF302FFE8F0306736F312F832D869020FF26785D5E53E29665C6913DB671B09EF26DD5D4EC56EDADCB0A77C1EF1064F99241E930E5CD7BFA1494F4DAC348BD03589FD63658E8B5056B670640EC531A123D46974136DEED75E0D97275322FA99081EAC1D76B15C078F257032EA15DE9E3E1BDBBDCDFD9878E09FAF6B48836397DD71FD68FFBD8C3193B544FF4AC8C180D03EED5DE9DEE263B5A47E1AA7F89</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 C0 95 34 2D AB B9 68
0010 | 34 00 00 00 34 F7 CB 3B 8F 28 EE 3D 51 44 80 1B
0020 | 43 EB 55 4F 03 DF A3 AE 6F 67 72 DB 78 01 BF 0D
0030 | EE 7E 40 FE F1 93 D8 41 48 A0 F2 F6 0B 47 C6 4F
0040 | AB D1 09 FC EC 51 B5 D5</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01C095342DABB968</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8F28EE3D5144801B43EB554F03DFA3AE</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>6F6772DB7801BF0DEE7E40FEF193D841</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>48A0F2F60B47C64FABD109FCEC51B5D5</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

