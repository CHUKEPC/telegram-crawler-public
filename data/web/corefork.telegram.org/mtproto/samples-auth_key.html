<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?239" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 3C 76 0D 00 99 F8 97 66
0010 | 14 00 00 00 F1 8E 7E BE 14 48 2B 90 FA E8 E3 5C
0020 | E4 08 5A A7 53 2F 0F A8</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>3C760D0099F89766</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 44 4B DF 99 F8 97 66
0010 | A8 00 00 00 63 24 16 05 14 48 2B 90 FA E8 E3 5C
0020 | E4 08 5A A7 53 2F 0F A8 E8 BA 72 BA FB B7 A6 C5
0030 | DB 1D 85 74 D8 8F 6B 3A 08 1D 70 66 9E EC 19 9D
0040 | AD 00 00 00 15 C4 B5 1C 03 00 00 00 A5 B7 F7 09
0050 | 35 5F C3 0B 21 6B E8 6C 02 2B B4 C3 85 FD 64 DE
0060 | 85 1D 9D D0</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01444BDF99F89766</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>A8000000</code> (168 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081D70669EEC199DAD000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2121308257243471277</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 2121308257243471277</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>2121308257243471277 = 1377601429 * 1539856313</code></p>
<pre><code>p = 1377601429
q = 1539856313</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1D 70 66 9E EC 19 9D AD 00 00 00
0010 | 04 52 1C 87 95 00 00 00 04 5B C8 57 B9 00 00 00
0020 | 14 48 2B 90 FA E8 E3 5C E4 08 5A A7 53 2F 0F A8
0030 | E8 BA 72 BA FB B7 A6 C5 DB 1D 85 74 D8 8F 6B 3A
0040 | F9 09 96 64 AE 22 08 63 52 25 1B B9 50 D4 97 14
0050 | 49 2D EB 71 D9 81 06 F4 BF 21 B1 A4 49 86 5D 28
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081D70669EEC199DAD000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 2121308257243471277</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>04521C8795000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1377601429</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>045BC857B9000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1539856313</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>F9099664AE22086352251BB950D49714</code> <code>492DEB71D98106F4BF21B1A449865D28</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081D70669EEC199DAD00000004521C8795000000045BC857B900000014482B90FAE8E35CE4085AA7532F0FA8E8BA72BAFBB7A6C5DB1D8574D88F6B3AF9099664AE22086352251BB950D49714492DEB71D98106F4BF21B1A449865D2802000000
random_padding_bytes = 7A881DD3A1A48086032513FB9E5E12D26EA2F2A1638117FABF0B10FF3C0AF8A3F54E5833BE879EA1DD7C77020707D1A8CA4AA49956107C8475B7B34901E29978191934994EF3ECC9CB05750945CF6111924260DA932052328617FD20</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 106D1395F405D025BFCD6B3CC73D7FC9D7C3B82AD5FFDF798172421059A949A512A74B4B885A8444B2AB9CB04AB50942045541C586C6F9509E651E2636729C8F4A060F81CD75574418B80D007E628E547698D2AAD2948C16C5EB2518FD2468A564663B9C521C811B2306D9009F63F6AA34F3E6B63130102702335C81ABCEC66AEAA317FCACB150A8D34B805204E26571ED2A4368DB061A2A2ACF5235CBE34C287331E2F0ACB2E007A6737098ECBC85C5C90B58E87EC0667EE69BBCE3658CE8B09F87575CD05A0C2E6DB57944112B438084006A06A4C24E59F31E13599867CFC4EDB06C0449A203D7E0D5BDF42E9C1D454F5C7067B18E8385822A1CE4DAFAE5C8</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 88 EA 0C 00 9A F8 97 66
0010 | 40 01 00 00 BE E4 12 D7 14 48 2B 90 FA E8 E3 5C
0020 | E4 08 5A A7 53 2F 0F A8 E8 BA 72 BA FB B7 A6 C5
0030 | DB 1D 85 74 D8 8F 6B 3A 04 52 1C 87 95 00 00 00
0040 | 04 5B C8 57 B9 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 10 6D 13 95 F4 05 D0 25 BF CD 6B 3C
0060 | C7 3D 7F C9 D7 C3 B8 2A D5 FF DF 79 81 72 42 10
0070 | 59 A9 49 A5 12 A7 4B 4B 88 5A 84 44 B2 AB 9C B0
0080 | 4A B5 09 42 04 55 41 C5 86 C6 F9 50 9E 65 1E 26
0090 | 36 72 9C 8F 4A 06 0F 81 CD 75 57 44 18 B8 0D 00
00A0 | 7E 62 8E 54 76 98 D2 AA D2 94 8C 16 C5 EB 25 18
00B0 | FD 24 68 A5 64 66 3B 9C 52 1C 81 1B 23 06 D9 00
00C0 | 9F 63 F6 AA 34 F3 E6 B6 31 30 10 27 02 33 5C 81
00D0 | AB CE C6 6A EA A3 17 FC AC B1 50 A8 D3 4B 80 52
00E0 | 04 E2 65 71 ED 2A 43 68 DB 06 1A 2A 2A CF 52 35
00F0 | CB E3 4C 28 73 31 E2 F0 AC B2 E0 07 A6 73 70 98
0100 | EC BC 85 C5 C9 0B 58 E8 7E C0 66 7E E6 9B BC E3
0110 | 65 8C E8 B0 9F 87 57 5C D0 5A 0C 2E 6D B5 79 44
0120 | 11 2B 43 80 84 00 6A 06 A4 C2 4E 59 F3 1E 13 59
0130 | 98 67 CF C4 ED B0 6C 04 49 A2 03 D7 E0 D5 BD F4
0140 | 2E 9C 1D 45 4F 5C 70 67 B1 8E 83 85 82 2A 1C E4
0150 | DA FA E5 C8</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>88EA0C009AF89766</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>04521C8795000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1377601429</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>045BC857B9000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1539856313</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE000100106D1395F405D025BFCD6B3C</code> <code>C73D7FC9D7C3B82AD5FFDF7981724210</code> <code>59A949A512A74B4B885A8444B2AB9CB0</code> <code>4AB50942045541C586C6F9509E651E26</code> <code>36729C8F4A060F81CD75574418B80D00</code> <code>7E628E547698D2AAD2948C16C5EB2518</code> <code>FD2468A564663B9C521C811B2306D900</code> <code>9F63F6AA34F3E6B63130102702335C81</code> <code>ABCEC66AEAA317FCACB150A8D34B8052</code> <code>04E26571ED2A4368DB061A2A2ACF5235</code> <code>CBE34C287331E2F0ACB2E007A6737098</code> <code>ECBC85C5C90B58E87EC0667EE69BBCE3</code> <code>658CE8B09F87575CD05A0C2E6DB57944</code> <code>112B438084006A06A4C24E59F31E1359</code> <code>9867CFC4EDB06C0449A203D7E0D5BDF4</code> <code>2E9C1D454F5C7067B18E8385822A1CE4</code><br> <code>DAFAE5C8</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 BC 30 94 9A F8 97 66
0010 | 94 02 00 00 5C 07 E8 D0 14 48 2B 90 FA E8 E3 5C
0020 | E4 08 5A A7 53 2F 0F A8 E8 BA 72 BA FB B7 A6 C5
0030 | DB 1D 85 74 D8 8F 6B 3A FE 50 02 00 AE DB 97 24
0040 | 1B DC 01 25 FC 04 D1 40 57 AB 83 7A EB 0F BA 29
0050 | 58 38 23 CC 3C AE 7B 94 6A 7C 48 74 CF 44 5A EB
0060 | 64 3D F6 B8 18 86 13 39 20 57 E8 3C FC FC 49 94
0070 | 62 B8 99 EF 03 05 46 FE B9 B8 DA 2B C4 83 28 E6
0080 | 08 13 35 D4 CC 0E D3 79 E6 C6 B2 D4 21 2F 69 EE
0090 | 94 3C 54 CD 7F E9 0A 02 63 55 C5 4B 42 1D F3 DC
00A0 | DD 83 C1 2F 97 CD AF 8D 61 3D 5E 03 34 52 BC 52
00B0 | 55 3C C1 0C C3 95 D9 25 A0 FA FB 6D BC 14 63 A2
00C0 | 31 81 F4 A9 9D D3 C9 D4 C7 17 2D 3E 29 48 B0 02
00D0 | CC DC 40 2C 8A BE AE AC 4C ED 04 5F DF 2C 48 46
00E0 | 67 E5 B4 AF BF A9 01 9A 12 2A 07 AC FE 72 41 5A
00F0 | 5C C7 1C 4D DF CB D4 62 04 D6 E3 96 4D 8F BA 67
0100 | B5 73 2D B1 58 60 11 E6 C1 4B 49 D2 E9 CC AB B1
0110 | 5D 2B 98 DE A5 81 4A 71 EF 76 5B 40 43 BA 03 0C
0120 | 48 B4 BF 67 C5 34 7C 1F 32 0C 19 98 57 90 56 00
0130 | EA 19 39 F8 52 55 5A A5 C6 FF 01 FC 7A BC B2 4F
0140 | CA 38 BD 53 AC 3C 91 8F 19 0B 48 3E B6 3C 31 4A
0150 | 17 BB 4B D7 D5 41 F7 62 F5 6F D6 14 E6 BB 54 66
0160 | 5F B2 3F F1 10 81 75 B3 A0 E3 F1 2C A3 39 10 44
0170 | 44 33 99 D3 AA FF 21 E8 C0 CD 1C C1 85 6D 94 E8
0180 | 25 3D 2E B0 F9 17 B2 30 F3 B2 24 34 DD D2 9C 6B
0190 | 1B 24 D5 34 10 97 C5 2D 10 D0 5D 4B F6 ED 78 00
01A0 | 93 24 CF E8 9F A3 DB 95 72 9C 57 2B 9C 49 76 FF
01B0 | 11 A3 96 94 26 46 C8 63 79 83 D2 07 CF DB B8 43
01C0 | 81 B9 14 E7 E9 32 36 01 C4 6B 32 22 C0 2A B4 24
01D0 | 7B 0A 65 5E CB 7E F7 57 D7 27 0A DB AF D0 4E BE
01E0 | D9 4F 60 15 14 30 6D BF 41 D1 6E CA BD 5C 5D 33
01F0 | 1D 78 04 27 3E DB 0B 8E 55 B5 98 18 AF BB AD 04
0200 | 0D C6 A8 D4 3B CB 8F 2D 23 70 2B 31 6A 39 21 40
0210 | 54 CB 48 DE 92 04 74 71 A5 20 44 75 8C 3F 51 6D
0220 | 71 22 40 6A 3B 2D 17 17 57 E9 B7 1E 2B 8E 5E 27
0230 | 34 AB 80 BD A0 ED 20 CE 63 D4 6C DB 3D 44 2C 8B
0240 | B3 56 28 28 25 27 9E E4 37 2C F5 67 21 28 86 99
0250 | 06 C1 CF DC C3 AA A8 38 D7 33 61 79 B3 7A 3A 43
0260 | 7B 67 9A 05 22 53 B6 B3 7E 6D EB 1F EF D8 91 72
0270 | E6 06 0A 57 78 C8 F5 04 1E 17 C6 B1 2A 35 F5 2D
0280 | 03 BA 1F F5 0F 8F AF 46 36 66 E2 FB</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01BC30949AF89766</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>94020000</code> (660 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200AEDB97241BDC0125FC04D140</code> <code>57AB837AEB0FBA29583823CC3CAE7B94</code> <code>6A7C4874CF445AEB643DF6B818861339</code> <code>2057E83CFCFC499462B899EF030546FE</code> <code>B9B8DA2BC48328E6081335D4CC0ED379</code> <code>E6C6B2D4212F69EE943C54CD7FE90A02</code> <code>6355C54B421DF3DCDD83C12F97CDAF8D</code> <code>613D5E033452BC52553CC10CC395D925</code> <code>A0FAFB6DBC1463A23181F4A99DD3C9D4</code> <code>C7172D3E2948B002CCDC402C8ABEAEAC</code> <code>4CED045FDF2C484667E5B4AFBFA9019A</code> <code>122A07ACFE72415A5CC71C4DDFCBD462</code> <code>04D6E3964D8FBA67B5732DB1586011E6</code> <code>C14B49D2E9CCABB15D2B98DEA5814A71</code> <code>EF765B4043BA030C48B4BF67C5347C1F</code> <code>320C199857905600EA1939F852555AA5</code> <code>C6FF01FC7ABCB24FCA38BD53AC3C918F</code> <code>190B483EB63C314A17BB4BD7D541F762</code> <code>F56FD614E6BB54665FB23FF1108175B3</code> <code>A0E3F12CA3391044443399D3AAFF21E8</code> <code>C0CD1CC1856D94E8253D2EB0F917B230</code> <code>F3B22434DDD29C6B1B24D5341097C52D</code> <code>10D05D4BF6ED78009324CFE89FA3DB95</code> <code>729C572B9C4976FF11A396942646C863</code> <code>7983D207CFDBB84381B914E7E9323601</code> <code>C46B3222C02AB4247B0A655ECB7EF757</code> <code>D7270ADBAFD04EBED94F601514306DBF</code> <code>41D16ECABD5C5D331D7804273EDB0B8E</code> <code>55B59818AFBBAD040DC6A8D43BCB8F2D</code> <code>23702B316A39214054CB48DE92047471</code> <code>A52044758C3F516D7122406A3B2D1717</code> <code>57E9B71E2B8E5E2734AB80BDA0ED20CE</code> <code>63D46CDB3D442C8BB356282825279EE4</code> <code>372CF5672128869906C1CFDCC3AAA838</code> <code>D7336179B37A3A437B679A052253B6B3</code> <code>7E6DEB1FEFD89172E6060A5778C8F504</code> <code>1E17C6B12A35F52D03BA1FF50F8FAF46</code><br> <code>3666E2FB</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = AEDB97241BDC0125FC04D14057AB837AEB0FBA29583823CC3CAE7B946A7C4874CF445AEB643DF6B8188613392057E83CFCFC499462B899EF030546FEB9B8DA2BC48328E6081335D4CC0ED379E6C6B2D4212F69EE943C54CD7FE90A026355C54B421DF3DCDD83C12F97CDAF8D613D5E033452BC52553CC10CC395D925A0FAFB6DBC1463A23181F4A99DD3C9D4C7172D3E2948B002CCDC402C8ABEAEAC4CED045FDF2C484667E5B4AFBFA9019A122A07ACFE72415A5CC71C4DDFCBD46204D6E3964D8FBA67B5732DB1586011E6C14B49D2E9CCABB15D2B98DEA5814A71EF765B4043BA030C48B4BF67C5347C1F320C199857905600EA1939F852555AA5C6FF01FC7ABCB24FCA38BD53AC3C918F190B483EB63C314A17BB4BD7D541F762F56FD614E6BB54665FB23FF1108175B3A0E3F12CA3391044443399D3AAFF21E8C0CD1CC1856D94E8253D2EB0F917B230F3B22434DDD29C6B1B24D5341097C52D10D05D4BF6ED78009324CFE89FA3DB95729C572B9C4976FF11A396942646C8637983D207CFDBB84381B914E7E9323601C46B3222C02AB4247B0A655ECB7EF757D7270ADBAFD04EBED94F601514306DBF41D16ECABD5C5D331D7804273EDB0B8E55B59818AFBBAD040DC6A8D43BCB8F2D23702B316A39214054CB48DE92047471A52044758C3F516D7122406A3B2D171757E9B71E2B8E5E2734AB80BDA0ED20CE63D46CDB3D442C8BB356282825279EE4372CF5672128869906C1CFDCC3AAA838D7336179B37A3A437B679A052253B6B37E6DEB1FEFD89172E6060A5778C8F5041E17C6B12A35F52D03BA1FF50F8FAF463666E2FB
tmp_aes_key = 0D1AB98D8C2FE3AF83F67E85F0645D332B54D807D35779A8FB36B70042422BF8
tmp_aes_iv = 8E80A24FA6022D3165BA7BA0A9834DFFE4F0C061932BEC0859B04466F9099664</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = 2FBD28F7EC0B0029CCBA947CF72CA0DDA4701368BA0D89B514482B90FAE8E35CE4085AA7532F0FA8E8BA72BAFBB7A6C5DB1D8574D88F6B3A03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010066528525A93B29EB2527FE4F1A27F1AD78788B2AF9B05C4E5B4D6A16CFD0063EFE2E4CA8311A974FD3898A659CC4B19506D516BF3784227C4827766E2729FF7C46EBE0FD20A539417EAC566BFB921B3CE1D91CCE578B64CDAB0ED07B41EEA85A168492B519B6B2A0E9DAFB60855788D1A8B0B930B4D20A16F8C51AFC30F84FC32CBE48B600DFFE9FC62149D2912667D045CCFC4B0375F23B0E91B1EC65C475CA8ABC4305B556190DFF146AE4DC004D1FBD8E85219A8073AFEAAD7DBA57191774E473A76374F38912691B231340AC104AC1C6BDA1DDF047848B8BB8AE0D6F21CA78350E7B55253BC1D7DE588DA0A935443703ACFDCAE572CD93F581EB4387F7859AF89766DF0F57024D2651EA
answer = BA0D89B514482B90FAE8E35CE4085AA7532F0FA8E8BA72BAFBB7A6C5DB1D8574D88F6B3A03000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE00010066528525A93B29EB2527FE4F1A27F1AD78788B2AF9B05C4E5B4D6A16CFD0063EFE2E4CA8311A974FD3898A659CC4B19506D516BF3784227C4827766E2729FF7C46EBE0FD20A539417EAC566BFB921B3CE1D91CCE578B64CDAB0ED07B41EEA85A168492B519B6B2A0E9DAFB60855788D1A8B0B930B4D20A16F8C51AFC30F84FC32CBE48B600DFFE9FC62149D2912667D045CCFC4B0375F23B0E91B1EC65C475CA8ABC4305B556190DFF146AE4DC004D1FBD8E85219A8073AFEAAD7DBA57191774E473A76374F38912691B231340AC104AC1C6BDA1DDF047848B8BB8AE0D6F21CA78350E7B55253BC1D7DE588DA0A935443703ACFDCAE572CD93F581EB4387F7859AF89766DF0F57024D2651EA</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 14 48 2B 90 FA E8 E3 5C E4 08 5A A7
0010 | 53 2F 0F A8 E8 BA 72 BA FB B7 A6 C5 DB 1D 85 74
0020 | D8 8F 6B 3A 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | 66 52 85 25 A9 3B 29 EB 25 27 FE 4F 1A 27 F1 AD
0140 | 78 78 8B 2A F9 B0 5C 4E 5B 4D 6A 16 CF D0 06 3E
0150 | FE 2E 4C A8 31 1A 97 4F D3 89 8A 65 9C C4 B1 95
0160 | 06 D5 16 BF 37 84 22 7C 48 27 76 6E 27 29 FF 7C
0170 | 46 EB E0 FD 20 A5 39 41 7E AC 56 6B FB 92 1B 3C
0180 | E1 D9 1C CE 57 8B 64 CD AB 0E D0 7B 41 EE A8 5A
0190 | 16 84 92 B5 19 B6 B2 A0 E9 DA FB 60 85 57 88 D1
01A0 | A8 B0 B9 30 B4 D2 0A 16 F8 C5 1A FC 30 F8 4F C3
01B0 | 2C BE 48 B6 00 DF FE 9F C6 21 49 D2 91 26 67 D0
01C0 | 45 CC FC 4B 03 75 F2 3B 0E 91 B1 EC 65 C4 75 CA
01D0 | 8A BC 43 05 B5 56 19 0D FF 14 6A E4 DC 00 4D 1F
01E0 | BD 8E 85 21 9A 80 73 AF EA AD 7D BA 57 19 17 74
01F0 | E4 73 A7 63 74 F3 89 12 69 1B 23 13 40 AC 10 4A
0200 | C1 C6 BD A1 DD F0 47 84 8B 8B B8 AE 0D 6F 21 CA
0210 | 78 35 0E 7B 55 25 3B C1 D7 DE 58 8D A0 A9 35 44
0220 | 37 03 AC FD CA E5 72 CD 93 F5 81 EB 43 87 F7 85
0230 | 9A F8 97 66</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE00010066528525A93B29EB2527FE4F</code> <code>1A27F1AD78788B2AF9B05C4E5B4D6A16</code> <code>CFD0063EFE2E4CA8311A974FD3898A65</code> <code>9CC4B19506D516BF3784227C4827766E</code> <code>2729FF7C46EBE0FD20A539417EAC566B</code> <code>FB921B3CE1D91CCE578B64CDAB0ED07B</code> <code>41EEA85A168492B519B6B2A0E9DAFB60</code> <code>855788D1A8B0B930B4D20A16F8C51AFC</code> <code>30F84FC32CBE48B600DFFE9FC62149D2</code> <code>912667D045CCFC4B0375F23B0E91B1EC</code> <code>65C475CA8ABC4305B556190DFF146AE4</code> <code>DC004D1FBD8E85219A8073AFEAAD7DBA</code> <code>57191774E473A76374F38912691B2313</code> <code>40AC104AC1C6BDA1DDF047848B8BB8AE</code> <code>0D6F21CA78350E7B55253BC1D7DE588D</code> <code>A0A935443703ACFDCAE572CD93F581EB</code><br> <code>4387F785</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>9AF89766</code> (1721235610 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = F1AA65728283F290C0E0A2B1EFEE107F2FDEA6CCA3166BCD254BF3D00F46A9690A56389518BBEB1E88FB2E2D0FC5DDED0C5209D649E91B366ADDF426CA140B77C443705E9D1C13B207F8F1D318225E9B0C35319A4A7CD3D81824AEBFB27E45C9EA7E61045A044863EF54E5E8068A8E6D33F5CCD8BE24221909F24D3272E184A3BC96E6E44EE74DA78D4BC6A5F1CF10987386A57439E1F05C8B0317FB0F7139A4E3E24C8A6792638A37A2975CD3CBB7F6E5255CF304A14A2516F939F4EACFD8FD4E18DCAA02F2C6FB017B5DB56B308DEED41B0BB55481C168185DAB7F4B38B084528D272DA9EA08559620ADC3DB6A17583236B76DE76D7C84A91F36201574AF42</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 4D9AF0C3A92DBD05D49DCED6EEB260D5D38DF8DA0F18F969C083A51197CC61E85ACF92092A779BF9295AD191034E49FA1FD7B8E8E1E4E757D476E1BCBD0FABDC2807E94E3AAAF0D40D364B78E115104E1BB4CDD9371CEC96DBAA4382F878C7E8F6927E0EEE3A57CEA0508EDE1FE3564321C82916347A4E36730FE17C104113AB9060974BD0ACC65401CCAC258BA1B4FE621E9F359933237C0D2DEE76EA2584A80DF5121F9316E11E16CA427CFA19D61819C3976D9A1A60797EA92636781B0C9D127797EF53CB13EBD846B00BD215CE46B1A906AF97460490DFF9F368A109DD5BFAD6DA57375C0772D1830CDB3E2260E7A027BC122C92347E94E122F2A3E4A319</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 14 48 2B 90 FA E8 E3 5C E4 08 5A A7
0010 | 53 2F 0F A8 E8 BA 72 BA FB B7 A6 C5 DB 1D 85 74
0020 | D8 8F 6B 3A 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 4D 9A F0 C3 A9 2D BD 05 D4 9D CE D6 EE B2 60 D5
0040 | D3 8D F8 DA 0F 18 F9 69 C0 83 A5 11 97 CC 61 E8
0050 | 5A CF 92 09 2A 77 9B F9 29 5A D1 91 03 4E 49 FA
0060 | 1F D7 B8 E8 E1 E4 E7 57 D4 76 E1 BC BD 0F AB DC
0070 | 28 07 E9 4E 3A AA F0 D4 0D 36 4B 78 E1 15 10 4E
0080 | 1B B4 CD D9 37 1C EC 96 DB AA 43 82 F8 78 C7 E8
0090 | F6 92 7E 0E EE 3A 57 CE A0 50 8E DE 1F E3 56 43
00A0 | 21 C8 29 16 34 7A 4E 36 73 0F E1 7C 10 41 13 AB
00B0 | 90 60 97 4B D0 AC C6 54 01 CC AC 25 8B A1 B4 FE
00C0 | 62 1E 9F 35 99 33 23 7C 0D 2D EE 76 EA 25 84 A8
00D0 | 0D F5 12 1F 93 16 E1 1E 16 CA 42 7C FA 19 D6 18
00E0 | 19 C3 97 6D 9A 1A 60 79 7E A9 26 36 78 1B 0C 9D
00F0 | 12 77 97 EF 53 CB 13 EB D8 46 B0 0B D2 15 CE 46
0100 | B1 A9 06 AF 97 46 04 90 DF F9 F3 68 A1 09 DD 5B
0110 | FA D6 DA 57 37 5C 07 72 D1 83 0C DB 3E 22 60 E7
0120 | A0 27 BC 12 2C 92 34 7E 94 E1 22 F2 A3 E4 A3 19</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE0001004D9AF0C3A92DBD05D49DCED6</code> <code>EEB260D5D38DF8DA0F18F969C083A511</code> <code>97CC61E85ACF92092A779BF9295AD191</code> <code>034E49FA1FD7B8E8E1E4E757D476E1BC</code> <code>BD0FABDC2807E94E3AAAF0D40D364B78</code> <code>E115104E1BB4CDD9371CEC96DBAA4382</code> <code>F878C7E8F6927E0EEE3A57CEA0508EDE</code> <code>1FE3564321C82916347A4E36730FE17C</code> <code>104113AB9060974BD0ACC65401CCAC25</code> <code>8BA1B4FE621E9F359933237C0D2DEE76</code> <code>EA2584A80DF5121F9316E11E16CA427C</code> <code>FA19D61819C3976D9A1A60797EA92636</code> <code>781B0C9D127797EF53CB13EBD846B00B</code> <code>D215CE46B1A906AF97460490DFF9F368</code> <code>A109DD5BFAD6DA57375C0772D1830CDB</code> <code>3E2260E7A027BC122C92347E94E122F2</code><br> <code>A3E4A319</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B6436614482B90FAE8E35CE4085AA7532F0FA8E8BA72BAFBB7A6C5DB1D8574D88F6B3A0000000000000000FE0001004D9AF0C3A92DBD05D49DCED6EEB260D5D38DF8DA0F18F969C083A51197CC61E85ACF92092A779BF9295AD191034E49FA1FD7B8E8E1E4E757D476E1BCBD0FABDC2807E94E3AAAF0D40D364B78E115104E1BB4CDD9371CEC96DBAA4382F878C7E8F6927E0EEE3A57CEA0508EDE1FE3564321C82916347A4E36730FE17C104113AB9060974BD0ACC65401CCAC258BA1B4FE621E9F359933237C0D2DEE76EA2584A80DF5121F9316E11E16CA427CFA19D61819C3976D9A1A60797EA92636781B0C9D127797EF53CB13EBD846B00BD215CE46B1A906AF97460490DFF9F368A109DD5BFAD6DA57375C0772D1830CDB3E2260E7A027BC122C92347E94E122F2A3E4A319
padding = 0C14B6770150477FC8A1D763
tmp_aes_key = 0D1AB98D8C2FE3AF83F67E85F0645D332B54D807D35779A8FB36B70042422BF8
tmp_aes_iv = 8E80A24FA6022D3165BA7BA0A9834DFFE4F0C061932BEC0859B04466F9099664</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = B7B9874BF5A0342D8FB4A85528A61EB3F6FA78A6DF9B14A177B01E7E987C1E173CE6120713AAFD44F2E9239F5EB49AAD196E13A266E4D6BF208EA4FD1CBD08EF946115A49347BB92030A04C43FB26B58D96FFF3E59B6435B5FC707D1EE88C0430443C88FD4E41E1A9381F82EEE38BD3449295E9E478F10B4F13022F88E1D17E3D21DAA84B9A934535BD4E10ADF7491058277154FB2862213AD83E5B859809A745754A9CA01187A06AE81E7AA11ABC0949B0FA622E78F89613F74BA835A41E833E7943E47C0E43DAA15B771A3177F3F8034918AA01DB50247D81A2AB22B5822200FF7D14351373824A3145F769A1F1CC8351FA1F0FB825D1874C6E688A39C901003CF84C758D144959C81E50240D1DD934D45AEDDDD67CCBCBF4F3258401ECE04D40BA39BD658EC90E40BA3D27C8A7EAB7831588A982201DD02E96471C131739A574208ACA00133A1738D1106B84C8A09</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 E8 46 0C 00 9B F8 97 66
0010 | 78 01 00 00 1F 5F 04 F5 14 48 2B 90 FA E8 E3 5C
0020 | E4 08 5A A7 53 2F 0F A8 E8 BA 72 BA FB B7 A6 C5
0030 | DB 1D 85 74 D8 8F 6B 3A FE 50 01 00 B7 B9 87 4B
0040 | F5 A0 34 2D 8F B4 A8 55 28 A6 1E B3 F6 FA 78 A6
0050 | DF 9B 14 A1 77 B0 1E 7E 98 7C 1E 17 3C E6 12 07
0060 | 13 AA FD 44 F2 E9 23 9F 5E B4 9A AD 19 6E 13 A2
0070 | 66 E4 D6 BF 20 8E A4 FD 1C BD 08 EF 94 61 15 A4
0080 | 93 47 BB 92 03 0A 04 C4 3F B2 6B 58 D9 6F FF 3E
0090 | 59 B6 43 5B 5F C7 07 D1 EE 88 C0 43 04 43 C8 8F
00A0 | D4 E4 1E 1A 93 81 F8 2E EE 38 BD 34 49 29 5E 9E
00B0 | 47 8F 10 B4 F1 30 22 F8 8E 1D 17 E3 D2 1D AA 84
00C0 | B9 A9 34 53 5B D4 E1 0A DF 74 91 05 82 77 15 4F
00D0 | B2 86 22 13 AD 83 E5 B8 59 80 9A 74 57 54 A9 CA
00E0 | 01 18 7A 06 AE 81 E7 AA 11 AB C0 94 9B 0F A6 22
00F0 | E7 8F 89 61 3F 74 BA 83 5A 41 E8 33 E7 94 3E 47
0100 | C0 E4 3D AA 15 B7 71 A3 17 7F 3F 80 34 91 8A A0
0110 | 1D B5 02 47 D8 1A 2A B2 2B 58 22 20 0F F7 D1 43
0120 | 51 37 38 24 A3 14 5F 76 9A 1F 1C C8 35 1F A1 F0
0130 | FB 82 5D 18 74 C6 E6 88 A3 9C 90 10 03 CF 84 C7
0140 | 58 D1 44 95 9C 81 E5 02 40 D1 DD 93 4D 45 AE DD
0150 | DD 67 CC BC BF 4F 32 58 40 1E CE 04 D4 0B A3 9B
0160 | D6 58 EC 90 E4 0B A3 D2 7C 8A 7E AB 78 31 58 8A
0170 | 98 22 01 DD 02 E9 64 71 C1 31 73 9A 57 42 08 AC
0180 | A0 01 33 A1 73 8D 11 06 B8 4C 8A 09</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>E8460C009BF89766</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100B7B9874BF5A0342D8FB4A855</code> <code>28A61EB3F6FA78A6DF9B14A177B01E7E</code> <code>987C1E173CE6120713AAFD44F2E9239F</code> <code>5EB49AAD196E13A266E4D6BF208EA4FD</code> <code>1CBD08EF946115A49347BB92030A04C4</code> <code>3FB26B58D96FFF3E59B6435B5FC707D1</code> <code>EE88C0430443C88FD4E41E1A9381F82E</code> <code>EE38BD3449295E9E478F10B4F13022F8</code> <code>8E1D17E3D21DAA84B9A934535BD4E10A</code> <code>DF7491058277154FB2862213AD83E5B8</code> <code>59809A745754A9CA01187A06AE81E7AA</code> <code>11ABC0949B0FA622E78F89613F74BA83</code> <code>5A41E833E7943E47C0E43DAA15B771A3</code> <code>177F3F8034918AA01DB50247D81A2AB2</code> <code>2B5822200FF7D14351373824A3145F76</code> <code>9A1F1CC8351FA1F0FB825D1874C6E688</code> <code>A39C901003CF84C758D144959C81E502</code> <code>40D1DD934D45AEDDDD67CCBCBF4F3258</code> <code>401ECE04D40BA39BD658EC90E40BA3D2</code> <code>7C8A7EAB7831588A982201DD02E96471</code> <code>C131739A574208ACA00133A1738D1106</code><br> <code>B84C8A09</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 1D5CF4EEF0CEB1BF14A2CBCC3E9DF593C6D863BABB8984191CA8DA219ECFAB20C4B6C7CA6D7F83D7530B486DB4492EF140697676DBC5E3F2AD515240F988E8DDCD8A10277D219983009EC1212BD194D11C611DA4882E95369E4036A28607E8439C04BFFC9499E9C7286EE6DADAE51677288B1AF8934C67897C8164B69777BBBA89E7017FD93B47FB823011AD5AF635D96683D80D16076D4266BC700E6EE661AE85961F1DD071C2305DE9BA4659B7CC9BEA0ACBA41B360717DA28CB6F08774C3CFB4B75E828998CDE737574D062531AAB00AA2C243A70F8D5F3BED2AD01D79F8C76766ABD0C5283CABA6F385777BD383F8BC19D6C23FCF6D6EF43B10B4C372DAB</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 48 15 BD 9B F8 97 66
0010 | A4 00 00 00 34 F7 CB 3B 14 48 2B 90 FA E8 E3 5C
0020 | E4 08 5A A7 53 2F 0F A8 E8 BA 72 BA FB B7 A6 C5
0030 | DB 1D 85 74 D8 8F 6B 3A 19 44 CC 6D 4B 8B 8C 1B
0040 | D0 DE 7E 89 D6 89 E7 DC</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>014815BD9BF89766</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>A4000000</code> (164 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>14482B90FAE8E35CE4085AA7532F0FA8</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>E8BA72BAFBB7A6C5DB1D8574D88F6B3A</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>1944CC6D4B8B8C1BD0DE7E89D689E7DC</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps">Apps</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

