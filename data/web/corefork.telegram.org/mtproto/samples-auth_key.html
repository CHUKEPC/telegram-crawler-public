<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Auth key generation example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="A full auth key generation example">
    <meta property="og:title" content="Auth key generation example">
    <meta property="og:image" content="71a15765997de28d38">
    <meta property="og:description" content="A full auth key generation example">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?247" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class=""><a href="/api">API</a></li>
<li class="active"><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/mtproto" >Mobile Protocol</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/mtproto/samples-auth_key" >Auth key generation example</a></li></ul></div>
  <h1 id="dev_page_title">Auth key generation example</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>In the examples below, the <a href="/mtproto#transport">transport</a> headers are omitted:</p>
<blockquote>
<p>For example, for the <a href="/mtproto/mtproto-transports#abridged">abridged version of the transport »</a>, the client sends <code>0xef</code> as the first byte (<strong>important:</strong> only prior to the very first data packet), then the packet length is encoded with a single byte (<code>0x01-0x7e</code> = data length divided by 4; or <code>0x7f</code> followed by 3 bytes (little endian) divided by 4) followed by the data itself. In this case, server responses have the same structure (although the server does not send <code>0xef</code>as the first byte).</p>
</blockquote>
<p>Detailed documentation on creating authorization keys is available <a href="/mtproto/auth_key">here »</a>.</p>
<h4><a class="anchor" href="#dh-exchange-initiation" id="dh-exchange-initiation" name="dh-exchange-initiation"><i class="anchor-icon"></i></a>DH exchange initiation</h4>
<h5><a class="anchor" href="#1-client-sends-query-to-server" id="1-client-sends-query-to-server" name="1-client-sends-query-to-server"><i class="anchor-icon"></i></a>1) Client sends query to server</h5>
<!-- start req_pq_multi -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 10 31 0F 00 8C 55 DD 68
0010 | 14 00 00 00 F1 8E 7E BE 8E D5 B0 D5 FC 3F 1A D1
0020 | 19 E4 88 AC 4A DD 87 D4</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_pq_multi#be7e8ef1 nonce:int128 = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>10310F008C55DD68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>14000000</code> (20 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_pq_multi)</td>
<td>20, 4</td>
<td><code>f18e7ebe</code></td>
<td><em>req_pq_multi</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Random number</td>
</tr>
</tbody>
</table>
<!-- end req_pq_multi -->
<h5><a class="anchor" href="#2-server-sends-response-of-the-form" id="2-server-sends-response-of-the-form" name="2-server-sends-response-of-the-form"><i class="anchor-icon"></i></a>2) Server sends response of the form</h5>
<!-- start resPQ -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 48 2B 77 8C 55 DD 68
0010 | 50 00 00 00 63 24 16 05 8E D5 B0 D5 FC 3F 1A D1
0020 | 19 E4 88 AC 4A DD 87 D4 FB 39 07 85 74 22 B8 6F
0030 | F9 10 D0 D6 A0 8A E2 A0 08 1B 44 B9 2D BF 10 B7
0040 | 97 00 00 00 15 C4 B5 1C 03 00 00 00 85 FD 64 DE
0050 | 85 1D 9D D0 A5 B7 F7 09 35 5F C3 0B 21 6B E8 6C
0060 | 02 2B B4 C3</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>resPQ#05162463 nonce:int128 server_nonce:int128 pq:string server_public_key_fingerprints:Vector&lt;strlong&gt; = ResPQ;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01482B778C55DD68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>50000000</code> (80 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(resPQ)</td>
<td>20, 4</td>
<td><code>63241605</code></td>
<td><em>resPQ</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Server-generated random number</td>
</tr>
<tr>
<td>pq</td>
<td>56, 12</td>
<td><code>081B44B92DBF10B797000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1964898943570589591</td>
<td>Single-byte prefix denoting length, an 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>%(Vector strlong)</td>
<td>68, 4</td>
<td><code>15c4b51c</code></td>
<td><em>Vector t</em> constructor number from TL schema</td>
</tr>
<tr>
<td>count</td>
<td>72, 4</td>
<td><code>03000000</code></td>
<td>Number of elements in server_public_key_fingerprints</td>
</tr>
<tr>
<td>server_public_key_fingerprints[0]</td>
<td>76, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[1]</td>
<td>84, 8</td>
<td><code>A5B7F709355FC30B</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
<tr>
<td>server_public_key_fingerprints[2]</td>
<td>92, 8</td>
<td><code>216BE86C022BB4C3</code></td>
<td>64 lower-order bits of <code>SHA1(server_public_key)</code></td>
</tr>
</tbody>
</table>
<!-- end resPQ -->
<p>In our case, the client only has the following public keys, with the following fingerprints:</p>
<!-- start fingerprints -->
<ul>
<li><code>85FD64DE851D9DD0</code></li>
</ul>
<p>Let's choose the only matching key, the one with fingerprint equal to <code>85FD64DE851D9DD0</code>.</p>
<!-- end fingerprints -->
<h4><a class="anchor" href="#proof-of-work" id="proof-of-work" name="proof-of-work"><i class="anchor-icon"></i></a>Proof of work</h4>
<h5><a class="anchor" href="#3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" id="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q" name="3-client-decomposes-pq-into-prime-factors-such-that-p-lt-q"><i class="anchor-icon"></i></a>3) Client decomposes pq into prime factors such that p &lt; q.</h5>
<!-- start pq -->
<pre><code>pq = 1964898943570589591</code></pre>
<p>Decompose into 2 prime cofactors <code>p &lt; q</code>: <code>1964898943570589591 = 1059572279 * 1854426529</code></p>
<pre><code>p = 1059572279
q = 1854426529</code></pre>
<!-- end pq -->
<h4><a class="anchor" href="#presenting-proof-of-work-server-authentication" id="presenting-proof-of-work-server-authentication" name="presenting-proof-of-work-server-authentication"><i class="anchor-icon"></i></a>Presenting proof of work; Server authentication</h4>
<h5><a class="anchor" href="#4-encrypted-data-payload-generation" id="4-encrypted-data-payload-generation" name="4-encrypted-data-payload-generation"><i class="anchor-icon"></i></a>4) <code>encrypted_data</code> payload generation</h5>
<p>First of all, generate an <code>encrypted_data</code> payload as follows:</p>
<!-- start p_q_inner_data_dc -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 95 5F F5 A9 08 1B 44 B9 2D BF 10 B7 97 00 00 00
0010 | 04 3F 27 CA 37 00 00 00 04 6E 88 4D A1 00 00 00
0020 | 8E D5 B0 D5 FC 3F 1A D1 19 E4 88 AC 4A DD 87 D4
0030 | FB 39 07 85 74 22 B8 6F F9 10 D0 D6 A0 8A E2 A0
0040 | 0B 78 F9 5F 1D 1A 0C 48 72 84 8C 14 D3 BC 95 B1
0050 | 9E 37 7E 07 5B A0 44 83 49 C1 B8 9D 66 0E CD 65
0060 | 02 00 00 00</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>p_q_inner_data_dc#a9f55f95 pq:string p:string q:string nonce:int128 server_nonce:int128 new_nonce:int256 dc:int = P_Q_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(p_q_inner_data_dc)</td>
<td>0, 4</td>
<td><code>955ff5a9</code></td>
<td><em>p_q_inner_data_dc</em> constructor number from TL schema</td>
</tr>
<tr>
<td>pq</td>
<td>4, 12</td>
<td><code>081B44B92DBF10B797000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1964898943570589591</td>
<td>Single-byte prefix denoting length, 8-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>p</td>
<td>16, 8</td>
<td><code>043F27CA37000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1059572279</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>24, 8</td>
<td><code>046E884DA1000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1854426529</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>nonce</td>
<td>32, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>48, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce</td>
<td>64, 32</td>
<td><code>0B78F95F1D1A0C4872848C14D3BC95B1</code> <code>9E377E075BA0448349C1B89D660ECD65</code></td>
<td>Client-generated random number</td>
</tr>
<tr>
<td>dc</td>
<td>96, 4</td>
<td><code>02000000</code> (2 in decimal)</td>
<td>DC ID: <code>10000</code> (decimal) has to be added to the DC ID to connect to the test servers; it has to be made negative if the DC we're connecting to is a media (not CDN) DC.</td>
</tr>
</tbody>
</table>
<!-- end p_q_inner_data_dc -->
<p>The serialization of <em>P_Q_inner_data</em> produces <strong>data</strong>, which is used to generate <strong>encrypted_data</strong> as specified in <a href="/mtproto/auth_key">step 4.1</a>.<br>
These are the inputs to the algorithm specified in <a href="/mtproto/auth_key">step 4.1</a>:</p>
<!-- start p_q_inner_data_input -->
<pre><code>data = 955FF5A9081B44B92DBF10B797000000043F27CA37000000046E884DA10000008ED5B0D5FC3F1AD119E488AC4ADD87D4FB3907857422B86FF910D0D6A08AE2A00B78F95F1D1A0C4872848C14D3BC95B19E377E075BA0448349C1B89D660ECD6502000000
random_padding_bytes = 2FDD1E3316702ED4870FD555B4014029233936BAAAC00DB6660C43387063A34E8856A8AF778C5133AFBFCB81BC1FE343A673033C37626D195A7DF7308A5A7B99A843E448E7C5F09E5546FABEC793AA70C3CCF670E337B2FEFF499359</code></pre>
<!-- end p_q_inner_data_input -->
<p>And this is the output:</p>
<!-- start p_q_inner_data_output -->
<pre><code>encrypted_data = 16EB4455F71DAB10CE413649E907DA45AAD65A3DE4A3C5C8344DAC9B7C2E178B7372DEDF64A3B1C21686C40344CE4E5A65455C78BD2D4358125EFA4514B5B27A9D17544A0650681A74440D576C0D9260E93619251BE4FD67E5B6615450596C2DA797664589C77AFA086F45D2C6D81B79593C1072BB6D74894379B96C24C05A5B01A054C6C1ABA7E5E9814CAAC6BB6ABEC9249EF5C98A30E761174364274653E75EEE2237E24C1ED019AB52AEA2705A88A21378B1914DED037CAA2D62A68B794CD8BCB17B1212C44D6ABEF969E34AEBF1E2686DAF1A229AC5B2986A4A51612D0A3131638619B63C48A20FC01A76D5E148C8BC591959C20ADC425047E6791D9DB7</code></pre>
<!-- end p_q_inner_data_output -->
<p>The length of the final string is 256 bytes.</p>
<h5><a class="anchor" href="#5-send-req-dh-params-query-with-generated-encrypted-data" id="5-send-req-dh-params-query-with-generated-encrypted-data" name="5-send-req-dh-params-query-with-generated-encrypted-data"><i class="anchor-icon"></i></a>5) Send req_DH_params query with generated <code>encrypted_data</code></h5>
<!-- start req_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 14 31 0F 00 8C 55 DD 68
0010 | 40 01 00 00 BE E4 12 D7 8E D5 B0 D5 FC 3F 1A D1
0020 | 19 E4 88 AC 4A DD 87 D4 FB 39 07 85 74 22 B8 6F
0030 | F9 10 D0 D6 A0 8A E2 A0 04 3F 27 CA 37 00 00 00
0040 | 04 6E 88 4D A1 00 00 00 85 FD 64 DE 85 1D 9D D0
0050 | FE 00 01 00 16 EB 44 55 F7 1D AB 10 CE 41 36 49
0060 | E9 07 DA 45 AA D6 5A 3D E4 A3 C5 C8 34 4D AC 9B
0070 | 7C 2E 17 8B 73 72 DE DF 64 A3 B1 C2 16 86 C4 03
0080 | 44 CE 4E 5A 65 45 5C 78 BD 2D 43 58 12 5E FA 45
0090 | 14 B5 B2 7A 9D 17 54 4A 06 50 68 1A 74 44 0D 57
00A0 | 6C 0D 92 60 E9 36 19 25 1B E4 FD 67 E5 B6 61 54
00B0 | 50 59 6C 2D A7 97 66 45 89 C7 7A FA 08 6F 45 D2
00C0 | C6 D8 1B 79 59 3C 10 72 BB 6D 74 89 43 79 B9 6C
00D0 | 24 C0 5A 5B 01 A0 54 C6 C1 AB A7 E5 E9 81 4C AA
00E0 | C6 BB 6A BE C9 24 9E F5 C9 8A 30 E7 61 17 43 64
00F0 | 27 46 53 E7 5E EE 22 37 E2 4C 1E D0 19 AB 52 AE
0100 | A2 70 5A 88 A2 13 78 B1 91 4D ED 03 7C AA 2D 62
0110 | A6 8B 79 4C D8 BC B1 7B 12 12 C4 4D 6A BE F9 69
0120 | E3 4A EB F1 E2 68 6D AF 1A 22 9A C5 B2 98 6A 4A
0130 | 51 61 2D 0A 31 31 63 86 19 B6 3C 48 A2 0F C0 1A
0140 | 76 D5 E1 48 C8 BC 59 19 59 C2 0A DC 42 50 47 E6
0150 | 79 1D 9D B7</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>req_DH_params#d712e4be nonce:int128 server_nonce:int128 p:string q:string public_key_fingerprint:long encrypted_data:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>14310F008C55DD68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>40010000</code> (320 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(req_DH_params)</td>
<td>20, 4</td>
<td><code>bee412d7</code></td>
<td><em>req_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>p</td>
<td>56, 8</td>
<td><code>043F27CA37000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1059572279</td>
<td>First prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>q</td>
<td>64, 8</td>
<td><code>046E884DA1000000</code><br>TL byte deserialization <br>=&gt; bigendian conversion to decimal<br>=&gt; 1854426529</td>
<td>Second prime cofactor: single-byte prefix denoting length, 4-byte string, and three bytes of padding</td>
</tr>
<tr>
<td>public_key_fingerprint</td>
<td>72, 8</td>
<td><code>85FD64DE851D9DD0</code></td>
<td><code>fingerprint</code> of public key used</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>80, 260</td>
<td><code>FE00010016EB4455F71DAB10CE413649</code> <code>E907DA45AAD65A3DE4A3C5C8344DAC9B</code> <code>7C2E178B7372DEDF64A3B1C21686C403</code> <code>44CE4E5A65455C78BD2D4358125EFA45</code> <code>14B5B27A9D17544A0650681A74440D57</code> <code>6C0D9260E93619251BE4FD67E5B66154</code> <code>50596C2DA797664589C77AFA086F45D2</code> <code>C6D81B79593C1072BB6D74894379B96C</code> <code>24C05A5B01A054C6C1ABA7E5E9814CAA</code> <code>C6BB6ABEC9249EF5C98A30E761174364</code> <code>274653E75EEE2237E24C1ED019AB52AE</code> <code>A2705A88A21378B1914DED037CAA2D62</code> <code>A68B794CD8BCB17B1212C44D6ABEF969</code> <code>E34AEBF1E2686DAF1A229AC5B2986A4A</code> <code>51612D0A3131638619B63C48A20FC01A</code> <code>76D5E148C8BC591959C20ADC425047E6</code><br> <code>791D9DB7</code></td>
<td>Value generated above</td>
</tr>
</tbody>
</table>
<!-- end req_DH_params -->
<h5><a class="anchor" href="#6-server-responds-with" id="6-server-responds-with" name="6-server-responds-with"><i class="anchor-icon"></i></a>6) Server responds with:</h5>
<!-- start server_DH_params_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 08 68 AD 8C 55 DD 68
0010 | 78 02 00 00 5C 07 E8 D0 8E D5 B0 D5 FC 3F 1A D1
0020 | 19 E4 88 AC 4A DD 87 D4 FB 39 07 85 74 22 B8 6F
0030 | F9 10 D0 D6 A0 8A E2 A0 FE 50 02 00 E4 AC A5 A6
0040 | 53 AC 3E 5D 4C 93 4F 95 C9 96 32 CB 0F 3F 3D CA
0050 | 52 F6 B1 D8 5E F0 7D 2D 4B DB 2A 12 69 7C E7 3A
0060 | 7D A9 C5 45 C9 B0 7C 5E E9 CC CE 31 31 7A 3E E4
0070 | 35 01 8B B8 CC 54 9E 2A 19 AB F9 2A 76 8F EF 93
0080 | 72 74 90 40 B9 A5 8E C4 9D D7 03 B8 09 83 69 B1
0090 | 63 A4 F5 CB 49 88 47 21 B9 F5 74 CC 52 A2 76 6B
00A0 | 81 1D 68 48 27 2A 96 42 79 49 9C EA E0 61 D0 A9
00B0 | 86 AF 39 DC 0A B9 AE 29 1E 3A 33 BC 46 5D 39 6B
00C0 | 30 01 8D 4A 76 B8 F1 A0 6C D1 13 F0 C4 89 43 74
00D0 | 45 0D BE 67 EC EA BE 70 2F 23 5C 2A 31 91 AE B7
00E0 | 5F 09 C3 6A 32 7B 15 D2 87 51 4D 43 3F 2E F7 FA
00F0 | 11 FC 0D 1F 5D 9A 87 B6 F5 F4 68 0B 37 B0 FD 8C
0100 | 18 A0 24 97 65 3A DB 17 81 D4 F9 59 CC D5 11 67
0110 | 49 00 67 03 BC 73 C1 63 68 4A 39 F3 4F 9B AF D9
0120 | 15 14 1A 27 21 4E FE AB 65 48 1A 0F DF 9B 7A 5C
0130 | B7 43 BB 3E 23 89 BC 42 BB FD C8 72 C3 F2 1B 13
0140 | 48 0E DF AD EA 89 7C F0 53 0D E2 42 B6 9D 8C 16
0150 | 5F 66 2A 54 80 4C 97 52 8A 82 5C 6F C0 9A A4 ED
0160 | DE 16 0D 2D 14 1F AD 5C DD E6 24 4A E4 EE EA AB
0170 | 27 84 A1 F2 3D A9 D3 10 84 57 1E DA C7 66 47 CC
0180 | 83 44 39 4A 27 60 31 3A 4F 11 F7 07 93 8A 90 A5
0190 | A4 56 62 40 05 B3 35 3E EC 01 BA 8C E3 89 C1 54
01A0 | 1B 0D FF FB FF DD 67 83 97 6D 90 BF 5E C5 92 11
01B0 | 7C 9B 58 B0 E2 E6 E0 88 2B 19 55 AD 1A D3 8C B9
01C0 | EA 1F 13 07 92 D3 97 2F 28 9E 65 13 D6 B5 EB 91
01D0 | C5 3B 26 D7 C0 B8 AD 85 C2 FA F7 18 38 CD B8 BF
01E0 | F8 7D DF CA AF C3 9D 0B 77 09 CF C7 39 DF A1 60
01F0 | EC D2 7B 89 DF EA 83 0D 0C 10 69 83 CC CA 97 7D
0200 | 5D 5E 17 1B 51 21 D0 AD 0B 5A FC 58 4E 3A 02 43
0210 | A9 30 9D 41 A4 81 A8 D2 FE 70 FD 70 E9 17 3A A3
0220 | 88 0D D6 EE D5 8D F2 7A E0 85 E6 E9 BA 0C 64 84
0230 | 70 76 68 F9 FE 1F 63 8F 52 9A 42 03 68 F3 8C CC
0240 | E9 D1 E3 45 30 53 3D 39 72 17 50 09 5B D4 19 C6
0250 | 5A F3 C3 CD 30 F4 22 C5 54 8B C6 0E 6A EE 73 F7
0260 | C8 7A A6 54 CE 20 EE FE D4 5B AE F3 37 BF FF B7
0270 | 6D 54 E6 B6 87 ED 4C 84 8A 2C E5 94 E2 DD DD 5C
0280 | 3D D1 18 B4 05 12 8C 55 7C 62 8D 69</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_params_ok#d0e8075c nonce:int128 server_nonce:int128 encrypted_answer:string = Server_DH_Params;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>010868AD8C55DD68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78020000</code> (632 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(server_DH_params_ok)</td>
<td>20, 4</td>
<td><code>5c07e8d0</code></td>
<td><em>server_DH_params_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_answer</td>
<td>56, 596</td>
<td><code>FE500200E4ACA5A653AC3E5D4C934F95</code> <code>C99632CB0F3F3DCA52F6B1D85EF07D2D</code> <code>4BDB2A12697CE73A7DA9C545C9B07C5E</code> <code>E9CCCE31317A3EE435018BB8CC549E2A</code> <code>19ABF92A768FEF9372749040B9A58EC4</code> <code>9DD703B8098369B163A4F5CB49884721</code> <code>B9F574CC52A2766B811D6848272A9642</code> <code>79499CEAE061D0A986AF39DC0AB9AE29</code> <code>1E3A33BC465D396B30018D4A76B8F1A0</code> <code>6CD113F0C4894374450DBE67ECEABE70</code> <code>2F235C2A3191AEB75F09C36A327B15D2</code> <code>87514D433F2EF7FA11FC0D1F5D9A87B6</code> <code>F5F4680B37B0FD8C18A02497653ADB17</code> <code>81D4F959CCD5116749006703BC73C163</code> <code>684A39F34F9BAFD915141A27214EFEAB</code> <code>65481A0FDF9B7A5CB743BB3E2389BC42</code> <code>BBFDC872C3F21B13480EDFADEA897CF0</code> <code>530DE242B69D8C165F662A54804C9752</code> <code>8A825C6FC09AA4EDDE160D2D141FAD5C</code> <code>DDE6244AE4EEEAAB2784A1F23DA9D310</code> <code>84571EDAC76647CC8344394A2760313A</code> <code>4F11F707938A90A5A456624005B3353E</code> <code>EC01BA8CE389C1541B0DFFFBFFDD6783</code> <code>976D90BF5EC592117C9B58B0E2E6E088</code> <code>2B1955AD1AD38CB9EA1F130792D3972F</code> <code>289E6513D6B5EB91C53B26D7C0B8AD85</code> <code>C2FAF71838CDB8BFF87DDFCAAFC39D0B</code> <code>7709CFC739DFA160ECD27B89DFEA830D</code> <code>0C106983CCCA977D5D5E171B5121D0AD</code> <code>0B5AFC584E3A0243A9309D41A481A8D2</code> <code>FE70FD70E9173AA3880DD6EED58DF27A</code> <code>E085E6E9BA0C6484707668F9FE1F638F</code> <code>529A420368F38CCCE9D1E34530533D39</code> <code>721750095BD419C65AF3C3CD30F422C5</code> <code>548BC60E6AEE73F7C87AA654CE20EEFE</code> <code>D45BAEF337BFFFB76D54E6B687ED4C84</code> <code>8A2CE594E2DDDD5C3DD118B405128C55</code><br> <code>7C628D69</code></td>
<td>See below</td>
</tr>
</tbody>
</table>
<!-- end server_DH_params_ok -->
<p>Decrypt <code>encrypted_answer</code> using the reverse of the process specified in <a href="/mtproto/auth_key#6-server-responds-with">step 6</a>:</p>
<!-- start server_DH_inner_data_input -->
<pre><code>encrypted_answer = E4ACA5A653AC3E5D4C934F95C99632CB0F3F3DCA52F6B1D85EF07D2D4BDB2A12697CE73A7DA9C545C9B07C5EE9CCCE31317A3EE435018BB8CC549E2A19ABF92A768FEF9372749040B9A58EC49DD703B8098369B163A4F5CB49884721B9F574CC52A2766B811D6848272A964279499CEAE061D0A986AF39DC0AB9AE291E3A33BC465D396B30018D4A76B8F1A06CD113F0C4894374450DBE67ECEABE702F235C2A3191AEB75F09C36A327B15D287514D433F2EF7FA11FC0D1F5D9A87B6F5F4680B37B0FD8C18A02497653ADB1781D4F959CCD5116749006703BC73C163684A39F34F9BAFD915141A27214EFEAB65481A0FDF9B7A5CB743BB3E2389BC42BBFDC872C3F21B13480EDFADEA897CF0530DE242B69D8C165F662A54804C97528A825C6FC09AA4EDDE160D2D141FAD5CDDE6244AE4EEEAAB2784A1F23DA9D31084571EDAC76647CC8344394A2760313A4F11F707938A90A5A456624005B3353EEC01BA8CE389C1541B0DFFFBFFDD6783976D90BF5EC592117C9B58B0E2E6E0882B1955AD1AD38CB9EA1F130792D3972F289E6513D6B5EB91C53B26D7C0B8AD85C2FAF71838CDB8BFF87DDFCAAFC39D0B7709CFC739DFA160ECD27B89DFEA830D0C106983CCCA977D5D5E171B5121D0AD0B5AFC584E3A0243A9309D41A481A8D2FE70FD70E9173AA3880DD6EED58DF27AE085E6E9BA0C6484707668F9FE1F638F529A420368F38CCCE9D1E34530533D39721750095BD419C65AF3C3CD30F422C5548BC60E6AEE73F7C87AA654CE20EEFED45BAEF337BFFFB76D54E6B687ED4C848A2CE594E2DDDD5C3DD118B405128C557C628D69
tmp_aes_key = 37D55E06E93750E2B62CF4DE82CB9AEAC6FA47230F5FA46BF7F82DCA315D873B
tmp_aes_iv = 6878ACD46DEE76DEB00805930FB5C5F41534D686B2D5F3028F528AB00B78F95F</code></pre>
<!-- end server_DH_inner_data_input -->
<p>Yielding:</p>
<!-- start server_DH_inner_data_output -->
<pre><code>answer_with_hash = B09837E1C7354C63AE4E478E45918BF93E717551BA0D89B58ED5B0D5FC3F1AD119E488AC4ADD87D4FB3907857422B86FF910D0D6A08AE2A003000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100B0C2DCF812B52B4F1275D2637DB0456EE4080011C2A7A156D0BC9A1C4F41DE5DCA25F94BB48034F7C663A39002538744736A66077C47892796AC4EE11F028AC59A0EEE0EECF0CCF6E1DE2723011A3B55BE8BF53540845706706EA21E47EF7017BF01FA43BA685E5A6ACA673B6248A172C00BD0FFAACA2CEA4C2C032B862F974CA22283D8592A978873BBCC0EE37A9F1C01E87A7195657C07DD89474924FC767FEE489BCF78910A83DBA5D490F5961E51040650CCB27621D647DE4F4ECAC6D8917DA683CA4482B71E60A475BCC7DB26B7F4EFF2B006862B91256567E91E72AA74FAC694336A2B3BD3F76B7891896B19F989A9BC1F7EE258361AEB29A6ABD381AC8C55DD6830C23E42681FDC30
answer = BA0D89B58ED5B0D5FC3F1AD119E488AC4ADD87D4FB3907857422B86FF910D0D6A08AE2A003000000FE000100C71CAEB9C6B1C9048E6C522F70F13F73980D40238E3E21C14934D037563D930F48198A0AA7C14058229493D22530F4DBFA336F6E0AC925139543AED44CCE7C3720FD51F69458705AC68CD4FE6B6B13ABDC9746512969328454F18FAF8C595F642477FE96BB2A941D5BCD1D4AC8CC49880708FA9B378E3C4F3A9060BEE67CF9A4A4A695811051907E162753B56B0F6B410DBA74D8A84B2A14B3144E0EF1284754FD17ED950D5965B4B9DD46582DB1178D169C6BC465B0D6FF9CA3928FEF5B9AE4E418FC15E83EBEA0F87FA9FF5EED70050DED2849F47BF959D956850CE929851F0D8115F635B105EE2E4E15D04B2454BF6F4FADF034B10403119CD8E3B92FCC5BFE000100B0C2DCF812B52B4F1275D2637DB0456EE4080011C2A7A156D0BC9A1C4F41DE5DCA25F94BB48034F7C663A39002538744736A66077C47892796AC4EE11F028AC59A0EEE0EECF0CCF6E1DE2723011A3B55BE8BF53540845706706EA21E47EF7017BF01FA43BA685E5A6ACA673B6248A172C00BD0FFAACA2CEA4C2C032B862F974CA22283D8592A978873BBCC0EE37A9F1C01E87A7195657C07DD89474924FC767FEE489BCF78910A83DBA5D490F5961E51040650CCB27621D647DE4F4ECAC6D8917DA683CA4482B71E60A475BCC7DB26B7F4EFF2B006862B91256567E91E72AA74FAC694336A2B3BD3F76B7891896B19F989A9BC1F7EE258361AEB29A6ABD381AC8C55DD6830C23E42681FDC30</code></pre>
<!-- end server_DH_inner_data_output -->
<!-- start server_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | BA 0D 89 B5 8E D5 B0 D5 FC 3F 1A D1 19 E4 88 AC
0010 | 4A DD 87 D4 FB 39 07 85 74 22 B8 6F F9 10 D0 D6
0020 | A0 8A E2 A0 03 00 00 00 FE 00 01 00 C7 1C AE B9
0030 | C6 B1 C9 04 8E 6C 52 2F 70 F1 3F 73 98 0D 40 23
0040 | 8E 3E 21 C1 49 34 D0 37 56 3D 93 0F 48 19 8A 0A
0050 | A7 C1 40 58 22 94 93 D2 25 30 F4 DB FA 33 6F 6E
0060 | 0A C9 25 13 95 43 AE D4 4C CE 7C 37 20 FD 51 F6
0070 | 94 58 70 5A C6 8C D4 FE 6B 6B 13 AB DC 97 46 51
0080 | 29 69 32 84 54 F1 8F AF 8C 59 5F 64 24 77 FE 96
0090 | BB 2A 94 1D 5B CD 1D 4A C8 CC 49 88 07 08 FA 9B
00A0 | 37 8E 3C 4F 3A 90 60 BE E6 7C F9 A4 A4 A6 95 81
00B0 | 10 51 90 7E 16 27 53 B5 6B 0F 6B 41 0D BA 74 D8
00C0 | A8 4B 2A 14 B3 14 4E 0E F1 28 47 54 FD 17 ED 95
00D0 | 0D 59 65 B4 B9 DD 46 58 2D B1 17 8D 16 9C 6B C4
00E0 | 65 B0 D6 FF 9C A3 92 8F EF 5B 9A E4 E4 18 FC 15
00F0 | E8 3E BE A0 F8 7F A9 FF 5E ED 70 05 0D ED 28 49
0100 | F4 7B F9 59 D9 56 85 0C E9 29 85 1F 0D 81 15 F6
0110 | 35 B1 05 EE 2E 4E 15 D0 4B 24 54 BF 6F 4F AD F0
0120 | 34 B1 04 03 11 9C D8 E3 B9 2F CC 5B FE 00 01 00
0130 | B0 C2 DC F8 12 B5 2B 4F 12 75 D2 63 7D B0 45 6E
0140 | E4 08 00 11 C2 A7 A1 56 D0 BC 9A 1C 4F 41 DE 5D
0150 | CA 25 F9 4B B4 80 34 F7 C6 63 A3 90 02 53 87 44
0160 | 73 6A 66 07 7C 47 89 27 96 AC 4E E1 1F 02 8A C5
0170 | 9A 0E EE 0E EC F0 CC F6 E1 DE 27 23 01 1A 3B 55
0180 | BE 8B F5 35 40 84 57 06 70 6E A2 1E 47 EF 70 17
0190 | BF 01 FA 43 BA 68 5E 5A 6A CA 67 3B 62 48 A1 72
01A0 | C0 0B D0 FF AA CA 2C EA 4C 2C 03 2B 86 2F 97 4C
01B0 | A2 22 83 D8 59 2A 97 88 73 BB CC 0E E3 7A 9F 1C
01C0 | 01 E8 7A 71 95 65 7C 07 DD 89 47 49 24 FC 76 7F
01D0 | EE 48 9B CF 78 91 0A 83 DB A5 D4 90 F5 96 1E 51
01E0 | 04 06 50 CC B2 76 21 D6 47 DE 4F 4E CA C6 D8 91
01F0 | 7D A6 83 CA 44 82 B7 1E 60 A4 75 BC C7 DB 26 B7
0200 | F4 EF F2 B0 06 86 2B 91 25 65 67 E9 1E 72 AA 74
0210 | FA C6 94 33 6A 2B 3B D3 F7 6B 78 91 89 6B 19 F9
0220 | 89 A9 BC 1F 7E E2 58 36 1A EB 29 A6 AB D3 81 AC
0230 | 8C 55 DD 68</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>server_DH_inner_data#b5890dba nonce:int128 server_nonce:int128 g:int dh_prime:string g_a:string server_time:int = Server_DH_inner_data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(server_DH_inner_data)</td>
<td>0, 4</td>
<td><code>ba0d89b5</code></td>
<td><em>server_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g</td>
<td>36, 4</td>
<td><code>03000000</code> (3 in decimal)</td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>dh_prime</td>
<td>40, 260</td>
<td><code>FE000100C71CAEB9C6B1C9048E6C522F</code> <code>70F13F73980D40238E3E21C14934D037</code> <code>563D930F48198A0AA7C14058229493D2</code> <code>2530F4DBFA336F6E0AC925139543AED4</code> <code>4CCE7C3720FD51F69458705AC68CD4FE</code> <code>6B6B13ABDC9746512969328454F18FAF</code> <code>8C595F642477FE96BB2A941D5BCD1D4A</code> <code>C8CC49880708FA9B378E3C4F3A9060BE</code> <code>E67CF9A4A4A695811051907E162753B5</code> <code>6B0F6B410DBA74D8A84B2A14B3144E0E</code> <code>F1284754FD17ED950D5965B4B9DD4658</code> <code>2DB1178D169C6BC465B0D6FF9CA3928F</code> <code>EF5B9AE4E418FC15E83EBEA0F87FA9FF</code> <code>5EED70050DED2849F47BF959D956850C</code> <code>E929851F0D8115F635B105EE2E4E15D0</code> <code>4B2454BF6F4FADF034B10403119CD8E3</code><br> <code>B92FCC5B</code></td>
<td>2048-bit prime, in big-endian byte order, to be checked as specified in the auth key docs</td>
</tr>
<tr>
<td>g_a</td>
<td>300, 260</td>
<td><code>FE000100B0C2DCF812B52B4F1275D263</code> <code>7DB0456EE4080011C2A7A156D0BC9A1C</code> <code>4F41DE5DCA25F94BB48034F7C663A390</code> <code>02538744736A66077C47892796AC4EE1</code> <code>1F028AC59A0EEE0EECF0CCF6E1DE2723</code> <code>011A3B55BE8BF53540845706706EA21E</code> <code>47EF7017BF01FA43BA685E5A6ACA673B</code> <code>6248A172C00BD0FFAACA2CEA4C2C032B</code> <code>862F974CA22283D8592A978873BBCC0E</code> <code>E37A9F1C01E87A7195657C07DD894749</code> <code>24FC767FEE489BCF78910A83DBA5D490</code> <code>F5961E51040650CCB27621D647DE4F4E</code> <code>CAC6D8917DA683CA4482B71E60A475BC</code> <code>C7DB26B7F4EFF2B006862B91256567E9</code> <code>1E72AA74FAC694336A2B3BD3F76B7891</code> <code>896B19F989A9BC1F7EE258361AEB29A6</code><br> <code>ABD381AC</code></td>
<td><code>g_a</code> diffie-hellman parameter</td>
</tr>
<tr>
<td>server_time</td>
<td>560, 4</td>
<td><code>8C55DD68</code> (1759335820 in decimal)</td>
<td>Server time</td>
</tr>
</tbody>
</table>
<!-- end server_DH_inner_data -->
<h5><a class="anchor" href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" id="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message" name="7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message"><i class="anchor-icon"></i></a>7) Client computes random 2048-bit number <em>b</em> (using a sufficient amount of entropy) and sends the server a message</h5>
<p>First, generate a secure random 2048-bit number b:</p>
<!-- start b -->
<pre><code>b = 841D0CEB71E8F0071925BDC7F79F5426A3FC9BBF26FD9B394DF61D165D747B608CC1272F3ECF9850A489DFB0D0CEC8C3E21E7F789901D42121C036AC1102DE6AA17BB1848F67FC2F6E41E8AB9EFBB04CB2067CA93103BDFACC822AC67C37FBEC092EDEFAC68166152064B503F41773F8851E95D22DE8124EB0DF7901DBB1F749F3B213B2F01C8358B0801F6E93E5796F3668F26E320A635C46FDFE7A1902BAC13CE49C1432CC51B67AB97F35BC5813A87AFAA1A95C967FA048E8FF70191AE8E188F638A8D55A46363ED67E46CA6B1EFDCAB488F56FAF944FEBBD38C4E36B5DE6FECFEDD8ED22FACB4E98385E8E410CE25D1D27F44C57BE712826EF026B68CCF2</code></pre>
<!-- end b -->
<p>Then compute <code>g_b = pow(g, b) mod dh_prime</code></p>
<!-- start g_b -->
<pre><code>g_b = 8FEEB8FCBE4C076FCAF8D7FEAA8FBF671EEB673C7EC0FF972AD22FCB4ADEF7F45371577854359127A9CDABC20319B71276BEA583FE8C279666D308F417CC31B823288D3DA303402FD2E1610306F207CFDAF09DC59A781A34F66C20AD2A06A67FA3AF2C25CC442D63C559318374170C4B668F91E2024236E1891AABBEAC30B2171B4F65BFF4645B90F9149AEB54B2F46EAE53383E75579336A5DD32A628609848AC9BD8EE298A9EA146ED7AA2A04CDEF5B4449DBF68A02F9AAD553EF5E71AD056B8BD8D23F69E7967B5D58AB0500F94CB87115194E59DE98C28705008A50BC704A858A6CFE3BE3FF47DD86A4A578C5BFE337225ECFC75ECBB93FCA81D4D8B27EC</code></pre>
<!-- end g_b -->
<h6>7.1) generation of encrypted_data</h6>
<!-- start client_DH_inner_data -->
<p>Generated payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 54 B6 43 66 8E D5 B0 D5 FC 3F 1A D1 19 E4 88 AC
0010 | 4A DD 87 D4 FB 39 07 85 74 22 B8 6F F9 10 D0 D6
0020 | A0 8A E2 A0 00 00 00 00 00 00 00 00 FE 00 01 00
0030 | 8F EE B8 FC BE 4C 07 6F CA F8 D7 FE AA 8F BF 67
0040 | 1E EB 67 3C 7E C0 FF 97 2A D2 2F CB 4A DE F7 F4
0050 | 53 71 57 78 54 35 91 27 A9 CD AB C2 03 19 B7 12
0060 | 76 BE A5 83 FE 8C 27 96 66 D3 08 F4 17 CC 31 B8
0070 | 23 28 8D 3D A3 03 40 2F D2 E1 61 03 06 F2 07 CF
0080 | DA F0 9D C5 9A 78 1A 34 F6 6C 20 AD 2A 06 A6 7F
0090 | A3 AF 2C 25 CC 44 2D 63 C5 59 31 83 74 17 0C 4B
00A0 | 66 8F 91 E2 02 42 36 E1 89 1A AB BE AC 30 B2 17
00B0 | 1B 4F 65 BF F4 64 5B 90 F9 14 9A EB 54 B2 F4 6E
00C0 | AE 53 38 3E 75 57 93 36 A5 DD 32 A6 28 60 98 48
00D0 | AC 9B D8 EE 29 8A 9E A1 46 ED 7A A2 A0 4C DE F5
00E0 | B4 44 9D BF 68 A0 2F 9A AD 55 3E F5 E7 1A D0 56
00F0 | B8 BD 8D 23 F6 9E 79 67 B5 D5 8A B0 50 0F 94 CB
0100 | 87 11 51 94 E5 9D E9 8C 28 70 50 08 A5 0B C7 04
0110 | A8 58 A6 CF E3 BE 3F F4 7D D8 6A 4A 57 8C 5B FE
0120 | 33 72 25 EC FC 75 EC BB 93 FC A8 1D 4D 8B 27 EC</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>client_DH_inner_data#6643b654 nonce:int128 server_nonce:int128 retry_id:long g_b:string = Client_DH_Inner_Data;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(client_DH_inner_data)</td>
<td>0, 4</td>
<td><code>54b64366</code></td>
<td><em>client_DH_inner_data</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>4, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>20, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>g_b</td>
<td>36, 260</td>
<td><code>FE0001008FEEB8FCBE4C076FCAF8D7FE</code> <code>AA8FBF671EEB673C7EC0FF972AD22FCB</code> <code>4ADEF7F45371577854359127A9CDABC2</code> <code>0319B71276BEA583FE8C279666D308F4</code> <code>17CC31B823288D3DA303402FD2E16103</code> <code>06F207CFDAF09DC59A781A34F66C20AD</code> <code>2A06A67FA3AF2C25CC442D63C5593183</code> <code>74170C4B668F91E2024236E1891AABBE</code> <code>AC30B2171B4F65BFF4645B90F9149AEB</code> <code>54B2F46EAE53383E75579336A5DD32A6</code> <code>28609848AC9BD8EE298A9EA146ED7AA2</code> <code>A04CDEF5B4449DBF68A02F9AAD553EF5</code> <code>E71AD056B8BD8D23F69E7967B5D58AB0</code> <code>500F94CB87115194E59DE98C28705008</code> <code>A50BC704A858A6CFE3BE3FF47DD86A4A</code> <code>578C5BFE337225ECFC75ECBB93FCA81D</code><br> <code>4D8B27EC</code></td>
<td>Single-byte prefix denoting length, a 256-byte (2048-bit) string, and zero bytes of padding</td>
</tr>
<tr>
<td>retry_id</td>
<td>296, 8</td>
<td><code>0000000000000000</code></td>
<td>Equal to zero at the time of the first attempt; otherwise, it is equal to <code>auth_key_aux_hash</code> from the previous failed attempt (see Item 7).</td>
</tr>
</tbody>
</table>
<!-- end client_DH_inner_data -->
<p>The serialization of <em>Client_DH_Inner_Data</em> produces a string <strong>data</strong>. This is used to generate <strong>encrypted_data</strong> as specified in <a href="#7-client-computes-random-2048-bit-number-b-using-a-sufficient-amount-of-entropy-and-sends-the-server-a-message">step 6</a>, using the following inputs:</p>
<!-- start client_DH_inner_data_input -->
<pre><code>data = 54B643668ED5B0D5FC3F1AD119E488AC4ADD87D4FB3907857422B86FF910D0D6A08AE2A00000000000000000FE0001008FEEB8FCBE4C076FCAF8D7FEAA8FBF671EEB673C7EC0FF972AD22FCB4ADEF7F45371577854359127A9CDABC20319B71276BEA583FE8C279666D308F417CC31B823288D3DA303402FD2E1610306F207CFDAF09DC59A781A34F66C20AD2A06A67FA3AF2C25CC442D63C559318374170C4B668F91E2024236E1891AABBEAC30B2171B4F65BFF4645B90F9149AEB54B2F46EAE53383E75579336A5DD32A628609848AC9BD8EE298A9EA146ED7AA2A04CDEF5B4449DBF68A02F9AAD553EF5E71AD056B8BD8D23F69E7967B5D58AB0500F94CB87115194E59DE98C28705008A50BC704A858A6CFE3BE3FF47DD86A4A578C5BFE337225ECFC75ECBB93FCA81D4D8B27EC
padding = 8264E4FAF9AC8824D537453A
tmp_aes_key = 37D55E06E93750E2B62CF4DE82CB9AEAC6FA47230F5FA46BF7F82DCA315D873B
tmp_aes_iv = 6878ACD46DEE76DEB00805930FB5C5F41534D686B2D5F3028F528AB00B78F95F</code></pre>
<!-- end client_DH_inner_data_input -->
<p>Process:</p>
<pre><code>data_with_hash := SHA1(data) + data + padding (0-15 random bytes such that total length is divisible by 16)
encrypted_data := AES256_ige_encrypt (data_with_hash, tmp_aes_key, tmp_aes_iv);</code></pre>
<p>Output:</p>
<!-- start client_DH_inner_data_output -->
<pre><code>encrypted_data = D984FEB23953572FE11B51639E21972DA8025AEE25CEB566F22CF5B3222C71F13DCFD397A4F9A77F75D3A9F6CCC49A9ED14C48E17112B429D5AB73639DCB97D8BEE8FCEB92B5D05FB263FEE1DBE4923625BFF24A543D228AE2CA08C517C89E9413011329A87E0CAB27446048302889E872DE058C757689DBCB366BE5ADF7AF4E10A2EC2301E332689B5C6F522AD82A1D6049936C658E6A2AB7145D96D39E89ABB66E86C7C165EB8BFB2C11F86B7601C0FC44315191A5710D4CB3D3B344E5E2864EAF0FCBEFE15F2A10E48FE50B7F6FB42E05DBA90D7BDC97251C28CDBD5C7236EFA186D4EE03CDCA0FCF8453DFFEE55EFAE4478C4CA2080D261B10A8FDA4339C967E82EF15B93587FB49FAC9BD4083A5A18D0B144997C72402799AD2DFD6B2E5413C769D6F104C699D8527CC77FAB1916EC054FFAE47604B0E0A8F71EA3CBF5C5B6C8F0BA2B374F45538EC35E5A6117B</code></pre>
<!-- end client_DH_inner_data_output -->
<p>The length of the final string is 336 bytes.</p>
<h6>7.2) set_client_DH_params query</h6>
<!-- start set_client_DH_params -->
<p>Sent payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 18 31 0F 00 8C 55 DD 68
0010 | 78 01 00 00 1F 5F 04 F5 8E D5 B0 D5 FC 3F 1A D1
0020 | 19 E4 88 AC 4A DD 87 D4 FB 39 07 85 74 22 B8 6F
0030 | F9 10 D0 D6 A0 8A E2 A0 FE 50 01 00 D9 84 FE B2
0040 | 39 53 57 2F E1 1B 51 63 9E 21 97 2D A8 02 5A EE
0050 | 25 CE B5 66 F2 2C F5 B3 22 2C 71 F1 3D CF D3 97
0060 | A4 F9 A7 7F 75 D3 A9 F6 CC C4 9A 9E D1 4C 48 E1
0070 | 71 12 B4 29 D5 AB 73 63 9D CB 97 D8 BE E8 FC EB
0080 | 92 B5 D0 5F B2 63 FE E1 DB E4 92 36 25 BF F2 4A
0090 | 54 3D 22 8A E2 CA 08 C5 17 C8 9E 94 13 01 13 29
00A0 | A8 7E 0C AB 27 44 60 48 30 28 89 E8 72 DE 05 8C
00B0 | 75 76 89 DB CB 36 6B E5 AD F7 AF 4E 10 A2 EC 23
00C0 | 01 E3 32 68 9B 5C 6F 52 2A D8 2A 1D 60 49 93 6C
00D0 | 65 8E 6A 2A B7 14 5D 96 D3 9E 89 AB B6 6E 86 C7
00E0 | C1 65 EB 8B FB 2C 11 F8 6B 76 01 C0 FC 44 31 51
00F0 | 91 A5 71 0D 4C B3 D3 B3 44 E5 E2 86 4E AF 0F CB
0100 | EF E1 5F 2A 10 E4 8F E5 0B 7F 6F B4 2E 05 DB A9
0110 | 0D 7B DC 97 25 1C 28 CD BD 5C 72 36 EF A1 86 D4
0120 | EE 03 CD CA 0F CF 84 53 DF FE E5 5E FA E4 47 8C
0130 | 4C A2 08 0D 26 1B 10 A8 FD A4 33 9C 96 7E 82 EF
0140 | 15 B9 35 87 FB 49 FA C9 BD 40 83 A5 A1 8D 0B 14
0150 | 49 97 C7 24 02 79 9A D2 DF D6 B2 E5 41 3C 76 9D
0160 | 6F 10 4C 69 9D 85 27 CC 77 FA B1 91 6E C0 54 FF
0170 | AE 47 60 4B 0E 0A 8F 71 EA 3C BF 5C 5B 6C 8F 0B
0180 | A2 B3 74 F4 55 38 EC 35 E5 A6 11 7B</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:string = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>18310F008C55DD68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>78010000</code> (376 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(set_client_DH_params)</td>
<td>20, 4</td>
<td><code>1f5f04f5</code></td>
<td><em>set_client_DH_params</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>encrypted_data</td>
<td>56, 340</td>
<td><code>FE500100D984FEB23953572FE11B5163</code> <code>9E21972DA8025AEE25CEB566F22CF5B3</code> <code>222C71F13DCFD397A4F9A77F75D3A9F6</code> <code>CCC49A9ED14C48E17112B429D5AB7363</code> <code>9DCB97D8BEE8FCEB92B5D05FB263FEE1</code> <code>DBE4923625BFF24A543D228AE2CA08C5</code> <code>17C89E9413011329A87E0CAB27446048</code> <code>302889E872DE058C757689DBCB366BE5</code> <code>ADF7AF4E10A2EC2301E332689B5C6F52</code> <code>2AD82A1D6049936C658E6A2AB7145D96</code> <code>D39E89ABB66E86C7C165EB8BFB2C11F8</code> <code>6B7601C0FC44315191A5710D4CB3D3B3</code> <code>44E5E2864EAF0FCBEFE15F2A10E48FE5</code> <code>0B7F6FB42E05DBA90D7BDC97251C28CD</code> <code>BD5C7236EFA186D4EE03CDCA0FCF8453</code> <code>DFFEE55EFAE4478C4CA2080D261B10A8</code> <code>FDA4339C967E82EF15B93587FB49FAC9</code> <code>BD4083A5A18D0B144997C72402799AD2</code> <code>DFD6B2E5413C769D6F104C699D8527CC</code> <code>77FAB1916EC054FFAE47604B0E0A8F71</code> <code>EA3CBF5C5B6C8F0BA2B374F45538EC35</code><br> <code>E5A6117B</code></td>
<td>Encrypted client_DH_inner_data generated previously, serialized as a TL byte string</td>
</tr>
</tbody>
</table>
<!-- end set_client_DH_params -->
<h5><a class="anchor" href="#8-auth-key-generation" id="8-auth-key-generation" name="8-auth-key-generation"><i class="anchor-icon"></i></a>8) Auth key generation</h5>
<p>The client computes the auth_key using formula <code>g_a^b mod dh_prime</code>:</p>
<!-- start auth_key -->
<pre><code>auth_key = 2DCBD362E497404D823F60FCFE30B5F176148521FC3C6060A2DC691D48935BBAF18F6441CF98C4EEF38E68643E2F4B0034E94D8B84021A41FAF3A8334FC243798CA38604B4E27BDC936FBF6CBA08EEF65A733D85F0B1523C082C903901C51C84FAFDD9525961AFC2CDDF44BF96B152DD5D7E7D5B440741F61E14051286D4C84DE1AD1486C26336C1F160E77BB8843FDF01C85B2B40C73B8DC19A989D892842DC313F1EBF8604F03C68C7DB50A0402314B8F0D207D430A1C6FFF7DD434778D079FECA257388871CC98D51F634ADBCEB44C0E0C0C691E6977E0E9292793AFAD99A117534F8D2F0B3B717069DB1402634C395A639725D947C781777527DB9C9D519</code></pre>
<!-- end auth_key -->
<h5><a class="anchor" href="#9-final-server-reply" id="9-final-server-reply" name="9-final-server-reply"><i class="anchor-icon"></i></a>9) Final server reply</h5>
<p>The server verifies and confirms that auth_key_hash is unique: since it's unique, it replies with the following:</p>
<!-- start dh_gen_ok -->
<p>Received payload (excluding transport headers/trailers):</p>
<pre><code>0000 | 00 00 00 00 00 00 00 00 01 F0 2A B6 8D 55 DD 68
0010 | 34 00 00 00 34 F7 CB 3B 8E D5 B0 D5 FC 3F 1A D1
0020 | 19 E4 88 AC 4A DD 87 D4 FB 39 07 85 74 22 B8 6F
0030 | F9 10 D0 D6 A0 8A E2 A0 90 EB 29 ED 5F 2D F1 FA
0040 | D7 21 B9 DB F4 4F 14 BA</code></pre>
<p>Payload (de)serialization:</p>
<pre><code>dh_gen_ok#3bcbf734 nonce:int128 server_nonce:int128 new_nonce_hash1:int128 = Set_client_DH_params_answer;</code></pre>
<table class="table">
<thead>
<tr>
<th>Parameter</th>
<th>Offset, Length in bytes</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth_key_id</td>
<td>0, 8</td>
<td><code>0000000000000000</code></td>
<td>0 since the message is in plain text</td>
</tr>
<tr>
<td>message_id</td>
<td>8, 8</td>
<td><code>01F02AB68D55DD68</code></td>
<td>Message ID generated as specified <a href="/mtproto/description#message-identifier-msg-id">here »</a> (unixtime() &lt;&lt; 32) + (N*4)</td>
</tr>
<tr>
<td>message_length</td>
<td>16, 4</td>
<td><code>34000000</code> (52 in decimal)</td>
<td>Message body length</td>
</tr>
<tr>
<td>%(dh_gen_ok)</td>
<td>20, 4</td>
<td><code>34f7cb3b</code></td>
<td><em>dh_gen_ok</em> constructor number from TL schema</td>
</tr>
<tr>
<td>nonce</td>
<td>24, 16</td>
<td><code>8ED5B0D5FC3F1AD119E488AC4ADD87D4</code></td>
<td>Value generated by client in Step 1</td>
</tr>
<tr>
<td>server_nonce</td>
<td>40, 16</td>
<td><code>FB3907857422B86FF910D0D6A08AE2A0</code></td>
<td>Value received from server in Step 2</td>
</tr>
<tr>
<td>new_nonce_hash1</td>
<td>56, 16</td>
<td><code>90EB29ED5F2DF1FAD721B9DBF44F14BA</code></td>
<td>The 128 lower-order bits of SHA1 of the byte string derived from the <code>new_nonce</code> string by adding a single byte with the value of 1, 2, or 3, and followed by another 8 bytes with <code>auth_key_aux_hash</code>. Different values are required to prevent an intruder from changing server response dh_gen_ok into dh_gen_retry.</td>
</tr>
</tbody>
</table>
<!-- end dh_gen_ok --></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

